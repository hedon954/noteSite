<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes 数据存储 | Hedon</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/noteSite/favicon.ico">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/noteSite/assets/css/0.styles.0f3b0cbd.css" as="style"><link rel="preload" href="/noteSite/assets/js/app.982938bc.js" as="script"><link rel="preload" href="/noteSite/assets/js/2.6ff1f0ac.js" as="script"><link rel="preload" href="/noteSite/assets/js/290.a4aae21a.js" as="script"><link rel="prefetch" href="/noteSite/assets/js/10.628f2b18.js"><link rel="prefetch" href="/noteSite/assets/js/100.7d306b5e.js"><link rel="prefetch" href="/noteSite/assets/js/101.160551e6.js"><link rel="prefetch" href="/noteSite/assets/js/102.7c6f9e17.js"><link rel="prefetch" href="/noteSite/assets/js/103.fff19bb7.js"><link rel="prefetch" href="/noteSite/assets/js/104.d01908f8.js"><link rel="prefetch" href="/noteSite/assets/js/105.80c271ab.js"><link rel="prefetch" href="/noteSite/assets/js/106.89c9d739.js"><link rel="prefetch" href="/noteSite/assets/js/107.1cb7ab0b.js"><link rel="prefetch" href="/noteSite/assets/js/108.61f8fec1.js"><link rel="prefetch" href="/noteSite/assets/js/109.992ef243.js"><link rel="prefetch" href="/noteSite/assets/js/11.0f1631cd.js"><link rel="prefetch" href="/noteSite/assets/js/110.efbfb9cd.js"><link rel="prefetch" href="/noteSite/assets/js/111.9d73b118.js"><link rel="prefetch" href="/noteSite/assets/js/112.b23eb722.js"><link rel="prefetch" href="/noteSite/assets/js/113.325c98fb.js"><link rel="prefetch" href="/noteSite/assets/js/114.9ccf23ae.js"><link rel="prefetch" href="/noteSite/assets/js/115.37da2c1c.js"><link rel="prefetch" href="/noteSite/assets/js/116.74f2e867.js"><link rel="prefetch" href="/noteSite/assets/js/117.34460619.js"><link rel="prefetch" href="/noteSite/assets/js/118.d94b2b0e.js"><link rel="prefetch" href="/noteSite/assets/js/119.c7b9bd35.js"><link rel="prefetch" href="/noteSite/assets/js/12.c90a7522.js"><link rel="prefetch" href="/noteSite/assets/js/120.f347447d.js"><link rel="prefetch" href="/noteSite/assets/js/121.5e4abb40.js"><link rel="prefetch" href="/noteSite/assets/js/122.933551fd.js"><link rel="prefetch" href="/noteSite/assets/js/123.ddc60b06.js"><link rel="prefetch" href="/noteSite/assets/js/124.f5caf8d5.js"><link rel="prefetch" href="/noteSite/assets/js/125.813aa0ae.js"><link rel="prefetch" href="/noteSite/assets/js/126.d6d26b8a.js"><link rel="prefetch" href="/noteSite/assets/js/127.8dd077f9.js"><link rel="prefetch" href="/noteSite/assets/js/128.5d433104.js"><link rel="prefetch" href="/noteSite/assets/js/129.a16ebab1.js"><link rel="prefetch" href="/noteSite/assets/js/13.f5480015.js"><link rel="prefetch" href="/noteSite/assets/js/130.7ae16ab0.js"><link rel="prefetch" href="/noteSite/assets/js/131.42024b9f.js"><link rel="prefetch" href="/noteSite/assets/js/132.146c6bb0.js"><link rel="prefetch" href="/noteSite/assets/js/133.9c656bda.js"><link rel="prefetch" href="/noteSite/assets/js/134.b789212a.js"><link rel="prefetch" href="/noteSite/assets/js/135.d5293e46.js"><link rel="prefetch" href="/noteSite/assets/js/136.30394187.js"><link rel="prefetch" href="/noteSite/assets/js/137.732aeac4.js"><link rel="prefetch" href="/noteSite/assets/js/138.68be92f0.js"><link rel="prefetch" href="/noteSite/assets/js/139.1457f144.js"><link rel="prefetch" href="/noteSite/assets/js/14.38b5da2a.js"><link rel="prefetch" href="/noteSite/assets/js/140.89b7c848.js"><link rel="prefetch" href="/noteSite/assets/js/141.31c48ab7.js"><link rel="prefetch" href="/noteSite/assets/js/142.3e5352bb.js"><link rel="prefetch" href="/noteSite/assets/js/143.d4a915cc.js"><link rel="prefetch" href="/noteSite/assets/js/144.e43553ca.js"><link rel="prefetch" href="/noteSite/assets/js/145.8ee422be.js"><link rel="prefetch" href="/noteSite/assets/js/146.5cbc525c.js"><link rel="prefetch" href="/noteSite/assets/js/147.facdbe6f.js"><link rel="prefetch" href="/noteSite/assets/js/148.9a8c077e.js"><link rel="prefetch" href="/noteSite/assets/js/149.4d4e9cbc.js"><link rel="prefetch" href="/noteSite/assets/js/15.6fd503b0.js"><link rel="prefetch" href="/noteSite/assets/js/150.b8f1f558.js"><link rel="prefetch" href="/noteSite/assets/js/151.8330bf08.js"><link rel="prefetch" href="/noteSite/assets/js/152.761ff2bd.js"><link rel="prefetch" href="/noteSite/assets/js/153.720bac4e.js"><link rel="prefetch" href="/noteSite/assets/js/154.7d43471a.js"><link rel="prefetch" href="/noteSite/assets/js/155.ecaf0258.js"><link rel="prefetch" href="/noteSite/assets/js/156.9e9ee316.js"><link rel="prefetch" href="/noteSite/assets/js/157.55d37bef.js"><link rel="prefetch" href="/noteSite/assets/js/158.013d5bb9.js"><link rel="prefetch" href="/noteSite/assets/js/159.5bf7d03b.js"><link rel="prefetch" href="/noteSite/assets/js/16.ba5205e2.js"><link rel="prefetch" href="/noteSite/assets/js/160.6341dce8.js"><link rel="prefetch" href="/noteSite/assets/js/161.6fa4d730.js"><link rel="prefetch" href="/noteSite/assets/js/162.258c5e92.js"><link rel="prefetch" href="/noteSite/assets/js/163.f730f7ed.js"><link rel="prefetch" href="/noteSite/assets/js/164.f9b86d26.js"><link rel="prefetch" href="/noteSite/assets/js/165.b3e9162f.js"><link rel="prefetch" href="/noteSite/assets/js/166.d6681897.js"><link rel="prefetch" href="/noteSite/assets/js/167.6217dcc0.js"><link rel="prefetch" href="/noteSite/assets/js/168.cb8a769d.js"><link rel="prefetch" href="/noteSite/assets/js/169.1ee8576a.js"><link rel="prefetch" href="/noteSite/assets/js/17.204dc718.js"><link rel="prefetch" href="/noteSite/assets/js/170.12ef6829.js"><link rel="prefetch" href="/noteSite/assets/js/171.fc257906.js"><link rel="prefetch" href="/noteSite/assets/js/172.a5b4c485.js"><link rel="prefetch" href="/noteSite/assets/js/173.444e623e.js"><link rel="prefetch" href="/noteSite/assets/js/174.4d26301c.js"><link rel="prefetch" href="/noteSite/assets/js/175.279b00a9.js"><link rel="prefetch" href="/noteSite/assets/js/176.8164f7b6.js"><link rel="prefetch" href="/noteSite/assets/js/177.8e7566fe.js"><link rel="prefetch" href="/noteSite/assets/js/178.c7947b50.js"><link rel="prefetch" href="/noteSite/assets/js/179.1429b7a9.js"><link rel="prefetch" href="/noteSite/assets/js/18.b9adc259.js"><link rel="prefetch" href="/noteSite/assets/js/180.c794ae05.js"><link rel="prefetch" href="/noteSite/assets/js/181.3a1626eb.js"><link rel="prefetch" href="/noteSite/assets/js/182.6f3e1601.js"><link rel="prefetch" href="/noteSite/assets/js/183.598b59d3.js"><link rel="prefetch" href="/noteSite/assets/js/184.e969f132.js"><link rel="prefetch" href="/noteSite/assets/js/185.388b5ce0.js"><link rel="prefetch" href="/noteSite/assets/js/186.0f673ceb.js"><link rel="prefetch" href="/noteSite/assets/js/187.36881f36.js"><link rel="prefetch" href="/noteSite/assets/js/188.6a799b2d.js"><link rel="prefetch" href="/noteSite/assets/js/189.e579eda6.js"><link rel="prefetch" href="/noteSite/assets/js/19.811bf034.js"><link rel="prefetch" href="/noteSite/assets/js/190.7506fadf.js"><link rel="prefetch" href="/noteSite/assets/js/191.106f242e.js"><link rel="prefetch" href="/noteSite/assets/js/192.d6aceb24.js"><link rel="prefetch" href="/noteSite/assets/js/193.2ebba9d2.js"><link rel="prefetch" href="/noteSite/assets/js/194.13f462e4.js"><link rel="prefetch" href="/noteSite/assets/js/195.754d3c13.js"><link rel="prefetch" href="/noteSite/assets/js/196.364755c8.js"><link rel="prefetch" href="/noteSite/assets/js/197.e3ca3386.js"><link rel="prefetch" href="/noteSite/assets/js/198.3d3a0db6.js"><link rel="prefetch" href="/noteSite/assets/js/199.ef0ba7a6.js"><link rel="prefetch" href="/noteSite/assets/js/20.1e1303e3.js"><link rel="prefetch" href="/noteSite/assets/js/200.00447b17.js"><link rel="prefetch" href="/noteSite/assets/js/201.355daaf1.js"><link rel="prefetch" href="/noteSite/assets/js/202.29520685.js"><link rel="prefetch" href="/noteSite/assets/js/203.6ae4c241.js"><link rel="prefetch" href="/noteSite/assets/js/204.0673f94d.js"><link rel="prefetch" href="/noteSite/assets/js/205.f15a43a6.js"><link rel="prefetch" href="/noteSite/assets/js/206.ac53bd28.js"><link rel="prefetch" href="/noteSite/assets/js/207.14a713da.js"><link rel="prefetch" href="/noteSite/assets/js/208.51e6a79c.js"><link rel="prefetch" href="/noteSite/assets/js/209.decb8a3c.js"><link rel="prefetch" href="/noteSite/assets/js/21.441725c7.js"><link rel="prefetch" href="/noteSite/assets/js/210.456e406e.js"><link rel="prefetch" href="/noteSite/assets/js/211.7f24d463.js"><link rel="prefetch" href="/noteSite/assets/js/212.3aead310.js"><link rel="prefetch" href="/noteSite/assets/js/213.c35a3c6e.js"><link rel="prefetch" href="/noteSite/assets/js/214.163c76cb.js"><link rel="prefetch" href="/noteSite/assets/js/215.cf51c97a.js"><link rel="prefetch" href="/noteSite/assets/js/216.6724bf2f.js"><link rel="prefetch" href="/noteSite/assets/js/217.521a6e8c.js"><link rel="prefetch" href="/noteSite/assets/js/218.9c9d5dda.js"><link rel="prefetch" href="/noteSite/assets/js/219.73cf48d0.js"><link rel="prefetch" href="/noteSite/assets/js/22.f7b382c7.js"><link rel="prefetch" href="/noteSite/assets/js/220.766c1467.js"><link rel="prefetch" href="/noteSite/assets/js/221.19ae02a5.js"><link rel="prefetch" href="/noteSite/assets/js/222.68582cec.js"><link rel="prefetch" href="/noteSite/assets/js/223.616685ad.js"><link rel="prefetch" href="/noteSite/assets/js/224.c39a2b5a.js"><link rel="prefetch" href="/noteSite/assets/js/225.e417d2b6.js"><link rel="prefetch" href="/noteSite/assets/js/226.d91de7a1.js"><link rel="prefetch" href="/noteSite/assets/js/227.2f317234.js"><link rel="prefetch" href="/noteSite/assets/js/228.6966fc2b.js"><link rel="prefetch" href="/noteSite/assets/js/229.dbe59769.js"><link rel="prefetch" href="/noteSite/assets/js/23.8f0590d2.js"><link rel="prefetch" href="/noteSite/assets/js/230.ae79a6b7.js"><link rel="prefetch" href="/noteSite/assets/js/231.a5a3c809.js"><link rel="prefetch" href="/noteSite/assets/js/232.c6a21570.js"><link rel="prefetch" href="/noteSite/assets/js/233.e7f3150a.js"><link rel="prefetch" href="/noteSite/assets/js/234.67230dec.js"><link rel="prefetch" href="/noteSite/assets/js/235.3bf9527b.js"><link rel="prefetch" href="/noteSite/assets/js/236.41a0cf2f.js"><link rel="prefetch" href="/noteSite/assets/js/237.08d7ccd1.js"><link rel="prefetch" href="/noteSite/assets/js/238.611d9a1f.js"><link rel="prefetch" href="/noteSite/assets/js/239.c2136c89.js"><link rel="prefetch" href="/noteSite/assets/js/24.482618e6.js"><link rel="prefetch" href="/noteSite/assets/js/240.3c6819ab.js"><link rel="prefetch" href="/noteSite/assets/js/241.704d3e6b.js"><link rel="prefetch" href="/noteSite/assets/js/242.eb880d58.js"><link rel="prefetch" href="/noteSite/assets/js/243.47e12efe.js"><link rel="prefetch" href="/noteSite/assets/js/244.43f072eb.js"><link rel="prefetch" href="/noteSite/assets/js/245.0c34b77d.js"><link rel="prefetch" href="/noteSite/assets/js/246.0de68b1d.js"><link rel="prefetch" href="/noteSite/assets/js/247.42b44bd2.js"><link rel="prefetch" href="/noteSite/assets/js/248.40ec38ed.js"><link rel="prefetch" href="/noteSite/assets/js/249.5b79a578.js"><link rel="prefetch" href="/noteSite/assets/js/25.14b70d0b.js"><link rel="prefetch" href="/noteSite/assets/js/250.d1f10c25.js"><link rel="prefetch" href="/noteSite/assets/js/251.b15f5a76.js"><link rel="prefetch" href="/noteSite/assets/js/252.afecc36d.js"><link rel="prefetch" href="/noteSite/assets/js/253.bf747d9c.js"><link rel="prefetch" href="/noteSite/assets/js/254.42639d54.js"><link rel="prefetch" href="/noteSite/assets/js/255.025e2caa.js"><link rel="prefetch" href="/noteSite/assets/js/256.a4e88e55.js"><link rel="prefetch" href="/noteSite/assets/js/257.da0c6776.js"><link rel="prefetch" href="/noteSite/assets/js/258.fd563b44.js"><link rel="prefetch" href="/noteSite/assets/js/259.37ddc4bb.js"><link rel="prefetch" href="/noteSite/assets/js/26.3824ff3c.js"><link rel="prefetch" href="/noteSite/assets/js/260.7859cb26.js"><link rel="prefetch" href="/noteSite/assets/js/261.fa5308d8.js"><link rel="prefetch" href="/noteSite/assets/js/262.d7d7ee1a.js"><link rel="prefetch" href="/noteSite/assets/js/263.4015b1c1.js"><link rel="prefetch" href="/noteSite/assets/js/264.b2107564.js"><link rel="prefetch" href="/noteSite/assets/js/265.c4a53f75.js"><link rel="prefetch" href="/noteSite/assets/js/266.0e1ef200.js"><link rel="prefetch" href="/noteSite/assets/js/267.e163d745.js"><link rel="prefetch" href="/noteSite/assets/js/268.77e888dc.js"><link rel="prefetch" href="/noteSite/assets/js/269.46036138.js"><link rel="prefetch" href="/noteSite/assets/js/27.c31353e5.js"><link rel="prefetch" href="/noteSite/assets/js/270.a6458943.js"><link rel="prefetch" href="/noteSite/assets/js/271.e230b419.js"><link rel="prefetch" href="/noteSite/assets/js/272.13f4e8d5.js"><link rel="prefetch" href="/noteSite/assets/js/273.9a4e7dd3.js"><link rel="prefetch" href="/noteSite/assets/js/274.3aa60dcb.js"><link rel="prefetch" href="/noteSite/assets/js/275.551d6f77.js"><link rel="prefetch" href="/noteSite/assets/js/276.77d06f47.js"><link rel="prefetch" href="/noteSite/assets/js/277.dd58ec69.js"><link rel="prefetch" href="/noteSite/assets/js/278.dbbd2550.js"><link rel="prefetch" href="/noteSite/assets/js/279.8ab0ac93.js"><link rel="prefetch" href="/noteSite/assets/js/28.8963a888.js"><link rel="prefetch" href="/noteSite/assets/js/280.b4553e38.js"><link rel="prefetch" href="/noteSite/assets/js/281.e5167fd3.js"><link rel="prefetch" href="/noteSite/assets/js/282.a0117b49.js"><link rel="prefetch" href="/noteSite/assets/js/283.393fd4e0.js"><link rel="prefetch" href="/noteSite/assets/js/284.2c742f89.js"><link rel="prefetch" href="/noteSite/assets/js/285.6da585c3.js"><link rel="prefetch" href="/noteSite/assets/js/286.d9c24565.js"><link rel="prefetch" href="/noteSite/assets/js/287.fe345bbb.js"><link rel="prefetch" href="/noteSite/assets/js/288.d042012e.js"><link rel="prefetch" href="/noteSite/assets/js/289.46c14e72.js"><link rel="prefetch" href="/noteSite/assets/js/29.6cba673a.js"><link rel="prefetch" href="/noteSite/assets/js/291.7b3a2d3c.js"><link rel="prefetch" href="/noteSite/assets/js/292.5d978984.js"><link rel="prefetch" href="/noteSite/assets/js/293.f2441bb1.js"><link rel="prefetch" href="/noteSite/assets/js/294.de71cf3e.js"><link rel="prefetch" href="/noteSite/assets/js/295.3b97f4ab.js"><link rel="prefetch" href="/noteSite/assets/js/296.3205eaa3.js"><link rel="prefetch" href="/noteSite/assets/js/297.ebf18f1d.js"><link rel="prefetch" href="/noteSite/assets/js/298.900bfcd7.js"><link rel="prefetch" href="/noteSite/assets/js/299.9ecaecb3.js"><link rel="prefetch" href="/noteSite/assets/js/3.62138a35.js"><link rel="prefetch" href="/noteSite/assets/js/30.7a286695.js"><link rel="prefetch" href="/noteSite/assets/js/300.0ac50035.js"><link rel="prefetch" href="/noteSite/assets/js/301.3db350d4.js"><link rel="prefetch" href="/noteSite/assets/js/302.8851cb81.js"><link rel="prefetch" href="/noteSite/assets/js/303.c0b1fae8.js"><link rel="prefetch" href="/noteSite/assets/js/304.cee6c429.js"><link rel="prefetch" href="/noteSite/assets/js/305.4fb0190f.js"><link rel="prefetch" href="/noteSite/assets/js/306.556813b5.js"><link rel="prefetch" href="/noteSite/assets/js/307.3337f911.js"><link rel="prefetch" href="/noteSite/assets/js/308.ab0b26a2.js"><link rel="prefetch" href="/noteSite/assets/js/309.25e1b196.js"><link rel="prefetch" href="/noteSite/assets/js/31.0a3bb7fc.js"><link rel="prefetch" href="/noteSite/assets/js/310.1b80da75.js"><link rel="prefetch" href="/noteSite/assets/js/311.f15a50be.js"><link rel="prefetch" href="/noteSite/assets/js/312.ffa651d8.js"><link rel="prefetch" href="/noteSite/assets/js/32.247ecfd6.js"><link rel="prefetch" href="/noteSite/assets/js/33.0d8d1ace.js"><link rel="prefetch" href="/noteSite/assets/js/34.d451f5d8.js"><link rel="prefetch" href="/noteSite/assets/js/35.956398a7.js"><link rel="prefetch" href="/noteSite/assets/js/36.aadcf7c5.js"><link rel="prefetch" href="/noteSite/assets/js/37.d4153187.js"><link rel="prefetch" href="/noteSite/assets/js/38.a302264c.js"><link rel="prefetch" href="/noteSite/assets/js/39.016e8561.js"><link rel="prefetch" href="/noteSite/assets/js/4.a61e4cea.js"><link rel="prefetch" href="/noteSite/assets/js/40.bb4e9d8d.js"><link rel="prefetch" href="/noteSite/assets/js/41.3bff4415.js"><link rel="prefetch" href="/noteSite/assets/js/42.8c1c0cec.js"><link rel="prefetch" href="/noteSite/assets/js/43.59446b08.js"><link rel="prefetch" href="/noteSite/assets/js/44.4385e348.js"><link rel="prefetch" href="/noteSite/assets/js/45.c6ba8a4d.js"><link rel="prefetch" href="/noteSite/assets/js/46.af6bc4ca.js"><link rel="prefetch" href="/noteSite/assets/js/47.1afd53d1.js"><link rel="prefetch" href="/noteSite/assets/js/48.9c553cac.js"><link rel="prefetch" href="/noteSite/assets/js/49.992692d4.js"><link rel="prefetch" href="/noteSite/assets/js/5.2bccd6df.js"><link rel="prefetch" href="/noteSite/assets/js/50.707d7a0d.js"><link rel="prefetch" href="/noteSite/assets/js/51.6d728c33.js"><link rel="prefetch" href="/noteSite/assets/js/52.9b50022b.js"><link rel="prefetch" href="/noteSite/assets/js/53.9b4a076a.js"><link rel="prefetch" href="/noteSite/assets/js/54.d1563c6b.js"><link rel="prefetch" href="/noteSite/assets/js/55.81a03e44.js"><link rel="prefetch" href="/noteSite/assets/js/56.c9fddb70.js"><link rel="prefetch" href="/noteSite/assets/js/57.106c99d0.js"><link rel="prefetch" href="/noteSite/assets/js/58.d28c84f2.js"><link rel="prefetch" href="/noteSite/assets/js/59.285a831b.js"><link rel="prefetch" href="/noteSite/assets/js/6.f3d86aa7.js"><link rel="prefetch" href="/noteSite/assets/js/60.42583b94.js"><link rel="prefetch" href="/noteSite/assets/js/61.4949dafc.js"><link rel="prefetch" href="/noteSite/assets/js/62.df072eca.js"><link rel="prefetch" href="/noteSite/assets/js/63.0ccb8bdb.js"><link rel="prefetch" href="/noteSite/assets/js/64.5935571d.js"><link rel="prefetch" href="/noteSite/assets/js/65.df8e926a.js"><link rel="prefetch" href="/noteSite/assets/js/66.26019a22.js"><link rel="prefetch" href="/noteSite/assets/js/67.d70ff038.js"><link rel="prefetch" href="/noteSite/assets/js/68.44700a00.js"><link rel="prefetch" href="/noteSite/assets/js/69.a9ca22d1.js"><link rel="prefetch" href="/noteSite/assets/js/7.f685cce4.js"><link rel="prefetch" href="/noteSite/assets/js/70.69059b94.js"><link rel="prefetch" href="/noteSite/assets/js/71.c6865a58.js"><link rel="prefetch" href="/noteSite/assets/js/72.effa60ca.js"><link rel="prefetch" href="/noteSite/assets/js/73.04ac42aa.js"><link rel="prefetch" href="/noteSite/assets/js/74.2b837ef2.js"><link rel="prefetch" href="/noteSite/assets/js/75.efc117db.js"><link rel="prefetch" href="/noteSite/assets/js/76.5990ce89.js"><link rel="prefetch" href="/noteSite/assets/js/77.c514ff0c.js"><link rel="prefetch" href="/noteSite/assets/js/78.3784c459.js"><link rel="prefetch" href="/noteSite/assets/js/79.0c4367c4.js"><link rel="prefetch" href="/noteSite/assets/js/8.976ce270.js"><link rel="prefetch" href="/noteSite/assets/js/80.d051aec2.js"><link rel="prefetch" href="/noteSite/assets/js/81.9c0f97b7.js"><link rel="prefetch" href="/noteSite/assets/js/82.89fc466f.js"><link rel="prefetch" href="/noteSite/assets/js/83.320ed96e.js"><link rel="prefetch" href="/noteSite/assets/js/84.bf3d8a98.js"><link rel="prefetch" href="/noteSite/assets/js/85.80d5a739.js"><link rel="prefetch" href="/noteSite/assets/js/86.eb338f34.js"><link rel="prefetch" href="/noteSite/assets/js/87.3e2d0a09.js"><link rel="prefetch" href="/noteSite/assets/js/88.9f33d625.js"><link rel="prefetch" href="/noteSite/assets/js/89.bcd59f0a.js"><link rel="prefetch" href="/noteSite/assets/js/9.599a8138.js"><link rel="prefetch" href="/noteSite/assets/js/90.ba56afcb.js"><link rel="prefetch" href="/noteSite/assets/js/91.aca80f9b.js"><link rel="prefetch" href="/noteSite/assets/js/92.74693ade.js"><link rel="prefetch" href="/noteSite/assets/js/93.2b45c8ef.js"><link rel="prefetch" href="/noteSite/assets/js/94.49c19f23.js"><link rel="prefetch" href="/noteSite/assets/js/95.75569abd.js"><link rel="prefetch" href="/noteSite/assets/js/96.64fd1eef.js"><link rel="prefetch" href="/noteSite/assets/js/97.60c0a07f.js"><link rel="prefetch" href="/noteSite/assets/js/98.2a5e029f.js"><link rel="prefetch" href="/noteSite/assets/js/99.05e50471.js">
    <link rel="stylesheet" href="/noteSite/assets/css/0.styles.0f3b0cbd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/noteSite/" class="home-link router-link-active"><img src="/noteSite/images/hedon.png" alt="Hedon" class="logo"> <span class="site-name can-hide">Hedon</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/component/" class="nav-link">
  计算机组成原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link">
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/distribute/" class="nav-link">
  分布式
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link router-link-active">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><a href="/noteSite/leetcode/" class="nav-link">
  Leetcode
</a></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/component/" class="nav-link">
  计算机组成原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link">
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/distribute/" class="nav-link">
  分布式
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link router-link-active">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><a href="/noteSite/leetcode/" class="nav-link">
  Leetcode
</a></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux 基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Shell 脚本</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux IO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Kubernetes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/noteSite/linux/k8s/k8s-introduction.html" class="sidebar-link">Kubernetes 简介</a></li><li><a href="/noteSite/linux/k8s/k8s-concept.html" class="sidebar-link">Kubernetes 名词</a></li><li><a href="/noteSite/linux/k8s/k8s-clusterbuild.html" class="sidebar-link">Kubernetes 集群搭建</a></li><li><a href="/noteSite/linux/k8s/k8s-namespace.html" class="sidebar-link">Namespace</a></li><li><a href="/noteSite/linux/k8s/k8s-label.html" class="sidebar-link">Label</a></li><li><a href="/noteSite/linux/k8s/k8s-pod.html" class="sidebar-link">Pod</a></li><li><a href="/noteSite/linux/k8s/k8s-rs.html" class="sidebar-link">ReplicaSet</a></li><li><a href="/noteSite/linux/k8s/k8s-deployment.html" class="sidebar-link">Deployment</a></li><li><a href="/noteSite/linux/k8s/k8s-HPA.html" class="sidebar-link">Horizontal Pod Autoscaler</a></li><li><a href="/noteSite/linux/k8s/k8s-ds.html" class="sidebar-link">DaemonSet</a></li><li><a href="/noteSite/linux/k8s/k8s-job.html" class="sidebar-link">Job</a></li><li><a href="/noteSite/linux/k8s/k8s-service.html" class="sidebar-link">Service</a></li><li><a href="/noteSite/linux/k8s/k8s-ingress.html" class="sidebar-link">Ingress</a></li><li><a href="/noteSite/linux/k8s/k8s-ss.html" class="sidebar-link">StatefulSet</a></li><li><a href="/noteSite/linux/k8s/k8s-store.html" aria-current="page" class="active sidebar-link">Kubernetes 数据存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-store.html#一、基本存储" class="sidebar-link">一、基本存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-store.html#_1-emptydir" class="sidebar-link">1. emptyDir</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-store.html#_2-hostpath" class="sidebar-link">2. hostPath</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-store.html#_3-nfs" class="sidebar-link">3. NFS</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-store.html#二、高级存储" class="sidebar-link">二、高级存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-store.html#_1-pv" class="sidebar-link">1. PV</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-store.html#_2-pvc" class="sidebar-link">2. PVC</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-store.html#_3-生命周期" class="sidebar-link">3. 生命周期</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-store.html#三、配置存储" class="sidebar-link">三、配置存储</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-store.html#_1-configmap" class="sidebar-link">1. ConfigMap</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-store.html#_2-secret" class="sidebar-link">2. Secret</a></li></ul></li></ul></li><li><a href="/noteSite/linux/k8s/k8s-auth.html" class="sidebar-link">Kubernetes 安全认证</a></li><li><a href="/noteSite/linux/k8s/k8s-dashboard.html" class="sidebar-link">Kubernetes DashBoard</a></li><li><a href="/noteSite/linux/k8s/interview.html" class="sidebar-link">面试题丨Kubernetes</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小技巧</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="kubernetes-数据存储"><a href="#kubernetes-数据存储" class="header-anchor">#</a> Kubernetes 数据存储</h1> <p>在前面已经提到，容器的生命周期可能很短，会被频繁的创建和销毁。那么容器在销毁的时候，保存在容器中的数据也会被清除。这种结果对用户来说，在某些情况下是不乐意看到的。为了持久化保存容器中的数据，k8s 引入了 <strong>Volume</strong> 的概念。</p> <p>Volume 是 Pod 中能够被多个容器访问的共享目录，它被定义在 Pod 上，然后被一个 Pod 里面的多个容器挂载到具体的文件目录下，k8s 通过 Volume 实现同一个 Pod 中不同容器之间的数据共享以及数据的持久化存储。Volume 的生命周期不与 Pod 中的单个容器的生命周期有关，当容器终止或者重启的时候，Volume 中的数据也不会丢失。</p> <p>k8s 的 Volume 支持多种类型，比较场景的有下面几个：</p> <ul><li>简单存储：EmptyDir、HostPath、NFS</li> <li>高级存储：PV，PVC</li> <li>配置存储：ConfigMap、Secret</li></ul> <h2 id="一、基本存储"><a href="#一、基本存储" class="header-anchor">#</a> 一、基本存储</h2> <h3 id="_1-emptydir"><a href="#_1-emptydir" class="header-anchor">#</a> 1. emptyDir</h3> <p>emptyDir 是最基础的 Volume 类型，一个 emptyDir 就是Host上的一个空目录。</p> <p>emptyDir 是在 Pod 被分配到 Node 时创建的，它的初始内容为空，并且无须指定宿主机上对应的目录文件，因为 k8s 会自动分配一个目录，<strong>当 Pod 销毁时，emptyDir 中的数据也会被永久删除。</strong></p> <p>emptyDir 的用途如下：</p> <ul><li>临时空间，例如用于某些应用程序运行时所需的临时目录，且无须永久保留</li> <li>一个容器需要从另一个容器中获取数据的目录（多容器共享目录）</li></ul> <blockquote><p><strong>案例：</strong></p> <p>在一个 Pod 中准备两个容器 nginx 和 busybox，然后声明一个 volume 分别挂载到两个容器的目录中，然后 nginx 容器负责向volume 中写日志，busybox 中通过命令将日志内容读到控制台。</p> <p><img src="https://cdn.cdnjson.com/tvax1.sinaimg.cn/large/008i3skNly1gsdyjd17akj312c0gcai8.jpg" alt="image-20210712102913718"></p></blockquote> <h4 id="_1-1-创建-pod"><a href="#_1-1-创建-pod" class="header-anchor">#</a> 1.1 创建 Pod</h4> <ul><li><p>创建 <code>volume-emptydir.yaml</code> 文件：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> volume<span class="token punctuation">-</span>emptydir
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.17.1
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs<span class="token punctuation">-</span>volume <span class="token comment">#将logs-volume挂载到nginx容器中对应的目录，该目录为/var/log/nginx</span>
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log/nginx
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span><span class="token number">1.30</span>
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/bash&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tail -f /logs/access.log&quot;</span><span class="token punctuation">]</span> <span class="token comment">#初始命令，动态读取指定文件的内容变化</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> <span class="token comment">#将logs-volume挂载到busybox容器中的对应父母，该目录为/logs</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs<span class="token punctuation">-</span>volume
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /logs
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>  <span class="token comment">#声明volume，name为logs-volume，类型为emptyDir</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs<span class="token punctuation">-</span>volume
      <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><img src="https://cdn.cdnjson.com/tvax1.sinaimg.cn/large/008i3skNly1gsdz3itjhfj314k0oinck.jpg" alt="image-20210712104838415" style="zoom:50%;"></li> <li><p>创建 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl create -f volume-emptydir.yaml </span>
pod/volume-emptydir created
</code></pre></div></li> <li><p>查看 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl get pod volume-emptydir -n dev -o wide</span>
NAME              READY   STATUS    RESTARTS   AGE   IP            NODE        NOMINATED NODE   READINESS GATES
volume-emptydir   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          63s   <span class="token number">10.244</span>.3.20   k8s-node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div></li></ul> <h4 id="_1-2-监听日志"><a href="#_1-2-监听日志" class="header-anchor">#</a> 1.2 监听日志</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl logs -f volume-emptydir -n dev -c busybox
</code></pre></div><p><img src="https://cdn.cdnjson.com/tvax1.sinaimg.cn/large/008i3skNly1gsdz2e0545j30l6012mwz.jpg" alt="img"></p> <h4 id="_1-2-访问-pod-中的-nginx"><a href="#_1-2-访问-pod-中的-nginx" class="header-anchor">#</a> 1.2 访问 Pod 中的 nginx</h4> <ul><li><p>访问几次 Pod 中的 nginx，使其有日志输出</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">curl</span> <span class="token number">10.244</span>.3.20
</code></pre></div></li></ul> <h3 id="_2-hostpath"><a href="#_2-hostpath" class="header-anchor">#</a> 2. hostPath</h3> <p>很明显 emptyDir 中的数据不会被持久化，它会随着 Pod 的结束而销毁，如果想要简单的将数据持久化到主机中，可以选择 <strong>hostPath</strong>。</p> <p><strong>hostPath 就是将 Node 主机中的一个实际目录挂载到 Pod 中，以供容器使用</strong>，这样的设计就可以保证 Pod 销毁了，但是数据依旧可以保存在 Node 主机上。</p> <p><img src="https://cdn.cdnjson.com/tvax1.sinaimg.cn/large/008i3skNly1gsdz5yfv1vj313y0i4n4t.jpg" alt="image-20210712105059079"></p> <h4 id="_2-1-创建-pod"><a href="#_2-1-创建-pod" class="header-anchor">#</a> 2.1 创建 Pod</h4> <ul><li><p>创建 <code>volume-hostpath.yaml</code> 文件：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> volume<span class="token punctuation">-</span>hostpath
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.17.1
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> <span class="token comment"># 将logs-volume挂载到nginx容器中对应的目录，该目录为/var/log/nginx</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs<span class="token punctuation">-</span>volume
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log/nginx
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span><span class="token number">1.30</span>
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;tail -f /logs/access.log&quot;</span><span class="token punctuation">]</span> <span class="token comment"># 初始命令，动态读取指定文件</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> <span class="token comment"># 将logs-volume挂载到busybox容器中的对应目录，该目录为/logs</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs<span class="token punctuation">-</span>volume
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /logs
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span> <span class="token comment"># 声明volume，name为logs-volume，类型为hostPath</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs<span class="token punctuation">-</span>volume
      <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /root/logs
        <span class="token key atrule">type</span><span class="token punctuation">:</span> DirectoryOrCreate <span class="token comment"># 目录存在就使用，不存在就先创建再使用</span>
</code></pre></div><p>type 的值的说明：</p> <ul><li><p>DirectoryOrCreate：目录存在就使用，不存在就先创建后使用</p></li> <li><p>Directory：目录必须存在</p></li> <li><p>FileOrCreate：文件存在就使用，不存在就先创建后使用</p></li> <li><p>File：文件必须存在</p></li> <li><p>Socket：unix 套接字必须存在</p></li> <li><p>CharDevice：字符设备必须存在</p></li> <li><p>BlockDevice：块设备必须存在</p></li></ul></li> <li><p>创建 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create -f volume-hostpath.yaml
</code></pre></div></li> <li><p>查看 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get pod volume-hostpath -n dev -o wide
</code></pre></div></li></ul> <h4 id="_2-2-访问-pod-中的-nginx"><a href="#_2-2-访问-pod-中的-nginx" class="header-anchor">#</a> 2.2 访问 Pod 中的 nginx</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">curl</span> PodIP地址:80
</code></pre></div><h4 id="_2-3-删除-pod"><a href="#_2-3-删除-pod" class="header-anchor">#</a> 2.3 删除 Pod</h4> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl delete pod volume-hostpath -n dev
</code></pre></div><h4 id="_2-4-去-node-节点找到-hostpath-映射的目录中的文件"><a href="#_2-4-去-node-节点找到-hostpath-映射的目录中的文件" class="header-anchor">#</a> 2.4 去 node 节点找到 hostPath 映射的目录中的文件</h4> <p>到Pod所在的节点（k8s-node1 或 k8s-node2）查看 hostPath 映射的目录中的文件：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">ls</span> /root/logs
</code></pre></div><blockquote><p>同样的道理，如果在此目录中创建文件，到容器中也是可以看到的。</p></blockquote> <h3 id="_3-nfs"><a href="#_3-nfs" class="header-anchor">#</a> 3. NFS</h3> <p><strong>hostPath 虽然可以解决数据持久化的问题，但是一旦 Node 节点故障了，Pod 如果转移到别的 Node 节点上，又会出现问题</strong>，此时需要准备单独的网络存储系统，比较常用的是 <strong>NFS</strong> 和 <strong>CIFS</strong>。</p> <p><strong>NFS（network file system）</strong> 是一个网络文件存储系统，可以搭建一台 NFS 服务器，然后将 Pod 中的存储直接连接到 NFS 系统上，这样，无论 Pod 在节点上怎么转移，只要 Node 和 NFS 的对接没有问题，数据就可以成功访问。</p> <p><img src="https://cdn.cdnjson.com/tvax1.sinaimg.cn/large/008i3skNly1gsdzf9o570j31iu0ge14y.jpg" alt="image-20210712105956016"></p> <h4 id="_3-1-搭建-nfs-服务器"><a href="#_3-1-搭建-nfs-服务器" class="header-anchor">#</a> 3.1 搭建 NFS 服务器</h4> <ul><li><p>首先需要准备 NFS 服务器，这里为了简单，直接在 k8s-master 节点做 NFS 服务器</p> <div class="language-shell extra-class"><pre class="language-shell"><code>yum <span class="token function">install</span> -y nfs-utils rpcbind
</code></pre></div></li> <li><p>准备一个共享目录</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> -pv /root/data/nfs
</code></pre></div></li> <li><p>将共享目录以读写权限暴露给<code>172.16.58.0/24</code>网段中的所有主机</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/exports</span>
<span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># more /etc/exports</span>
/root/data/nfs <span class="token number">172.16</span>.58.0/24<span class="token punctuation">(</span>rw,no_root_squash<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>修改权限</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">chmod</span> <span class="token number">777</span> -R /root/data/nfs
</code></pre></div></li> <li><p>加载配置</p> <div class="language-shell extra-class"><pre class="language-shell"><code>exportfs -r
</code></pre></div></li> <li><p>启动 NFS 服务</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl start rpcbind
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>systemctl <span class="token builtin class-name">enable</span> rpcbind
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>systemctl start nfs
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>systemctl <span class="token builtin class-name">enable</span> nfs
</code></pre></div></li> <li><p>在 k8s-master 节点上测试是否挂载成功</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># showmount -e 172.16.58.200</span>
Export list <span class="token keyword">for</span> <span class="token number">172.16</span>.58.200:
/root/data/nfs <span class="token number">172.16</span>.58.0/24
</code></pre></div></li> <li><p>在 k8s-node1 和 k8s-node2 都安装 NFS 服务器，目前是为了 Node 节点可以驱动 NFS 服务器</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># 在Node节点上安装NFS服务，不需要启动</span>
yum -y <span class="token function">install</span> nfs-utils
</code></pre></div></li> <li><p>在 k8s-node1 和 k8s-node2 测试是否挂载成功</p> <div class="language-shell extra-class"><pre class="language-shell"><code>showmount -e <span class="token number">172.16</span>.58.200
</code></pre></div></li> <li><p>高可用备份方式，在所有节点执行如下的命令</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mount</span> -t  nfs <span class="token number">172.16</span>.58.200:/root/data/nfs /mnt
</code></pre></div></li></ul> <h4 id="_3-2-创建-pod"><a href="#_3-2-创建-pod" class="header-anchor">#</a> 3.2 创建 Pod</h4> <ul><li><p>创建 <code>volume-nfs.yaml</code> 文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> volume<span class="token punctuation">-</span>nfs
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.17.1
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
      <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs<span class="token punctuation">-</span>volume <span class="token comment">#将logs-volume挂载到nginx容器中对应的目录，该目录为/var/log/nginx</span>
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /var/log/nginx
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span><span class="token number">1.30</span>
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tail -f /logs/error.log&quot;</span><span class="token punctuation">]</span> <span class="token comment">#初始命令，动态读取指定文件的内容变化</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span> <span class="token comment">#将logs-volume挂载到busybox容器中的对应父母，该目录为/logs</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs<span class="token punctuation">-</span>volume
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /logs
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>  <span class="token comment">#声明volume，name为logs-volume，类型为emptyDir</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> logs<span class="token punctuation">-</span>volume
      <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
        <span class="token key atrule">server</span><span class="token punctuation">:</span> 172.16.58.200 <span class="token comment">#NFS服务器地址</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /root/data/nfs <span class="token comment">#共享文件路径</span>
</code></pre></div></li> <li><p>创建 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f volume-nfs.yaml </span>
pod/volume-nfs created
</code></pre></div></li> <li><p>查看 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl get pod volume-nfs -o wide</span>
NAME         READY   STATUS    RESTARTS   AGE   IP            NODE        NOMINATED NODE   READINESS GATES
volume-nfs   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          6s    <span class="token number">10.244</span>.1.45   k8s-node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div></li></ul> <h4 id="_3-3-访问-pod-中的-nginx"><a href="#_3-3-访问-pod-中的-nginx" class="header-anchor">#</a> 3.3 访问 pod 中的 nginx</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">curl</span> <span class="token number">10.244</span>.1.45
</code></pre></div><h4 id="_3-4-查看-nfs-服务器上的共享目录"><a href="#_3-4-查看-nfs-服务器上的共享目录" class="header-anchor">#</a> 3.4 查看 nfs 服务器上的共享目录</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># ls /root/data/nfs/</span>
access.log  error.log
</code></pre></div><h2 id="二、高级存储"><a href="#二、高级存储" class="header-anchor">#</a> 二、高级存储</h2> <p>前面我们已经学习了使用 NFS 提供存储，此时就要求用户会搭建 NFS 系统，并且会在 yaml 配置 NFS。</p> <p>由于 k8s 支持的存储系统有很多，要求客户全部掌握，显然不现实。为了能够屏蔽底层存储实现的细节，方便用户使用，k8s 引入了 <strong>PV</strong> 和 <strong>PVC</strong> 两种资源对象。</p> <ul><li><strong>PV（Persistent Volume）</strong> 是持久化卷的意思，是对底层的共享存储的一种抽象。一般情况下 PV 由 k8s <strong>管理员</strong>进行创建和配置，它和底层具体的共享存储技术有关，并通过插件完成和共享存储的对接</li> <li><strong>PVC（Persistent Volume Claim）</strong> 是持久化卷声明的意思，是用户对于存储需求的一种声明。换言之，PVC 其实就是<strong>用户</strong>向 k8s 系统发出的一种资源需求申请</li></ul> <p>使用了 PV 和 PVC 之后，工作可以得到进一步的提升：</p> <ul><li>存储：存储工程师维护</li> <li>PV：k8s 管理员维护</li> <li>PVC：k8s 用户维护</li></ul> <p><img src="https://cdn.cdnjson.com/tvax1.sinaimg.cn/large/008i3skNly1gse04pva6sj315a0oak4j.jpg" alt="image-20210712112423723"></p> <h3 id="_1-pv"><a href="#_1-pv" class="header-anchor">#</a> 1. PV</h3> <h4 id="_1-1-pv-资源清单"><a href="#_1-1-pv-资源清单" class="header-anchor">#</a> 1.1 PV 资源清单</h4> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pv2
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span> <span class="token comment"># 存储类型，和底层正则的存储对应，NFS/CIFS/GlusterFS</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span> <span class="token comment"># 存储能力，目前只支持存储空间的设置</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 2Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token comment"># 访问模式</span>
    <span class="token punctuation">-</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> <span class="token comment"># 存储类别</span>
  <span class="token key atrule">persistentVolumeReclaimPolicy</span><span class="token punctuation">:</span> <span class="token comment"># 回收策略</span>
</code></pre></div><ul><li><p><strong>存储类型</strong></p> <p>底层实际存储的类型，k8s 支持多种存储类型，每种存储类型的配置有所不同：</p> <ul><li>NFS</li> <li>CIFS</li> <li>ClusterFS</li> <li>...</li></ul></li> <li><p><strong>存储能力（capacity）</strong></p> <p>目前只支持存储空间的设置（storage=1Gi），不过未来可能会加入 IOPS、吞吐量等指标的配置</p></li> <li><p><strong>访问模式（accessModes）</strong></p> <p>用来描述用户应用对存储资源的访问权限，访问权限包括下面几种方式：</p> <ul><li>ReadWriteOnce（RWO）：读写权限，但是只能被<strong>单个节点</strong>挂载</li> <li>ReadOnlyMany（ROX）：只读权限，可以被多个节点挂载</li> <li>ReadWriteMany（RWX）：读写权限，可以被多个节点挂载</li></ul> <p><font color="orange">需要注意的是，底层不同的存储类型可能支持的访问模式不同。</font></p></li> <li><p><strong>回收策略（ persistentVolumeReclaimPolicy）</strong></p> <p>当 PV 不再被使用之后，对其的处理方式，目前支持三种策略：</p> <ul><li>Retain（保留）：保留数据，需要管理员手动清理数据</li> <li>Recycle（回收）：清除 PV 中的数据，效果相当于<code>rm -rf /volume/*</code></li> <li>Delete（删除）：和 PV 相连的后端存储完成 volume 的删除操作，常见于云服务器厂商的存储服务</li></ul> <p><font color="orange">需要注意的是，底层不同的存储类型可能支持的回收策略不同。</font></p></li> <li><p><strong>存储类别（storageClassName）</strong></p> <p>PV 可以通过 <code>storageClassName</code> 参数指定一个存储类别：</p> <ul><li>具有特定类型的 PV 只能和请求了该类别的 PVC 进行绑定</li> <li>未设定类别的 PV 只能和不请求任何类别的 PVC 进行绑定</li></ul></li> <li><p><strong>状态（status）</strong></p> <p>一个 PV 的生命周期，可能会处于 4 种不同的阶段：</p> <ul><li>Available（可用）：表示可用状态，还未被任何 PVC 绑定</li> <li>Bound（已绑定）：表示PV已经被 PVC 绑定</li> <li>Released（已释放）：表示 PVC 被删除，但是资源还没有被集群重新释放</li> <li>Failed（失败）：表示该 PV 的自动回收失败</li></ul></li></ul> <h4 id="_1-2-准备-nfs-环境"><a href="#_1-2-准备-nfs-环境" class="header-anchor">#</a> 1.2 准备 NFS 环境</h4> <blockquote><p>为了方便，就直接在 k8s-master 上搭建了。</p></blockquote> <ul><li><p>创建共享目录</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> -pv /root/data/<span class="token punctuation">{</span>pv1,pv2,pv3<span class="token punctuation">}</span>
</code></pre></div></li> <li><p>授权共享目录的读写权限</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">chmod</span> <span class="token number">777</span> -R /root/data
</code></pre></div></li> <li><p>修改 /etc/exports，将共享目录以读写权限暴露给<code>172.16.58.0/24</code>网段中的所有主机</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># vim /etc/exports</span>
<span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># cat /etc/exports</span>
/root/data/nfs <span class="token number">172.16</span>.58.0/24<span class="token punctuation">(</span>rw,no_root_squash<span class="token punctuation">)</span>
<span class="token comment">#添加以下内容</span>
/root/data/pv1 <span class="token number">172.16</span>.58.0/24<span class="token punctuation">(</span>rw,no_root_squash<span class="token punctuation">)</span>
/root/data/pv2 <span class="token number">172.16</span>.58.0/24<span class="token punctuation">(</span>rw,no_root_squash<span class="token punctuation">)</span>
/root/data/pv3 <span class="token number">172.16</span>.58.0/24<span class="token punctuation">(</span>rw,no_root_squash<span class="token punctuation">)</span>
</code></pre></div></li> <li><p>重启 NFS 服务</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl restart nfs
</code></pre></div></li></ul> <h4 id="_1-3-创建-pv"><a href="#_1-3-创建-pv" class="header-anchor">#</a> 1.3 创建 PV</h4> <ul><li><p>创建 <code>pv.yaml</code> 文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pv1
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span> <span class="token comment">#存储类型，和底层支持的存储对应</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /root/data/pv1
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 172.16.58.200
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token comment">#访问模式</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">persistentVolumeReclaimPolicy</span><span class="token punctuation">:</span> Retain <span class="token comment">#回收策略</span>

<span class="token punctuation">---</span> 

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pv2
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span> <span class="token comment">#存储类型，和底层支持的存储对应</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /root/data/pv2
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 172.16.58.200
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 2Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token comment">#访问模式</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">persistentVolumeReclaimPolicy</span><span class="token punctuation">:</span> Retain <span class="token comment">#回收策略</span>

<span class="token punctuation">---</span> 

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pv3
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span> <span class="token comment">#存储类型，和底层支持的存储对应</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> /root/data/pv3
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 172.16.58.200
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
    <span class="token key atrule">storage</span><span class="token punctuation">:</span> 3Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token comment">#访问模式</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">persistentVolumeReclaimPolicy</span><span class="token punctuation">:</span> Retain <span class="token comment">#回收策略</span>
</code></pre></div></li> <li><p>创建 PV</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pv.yaml </span>
persistentvolume/pv1 created
persistentvolume/pv2 created
persistentvolume/pv3 created
</code></pre></div></li></ul> <h4 id="_1-4-查看-pv"><a href="#_1-4-查看-pv" class="header-anchor">#</a> 1.4 查看 PV</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl get pv -o wide</span>
NAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE   VOLUMEMODE
pv1    1Gi        RWX            Retain           Available                                   31s   Filesystem
pv2    2Gi        RWX            Retain           Available                                   31s   Filesystem
pv3    3Gi        RWX            Retain           Available                                   31s   Filesystem
</code></pre></div><h3 id="_2-pvc"><a href="#_2-pvc" class="header-anchor">#</a> 2. PVC</h3> <h4 id="_2-1-pvc-资源清单"><a href="#_2-1-pvc-资源清单" class="header-anchor">#</a> 2.1 PVC 资源清单</h4> <p>PVC 是资源的申请，用来声明对存储空间、访问模式、存储类别需求信息，下面是 PVC 的资源清单文件：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pvc
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token comment"># 访客模式</span>
    <span class="token punctuation">-</span> 
  <span class="token key atrule">selector</span><span class="token punctuation">:</span> <span class="token comment">#采用标签对PV选择</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> <span class="token comment">#存储类别</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token comment"># 请求空间</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 5Gi
</code></pre></div><ul><li><p><strong>访客模式（accessModes）</strong>：用于描述用户应用对存储资源的访问权限</p></li> <li><p>用于描述用户应用对存储资源的访问权限：</p> <ul><li><strong>选择条件（selector）</strong>：通过 Label Selector 的设置，可使 PVC 对于系统中已存在的 PV 进行筛选</li> <li><strong>存储类别（storageClassName）</strong>：PVC 在定义时可以设定需要的后端存储的类别，只有设置了该 class 的 PV 才能被系统选出</li> <li><strong>资源请求（resources）</strong>：描述对存储资源的请求</li></ul></li></ul> <h4 id="_2-2-创建-pvc"><a href="#_2-2-创建-pvc" class="header-anchor">#</a> 2.2 创建 PVC</h4> <ul><li><p>编写 <code>pvc.yaml</code> 文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pvc1
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token comment">#访客模式</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token comment">#资源要求</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span> 
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Gi

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pvc2
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token comment">#访客模式</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token comment">#资源要求</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span> 
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Gi

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pvc3
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span> <span class="token comment">#访客模式</span>
    <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token comment">#资源要求</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span> 
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 5Gi
</code></pre></div></li> <li><p>创建 PVC</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pvc.yaml </span>
persistentvolumeclaim/pvc1 created
persistentvolumeclaim/pvc2 created
persistentvolumeclaim/pvc3 created
</code></pre></div></li></ul> <h4 id="_2-3-查看-pvc"><a href="#_2-3-查看-pvc" class="header-anchor">#</a> 2.3 查看 PVC</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl get pvc</span>
NAME   STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
pvc1   Bound     pv1      1Gi        RWX                           41s
pvc2   Bound     pv2      2Gi        RWX                           41s
pvc3   Pending                                                     41s
</code></pre></div><p>会发现 <code>pvc3</code> 由于请求的资源（5Gi）大于目前所有提供资源的 PV，所以没法为 pvc3 分配 PV。</p> <h4 id="_2-4-查看-pv"><a href="#_2-4-查看-pv" class="header-anchor">#</a> 2.4 查看 PV</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl get pv</span>
NAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM          STORAGECLASS   REASON   AGE
pv1    1Gi        RWX            Retain           Bound       default/pvc1                           7m29s
pv2    2Gi        RWX            Retain           Bound       default/pvc2                           7m29s
pv3    3Gi        RWX            Retain           Available                                          7m29s
</code></pre></div><p>可以看到 pv1 和 pv2 都已经被分配了，pv3 还没有被分配。</p> <h4 id="_2-5-创建-pod"><a href="#_2-5-创建-pod" class="header-anchor">#</a> 2.5 创建 Pod</h4> <ul><li><p>创建 <code>pvc-pod.yaml</code> 文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pvc<span class="token punctuation">-</span>pod1
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span><span class="token number">1.30</span>
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;while true; do echo pvc-pod1 &gt;&gt; /root/out.txt; sleep 10; done;&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> volume
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /root/
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> volume
      <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
        <span class="token key atrule">claimName</span><span class="token punctuation">:</span> pvc1
        <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pvc<span class="token punctuation">-</span>pod2
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> busybox
      <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span><span class="token number">1.30</span>
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
      <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/bin/sh&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;-c&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;while true; do echo pvc-pod2 &gt;&gt; /root/out.txt; sleep 10; done;&quot;</span><span class="token punctuation">]</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> volume
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /root/
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> volume
      <span class="token key atrule">persistentVolumeClaim</span><span class="token punctuation">:</span>
        <span class="token key atrule">claimName</span><span class="token punctuation">:</span> pvc2
        <span class="token key atrule">readOnly</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre></div></li> <li><p>创建 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pvc-pod.yaml </span>
pod/pvc-pod1 created
pod/pvc-pod2 created
</code></pre></div></li> <li><p>查看 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl get pod pvc-pod1 -o wide</span>
NAME       READY   STATUS    RESTARTS   AGE   IP            NODE        NOMINATED NODE   READINESS GATES
pvc-pod1   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          7s    <span class="token number">10.244</span>.3.21   k8s-node2   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl get pod pvc-pod2 -o wide</span>
NAME       READY   STATUS    RESTARTS   AGE   IP            NODE        NOMINATED NODE   READINESS GATES
pvc-pod2   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          17s   <span class="token number">10.244</span>.1.46   k8s-node1   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>           <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
</code></pre></div></li></ul> <h4 id="_2-6-查看-pvc"><a href="#_2-6-查看-pvc" class="header-anchor">#</a> 2.6 查看 PVC</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl get pvc</span>
NAME   STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
pvc1   Bound     pv1      1Gi        RWX                           9m25s
pvc2   Bound     pv2      2Gi        RWX                           9m25s
pvc3   Pending                                                     9m25s
</code></pre></div><h4 id="_2-7-查看-pv"><a href="#_2-7-查看-pv" class="header-anchor">#</a> 2.7 查看 PV</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># kubectl get pv</span>
NAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM          STORAGECLASS   REASON   AGE
pv1    1Gi        RWX            Retain           Bound       default/pvc1                           15m
pv2    2Gi        RWX            Retain           Bound       default/pvc2                           15m
pv3    3Gi        RWX            Retain           Available                                          15m
</code></pre></div><h4 id="_2-8-查看-nfs-中的文件存储"><a href="#_2-8-查看-nfs-中的文件存储" class="header-anchor">#</a> 2.8 查看 NFS 中的文件存储</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># cat /root/data/pv1/out.txt </span>
pvc-pod1
pvc-pod1
pvc-pod1
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@k8s-master volume<span class="token punctuation">]</span><span class="token comment"># cat /root/data/pv2/out.txt </span>
pvc-pod2
pvc-pod2
pvc-pod2
<span class="token punctuation">..</span>.
</code></pre></div><h3 id="_3-生命周期"><a href="#_3-生命周期" class="header-anchor">#</a> 3. 生命周期</h3> <p><img src="https://cdn.cdnjson.com/tvax1.sinaimg.cn/large/008i3skNly1gse19s6j48j31q00rsama.jpg" alt="image-20210712120351532"></p> <p>PVC 和 PV 是一一对应的，PV 和 PVC 之间的相互作用遵循如下的生命周期：</p> <ul><li><p><strong>资源供应</strong></p> <p>管理员手动创建底层存储和 PV。</p></li> <li><p><strong>资源绑定</strong></p> <ul><li>用户创建 PVC，k8s 负责根据 PVC 声明去寻找 PV，并绑定在用户定义好 PVC 之后，系统将根据 PVC 对存储资源的请求在以存在的 PV 中选择一个满足条件的。
<ul><li>一旦找到，就将该 PV 和用户定义的 PVC 进行绑定，用户的应用就可以使用这个 PVC 了，PV 一旦绑定到某个 PVC 上，就会被这个 PVC 独占，不能再和其他的 PVC 进行绑定了</li> <li>如果找不到，PVC 就会无限期的处于 Pending 状态，直到系统管理员创建一个符合其要求的PV</li></ul></li></ul></li> <li><p><strong>资源使用</strong></p> <p>用户可以在 Pod 中像 volume 一样使用 PVC，Pod 使用 Volume 的定义，将 PVC 挂载到容器内的某个路径进行使用。</p></li> <li><p><strong>资源释放</strong></p> <p>用户删除 PVC 来释放 PV。</p> <blockquote><p>当存储资源使用完毕后，用户可以删除 PVC，和该 PVC 绑定的 PV 将会标记为“<strong>已释放</strong>”，但是还不能立刻和其他的 PVC 进行绑定。通过之前 PVC 写入的数据可能还留在存储设备上，只有在清除之后该 PV 才能再次使用。</p></blockquote></li> <li><p><strong>资源回收</strong></p> <p>k8s 根据 PV 设置的回收策略进行资源的回收。</p> <blockquote><p>对于 PV，管理员可以设定回收策略，用于设置与之绑定的 PVC 释放资源之后如何处理遗留数据的问题。只有 PV 的存储空间完成回收，才能供新的 PVC 绑定和使用。</p></blockquote></li></ul> <h2 id="三、配置存储"><a href="#三、配置存储" class="header-anchor">#</a> 三、配置存储</h2> <h3 id="_1-configmap"><a href="#_1-configmap" class="header-anchor">#</a> 1. ConfigMap</h3> <p>ConfigMap 是一种比较特殊的存储卷，它的主要作用是用来<strong>存储配置信息</strong>的。</p> <h4 id="_1-1-configmap-资源清单"><a href="#_1-1-configmap-资源清单" class="header-anchor">#</a> 1.1 ConfigMap 资源清单</h4> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> configMap
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">data</span><span class="token punctuation">:</span> <span class="token comment"># &lt;map[string]string&gt;</span>
  <span class="token key atrule">info</span><span class="token punctuation">:</span>
  	<span class="token key atrule">username</span><span class="token punctuation">:</span> admin
  	<span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
</code></pre></div><h4 id="_1-2-创建-configmap"><a href="#_1-2-创建-configmap" class="header-anchor">#</a> 1.2 创建 ConfigMap</h4> <ul><li><p>编写 <code>configmap.yaml</code> 文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> configmap
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">info</span><span class="token punctuation">:</span>
    username<span class="token punctuation">:</span>admin
    password<span class="token punctuation">:</span><span class="token number">123456</span>
</code></pre></div></li> <li><p>创建 ConfigMap</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create -f configmap.yaml
</code></pre></div></li></ul> <h4 id="_1-3-创建-pod"><a href="#_1-3-创建-pod" class="header-anchor">#</a> 1.3 创建 Pod</h4> <ul><li><p>编写 <code>pod-configmap.yaml</code> 文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>configmap
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.17.1
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /configmap/config
          <span class="token key atrule">name</span><span class="token punctuation">:</span> config
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> config
      <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> configmap
</code></pre></div></li> <li><p>创建 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create -f pod-configmap.yaml
</code></pre></div></li> <li><p>查看 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get pod pod-configmap -n dev
</code></pre></div></li></ul> <h4 id="_1-4-查看配置"><a href="#_1-4-查看配置" class="header-anchor">#</a> 1.4 查看配置</h4> <ul><li><p>进入容器</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl <span class="token builtin class-name">exec</span> -it pod-configmap -n dev /bin/sh
</code></pre></div></li> <li><p>查看配置</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> /configmap/config
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">ls</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">more</span> info
</code></pre></div></li></ul> <blockquote><p>ConfigMap 中的 key 映射为一个文件，value 映射为文件中的内容。如果更新了 ConfigMap 中的内容，容器中的值也会动态更新。</p></blockquote> <h3 id="_2-secret"><a href="#_2-secret" class="header-anchor">#</a> 2. Secret</h3> <p>在 k8s 中，还存在一种和 ConfigMap 非常类似的对象，称为 Secret 对象，它主要用来存储敏感信息，例如密码、密钥、证书等等。</p> <h4 id="_2-1-secret-资源清单"><a href="#_2-1-secret-资源清单" class="header-anchor">#</a> 2.1 Secret 资源清单</h4> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque <span class="token comment"># Secret 类型</span>
<span class="token key atrule">data</span><span class="token punctuation">:</span> <span class="token comment">#加密数据</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> YWRtaW4= 
  <span class="token key atrule">password</span><span class="token punctuation">:</span> MTIzNDU2
<span class="token key atrule">stringData</span><span class="token punctuation">:</span> <span class="token comment">#明文数据，stringData会覆盖data</span>
	<span class="token key atrule">username</span><span class="token punctuation">:</span> admin <span class="token comment">#会被自动加密，默认 base64</span>
	<span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
</code></pre></div><ul><li><p>type</p> <table><thead><tr><th>内置类型</th> <th>用法</th></tr></thead> <tbody><tr><td><code>Opaque</code></td> <td>用户定义的任意数据</td></tr> <tr><td><code>kubernetes.io/service-account-token</code></td> <td>服务账号令牌</td></tr> <tr><td><code>kubernetes.io/dockercfg</code></td> <td><code>~/.dockercfg</code> 文件的序列化形式</td></tr> <tr><td><code>kubernetes.io/dockerconfigjson</code></td> <td><code>~/.docker/config.json</code> 文件的序列化形式</td></tr> <tr><td><code>kubernetes.io/basic-auth</code></td> <td>用于基本身份认证的凭据</td></tr> <tr><td><code>kubernetes.io/ssh-auth</code></td> <td>用于 SSH 身份认证的凭据</td></tr> <tr><td><code>kubernetes.io/tls</code></td> <td>用于 TLS 客户端或者服务器端的数据</td></tr> <tr><td><code>bootstrap.kubernetes.io/token</code></td> <td>启动引导令牌数据</td></tr></tbody></table> <ul><li><p>Opaque Secret</p> <p>当 Secret 配置文件中未作显式设定时，默认的 Secret 类型是 <code>Opaque</code>。 当你使用 <code>kubectl</code> 来创建一个 Secret 时，你会使用 <code>generic</code> 子命令来标明 要创建的是一个 <code>Opaque</code> 类型 Secret。 例如，下面的命令会创建一个空的 <code>Opaque</code> 类型 Secret 对象：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master secret<span class="token punctuation">]</span><span class="token comment"># kubectl create secret generic empty-secret</span>
secret/empty-secret created
<span class="token punctuation">[</span>root@k8s-master secret<span class="token punctuation">]</span><span class="token comment"># kubectl get secret empty-secret</span>
NAME           TYPE     DATA   AGE
empty-secret   Opaque   <span class="token number">0</span>      8s
</code></pre></div><p><code>DATA</code> 列显示 Secret 中保存的数据条目个数。 在这个例子种，<code>0</code> 意味着我们刚刚创建了一个空的 Secret。</p></li> <li><p>服务账号令牌 Secret</p> <p>类型为 <code>kubernetes.io/service-account-token</code> 的 Secret 用来存放标识某 服务账号的令牌。使用这种 Secret 类型时，你需要确保对象的注解 <code>kubernetes.io/service-account-name</code> 被设置为某个已有的服务账号名称。 某个 Kubernetes 控制器会填写 Secret 的其它字段，例如 <code>kubernetes.io/service-account.uid</code> 注解以及 <code>data</code> 字段中的 <code>token</code> 键值，使之包含实际的令牌内容。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret<span class="token punctuation">-</span>sa<span class="token punctuation">-</span>sample
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">kubernetes.io/service-account.name</span><span class="token punctuation">:</span> <span class="token string">&quot;sa-name&quot;</span>
<span class="token key atrule">type</span><span class="token punctuation">:</span> kubernetes.io/service<span class="token punctuation">-</span>account<span class="token punctuation">-</span>token
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token comment"># 你可以像 Opaque Secret 一样在这里添加额外的键/值偶对</span>
  <span class="token key atrule">extra</span><span class="token punctuation">:</span> YmFyCg==
</code></pre></div><p>Kubernetes 在创建 Pod 时会自动创建一个服务账号 Secret 并自动修改你的 Pod 以使用该 Secret。该服务账号令牌 Secret 中包含了访问 Kubernetes API 所需要的凭据</p></li> <li><p>Docker 配置 Secret</p> <p>你可以使用下面两种 <code>type</code> 值之一来创建 Secret，用以存放访问 Docker 仓库 来下载镜像的凭据。</p> <ul><li><code>kubernetes.io/dockercfg</code></li> <li><code>kubernetes.io/dockerconfigjson</code></li></ul> <p><code>kubernetes.io/dockercfg</code> 是一种保留类型，用来存放 <code>~/.dockercfg</code> 文件的 序列化形式。该文件是配置 Docker 命令行的一种老旧形式。 使用此 Secret 类型时，你需要确保 Secret 的 <code>data</code> 字段中包含名为 <code>.dockercfg</code> 的主键，其对应键值是用 base64 编码的某 <code>~/.dockercfg</code> 文件的内容。</p> <p>类型 <code>kubernetes.io/dockerconfigjson</code> 被设计用来保存 JSON 数据的序列化形式， 该 JSON 也遵从 <code>~/.docker/config.json</code> 文件的格式规则，而后者是 <code>~/.dockercfg</code> 的新版本格式。 使用此 Secret 类型时，Secret 对象的 <code>data</code> 字段必须包含 <code>.dockerconfigjson</code> 键，其键值为 base64 编码的字符串包含 <code>~/.docker/config.json</code> 文件的内容。</p> <p>下面是一个 <code>kubernetes.io/dockercfg</code> 类型 Secret 的示例：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret<span class="token punctuation">-</span>dockercfg
<span class="token key atrule">type</span><span class="token punctuation">:</span> kubernetes.io/dockercfg
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">.dockercfg</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        &quot;&lt;base64 encoded ~/.dockercfg file&gt;&quot;</span>
</code></pre></div></li> <li><p>基本身份认证 Secret</p> <p><code>kubernetes.io/basic-auth</code> 类型用来存放用于基本身份认证所需的凭据信息。 使用这种 Secret 类型时，Secret 的 <code>data</code> 字段必须包含以下两个键：</p> <ul><li><code>username</code>: 用于身份认证的用户名；</li> <li><code>password</code>: 用于身份认证的密码或令牌。</li></ul> <p>以上两个键的键值都是 base64 编码的字符串。 当然你也可以在创建 Secret 时使用 <code>stringData</code> 字段来提供明文形式的内容。 下面的 YAML 是基本身份认证 Secret 的一个示例清单：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret<span class="token punctuation">-</span>basic<span class="token punctuation">-</span>auth
<span class="token key atrule">type</span><span class="token punctuation">:</span> kubernetes.io/basic<span class="token punctuation">-</span>auth
<span class="token key atrule">stringData</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> admin
  <span class="token key atrule">password</span><span class="token punctuation">:</span> t0p<span class="token punctuation">-</span>Secret
</code></pre></div><p>提供基本身份认证类型的 Secret 仅仅是出于用户方便性考虑。 你也可以使用 <code>Opaque</code> 类型来保存用于基本身份认证的凭据。 不过，使用内置的 Secret 类型的有助于对凭据格式进行归一化处理，并且 API 服务器确实会检查 Secret 配置中是否提供了所需要的主键。</p></li> <li><p>SSH 身份认证 Secret</p> <p>Kubernetes 所提供的内置类型 <code>kubernetes.io/ssh-auth</code> 用来存放 SSH 身份认证中 所需要的凭据。使用这种 Secret 类型时，你就必须在其 <code>data</code> （或 <code>stringData</code>） 字段中提供一个 <code>ssh-privatekey</code> 键值对，作为要使用的 SSH 凭据。</p> <p>下面的 YAML 是一个 SSH 身份认证 Secret 的配置示例：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret<span class="token punctuation">-</span>ssh<span class="token punctuation">-</span>auth
<span class="token key atrule">type</span><span class="token punctuation">:</span> kubernetes.io/ssh<span class="token punctuation">-</span>auth
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token comment"># 此例中的实际数据被截断</span>
  <span class="token key atrule">ssh-privatekey</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          MIIEpQIBAAKCAQEAulqb/Y ..</span>
</code></pre></div><p>提供 SSH 身份认证类型的 Secret 仅仅是出于用户方便性考虑。 你也可以使用 <code>Opaque</code> 类型来保存用于 SSH 身份认证的凭据。 不过，使用内置的 Secret 类型的有助于对凭据格式进行归一化处理，并且 API 服务器确实会检查 Secret 配置中是否提供了所需要的主键。</p></li> <li><p>TLS Secret</p> <p>Kubernetes 提供一种内置的 <code>kubernetes.io/tls</code> Secret 类型，用来存放证书 及其相关密钥（通常用在 TLS 场合）。 此类数据主要提供给 Ingress 资源，用以终结 TLS 链接，不过也可以用于其他 资源或者负载。当使用此类型的 Secret 时，Secret 配置中的 <code>data</code> （或 <code>stringData</code>）字段必须包含 <code>tls.key</code> 和 <code>tls.crt</code> 主键，尽管 API 服务器 实际上并不会对每个键的取值作进一步的合法性检查。</p> <p>下面的 YAML 包含一个 TLS Secret 的配置示例：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret<span class="token punctuation">-</span>tls
<span class="token key atrule">type</span><span class="token punctuation">:</span> kubernetes.io/tls
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token comment"># 此例中的数据被截断</span>
  <span class="token key atrule">tls.crt</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        MIIC2DCCAcCgAwIBAgIBATANBgkqh ...</span>
  <span class="token key atrule">tls.key</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        MIIEpgIBAAKCAQEA7yn3bRHQ5FHMQ ...</span>
</code></pre></div></li> <li><p>启动引导令牌 Secret</p> <p>通过将 Secret 的 <code>type</code> 设置为 <code>bootstrap.kubernetes.io/token</code> 可以创建 启动引导令牌类型的 Secret。这种类型的 Secret 被设计用来支持节点的启动引导过程。 其中包含用来为周知的 ConfigMap 签名的令牌。</p> <p>启动引导令牌 Secret 通常创建于 <code>kube-system</code> 名字空间内，并以 <code>bootstrap-token-&lt;令牌 ID&gt;</code> 的形式命名；其中 <code>&lt;令牌 ID&gt;</code> 是一个由 6 个字符组成 的字符串，用作令牌的标识。</p> <p>以 Kubernetes 清单文件的形式，某启动引导令牌 Secret 可能看起来像下面这样：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> bootstrap<span class="token punctuation">-</span>token<span class="token punctuation">-</span>5emitj
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">type</span><span class="token punctuation">:</span> bootstrap.kubernetes.io/token
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">auth-extra-groups</span><span class="token punctuation">:</span> c3lzdGVtOmJvb3RzdHJhcHBlcnM6a3ViZWFkbTpkZWZhdWx0LW5vZGUtdG9rZW4=
  <span class="token key atrule">expiration</span><span class="token punctuation">:</span> MjAyMC0wOS0xM1QwNDozOToxMFo=
  <span class="token key atrule">token-id</span><span class="token punctuation">:</span> NWVtaXRq
  <span class="token key atrule">token-secret</span><span class="token punctuation">:</span> a3E0Z2lodnN6emduMXAwcg==
  <span class="token key atrule">usage-bootstrap-authentication</span><span class="token punctuation">:</span> dHJ1ZQ==
  <span class="token key atrule">usage-bootstrap-signing</span><span class="token punctuation">:</span> dHJ1ZQ==
</code></pre></div><p>启动引导令牌类型的 Secret 会在 <code>data</code> 字段中包含如下主键：</p> <ul><li><code>token-id</code>：由 6 个随机字符组成的字符串，作为令牌的标识符。必需。</li> <li><code>token-secret</code>：由 16 个随机字符组成的字符串，包含实际的令牌机密。必需。</li> <li><code>description</code>：供用户阅读的字符串，描述令牌的用途。可选。</li> <li><code>expiration</code>：一个使用 RFC3339 来编码的 UTC 绝对时间，给出令牌要过期的时间。可选。</li> <li><code>usage-bootstrap-&lt;usage&gt;</code>：布尔类型的标志，用来标明启动引导令牌的其他用途。</li> <li><code>auth-extra-groups</code>：用逗号分隔的组名列表，身份认证时除被认证为 <code>system:bootstrappers</code> 组之外，还会被添加到所列的用户组中。</li></ul> <p>上面的 YAML 文件可能看起来令人费解，因为其中的数值均为 base64 编码的字符串。 实际上，你完全可以使用下面的 YAML 来创建一个一模一样的 Secret：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token comment"># 注意 Secret 的命名方式</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> bootstrap<span class="token punctuation">-</span>token<span class="token punctuation">-</span>5emitj
  <span class="token comment"># 启动引导令牌 Secret 通常位于 kube-system 名字空间</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token key atrule">type</span><span class="token punctuation">:</span> bootstrap.kubernetes.io/token
<span class="token key atrule">stringData</span><span class="token punctuation">:</span>
  <span class="token key atrule">auth-extra-groups</span><span class="token punctuation">:</span> <span class="token string">&quot;system:bootstrappers:kubeadm:default-node-token&quot;</span>
  <span class="token key atrule">expiration</span><span class="token punctuation">:</span> <span class="token string">&quot;2020-09-13T04:39:10Z&quot;</span>
  <span class="token comment"># 此令牌 ID 被用于生成 Secret 名称</span>
  <span class="token key atrule">token-id</span><span class="token punctuation">:</span> <span class="token string">&quot;5emitj&quot;</span>
  <span class="token key atrule">token-secret</span><span class="token punctuation">:</span> <span class="token string">&quot;kq4gihvszzgn1p0r&quot;</span>
  <span class="token comment"># 此令牌还可用于 authentication （身份认证）</span>
  <span class="token key atrule">usage-bootstrap-authentication</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
  <span class="token comment"># 且可用于 signing （证书签名）</span>
  <span class="token key atrule">usage-bootstrap-signing</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
</code></pre></div></li></ul></li></ul> <h4 id="_2-2-使用-base64-对数据进行编码"><a href="#_2-2-使用-base64-对数据进行编码" class="header-anchor">#</a> 2.2 使用 base64 对数据进行编码</h4> <ul><li><p>加密 username</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># echo -n &quot;admin&quot; | base64</span>
<span class="token assign-left variable">YWRtaW4</span><span class="token operator">=</span>
</code></pre></div></li> <li><p>加密 password</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ~<span class="token punctuation">]</span><span class="token comment"># echo -n &quot;123456&quot; | base64</span>
MTIzNDU2
</code></pre></div></li></ul> <h4 id="_2-3-创建-secret"><a href="#_2-3-创建-secret" class="header-anchor">#</a> 2.3 创建 Secret</h4> <ul><li><p>编写 <code>secret.yaml</code> 文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> YWRtaW4=
  <span class="token key atrule">password</span><span class="token punctuation">:</span> MTIzNDU2
</code></pre></div></li> <li><p>创建 Secret</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create -f secret.yaml
</code></pre></div></li></ul> <h4 id="_2-4-自动编码"><a href="#_2-4-自动编码" class="header-anchor">#</a> 2.4 自动编码</h4> <ul><li>上面的方式是先手动将数据进行编码，其实也可以使用直接编写数据，将数据编码交给 k8s。</li></ul> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque
<span class="token key atrule">stringData</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> <span class="token string">&quot;admin&quot;</span>
  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token string">&quot;123456&quot;</span>
</code></pre></div><blockquote><p>如果同时使用 data 和 stringData，那么 data 会被忽略。</p></blockquote> <h4 id="_2-5-查看-secret"><a href="#_2-5-查看-secret" class="header-anchor">#</a> 2.5 查看 Secret</h4> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master secret<span class="token punctuation">]</span><span class="token comment"># kubectl get secret secret -n dev</span>
NAME     TYPE     DATA   AGE
secret   Opaque   <span class="token number">2</span>      73s

<span class="token punctuation">[</span>root@k8s-master secret<span class="token punctuation">]</span><span class="token comment"># kubectl describe secret secret -n dev</span>
Name:         secret
Namespace:    dev
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  
Type:         Opaque

Data
<span class="token operator">==</span><span class="token operator">==</span>
username:  <span class="token number">5</span> bytes
password:  <span class="token number">6</span> bytes
</code></pre></div><h4 id="_2-6-创建-pod"><a href="#_2-6-创建-pod" class="header-anchor">#</a> 2.6 创建 Pod</h4> <ul><li><p>编写 <code>pod-secret.yaml</code> 文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>secret
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
      <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.17.1
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /secret/config
          <span class="token key atrule">name</span><span class="token punctuation">:</span> config
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> config
      <span class="token key atrule">secret</span><span class="token punctuation">:</span>
        <span class="token key atrule">secretName</span><span class="token punctuation">:</span> secret
</code></pre></div></li> <li><p>创建 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl apply -f pod-secret.yaml 
</code></pre></div></li> <li><p>查看 Pod</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl get pod pod-secret -n dev
</code></pre></div></li></ul> <h4 id="_2-7-进入-pod-查看配置信息"><a href="#_2-7-进入-pod-查看配置信息" class="header-anchor">#</a> 2.7 进入 Pod 查看配置信息</h4> <ul><li>进入容器，查看 Secret 信息，发现已经自动解码了</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master secret<span class="token punctuation">]</span><span class="token comment"># kubectl exec -it pod-secret -n dev /bin/sh</span>
kubectl <span class="token builtin class-name">exec</span> <span class="token punctuation">[</span>POD<span class="token punctuation">]</span> <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> is DEPRECATED and will be removed <span class="token keyword">in</span> a future version. Use kubectl kubectl <span class="token builtin class-name">exec</span> <span class="token punctuation">[</span>POD<span class="token punctuation">]</span> -- <span class="token punctuation">[</span>COMMAND<span class="token punctuation">]</span> instead.
<span class="token comment"># ls /secret/config</span>
password  username
<span class="token comment"># more /secret/config/username</span>
admin
<span class="token comment"># more /secret/config/password</span>
<span class="token number">123456</span>
<span class="token comment"># </span>
</code></pre></div><h4 id="_2-8-secret-用途"><a href="#_2-8-secret-用途" class="header-anchor">#</a> 2.8 Secret 用途</h4> <p>imagePullSecret：Pod 拉取私有镜像仓库的时使用的账户密码，会传递给 kubelet，然后 kubelet 就可以拉取有密码的仓库里面的镜像。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create secret docker-registry docker-harbor-registrykey --docker-server<span class="token operator">=</span>IP:PORT <span class="token punctuation">\</span>
          --docker-username<span class="token operator">=</span>username --docker-password<span class="token operator">=</span>password <span class="token punctuation">\</span>
          --docker-email<span class="token operator">=</span>xxxxx@qq.com
</code></pre></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">7/13/2021, 11:54:08 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/noteSite/linux/k8s/k8s-ss.html" class="prev">
        StatefulSet
      </a></span> <span class="next"><a href="/noteSite/linux/k8s/k8s-auth.html">
        Kubernetes 安全认证
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/noteSite/assets/js/app.982938bc.js" defer></script><script src="/noteSite/assets/js/2.6ff1f0ac.js" defer></script><script src="/noteSite/assets/js/290.a4aae21a.js" defer></script>
  </body>
</html>
