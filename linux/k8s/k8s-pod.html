<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pod | Hedon</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/noteSite/assets/css/0.styles.2fd33669.css" as="style"><link rel="preload" href="/noteSite/assets/js/app.d406638e.js" as="script"><link rel="preload" href="/noteSite/assets/js/2.691adf44.js" as="script"><link rel="preload" href="/noteSite/assets/js/23.6310a039.js" as="script"><link rel="prefetch" href="/noteSite/assets/js/10.881db4ea.js"><link rel="prefetch" href="/noteSite/assets/js/11.daa6417c.js"><link rel="prefetch" href="/noteSite/assets/js/12.4c7dd5e0.js"><link rel="prefetch" href="/noteSite/assets/js/13.f3e71a37.js"><link rel="prefetch" href="/noteSite/assets/js/14.09de4d83.js"><link rel="prefetch" href="/noteSite/assets/js/15.19638ff1.js"><link rel="prefetch" href="/noteSite/assets/js/16.39473b5c.js"><link rel="prefetch" href="/noteSite/assets/js/17.bcf5cde8.js"><link rel="prefetch" href="/noteSite/assets/js/18.70b3790f.js"><link rel="prefetch" href="/noteSite/assets/js/19.11f38a7c.js"><link rel="prefetch" href="/noteSite/assets/js/20.645272fc.js"><link rel="prefetch" href="/noteSite/assets/js/21.be3f670c.js"><link rel="prefetch" href="/noteSite/assets/js/22.2b2ac276.js"><link rel="prefetch" href="/noteSite/assets/js/24.e95a2dcc.js"><link rel="prefetch" href="/noteSite/assets/js/25.7cdfdbde.js"><link rel="prefetch" href="/noteSite/assets/js/26.4e593b7d.js"><link rel="prefetch" href="/noteSite/assets/js/27.5a39e1ec.js"><link rel="prefetch" href="/noteSite/assets/js/3.993ac28b.js"><link rel="prefetch" href="/noteSite/assets/js/4.00d489fc.js"><link rel="prefetch" href="/noteSite/assets/js/5.2bccd6df.js"><link rel="prefetch" href="/noteSite/assets/js/6.f3d86aa7.js"><link rel="prefetch" href="/noteSite/assets/js/7.80f82a7b.js"><link rel="prefetch" href="/noteSite/assets/js/8.f6285dc4.js"><link rel="prefetch" href="/noteSite/assets/js/9.1df1d60f.js">
    <link rel="stylesheet" href="/noteSite/assets/css/0.styles.2fd33669.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/noteSite/" class="home-link router-link-active"><img src="/noteSite/images/hedon.png" alt="Hedon" class="logo"> <span class="site-name can-hide">Hedon</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/noteSite/golang/" class="nav-link">
  Golang
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link router-link-active">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/language/chinese/" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/language/english.html" class="nav-link">
  English
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="/noteSite/golang/" class="nav-link">
  Golang
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link router-link-active">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/java/" class="nav-link">
  Java
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Language Menu" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Language Menu" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/language/chinese/" class="nav-link">
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/language/english.html" class="nav-link">
  English
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/noteSite/linux/shell/shell.html" class="sidebar-link">Shell 脚本</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Docker</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/noteSite/linux/docker/docker-introduction.html" class="sidebar-link">Docker 介绍</a></li><li><a href="/noteSite/linux/docker/docker-install.html" class="sidebar-link">Docker 安装</a></li><li><a href="/noteSite/linux/docker/docker-image.html" class="sidebar-link">Docker 镜像</a></li><li><a href="/noteSite/linux/docker/docker-container.html" class="sidebar-link">Docker 容器</a></li><li><a href="/noteSite/linux/docker/docker-network.html" class="sidebar-link">Docker 网络</a></li><li><a href="/noteSite/linux/docker/dockerfile.html" class="sidebar-link">Dockerfile</a></li><li><a href="/noteSite/linux/docker/docker-primary-resp.html" class="sidebar-link">Docker 镜像私有仓库</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Kubernetes</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/noteSite/linux/k8s/k8s-introduction.html" class="sidebar-link">Kubernetes 简介</a></li><li><a href="/noteSite/linux/k8s/k8s-concept.html" class="sidebar-link">Kubernetes 名词</a></li><li><a href="/noteSite/linux/k8s/k8s-architecture.html" class="sidebar-link">Kubernetes 集群</a></li><li><a href="/noteSite/linux/k8s/k8s-pod.html" aria-current="page" class="active sidebar-link">Pod</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-pod.html#一、使用-pod" class="sidebar-link">一、使用 Pod</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-pod.html#二、pod-控制器" class="sidebar-link">二、Pod 控制器</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-pod.html#三、pod-模板" class="sidebar-link">三、Pod 模板</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-pod.html#四、pod-更新与替换" class="sidebar-link">四、Pod 更新与替换</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-pod.html#五、pod-生命周期" class="sidebar-link">五、Pod 生命周期</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-pod.html#_1-pod-阶段" class="sidebar-link">1. Pod 阶段</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-pod.html#_2-容器状态" class="sidebar-link">2. 容器状态</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-pod.html#_3-容器重启策略" class="sidebar-link">3. 容器重启策略</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-pod.html#_4-pod-状况" class="sidebar-link">4. Pod 状况</a></li></ul></li></ul></li><li><a href="/noteSite/linux/k8s/k8s-deployment.html" class="sidebar-link">Deployment</a></li><li><a href="/noteSite/linux/k8s/k8s-rs.html" class="sidebar-link">ReplicaSet</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>小技巧</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/noteSite/linux/skills/skill-curl.html" class="sidebar-link">curl 上传/下载文件</a></li><li><a href="/noteSite/linux/skills/skill-searchfilewithcontent.html" class="sidebar-link">Linux 查找当前目录下包含特定字符串的所有文件</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="pod"><a href="#pod" class="header-anchor">#</a> Pod</h1> <blockquote><p><em>Pod</em> 是可以在 Kubernetes 中创建和管理的、最小的可部署的计算单元。</p></blockquote> <h2 id="一、使用-pod"><a href="#一、使用-pod" class="header-anchor">#</a> 一、使用 Pod</h2> <p>通常不需要直接创建 Pod，甚至单实例 Pod。 相反，我们会使用诸如 <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">Deployment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 或 <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/job/" target="_blank" rel="noopener noreferrer">Job<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>这类工作负载资源来创建 Pod。如果 Pod 需要跟踪状态， 可以考虑 <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/statefulset/" target="_blank" rel="noopener noreferrer">StatefulSet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 资源。</p> <p>Kubernetes 集群中的 Pod 主要有两种用法：</p> <ul><li><p><strong>运行单个容器的 Pod</strong>。&quot;每个 Pod 一个容器&quot;模型是最常见的 Kubernetes 用例； 在这种情况下，可以将 Pod 看作单个容器的包装器，并且 Kubernetes 直接管理 Pod，而不是容器。</p></li> <li><p><strong>运行多个协同工作的容器的 Pod</strong>。 Pod 可能封装由多个紧密耦合且需要共享资源的共处容器组成的应用程序。 这些位于同一位置的容器可能形成单个内聚的服务单元 —— 一个容器将文件从共享卷提供给公众， 而另一个单独的“边车”（sidecar）容器则刷新或更新这些文件。 Pod 将这些容器和存储资源打包为一个可管理的实体。</p> <blockquote><p><strong>说明：</strong> 将多个并置、同管的容器组织到一个 Pod 中是一种相对高级的使用场景。 只有在一些场景中，容器之间紧密关联时你才应该使用这种模式。</p></blockquote></li></ul> <p>每个 Pod 都旨在运行给定应用程序的单个实例。如果希望横向扩展应用程序（例如，运行多个实例 以提供更多的资源），则应该使用多个 Pod，每个实例使用一个 Pod。 在 Kubernetes 中，这通常被称为 <em>副本（Replication）</em>。 通常使用一种工作负载资源及其控制器]来创建和管理一组 Pod 副本。</p> <p><strong>Pod 如何管理多个容器：</strong></p> <p>Pod 被设计成支持形成内聚服务单元的多个协作过程（形式为容器）。 Pod 中的容器被自动安排到集群中的同一物理机或虚拟机上，并可以一起进行调度。 容器之间可以共享资源和依赖、彼此通信、协调何时以及何种方式终止自身。</p> <p>例如，你可能有一个容器，为共享卷中的文件提供 Web 服务器支持，以及一个单独的 “sidecar（挂斗）”容器负责从远端更新这些文件，如下图所示：</p> <img src="https://tva1.sinaimg.cn/large/008i3skNgy1grt64hdq7mj30no0oytbs.jpg" alt="image-20210624105451272" style="zoom:50%;"> <p>有些 Pod 具有 <a href="https://kubernetes.io/zh/docs/reference/glossary/?all=true#term-init-container" target="_blank" rel="noopener noreferrer">Init 容器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://kubernetes.io/zh/docs/reference/glossary/?all=true#term-app-container" target="_blank" rel="noopener noreferrer">应用容器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。 Init 容器会在启动应用容器之前运行并完成。</p> <p>Pod 天生地为其成员容器提供了两种共享资源：<strong>网络</strong>和<strong>存储</strong>。</p> <h2 id="二、pod-控制器"><a href="#二、pod-控制器" class="header-anchor">#</a> 二、Pod 控制器</h2> <p>你可以使用工作负载资源来创建和管理多个 Pod。 资源的控制器能够处理副本的管理、上线，并在 Pod 失效时提供自愈能力。 例如，如果一个节点失败，控制器注意到该节点上的 Pod 已经停止工作， 就可以创建替换性的 Pod。调度器会将替身 Pod 调度到一个健康的节点执行。</p> <p>下面是一些管理一个或者多个 Pod 的工作负载资源的示例：</p> <ul><li>Deployment</li> <li>StatefulSet</li> <li>DaemonSet</li></ul> <h2 id="三、pod-模板"><a href="#三、pod-模板" class="header-anchor">#</a> 三、Pod 模板</h2> <p><a href="https://kubernetes.io/zh/docs/concepts/workloads/" target="_blank" rel="noopener noreferrer">负载<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>资源的控制器通常使用 <em>Pod 模板（Pod Template）</em> 来替你创建 Pod 并管理它们。</p> <p>Pod 模板是包含在工作负载对象中的规范，用来创建 Pod。这类负载资源包括<a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">Deployment<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>、 <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/job/" target="_blank" rel="noopener noreferrer">Job<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/daemonset/" target="_blank" rel="noopener noreferrer">DaemonSets<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>等。</p> <p>工作负载的控制器会使用负载对象中的 <code>PodTemplate</code> 来生成实际的 Pod。 <code>PodTemplate</code>是你用来运行应用时指定的负载资源的目标状态的一部分。</p> <p>下面的示例是一个简单的 Job 的清单，其中的 <code>template</code> 指示启动一个容器。 该 Pod 中的容器会打印一条消息之后暂停。</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> batch/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Job
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> hello
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token comment"># 这里是 Pod 模版</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> hello
        <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox
        <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sh'</span><span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'echo &quot;Hello, Kubernetes!&quot; &amp;&amp; sleep 3600'</span><span class="token punctuation">]</span>
      <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> OnFailure
    <span class="token comment"># 以上为 Pod 模版</span>
</code></pre></div><blockquote><p>修改 Pod 模版或者切换到新的 Pod 模版都不会对已经存在的 Pod 起作用。 Pod 不会直接收到模版的更新。相反， 新的 Pod 会被创建出来，与更改后的 Pod 模版匹配。</p></blockquote> <h2 id="四、pod-更新与替换"><a href="#四、pod-更新与替换" class="header-anchor">#</a> 四、Pod 更新与替换</h2> <p>正如前面章节所述，当某工作负载的 Pod 模板被改变时，控制器会基于更新的模板 创建新的 Pod 对象而不是对现有 Pod 执行更新或者修补操作。</p> <p>Kubernetes 并不禁止你直接管理 Pod。对运行中的 Pod 的某些字段执行就地更新操作 还是可能的。不过，类似 <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.21/#patch-pod-v1-core" target="_blank" rel="noopener noreferrer"><code>patch</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 和 <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.21/#replace-pod-v1-core" target="_blank" rel="noopener noreferrer"><code>replace</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 这类更新操作有一些限制：</p> <ul><li>Pod 的绝大多数元数据都是不可变的。例如，你不可以改变其 <code>namespace</code>、<code>name</code>、<code>uid</code> 或者 <code>creationTimestamp</code> 字段；<code>generation</code> 字段是比较特别的，如果更新 该字段，只能增加字段取值而不能减少。</li> <li>如果 <code>metadata.deletionTimestamp</code> 已经被设置，则不可以向 <code>metadata.finalizers</code> 列表中添加新的条目。</li> <li>Pod 更新不可以改变除 <code>spec.containers[*].image</code>、<code>spec.initContainers[*].image</code>、<code>spec.activeDeadlineSeconds</code> 或 <code>spec.tolerations</code> 之外的字段。 对于 <code>spec.tolerations</code>，你只被允许添加新的条目到其中。</li> <li>在更新<code>spec.activeDeadlineSeconds</code> 字段时，以下两种更新操作是被允许的：
<ol><li>如果该字段尚未设置，可以将其设置为一个正数；</li> <li>如果该字段已经设置为一个正数，可以将其设置为一个更小的、非负的整数。</li></ol></li></ul> <h2 id="五、pod-生命周期"><a href="#五、pod-生命周期" class="header-anchor">#</a> 五、Pod 生命周期</h2> <h3 id="_1-pod-阶段"><a href="#_1-pod-阶段" class="header-anchor">#</a> 1. Pod 阶段</h3> <p>Pod 的 <code>status</code> 字段是一个 <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.21/#podstatus-v1-core" target="_blank" rel="noopener noreferrer">PodStatus<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对象，其中包含一个 <code>phase</code> 字段。</p> <p>Pod 的阶段（Phase）是 Pod 在其生命周期中所处位置的简单宏观概述。 该阶段并不是对容器或 Pod 状态的综合汇总，也不是为了成为完整的状态机。</p> <p>Pod 阶段的数量和含义是严格定义的。 除了本文档中列举的内容外，不应该再假定 Pod 有其他的 <code>phase</code> 值。</p> <p>下面是 <code>phase</code> 可能的值：</p> <table><thead><tr><th style="text-align:left;">取值</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>Pending</code>（悬决）</td> <td style="text-align:left;">Pod 已被 Kubernetes 系统接受，但有一个或者多个容器尚未创建亦未运行。此阶段包括等待 Pod 被调度的时间和通过网络下载镜像的时间，</td></tr> <tr><td style="text-align:left;"><code>Running</code>（运行中）</td> <td style="text-align:left;">Pod 已经绑定到了某个节点，Pod 中所有的容器都已被创建。至少有一个容器仍在运行，或者正处于启动或重启状态。</td></tr> <tr><td style="text-align:left;"><code>Succeeded</code>（成功）</td> <td style="text-align:left;">Pod 中的所有容器都已成功终止，并且不会再重启。</td></tr> <tr><td style="text-align:left;"><code>Failed</code>（失败）</td> <td style="text-align:left;">Pod 中的所有容器都已终止，并且至少有一个容器是因为失败终止。也就是说，容器以非 0 状态退出或者被系统终止。</td></tr> <tr><td style="text-align:left;"><code>Unknown</code>（未知）</td> <td style="text-align:left;">因为某些原因无法取得 Pod 的状态。这种情况通常是因为与 Pod 所在主机通信失败。</td></tr></tbody></table> <p>如果某节点死掉或者与集群中其他节点失联，Kubernetes 会实施一种策略，将失去的节点上运行的所有 Pod 的 <code>phase</code> 设置为 <code>Failed</code>。</p> <h3 id="_2-容器状态"><a href="#_2-容器状态" class="header-anchor">#</a> 2. 容器状态</h3> <p>Kubernetes 会跟踪 Pod 中每个容器的状态，就像它跟踪 Pod 总体上的<a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/pod-lifecycle/#pod-phase" target="_blank" rel="noopener noreferrer">阶段<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>一样。 你可以使用<a href="https://kubernetes.io/zh/docs/concepts/containers/container-lifecycle-hooks/" target="_blank" rel="noopener noreferrer">容器生命周期回调<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 来在容器生命周期中的特定时间点触发事件。</p> <p>一旦 Kube Scheduler 将 Pod 分派给某个节点，<code>kubelet</code> 就通过 Container Runtime 开始为 Pod 创建容器。 容器的状态有三种：<code>Waiting</code>（等待）、<code>Running</code>（运行中）和 <code>Terminated</code>（已终止）。</p> <p>要检查 Pod 中容器的状态，你可以使用：</p> <div class="language- extra-class"><pre class="language-text"><code>kubectl describe pod &lt;pod 名称&gt;
</code></pre></div><h3 id="_3-容器重启策略"><a href="#_3-容器重启策略" class="header-anchor">#</a> 3. 容器重启策略</h3> <p>Pod 的 <code>spec</code> 中包含一个 <code>restartPolicy</code> 字段，其可能取值包括 <strong>Always</strong>、<strong>OnFailure</strong> 和 <strong>Never</strong>。默认值是 Always。</p> <p><code>restartPolicy</code> 适用于 Pod 中的所有容器。<code>restartPolicy</code> 仅针对同一节点上 <code>kubelet</code>的容器重启动作。当 Pod 中的容器退出时，<code>kubelet</code> 会按指数回退 方式计算重启的延迟（10s、20s、40s、...），其最长延迟为 5 分钟。 一旦某容器执行了 10 分钟并且没有出现问题，<code>kubelet</code> 对该容器的重启回退计时器执行重置操作。</p> <h3 id="_4-pod-状况"><a href="#_4-pod-状况" class="header-anchor">#</a> 4. Pod 状况</h3> <p>Pod 有一个 <code>PodStatus</code> 对象，其中包含一个 <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.21/#podcondition-v1-core" target="_blank" rel="noopener noreferrer">PodConditions<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 数组。Pod 可能通过也可能未通过其中的一些状况测试。</p> <ul><li><code>PodScheduled</code>：Pod 已经被调度到某节点；</li> <li><code>ContainersReady</code>：Pod 中所有容器都已就绪；</li> <li><code>Initialized</code>：所有的 <a href="https://kubernetes.io/zh/docs/concepts/workloads/pods/init-containers/" target="_blank" rel="noopener noreferrer">Init 容器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 都已成功启动；</li> <li><code>Ready</code>：Pod 可以为请求提供服务，并且应该被添加到对应服务的负载均衡池中。</li></ul> <table><thead><tr><th style="text-align:left;">字段名称</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>type</code></td> <td style="text-align:left;">Pod 状况的名称</td></tr> <tr><td style="text-align:left;"><code>status</code></td> <td style="text-align:left;">表明该状况是否适用，可能的取值有 &quot;<code>True</code>&quot;, &quot;<code>False</code>&quot; 或 &quot;<code>Unknown</code>&quot;</td></tr> <tr><td style="text-align:left;"><code>lastProbeTime</code></td> <td style="text-align:left;">上次探测 Pod 状况时的时间戳</td></tr> <tr><td style="text-align:left;"><code>lastTransitionTime</code></td> <td style="text-align:left;">Pod 上次从一种状态转换到另一种状态时的时间戳</td></tr> <tr><td style="text-align:left;"><code>reason</code></td> <td style="text-align:left;">机器可读的、驼峰编码（UpperCamelCase）的文字，表述上次状况变化的原因</td></tr> <tr><td style="text-align:left;"><code>message</code></td> <td style="text-align:left;">人类可读的消息，给出上次状态转换的详细信息</td></tr></tbody></table></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">6/24/2021, 6:26:53 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/noteSite/linux/k8s/k8s-architecture.html" class="prev">
        Kubernetes 集群
      </a></span> <span class="next"><a href="/noteSite/linux/k8s/k8s-deployment.html">
        Deployment
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/noteSite/assets/js/app.d406638e.js" defer></script><script src="/noteSite/assets/js/2.691adf44.js" defer></script><script src="/noteSite/assets/js/23.6310a039.js" defer></script>
  </body>
</html>
