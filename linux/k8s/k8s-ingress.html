<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ingress | Hedon</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/noteSite/favicon.ico">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/noteSite/assets/css/0.styles.0f3b0cbd.css" as="style"><link rel="preload" href="/noteSite/assets/js/app.0c811189.js" as="script"><link rel="preload" href="/noteSite/assets/js/2.691adf44.js" as="script"><link rel="preload" href="/noteSite/assets/js/167.0d58159f.js" as="script"><link rel="prefetch" href="/noteSite/assets/js/10.513ffb86.js"><link rel="prefetch" href="/noteSite/assets/js/100.ac07ec37.js"><link rel="prefetch" href="/noteSite/assets/js/101.ddd933a6.js"><link rel="prefetch" href="/noteSite/assets/js/102.16fe064a.js"><link rel="prefetch" href="/noteSite/assets/js/103.688a786e.js"><link rel="prefetch" href="/noteSite/assets/js/104.8584bb09.js"><link rel="prefetch" href="/noteSite/assets/js/105.250e7dc0.js"><link rel="prefetch" href="/noteSite/assets/js/106.16252a49.js"><link rel="prefetch" href="/noteSite/assets/js/107.d5aa347c.js"><link rel="prefetch" href="/noteSite/assets/js/108.3db1e9b4.js"><link rel="prefetch" href="/noteSite/assets/js/109.04f614fd.js"><link rel="prefetch" href="/noteSite/assets/js/11.f94804aa.js"><link rel="prefetch" href="/noteSite/assets/js/110.df82eeb3.js"><link rel="prefetch" href="/noteSite/assets/js/111.b8428418.js"><link rel="prefetch" href="/noteSite/assets/js/112.d5fd6daa.js"><link rel="prefetch" href="/noteSite/assets/js/113.b1a139d0.js"><link rel="prefetch" href="/noteSite/assets/js/114.a483f638.js"><link rel="prefetch" href="/noteSite/assets/js/115.f4d24768.js"><link rel="prefetch" href="/noteSite/assets/js/116.9495281e.js"><link rel="prefetch" href="/noteSite/assets/js/117.4cb501df.js"><link rel="prefetch" href="/noteSite/assets/js/118.28510268.js"><link rel="prefetch" href="/noteSite/assets/js/119.4750dc83.js"><link rel="prefetch" href="/noteSite/assets/js/12.9e6f8d2b.js"><link rel="prefetch" href="/noteSite/assets/js/120.a1791068.js"><link rel="prefetch" href="/noteSite/assets/js/121.a04290e3.js"><link rel="prefetch" href="/noteSite/assets/js/122.36aae3bf.js"><link rel="prefetch" href="/noteSite/assets/js/123.84a73be5.js"><link rel="prefetch" href="/noteSite/assets/js/124.ea81e59b.js"><link rel="prefetch" href="/noteSite/assets/js/125.daf34cd9.js"><link rel="prefetch" href="/noteSite/assets/js/126.7a4d2950.js"><link rel="prefetch" href="/noteSite/assets/js/127.a90704fe.js"><link rel="prefetch" href="/noteSite/assets/js/128.d5dde71f.js"><link rel="prefetch" href="/noteSite/assets/js/129.edb3b93e.js"><link rel="prefetch" href="/noteSite/assets/js/13.731b1910.js"><link rel="prefetch" href="/noteSite/assets/js/130.4d7387b8.js"><link rel="prefetch" href="/noteSite/assets/js/131.bcca6af8.js"><link rel="prefetch" href="/noteSite/assets/js/132.fbb9801d.js"><link rel="prefetch" href="/noteSite/assets/js/133.909b2229.js"><link rel="prefetch" href="/noteSite/assets/js/134.02d3ded2.js"><link rel="prefetch" href="/noteSite/assets/js/135.dae2ba68.js"><link rel="prefetch" href="/noteSite/assets/js/136.4fe303ea.js"><link rel="prefetch" href="/noteSite/assets/js/137.faa9c671.js"><link rel="prefetch" href="/noteSite/assets/js/138.26e78484.js"><link rel="prefetch" href="/noteSite/assets/js/139.2ef9aa05.js"><link rel="prefetch" href="/noteSite/assets/js/14.187d2c31.js"><link rel="prefetch" href="/noteSite/assets/js/140.4063c62b.js"><link rel="prefetch" href="/noteSite/assets/js/141.f8068804.js"><link rel="prefetch" href="/noteSite/assets/js/142.2835b754.js"><link rel="prefetch" href="/noteSite/assets/js/143.19426a78.js"><link rel="prefetch" href="/noteSite/assets/js/144.6be2ba40.js"><link rel="prefetch" href="/noteSite/assets/js/145.d73c0de9.js"><link rel="prefetch" href="/noteSite/assets/js/146.ef0b48e3.js"><link rel="prefetch" href="/noteSite/assets/js/147.4b80e986.js"><link rel="prefetch" href="/noteSite/assets/js/148.d11d779a.js"><link rel="prefetch" href="/noteSite/assets/js/149.9bd8909d.js"><link rel="prefetch" href="/noteSite/assets/js/15.1b3c9e85.js"><link rel="prefetch" href="/noteSite/assets/js/150.1255d1fe.js"><link rel="prefetch" href="/noteSite/assets/js/151.46963679.js"><link rel="prefetch" href="/noteSite/assets/js/152.87d91a0f.js"><link rel="prefetch" href="/noteSite/assets/js/153.e3e35324.js"><link rel="prefetch" href="/noteSite/assets/js/154.17662d30.js"><link rel="prefetch" href="/noteSite/assets/js/155.c5099bd7.js"><link rel="prefetch" href="/noteSite/assets/js/156.01b0f713.js"><link rel="prefetch" href="/noteSite/assets/js/157.544c8c28.js"><link rel="prefetch" href="/noteSite/assets/js/158.5a5c674d.js"><link rel="prefetch" href="/noteSite/assets/js/159.13a02ff5.js"><link rel="prefetch" href="/noteSite/assets/js/16.46fee424.js"><link rel="prefetch" href="/noteSite/assets/js/160.07a62b62.js"><link rel="prefetch" href="/noteSite/assets/js/161.ce13a129.js"><link rel="prefetch" href="/noteSite/assets/js/162.181ffe3d.js"><link rel="prefetch" href="/noteSite/assets/js/163.2a62e687.js"><link rel="prefetch" href="/noteSite/assets/js/164.8095b198.js"><link rel="prefetch" href="/noteSite/assets/js/165.9f247d76.js"><link rel="prefetch" href="/noteSite/assets/js/166.3671c912.js"><link rel="prefetch" href="/noteSite/assets/js/168.362ca70b.js"><link rel="prefetch" href="/noteSite/assets/js/169.49d9c511.js"><link rel="prefetch" href="/noteSite/assets/js/17.6fb53274.js"><link rel="prefetch" href="/noteSite/assets/js/170.08ddf2b4.js"><link rel="prefetch" href="/noteSite/assets/js/171.a1119dac.js"><link rel="prefetch" href="/noteSite/assets/js/172.73a05c0c.js"><link rel="prefetch" href="/noteSite/assets/js/173.ece9208f.js"><link rel="prefetch" href="/noteSite/assets/js/174.c5c9adc8.js"><link rel="prefetch" href="/noteSite/assets/js/175.4a982c7c.js"><link rel="prefetch" href="/noteSite/assets/js/176.5ed69a2f.js"><link rel="prefetch" href="/noteSite/assets/js/177.a664a573.js"><link rel="prefetch" href="/noteSite/assets/js/178.4ed691e2.js"><link rel="prefetch" href="/noteSite/assets/js/179.6f65659a.js"><link rel="prefetch" href="/noteSite/assets/js/18.898d6582.js"><link rel="prefetch" href="/noteSite/assets/js/180.9fde8c30.js"><link rel="prefetch" href="/noteSite/assets/js/181.2599d514.js"><link rel="prefetch" href="/noteSite/assets/js/182.4349a358.js"><link rel="prefetch" href="/noteSite/assets/js/183.4ef653e3.js"><link rel="prefetch" href="/noteSite/assets/js/184.dc82f566.js"><link rel="prefetch" href="/noteSite/assets/js/185.6564ea92.js"><link rel="prefetch" href="/noteSite/assets/js/186.cb092c8d.js"><link rel="prefetch" href="/noteSite/assets/js/187.59bfc712.js"><link rel="prefetch" href="/noteSite/assets/js/188.1e3fbbf5.js"><link rel="prefetch" href="/noteSite/assets/js/189.e1516fef.js"><link rel="prefetch" href="/noteSite/assets/js/19.8eac4113.js"><link rel="prefetch" href="/noteSite/assets/js/190.6c8110a5.js"><link rel="prefetch" href="/noteSite/assets/js/191.f83b96b7.js"><link rel="prefetch" href="/noteSite/assets/js/192.a622e72b.js"><link rel="prefetch" href="/noteSite/assets/js/193.da13872e.js"><link rel="prefetch" href="/noteSite/assets/js/20.33aeeee1.js"><link rel="prefetch" href="/noteSite/assets/js/21.44c7bf65.js"><link rel="prefetch" href="/noteSite/assets/js/22.361b5176.js"><link rel="prefetch" href="/noteSite/assets/js/23.4908f584.js"><link rel="prefetch" href="/noteSite/assets/js/24.0a42ddb5.js"><link rel="prefetch" href="/noteSite/assets/js/25.8a4456fb.js"><link rel="prefetch" href="/noteSite/assets/js/26.3a6ff334.js"><link rel="prefetch" href="/noteSite/assets/js/27.9605d8df.js"><link rel="prefetch" href="/noteSite/assets/js/28.84e64526.js"><link rel="prefetch" href="/noteSite/assets/js/29.4a2c052d.js"><link rel="prefetch" href="/noteSite/assets/js/3.20f319b2.js"><link rel="prefetch" href="/noteSite/assets/js/30.3f36708c.js"><link rel="prefetch" href="/noteSite/assets/js/31.fde36f38.js"><link rel="prefetch" href="/noteSite/assets/js/32.5018ab21.js"><link rel="prefetch" href="/noteSite/assets/js/33.987398b4.js"><link rel="prefetch" href="/noteSite/assets/js/34.5c9e6c14.js"><link rel="prefetch" href="/noteSite/assets/js/35.9482c4af.js"><link rel="prefetch" href="/noteSite/assets/js/36.e1642b75.js"><link rel="prefetch" href="/noteSite/assets/js/37.6b470bb8.js"><link rel="prefetch" href="/noteSite/assets/js/38.94049564.js"><link rel="prefetch" href="/noteSite/assets/js/39.83b24cbb.js"><link rel="prefetch" href="/noteSite/assets/js/4.a61e4cea.js"><link rel="prefetch" href="/noteSite/assets/js/40.1fe595a8.js"><link rel="prefetch" href="/noteSite/assets/js/41.3ccdda4d.js"><link rel="prefetch" href="/noteSite/assets/js/42.ec2254d5.js"><link rel="prefetch" href="/noteSite/assets/js/43.cf635e74.js"><link rel="prefetch" href="/noteSite/assets/js/44.5c04b2c4.js"><link rel="prefetch" href="/noteSite/assets/js/45.2f9a6d96.js"><link rel="prefetch" href="/noteSite/assets/js/46.01edd7e1.js"><link rel="prefetch" href="/noteSite/assets/js/47.3ccd29c8.js"><link rel="prefetch" href="/noteSite/assets/js/48.6a62a942.js"><link rel="prefetch" href="/noteSite/assets/js/49.5d717ef1.js"><link rel="prefetch" href="/noteSite/assets/js/5.2bccd6df.js"><link rel="prefetch" href="/noteSite/assets/js/50.ace810fb.js"><link rel="prefetch" href="/noteSite/assets/js/51.0f9f5efb.js"><link rel="prefetch" href="/noteSite/assets/js/52.bbfcd8b7.js"><link rel="prefetch" href="/noteSite/assets/js/53.cf21e429.js"><link rel="prefetch" href="/noteSite/assets/js/54.abee4df0.js"><link rel="prefetch" href="/noteSite/assets/js/55.b5e226f7.js"><link rel="prefetch" href="/noteSite/assets/js/56.aef795d9.js"><link rel="prefetch" href="/noteSite/assets/js/57.2df49766.js"><link rel="prefetch" href="/noteSite/assets/js/58.627be3d1.js"><link rel="prefetch" href="/noteSite/assets/js/59.c59792f8.js"><link rel="prefetch" href="/noteSite/assets/js/6.f3d86aa7.js"><link rel="prefetch" href="/noteSite/assets/js/60.2802df43.js"><link rel="prefetch" href="/noteSite/assets/js/61.77833b1e.js"><link rel="prefetch" href="/noteSite/assets/js/62.7a92ee71.js"><link rel="prefetch" href="/noteSite/assets/js/63.b4235576.js"><link rel="prefetch" href="/noteSite/assets/js/64.a51dd8d2.js"><link rel="prefetch" href="/noteSite/assets/js/65.e38443b9.js"><link rel="prefetch" href="/noteSite/assets/js/66.e8bad6ce.js"><link rel="prefetch" href="/noteSite/assets/js/67.ccc8d23f.js"><link rel="prefetch" href="/noteSite/assets/js/68.e70f204f.js"><link rel="prefetch" href="/noteSite/assets/js/69.91836722.js"><link rel="prefetch" href="/noteSite/assets/js/7.f685cce4.js"><link rel="prefetch" href="/noteSite/assets/js/70.038b4cb2.js"><link rel="prefetch" href="/noteSite/assets/js/71.37c9ec6c.js"><link rel="prefetch" href="/noteSite/assets/js/72.e97a7b19.js"><link rel="prefetch" href="/noteSite/assets/js/73.e0c027c5.js"><link rel="prefetch" href="/noteSite/assets/js/74.fcc77e38.js"><link rel="prefetch" href="/noteSite/assets/js/75.cf59b80c.js"><link rel="prefetch" href="/noteSite/assets/js/76.28685e6b.js"><link rel="prefetch" href="/noteSite/assets/js/77.1942d3ed.js"><link rel="prefetch" href="/noteSite/assets/js/78.ec79de66.js"><link rel="prefetch" href="/noteSite/assets/js/79.5aef8285.js"><link rel="prefetch" href="/noteSite/assets/js/8.8201f3a6.js"><link rel="prefetch" href="/noteSite/assets/js/80.973b9ff8.js"><link rel="prefetch" href="/noteSite/assets/js/81.173df5b0.js"><link rel="prefetch" href="/noteSite/assets/js/82.b0caf8f7.js"><link rel="prefetch" href="/noteSite/assets/js/83.414628ac.js"><link rel="prefetch" href="/noteSite/assets/js/84.35c96e2a.js"><link rel="prefetch" href="/noteSite/assets/js/85.371ecfbc.js"><link rel="prefetch" href="/noteSite/assets/js/86.3d2e8bf9.js"><link rel="prefetch" href="/noteSite/assets/js/87.0f2110ba.js"><link rel="prefetch" href="/noteSite/assets/js/88.988e9e38.js"><link rel="prefetch" href="/noteSite/assets/js/89.2188a214.js"><link rel="prefetch" href="/noteSite/assets/js/9.5c954135.js"><link rel="prefetch" href="/noteSite/assets/js/90.42bed1bc.js"><link rel="prefetch" href="/noteSite/assets/js/91.2fe58738.js"><link rel="prefetch" href="/noteSite/assets/js/92.29459b21.js"><link rel="prefetch" href="/noteSite/assets/js/93.26f23013.js"><link rel="prefetch" href="/noteSite/assets/js/94.8c264e19.js"><link rel="prefetch" href="/noteSite/assets/js/95.0e3e39f9.js"><link rel="prefetch" href="/noteSite/assets/js/96.6c57a117.js"><link rel="prefetch" href="/noteSite/assets/js/97.b201f736.js"><link rel="prefetch" href="/noteSite/assets/js/98.a790f10b.js"><link rel="prefetch" href="/noteSite/assets/js/99.67dd0fe7.js">
    <link rel="stylesheet" href="/noteSite/assets/css/0.styles.0f3b0cbd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/noteSite/" class="home-link router-link-active"><img src="/noteSite/images/hedon.png" alt="Hedon" class="logo"> <span class="site-name can-hide">Hedon</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/component/" class="nav-link">
  计算机组成原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/go-full/" class="nav-link">
  Go 开发工程师
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link">
  中间件
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link router-link-active">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><a href="/noteSite/leetcode/" class="nav-link">
  Leetcode
</a></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/component/" class="nav-link">
  计算机组成原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/go-full/" class="nav-link">
  Go 开发工程师
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link">
  中间件
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link router-link-active">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><a href="/noteSite/leetcode/" class="nav-link">
  Leetcode
</a></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux IO</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nginx</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Kubernetes</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/noteSite/linux/k8s/k8s-introduction.html" class="sidebar-link">Kubernetes 简介</a></li><li><a href="/noteSite/linux/k8s/k8s-concept.html" class="sidebar-link">Kubernetes 名词</a></li><li><a href="/noteSite/linux/k8s/k8s-clusterbuild.html" class="sidebar-link">Kubernetes 集群搭建</a></li><li><a href="/noteSite/linux/k8s/k8s-namespace.html" class="sidebar-link">Namespace</a></li><li><a href="/noteSite/linux/k8s/k8s-label.html" class="sidebar-link">Label</a></li><li><a href="/noteSite/linux/k8s/k8s-pod.html" class="sidebar-link">Pod</a></li><li><a href="/noteSite/linux/k8s/k8s-rs.html" class="sidebar-link">ReplicaSet</a></li><li><a href="/noteSite/linux/k8s/k8s-deployment.html" class="sidebar-link">Deployment</a></li><li><a href="/noteSite/linux/k8s/k8s-HPA.html" class="sidebar-link">Horizontal Pod Autoscaler</a></li><li><a href="/noteSite/linux/k8s/k8s-ds.html" class="sidebar-link">DaemonSet</a></li><li><a href="/noteSite/linux/k8s/k8s-job.html" class="sidebar-link">Job</a></li><li><a href="/noteSite/linux/k8s/k8s-service.html" class="sidebar-link">Service</a></li><li><a href="/noteSite/linux/k8s/k8s-ingress.html" aria-current="page" class="active sidebar-link">Ingress</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-ingress.html#一、ingress-原理" class="sidebar-link">一、Ingress 原理</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-ingress.html#二、ingress-使用" class="sidebar-link">二、Ingress 使用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-ingress.html#_1-环境准备" class="sidebar-link">1. 环境准备</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-ingress.html#_2-http-代理" class="sidebar-link">2. HTTP 代理</a></li><li class="sidebar-sub-header"><a href="/noteSite/linux/k8s/k8s-ingress.html#_3-https-代理" class="sidebar-link">3. HTTPS 代理</a></li></ul></li></ul></li><li><a href="/noteSite/linux/k8s/k8s-ss.html" class="sidebar-link">StatefulSet</a></li><li><a href="/noteSite/linux/k8s/k8s-store.html" class="sidebar-link">Kubernetes 数据存储</a></li><li><a href="/noteSite/linux/k8s/k8s-auth.html" class="sidebar-link">Kubernetes 安全认证</a></li><li><a href="/noteSite/linux/k8s/k8s-dashboard.html" class="sidebar-link">Kubernetes DashBoard</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>小技巧</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="ingress"><a href="#ingress" class="header-anchor">#</a> Ingress</h1> <p>我们已经知道，Service 对集群之外暴露服务的主要方式有两种：</p> <ul><li>NodePort</li> <li>LoadBalancer</li></ul> <p>但是这两种方式，都有一定的缺点：</p> <ul><li>NodePort方式 的缺点是会占用很多集群机器的端口，那么当集群服务变多的时候，这个缺点就愈发明显</li> <li>LoadBalancer 的缺点是每个 Service 都需要一个 LB，浪费，麻烦，并且需要 k8s 之外的设备的支持</li></ul> <p>基于这种现状，k8s 提供了 <strong>Ingress</strong> 资源对象，Ingress <strong>只需要一个</strong> NodePort 或者一个 LB 就可以满足暴露多个 Service 的需求，工作机制大致如下图所示：</p> <h2 id="一、ingress-原理"><a href="#一、ingress-原理" class="header-anchor">#</a> 一、Ingress 原理</h2> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gsahzuqow9j30tt0flwft.jpg" alt="Ingress介绍.png"></p> <p>实际上，<strong>Ingress</strong> 相当于一个七层的负载均衡器，是 k8s 对反向代理的一个抽象，它的工作原理类似于 <code>Nginx</code>，<strong>可以理解为 Ingress 里面建立了诸多映射规则，Ingress Controller 通过监听这些配置规则并转化为 Nginx 的反向代理配置，然后对外提供服务。</strong></p> <ul><li>Ingress：k8s 中的一个对象，作用是定义请求如何转发到 Service 的规则</li> <li>Ingress Controller：具体实现反向代理及负载均衡的程序，对 Ingress 定义的规则进行解析，根据配置的规则来实现请求转发，实现的方式有很多，比如 Nginx，Contour，Haproxy 等</li></ul> <p><strong>Ingress</strong>（以Nginx）的工作原理如下：</p> <ol><li>用户编写 Ingress 规则，说明那个域名对应 k8s 集群中的哪个 Service；</li> <li>Ingress Controller 动态感知 Ingress 服务规则的变化，然后生成一段对应的 Nginx 的反向代理配置；</li> <li>Ingress Controller 会将生成的 Nginx 配置写入到一个运行着的 Nginx 服务中，并动态更新；</li> <li>到此为止，其实真正在工作的就是一个 Nginx 了，内部配置了用户定义的请求规则。</li></ol> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gsai83l77fj31400j2teu.jpg" alt="image-20210709104809548"></p> <h2 id="二、ingress-使用"><a href="#二、ingress-使用" class="header-anchor">#</a> 二、Ingress 使用</h2> <h3 id="_1-环境准备"><a href="#_1-环境准备" class="header-anchor">#</a> 1. 环境准备</h3> <h4 id="_1-1-搭建-ingress-环境"><a href="#_1-1-搭建-ingress-环境" class="header-anchor">#</a> 1.1 搭建 Ingress 环境</h4> <ul><li><p>创建 ingress 文件夹，并进去其中</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master k8s<span class="token punctuation">]</span><span class="token comment"># mkdir ingress</span>
<span class="token punctuation">[</span>root@k8s-master k8s<span class="token punctuation">]</span><span class="token comment"># cd ingress/</span>
<span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre></div></li> <li><p>获取 ingress-nginx（v0.30.0）</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">wget</span> https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">wget</span> https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml
</code></pre></div><p>其实就是两个 yaml 文件，下载不了的话可以直接复制下面内容：</p> <p><code>mandatory.yaml</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>configuration
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx

<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tcp<span class="token punctuation">-</span>services
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx

<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> udp<span class="token punctuation">-</span>services
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>serviceaccount
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>clusterrole
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> configmaps
      <span class="token punctuation">-</span> endpoints
      <span class="token punctuation">-</span> nodes
      <span class="token punctuation">-</span> pods
      <span class="token punctuation">-</span> secrets
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> nodes
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> services
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> events
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> create
      <span class="token punctuation">-</span> patch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;extensions&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;networking.k8s.io&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ingresses
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> list
      <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;extensions&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;networking.k8s.io&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ingresses/status
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> update

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>role
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> configmaps
      <span class="token punctuation">-</span> pods
      <span class="token punctuation">-</span> secrets
      <span class="token punctuation">-</span> namespaces
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> configmaps
    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span>
      <span class="token comment"># Defaults to &quot;&lt;election-id&gt;-&lt;ingress-class&gt;&quot;</span>
      <span class="token comment"># Here: &quot;&lt;ingress-controller-leader&gt;-&lt;nginx&gt;&quot;</span>
      <span class="token comment"># This has to be adapted if you change either parameter</span>
      <span class="token comment"># when launching the nginx-ingress-controller.</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;ingress-controller-leader-nginx&quot;</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get
      <span class="token punctuation">-</span> update
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> configmaps
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> create
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> endpoints
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> get

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>role<span class="token punctuation">-</span>nisa<span class="token punctuation">-</span>binding
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>role
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>serviceaccount
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx

<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>clusterrole<span class="token punctuation">-</span>nisa<span class="token punctuation">-</span>binding
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>clusterrole
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>serviceaccount
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>controller
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
      <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
        <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token key atrule">prometheus.io/port</span><span class="token punctuation">:</span> <span class="token string">&quot;10254&quot;</span>
        <span class="token key atrule">prometheus.io/scrape</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token comment"># wait up to five minutes for the drain of connections</span>
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">300</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>serviceaccount
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">kubernetes.io/os</span><span class="token punctuation">:</span> linux
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>controller
          <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/kubernetes<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>controller/nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>controller<span class="token punctuation">:</span>0.30.0
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> /nginx<span class="token punctuation">-</span>ingress<span class="token punctuation">-</span>controller
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>configmap=$(POD_NAMESPACE)/nginx<span class="token punctuation">-</span>configuration
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>tcp<span class="token punctuation">-</span>services<span class="token punctuation">-</span>configmap=$(POD_NAMESPACE)/tcp<span class="token punctuation">-</span>services
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>udp<span class="token punctuation">-</span>services<span class="token punctuation">-</span>configmap=$(POD_NAMESPACE)/udp<span class="token punctuation">-</span>services
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>publish<span class="token punctuation">-</span>service=$(POD_NAMESPACE)/ingress<span class="token punctuation">-</span>nginx
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>annotations<span class="token punctuation">-</span>prefix=nginx.ingress.kubernetes.io
          <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">capabilities</span><span class="token punctuation">:</span>
              <span class="token key atrule">drop</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> ALL
              <span class="token key atrule">add</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> NET_BIND_SERVICE
            <span class="token comment"># www-data -&gt; 101</span>
            <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">101</span>
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAME
              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.name
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAMESPACE
              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.namespace
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> https
              <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">443</span>
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /healthz
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10254</span>
              <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">3</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /healthz
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10254</span>
              <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
            <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span>
            <span class="token key atrule">preStop</span><span class="token punctuation">:</span>
              <span class="token key atrule">exec</span><span class="token punctuation">:</span>
                <span class="token key atrule">command</span><span class="token punctuation">:</span>
                  <span class="token punctuation">-</span> /wait<span class="token punctuation">-</span>shutdown

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> LimitRange
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">limits</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">min</span><span class="token punctuation">:</span>
      <span class="token key atrule">memory</span><span class="token punctuation">:</span> 90Mi
      <span class="token key atrule">cpu</span><span class="token punctuation">:</span> 100m
    <span class="token key atrule">type</span><span class="token punctuation">:</span> Container
</code></pre></div><p><code>service-nodeport.yaml</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> http
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> https
      <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">443</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app.kubernetes.io/name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx
    <span class="token key atrule">app.kubernetes.io/part-of</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>nginx

<span class="token punctuation">---</span>
</code></pre></div></li> <li><p>创建 ingress-nginx</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f ./</span>
namespace/ingress-nginx created
configmap/nginx-configuration created
configmap/tcp-services created
configmap/udp-services created
serviceaccount/nginx-ingress-serviceaccount created
clusterrole.rbac.authorization.k8s.io/nginx-ingress-clusterrole created
role.rbac.authorization.k8s.io/nginx-ingress-role created
rolebinding.rbac.authorization.k8s.io/nginx-ingress-role-nisa-binding created
clusterrolebinding.rbac.authorization.k8s.io/nginx-ingress-clusterrole-nisa-binding created
deployment.apps/nginx-ingress-controller created
limitrange/ingress-nginx created
service/ingress-nginx created
</code></pre></div></li> <li><p>查看 ingress-nginx</p> <div class="language-shell extra-class"><pre class="language-shell"><code>service/ingress-nginx created
<span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n ingress-nginx</span>
NAME                                        READY   STATUS    RESTARTS   AGE
nginx-ingress-controller-5bb8fb4bb6-zbb8x   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          30s
</code></pre></div></li> <li><p>查看 Service</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl get svc -n ingress-nginx</span>
NAME            TYPE       CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
ingress-nginx   NodePort   <span class="token number">10.109</span>.184.192   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:32235/TCP,443:31935/TCP   64s
</code></pre></div></li></ul> <h4 id="_1-2-准备-pod-和-service"><a href="#_1-2-准备-pod-和-service" class="header-anchor">#</a> 1.2 准备 Pod 和 Service</h4> <ul><li><p>为了后面的实验比较方便，创建如下图所示的模型：</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gsaih350spj31da0jagtj.jpg" alt="image-20210709105648149"></p></li> <li><p>创建 <code>tomcat-nginx.yaml</code> 文件，内容如下：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>deployment
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>1.17.1
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">-</span>deployment
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">-</span>pod
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">-</span>pod
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat
        <span class="token key atrule">image</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">:</span>8.5<span class="token punctuation">-</span>jre10<span class="token punctuation">-</span>slim
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>pod
  <span class="token key atrule">clusterIP</span><span class="token punctuation">:</span> None
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">-</span>service
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">-</span>pod
  <span class="token key atrule">clusterIP</span><span class="token punctuation">:</span> None
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre></div></li> <li><p>清理环境</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl delete ns dev</span>
namespace <span class="token string">&quot;dev&quot;</span> deleted
<span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl create ns dev</span>
namespace/dev created
</code></pre></div></li> <li><p>创建 Pod 和 Service</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f tomcat-nginx.yaml </span>
deployment.apps/nginx-deployment created
deployment.apps/tomcat-deployment created
service/nginx-service created
service/tomcat-service created
</code></pre></div></li> <li><p>查看 Pod 和 Service</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl get pod,service -n dev</span>
NAME                                     READY   STATUS    RESTARTS   AGE
pod/nginx-deployment-7d7dd5499b-bt96d    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          69s
pod/nginx-deployment-7d7dd5499b-bwsnp    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          69s
pod/nginx-deployment-7d7dd5499b-pbvzs    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          69s
pod/tomcat-deployment-7d5fcd4756-4j2sv   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          69s
pod/tomcat-deployment-7d5fcd4756-dv5n8   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          69s
pod/tomcat-deployment-7d5fcd4756-lpqbk   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          69s

NAME                     TYPE        CLUSTER-IP   EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>    AGE
service/nginx-service    ClusterIP   None         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>/TCP     69s
service/tomcat-service   ClusterIP   None         <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span>/TCP   69s
</code></pre></div></li></ul> <h3 id="_2-http-代理"><a href="#_2-http-代理" class="header-anchor">#</a> 2. HTTP 代理</h3> <ul><li><p>创建 <code>ingress-http.yaml</code> 文件</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>http
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> nginx.hedon.com <span class="token comment">#可以通过这个域名来访问我们的Nginx</span>
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
            <span class="token key atrule">backend</span><span class="token punctuation">:</span>
              <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service
              <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> tomcat.hedon.com <span class="token comment">#可以通过这个域名来访问我们的Tomcat</span>
      <span class="token key atrule">http</span><span class="token punctuation">:</span>
        <span class="token key atrule">paths</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
            <span class="token key atrule">backend</span><span class="token punctuation">:</span>
              <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">-</span>service
              <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre></div><p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gsaiumli4oj61y60q0tjy02.jpg" alt="image-20210709110948793"></p></li> <li><p>创建 <code>ingress-http</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl create -f ingress-http.yaml</span>
ingress.extensions/ingress-http created
</code></pre></div></li> <li><p>查看 ingress</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl get ingress ingress-http -n dev</span>
NAME           CLASS    HOSTS                              ADDRESS          PORTS   AGE
ingress-http   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>   nginx.hedon.com,tomcat.hedon.com   <span class="token number">10.109</span>.184.192   <span class="token number">80</span>      4m33s
</code></pre></div></li> <li><p>查看对应的 Service</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl get service -n ingress-nginx</span>
NAME            TYPE       CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
ingress-nginx   NodePort   <span class="token number">10.109</span>.184.192   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:32235/TCP,443:31935/TCP   21m
</code></pre></div></li> <li><p>在宿主机的 /etc/hosts 文件中添加如下映射：(172.16.58.200 为 Master 节点的 IP 地址)</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token number">172.16</span>.58.200 nginx.hedon.com
<span class="token number">172.16</span>.58.200 tomcat.hedon.com
</code></pre></div></li> <li><p>查看端口</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl get service -n ingress-nginx</span>
NAME            TYPE       CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
ingress-nginx   NodePort   <span class="token number">10.109</span>.184.192   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:32235/TCP,443:31935/TCP   27m
</code></pre></div></li> <li><p>访问</p> <div class="language-shell extra-class"><pre class="language-shell"><code>http://nginx.hedon.com:32235
http://tomcat.hedon.com:32235
</code></pre></div></li></ul> <h3 id="_3-https-代理"><a href="#_3-https-代理" class="header-anchor">#</a> 3. HTTPS 代理</h3> <ul><li><p>生成证书</p> <div class="language-shell extra-class"><pre class="language-shell"><code>openssl req -x509 -sha256 -nodes -days <span class="token number">365</span> -newkey rsa:2048 -keyout tls.key -out tls.crt -subj <span class="token string">&quot;/C=CN/ST=BJ/L=BJ/O=nginx/CN=hedon.com&quot;</span>
</code></pre></div></li> <li><p>创建密钥</p> <div class="language-shell extra-class"><pre class="language-shell"><code>kubectl create secret tls tls-secret --key tls.key --cert tls.crt
</code></pre></div></li> <li><p>创建 <code>ingress-https.yaml</code></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> extensions/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ingress<span class="token punctuation">-</span>https
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">tls</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> nginx.hedon.com
      <span class="token punctuation">-</span> tomcat.hedon.com
      <span class="token key atrule">secretName</span><span class="token punctuation">:</span> tls<span class="token punctuation">-</span>secret <span class="token comment"># 指定秘钥</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> nginx.hedon.com
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>service
          <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> tomcat.hedon.com
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
        <span class="token key atrule">backend</span><span class="token punctuation">:</span>
          <span class="token key atrule">serviceName</span><span class="token punctuation">:</span> tomcat<span class="token punctuation">-</span>service
          <span class="token key atrule">servicePort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
</code></pre></div></li> <li><p>创建 ingress</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl create -f ingress-https.yaml</span>
ingress.extensions/ingress-https created
</code></pre></div></li> <li><p>查看端口号</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>root@k8s-master ingress<span class="token punctuation">]</span><span class="token comment"># kubectl get service -n ingress-nginx</span>
NAME            TYPE       CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                      AGE
ingress-nginx   NodePort   <span class="token number">10.109</span>.184.192   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:32235/TCP,443:31935/TCP   46m
</code></pre></div></li> <li><p>访问</p> <div class="language-shell extra-class"><pre class="language-shell"><code>https://nginx.hedon.com:31935
https://tomcat.hedon.com:31935
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">7/9/2021, 12:00:10 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/noteSite/linux/k8s/k8s-service.html" class="prev">
        Service
      </a></span> <span class="next"><a href="/noteSite/linux/k8s/k8s-ss.html">
        StatefulSet
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/noteSite/assets/js/app.0c811189.js" defer></script><script src="/noteSite/assets/js/2.691adf44.js" defer></script><script src="/noteSite/assets/js/167.0d58159f.js" defer></script>
  </body>
</html>
