<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>三、网络层 | Hedon</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/noteSite/favicon.ico">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/noteSite/assets/css/0.styles.0f3b0cbd.css" as="style"><link rel="preload" href="/noteSite/assets/js/app.b7b8330f.js" as="script"><link rel="preload" href="/noteSite/assets/js/2.0f8877a4.js" as="script"><link rel="preload" href="/noteSite/assets/js/55.20b0af56.js" as="script"><link rel="prefetch" href="/noteSite/assets/js/10.15bae158.js"><link rel="prefetch" href="/noteSite/assets/js/100.da77329f.js"><link rel="prefetch" href="/noteSite/assets/js/101.62303c19.js"><link rel="prefetch" href="/noteSite/assets/js/102.fa7af2ed.js"><link rel="prefetch" href="/noteSite/assets/js/103.7cd06d4d.js"><link rel="prefetch" href="/noteSite/assets/js/104.47a2f579.js"><link rel="prefetch" href="/noteSite/assets/js/105.c6801f91.js"><link rel="prefetch" href="/noteSite/assets/js/106.6798bda3.js"><link rel="prefetch" href="/noteSite/assets/js/107.640f2f82.js"><link rel="prefetch" href="/noteSite/assets/js/108.4cb1bda1.js"><link rel="prefetch" href="/noteSite/assets/js/109.4f9fd3b6.js"><link rel="prefetch" href="/noteSite/assets/js/11.9a37c04b.js"><link rel="prefetch" href="/noteSite/assets/js/110.3cdaa804.js"><link rel="prefetch" href="/noteSite/assets/js/111.75f75099.js"><link rel="prefetch" href="/noteSite/assets/js/112.252bc34a.js"><link rel="prefetch" href="/noteSite/assets/js/113.5d75064d.js"><link rel="prefetch" href="/noteSite/assets/js/114.46ba6c5b.js"><link rel="prefetch" href="/noteSite/assets/js/115.b4a60c6f.js"><link rel="prefetch" href="/noteSite/assets/js/116.407ecd16.js"><link rel="prefetch" href="/noteSite/assets/js/117.2d7ef551.js"><link rel="prefetch" href="/noteSite/assets/js/118.ec6637e1.js"><link rel="prefetch" href="/noteSite/assets/js/119.4a4b833e.js"><link rel="prefetch" href="/noteSite/assets/js/12.4c375597.js"><link rel="prefetch" href="/noteSite/assets/js/120.30cf49dc.js"><link rel="prefetch" href="/noteSite/assets/js/121.eda11e46.js"><link rel="prefetch" href="/noteSite/assets/js/122.36860463.js"><link rel="prefetch" href="/noteSite/assets/js/123.f44b2d4c.js"><link rel="prefetch" href="/noteSite/assets/js/124.de76a3f1.js"><link rel="prefetch" href="/noteSite/assets/js/125.2e15f8e8.js"><link rel="prefetch" href="/noteSite/assets/js/126.ec40f9a0.js"><link rel="prefetch" href="/noteSite/assets/js/127.b07b8c8a.js"><link rel="prefetch" href="/noteSite/assets/js/128.5adb1f8a.js"><link rel="prefetch" href="/noteSite/assets/js/129.377204a2.js"><link rel="prefetch" href="/noteSite/assets/js/13.434b5f1e.js"><link rel="prefetch" href="/noteSite/assets/js/130.4b113c66.js"><link rel="prefetch" href="/noteSite/assets/js/14.c4835766.js"><link rel="prefetch" href="/noteSite/assets/js/15.75fb42a0.js"><link rel="prefetch" href="/noteSite/assets/js/16.c118e0d3.js"><link rel="prefetch" href="/noteSite/assets/js/17.3d6697d1.js"><link rel="prefetch" href="/noteSite/assets/js/18.d815f23f.js"><link rel="prefetch" href="/noteSite/assets/js/19.bec6f68b.js"><link rel="prefetch" href="/noteSite/assets/js/20.fdf3ee8c.js"><link rel="prefetch" href="/noteSite/assets/js/21.824bcb2d.js"><link rel="prefetch" href="/noteSite/assets/js/22.cf71177a.js"><link rel="prefetch" href="/noteSite/assets/js/23.6f74a633.js"><link rel="prefetch" href="/noteSite/assets/js/24.7382ddd7.js"><link rel="prefetch" href="/noteSite/assets/js/25.af43d6fd.js"><link rel="prefetch" href="/noteSite/assets/js/26.eabb7cc4.js"><link rel="prefetch" href="/noteSite/assets/js/27.f59ddf00.js"><link rel="prefetch" href="/noteSite/assets/js/28.3cd8d62d.js"><link rel="prefetch" href="/noteSite/assets/js/29.e890aaed.js"><link rel="prefetch" href="/noteSite/assets/js/3.0a7565fe.js"><link rel="prefetch" href="/noteSite/assets/js/30.92bc43cd.js"><link rel="prefetch" href="/noteSite/assets/js/31.6612acd4.js"><link rel="prefetch" href="/noteSite/assets/js/32.09f35455.js"><link rel="prefetch" href="/noteSite/assets/js/33.6cd05492.js"><link rel="prefetch" href="/noteSite/assets/js/34.f20f23e5.js"><link rel="prefetch" href="/noteSite/assets/js/35.75974898.js"><link rel="prefetch" href="/noteSite/assets/js/36.a5858bc3.js"><link rel="prefetch" href="/noteSite/assets/js/37.bb0f36b8.js"><link rel="prefetch" href="/noteSite/assets/js/38.203de39c.js"><link rel="prefetch" href="/noteSite/assets/js/39.5ab121bf.js"><link rel="prefetch" href="/noteSite/assets/js/4.a61e4cea.js"><link rel="prefetch" href="/noteSite/assets/js/40.f59ebf3c.js"><link rel="prefetch" href="/noteSite/assets/js/41.71e89eba.js"><link rel="prefetch" href="/noteSite/assets/js/42.36252a8d.js"><link rel="prefetch" href="/noteSite/assets/js/43.384f9aba.js"><link rel="prefetch" href="/noteSite/assets/js/44.5fbc05d2.js"><link rel="prefetch" href="/noteSite/assets/js/45.8f067cee.js"><link rel="prefetch" href="/noteSite/assets/js/46.a976536b.js"><link rel="prefetch" href="/noteSite/assets/js/47.4b1b18f6.js"><link rel="prefetch" href="/noteSite/assets/js/48.677ddcbf.js"><link rel="prefetch" href="/noteSite/assets/js/49.46837e83.js"><link rel="prefetch" href="/noteSite/assets/js/5.2bccd6df.js"><link rel="prefetch" href="/noteSite/assets/js/50.8d606821.js"><link rel="prefetch" href="/noteSite/assets/js/51.42f31180.js"><link rel="prefetch" href="/noteSite/assets/js/52.4a21edaf.js"><link rel="prefetch" href="/noteSite/assets/js/53.5f849076.js"><link rel="prefetch" href="/noteSite/assets/js/54.77540704.js"><link rel="prefetch" href="/noteSite/assets/js/56.380ee0ef.js"><link rel="prefetch" href="/noteSite/assets/js/57.a3b47db0.js"><link rel="prefetch" href="/noteSite/assets/js/58.26616988.js"><link rel="prefetch" href="/noteSite/assets/js/59.f9de7eb4.js"><link rel="prefetch" href="/noteSite/assets/js/6.f3d86aa7.js"><link rel="prefetch" href="/noteSite/assets/js/60.aedebc3c.js"><link rel="prefetch" href="/noteSite/assets/js/61.5e1c5bf5.js"><link rel="prefetch" href="/noteSite/assets/js/62.456d2379.js"><link rel="prefetch" href="/noteSite/assets/js/63.bda54a58.js"><link rel="prefetch" href="/noteSite/assets/js/64.4ec660ac.js"><link rel="prefetch" href="/noteSite/assets/js/65.656ea5b5.js"><link rel="prefetch" href="/noteSite/assets/js/66.9fa19698.js"><link rel="prefetch" href="/noteSite/assets/js/67.b6603c5c.js"><link rel="prefetch" href="/noteSite/assets/js/68.552b5187.js"><link rel="prefetch" href="/noteSite/assets/js/69.4ad81a4c.js"><link rel="prefetch" href="/noteSite/assets/js/7.f685cce4.js"><link rel="prefetch" href="/noteSite/assets/js/70.e738a94f.js"><link rel="prefetch" href="/noteSite/assets/js/71.fa309b95.js"><link rel="prefetch" href="/noteSite/assets/js/72.3ad1ad8e.js"><link rel="prefetch" href="/noteSite/assets/js/73.59db72fb.js"><link rel="prefetch" href="/noteSite/assets/js/74.aca76866.js"><link rel="prefetch" href="/noteSite/assets/js/75.9a48d62d.js"><link rel="prefetch" href="/noteSite/assets/js/76.f5d83364.js"><link rel="prefetch" href="/noteSite/assets/js/77.940a3c4f.js"><link rel="prefetch" href="/noteSite/assets/js/78.dda81c31.js"><link rel="prefetch" href="/noteSite/assets/js/79.6b7b3149.js"><link rel="prefetch" href="/noteSite/assets/js/8.1e22ea55.js"><link rel="prefetch" href="/noteSite/assets/js/80.47649e06.js"><link rel="prefetch" href="/noteSite/assets/js/81.7e29c52f.js"><link rel="prefetch" href="/noteSite/assets/js/82.ef5c05e0.js"><link rel="prefetch" href="/noteSite/assets/js/83.33f9554d.js"><link rel="prefetch" href="/noteSite/assets/js/84.59a86b96.js"><link rel="prefetch" href="/noteSite/assets/js/85.a5af06ea.js"><link rel="prefetch" href="/noteSite/assets/js/86.d6acd6da.js"><link rel="prefetch" href="/noteSite/assets/js/87.d586a791.js"><link rel="prefetch" href="/noteSite/assets/js/88.b6b0edf8.js"><link rel="prefetch" href="/noteSite/assets/js/89.c2fd328c.js"><link rel="prefetch" href="/noteSite/assets/js/9.09db9bdb.js"><link rel="prefetch" href="/noteSite/assets/js/90.f4c54fd9.js"><link rel="prefetch" href="/noteSite/assets/js/91.08c0bb8e.js"><link rel="prefetch" href="/noteSite/assets/js/92.6524d29c.js"><link rel="prefetch" href="/noteSite/assets/js/93.9a23433e.js"><link rel="prefetch" href="/noteSite/assets/js/94.40cb7921.js"><link rel="prefetch" href="/noteSite/assets/js/95.b6787120.js"><link rel="prefetch" href="/noteSite/assets/js/96.22e5365f.js"><link rel="prefetch" href="/noteSite/assets/js/97.3ce29173.js"><link rel="prefetch" href="/noteSite/assets/js/98.b28577f8.js"><link rel="prefetch" href="/noteSite/assets/js/99.e6d99a5b.js">
    <link rel="stylesheet" href="/noteSite/assets/css/0.styles.0f3b0cbd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/noteSite/" class="home-link router-link-active"><img src="/noteSite/images/hedon.png" alt="Hedon" class="logo"> <span class="site-name can-hide">Hedon</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link router-link-active">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link">
  中间件
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Leetcode Menu" class="dropdown-title"><span class="title">Leetcode</span> <span class="arrow down"></span></button> <button type="button" aria-label="Leetcode Menu" class="mobile-dropdown-title"><span class="title">Leetcode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/data-structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/algorithm-thought/" class="nav-link">
  算法思想
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/leetcode/" class="nav-link">
  Leetcode
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link router-link-active">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link">
  中间件
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Leetcode Menu" class="dropdown-title"><span class="title">Leetcode</span> <span class="arrow down"></span></button> <button type="button" aria-label="Leetcode Menu" class="mobile-dropdown-title"><span class="title">Leetcode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/data-structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/algorithm-thought/" class="nav-link">
  算法思想
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/leetcode/" class="nav-link">
  Leetcode
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>计算机网络</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/noteSite/cs/cn/cn-total.html" class="sidebar-link">一、计算机网络模型</a></li><li><a href="/noteSite/cs/cn/cn-link-layer.html" class="sidebar-link">二、链路层</a></li><li><a href="/noteSite/cs/cn/cn-network-layer.html" aria-current="page" class="active sidebar-link">三、网络层</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_1-ip-协议" class="sidebar-link">1. IP 协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_1-1-ip报文" class="sidebar-link">1.1 IP报文</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_1-2-分类-ip-地址" class="sidebar-link">1.2 分类 IP 地址</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_1-3-ip-协议的转发流程" class="sidebar-link">1.3 IP 协议的转发流程</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_1-4-子网划分" class="sidebar-link">1.4 子网划分</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_1-5-无分类编址-cidr" class="sidebar-link">1.5 无分类编址 CIDR</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_1-6-网络地址转换-nat" class="sidebar-link">1.6 网络地址转换 NAT</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_2-arp-协议" class="sidebar-link">2. ARP 协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_2-1-作用" class="sidebar-link">2.1 作用</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_2-2-工作原理" class="sidebar-link">2.2 工作原理</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_3-rarp-协议" class="sidebar-link">3. RARP 协议</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_4-icmp-协议" class="sidebar-link">4. ICMP 协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_4-1-作用" class="sidebar-link">4.1 作用</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_4-2-icmp-报文的格式" class="sidebar-link">4.2 ICMP 报文的格式</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_4-3-icmp-报文的种类" class="sidebar-link">4.3 ICMP 报文的种类</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_4-4-应用" class="sidebar-link">4.4 应用</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_5-路由" class="sidebar-link">5. 路由</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_5-1-自治系统" class="sidebar-link">5.1 自治系统</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_5-2-内部网关协议-rip-路由信息协议" class="sidebar-link">5.2 内部网关协议 RIP —— 路由信息协议</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_5-3-内部网关协议-ospf-开放最短路径优先" class="sidebar-link">5.3 内部网关协议 OSPF —— 开放最短路径优先</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_5-4-外部网关协议-bgp" class="sidebar-link">5.4 外部网关协议 BGP</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_5-5-路由器的构成" class="sidebar-link">5.5 路由器的构成</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_6-ipv6" class="sidebar-link">6. IPv6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_6-1-ipv6-的基本首部" class="sidebar-link">6.1 IPv6 的基本首部</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_6-2-ipv6-的地址" class="sidebar-link">6.2 IPv6 的地址</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_6-3-从-ipv4-向-ipv6-过渡" class="sidebar-link">6.3 从 IPv4 向 IPv6 过渡</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_6-4-icmpv6" class="sidebar-link">6.4 ICMPv6</a></li><li class="sidebar-sub-header"><a href="/noteSite/cs/cn/cn-network-layer.html#_6-5-与-ipv4-进行比较" class="sidebar-link">6.5 与 IPv4 进行比较</a></li></ul></li></ul></li><li><a href="/noteSite/cs/cn/cn-transfer-layer.html" class="sidebar-link">四、传输层</a></li><li><a href="/noteSite/cs/cn/cn-apply-layer.html" class="sidebar-link">五、应用层</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试题</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="三、网络层"><a href="#三、网络层" class="header-anchor">#</a> 三、网络层</h1> <img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gndutfs001j31mp0u0dls.jpg" alt="image-20200326114127000"> <h2 id="_1-ip-协议"><a href="#_1-ip-协议" class="header-anchor">#</a> 1. IP 协议</h2> <h3 id="_1-1-ip报文"><a href="#_1-1-ip报文" class="header-anchor">#</a> 1.1 IP报文</h3> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3muv02xkj31ch0u077x.jpg" alt="image-20210206160107159" style="zoom:33%;"> <ol><li>版本：ip报文中，版本占了4位，用来表示该协议采用的是那一个版本的ip，相同版本的ip才能进行通信。一般此处的值为4，表示ipv4。</li> <li>头长度：该字段用四位表示，表示整个ip包头的长度，其中数的单位是4字节。即二进制数0000-1111（十进制数0-15），其中一个最小长度为0字节，最大长度为60字节。一般来说此处的值为0101，表示头长度为20字节。</li> <li>Tos服务字段：该字段用8位表示。该字段一般情况下不使用。</li> <li>总长度：该字段表示整个ip报文的长度，单位是1字节。能表示的最大字节为2^16-1=65535字节。不过由于链路层的MTU限制。超过1480字节后就会被分片（以太帧MTU为1500的情况下，除去20字节的包头）</li> <li>标识：该字段是ip软件实现的时候自动产生的，该字段的目的不是为了接受方的按序接受而设置的，而是在ip分片以后，用来标识同一片分片的。方便ip分片的重组。</li> <li>标志：该字段是与ip分片有关的。其中有三位，但只有两位是有效的，分别为MF，DF。<strong>MF标识后面是否还有分片，为1时，表示后面还有分片。DF标识是否能分片，为0表示可以分片。</strong></li> <li>片偏移：该字段是与ip分片后，相应的ip片在总的ip片的位置。该字段的单位是8字节。比如，一个长度为4000字节的ip报文，到达路由器。这是超过了链路层的MTU，需要进行分片，4000字节中，20字节为包头，3980字节为数据，需要分成3个ip片（链路层MTU为1500），那么第一个分片的片偏移就是0，表示该分片在3980的第0位开始，第1479位结束。第二个ip片的片偏移为185（1480/8），表示该分片开始的位置在原来ip的第1480位，结束在2959。第三片的片偏移为370（2960/8），表示开始的时候是2960位，结束的时候在3979位。</li> <li>TTL：该片表示生存周期，该值占8位。ip分片每经过一个路由器该值减一，它的出现是为了防止路由环路，浪费带宽的问题。比如，该ip在R1路由器发送到R2路由器。R2路由器又发给R1路由器。防止这种循环。window系统默认为128.</li> <li>协议：该值标识上层的协议。占8位。其中1，标识ICMP、2标识IGMP、6标识TCP、17标识UDP、89标识OSPF。</li> <li>校验和：该值是对整个数据包的包头进行的校验。占16位。</li> <li>源地址和目的地址:标识发送ip片的源和目的ip，32位</li> <li>可选的部分：一般一些特殊的要求会加在这个部分。</li> <li>数据</li></ol> <h3 id="_1-2-分类-ip-地址"><a href="#_1-2-分类-ip-地址" class="header-anchor">#</a> 1.2 分类 IP 地址</h3> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv44j3yj31g60u0afg.jpg" alt="image-20200326145344859" style="zoom:25%;"> <p><font color="pink">规律：最多4位，且1越来越多，0只能在后。</font></p> <h5 id="一般不使用的特殊的-ip-地址"><a href="#一般不使用的特殊的-ip-地址" class="header-anchor">#</a> 一般不使用的特殊的 IP 地址</h5> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3muvqyffj31pm0u07ft.jpg" alt="image-20200326150927810" style="zoom:25%;"> <h5 id="常用的3种类别的-ip-地址"><a href="#常用的3种类别的-ip-地址" class="header-anchor">#</a> 常用的3种类别的 IP 地址</h5> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv7f9yuj31qm0k6n36.jpg" alt="image-20200402100326347" style="zoom:25%;"> <ul><li>A 网络号个数减 2 的原因：
<ul><li>网络号全0，是个保留地址，表示”本网络“。</li> <li>网络号全1，保留作文本地软件”环回测试“本主机的进程之间的通信之用。
<ul><li>不会发送到任何网络。</li></ul></li></ul></li> <li>A 主机号个数减 2 的原因：
<ul><li>全 0 的主机号字段表示该 IP 地址是“本主机”所连接到的单个网络地址。</li> <li>全 1 的主机号字段表示该网络上的所有主机。</li></ul></li> <li>B 网络号减 1 的原因
<ul><li>不存在全 0 和 全 1</li> <li>但是128.0.0.0 是不指派的，而可以指派的 B 类最小网络地址是 128.1.0.0</li></ul></li> <li>B 主机号 减 2 的原因同 A</li> <li>C 网络号 减 1 的原因同 B</li> <li>C 主机号 减 2 的原因同 A</li></ul> <h3 id="_1-3-ip-协议的转发流程"><a href="#_1-3-ip-协议的转发流程" class="header-anchor">#</a> 1.3 IP 协议的转发流程</h3> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv0etw6j31bd0u0qcf.jpg" alt="image-20200402113538109" style="zoom:33%;"> <h3 id="_1-4-子网划分"><a href="#_1-4-子网划分" class="header-anchor">#</a> 1.4 子网划分</h3> <h5 id="划分思路"><a href="#划分思路" class="header-anchor">#</a> 划分思路</h5> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv2ru4yj31ek0u046j.jpg" alt="image-20200402120026072" style="zoom:33%;"> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3muwp2p2j31940u0k00.jpg" alt="image-20200402120036917" style="zoom:33%;"> <ul><li><p>划分子网纯属一个单位内部的事情。单位对外仍然表现为没有划分子网的网络。</p></li> <li><p>从主机号借用若干个位作为子网号 <strong>subnet-id</strong>，而主机号 <strong>host-id</strong> 也就相应减少了若干个位。</p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3muzf9dyj31lo0gotby.jpg" alt="image-20200402115806570" style="zoom:25%;"></li> <li><p>凡是从其他网络发送给本单位某个主机的 <strong>IP</strong> 数 据报，仍然是根据 <strong>IP</strong> 数据报的目的网络号 <strong>net- id</strong>，先找到连接在本单位网络上的路由器。</p></li> <li><p>然后此路由器在收到 <strong>IP</strong> 数据报后，再按目的网 络号 <strong>net-id</strong> 和子网号 <strong>subnet-id</strong> 找到目的子网。</p></li> <li><p>最后就将 <strong>IP</strong> 数据报直接交付目的主机。</p></li></ul> <h5 id="子网掩码"><a href="#子网掩码" class="header-anchor">#</a> 子网掩码</h5> <p>从一个 IP 数据包的首部并无法判断源主机或目的主机所连接的网络是否进行了子网划分。</p> <p>使用子网掩码可以找出 IP 地址的子网部分。</p> <ul><li>子网掩码长度 = 32 位
<ul><li>某位 = 1：IP 地址对应位为网络号和子网号</li> <li>某位 = 0：IP 地址对应位为主机号</li></ul></li></ul> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv6xg5ij31m00rudm9.jpg" alt="image-20200402120612061" style="zoom:25%;"> <h3 id="_1-5-无分类编址-cidr"><a href="#_1-5-无分类编址-cidr" class="header-anchor">#</a> 1.5 无分类编址 CIDR</h3> <ul><li><strong>CIDR</strong> 消除了传统的 <strong>A</strong> 类、<strong>B</strong> 类和 <strong>C</strong> 类地址以及划分子网的概念，因而可以更加有效地分配 <strong>IPv4</strong> 的地址空间。</li> <li><strong>CIDR</strong>使用各种长度的“网络前缀”**(network- prefix)**来代替分类地址中的网络号和子网号。</li> <li><strong>IP</strong> 地址从三级编址(使用子网掩码)又回到了 <strong>两级编址</strong>。</li></ul> <h4 id="_1-5-1-格式"><a href="#_1-5-1-格式" class="header-anchor">#</a> 1.5.1 格式</h4> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv0whaej310807swfv.jpg" alt="image-20200409101713821" style="zoom:33%;"> <h5 id="_1-使用-斜线记法"><a href="#_1-使用-斜线记法" class="header-anchor">#</a> [1] 使用“斜线记法”</h5> <ul><li>220.78.168.0 / 24
<ul><li>表明网络前缀占了24位</li> <li>这样就剩下8位主机号了</li></ul></li></ul> <h5 id="_2-其他记法"><a href="#_2-其他记法" class="header-anchor">#</a> [2] 其他记法</h5> <ul><li><p><strong>10.0.0.0/10</strong> 可简写为 <strong>10/10</strong>，也就是把点分十进制中低位连续的 <strong>0</strong> 省略。</p></li> <li><p><strong>10.0.0.0/10</strong> 隐含地指出 <strong>IP</strong> 地址 <strong>10.0.0.0</strong> 的掩码是<strong>255.192.0.0</strong>。</p></li> <li><p>网络前缀的后面加一个星号 ***** 的表示方法，如 <strong>00001010 00*</strong>，在星号 ***** 之前是网络前缀，而星号 ***** 表示 <strong>IP</strong> 地址中的主机号，可以是任意值。</p></li></ul> <h4 id="_1-5-2-常用的-cidr-地址块"><a href="#_1-5-2-常用的-cidr-地址块" class="header-anchor">#</a> 1.5.2 常用的 CIDR 地址块</h4> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mvd1gc2j310w0m6q8x.jpg" alt="image-20200409102903372" style="zoom:33%;"> <h5 id="【例题】"><a href="#【例题】" class="header-anchor">#</a> 【例题】</h5> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3muy2x0sj317o0u0q7o.jpg" alt="image-20200410204129693"></p> <h4 id="_1-5-3-构成超网"><a href="#_1-5-3-构成超网" class="header-anchor">#</a> 1.5.3 构成超网</h4> <p>前缀长度不超过 <strong>23</strong> 位的 <strong>CIDR</strong> 地址块都包含了多个 <strong>C</strong> 类地址。这些 <strong>C</strong> 类地址合起来就构成了超网。</p> <h4 id="_1-5-4-cidr-地址块划分举例"><a href="#_1-5-4-cidr-地址块划分举例" class="header-anchor">#</a> 1.5.4 CIDR 地址块划分举例</h4> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv3o0nsj312s0nen5l.jpg" alt="image-20200409103240252" style="zoom:33%;"> <h4 id="_1-5-5-最长前缀匹配"><a href="#_1-5-5-最长前缀匹配" class="header-anchor">#</a> 1.5.5 最长前缀匹配</h4> <p>从匹配结果中选择具有最长网络前缀的路由。</p> <img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdnbo7dp07j30y60lytd6.jpg" alt="image-20200409104846259" style="zoom:33%;"> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv62dk3j310q0g0dkh.jpg" alt="image-20200409104907630" style="zoom:33%;"> <p>这里选择第2个项目。</p> <h4 id="_1-5-6-使用二叉线索查找路由表"><a href="#_1-5-6-使用二叉线索查找路由表" class="header-anchor">#</a> 1.5.6 使用二叉线索查找路由表</h4> <p>下面例题的唯一前缀有 5 位</p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv7uhbkj310y0bkadb.jpg" alt="image-20200409105529810" style="zoom:33%;"> <h3 id="_1-6-网络地址转换-nat"><a href="#_1-6-网络地址转换-nat" class="header-anchor">#</a> 1.6 网络地址转换 NAT</h3> <blockquote><p>NAT 技术用于多个主机通过一个公有 IP 访问互联网的私有网络中。</p></blockquote> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3muv8k7hj31940msdj0.jpg" alt="image-20210206201708504"></p> <h2 id="_2-arp-协议"><a href="#_2-arp-协议" class="header-anchor">#</a> 2. ARP 协议</h2> <blockquote><p>ARP 协议在 TCP/IP 模型中属于IP层（网络层），在 OSI 模型中属于链路层。ARP 协议即地址解析协议，是根据 IP 地址获取物理地址的一个 TCP/IP 协议。它可以解决同一个局域网内主机或路由器的IP地址和 MAC 地址的映射问题</p></blockquote> <h3 id="_2-1-作用"><a href="#_2-1-作用" class="header-anchor">#</a> 2.1 作用</h3> <blockquote><p>通过一个机器（主机或路由器）的 IP 地址，找出其相应的硬件地址。</p></blockquote> <img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gndw2w4tp2j31ca0ek77j.jpg" alt="image-20200402102958914" style="zoom:33%;"> <h3 id="_2-2-工作原理"><a href="#_2-2-工作原理" class="header-anchor">#</a> 2.2 工作原理</h3> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv1uwsej316r0u0gtl.jpg" alt="image-20200402103223569" style="zoom:40%;"> <h2 id="_3-rarp-协议"><a href="#_3-rarp-协议" class="header-anchor">#</a> 3. RARP 协议</h2> <blockquote><p>将 MAC 地址转为 IP 地址。</p></blockquote> <h2 id="_4-icmp-协议"><a href="#_4-icmp-协议" class="header-anchor">#</a> 4. ICMP 协议</h2> <blockquote><p>网际控制报文协议（Internet Control Message Protocal）。</p></blockquote> <h3 id="_4-1-作用"><a href="#_4-1-作用" class="header-anchor">#</a> 4.1 作用</h3> <ul><li><strong>ICMP</strong> 允许主机或路由器报告<strong>差错</strong>情况和提供有关<strong>异常</strong>情况的报告。</li></ul> <h3 id="_4-2-icmp-报文的格式"><a href="#_4-2-icmp-报文的格式" class="header-anchor">#</a> 4.2 ICMP 报文的格式</h3> <p><font color="Red">PS： <strong>ICMP</strong> 不是高层协议</font></p> <img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdnc59r629j310w0g0dim.jpg" alt="image-20200409110510138" style="zoom:33%;"> <h3 id="_4-3-icmp-报文的种类"><a href="#_4-3-icmp-报文的种类" class="header-anchor">#</a> 4.3 ICMP 报文的种类</h3> <h5 id="icmp-差错报告报文"><a href="#icmp-差错报告报文" class="header-anchor">#</a> ICMP 差错报告报文</h5> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3muw68u7j31180f4q60.jpg" alt="image-20200409110656993" style="zoom:33%;"> <ul><li>终点不可达</li> <li>重定向</li> <li>超时</li> <li>参数问题</li></ul> <p>几种不应该发送 ICMP 差错报告报文的情况</p> <ul><li>对 <strong>ICMP</strong> 差错报告报文不再发送 <strong>ICMP</strong> 差错报告报文。</li> <li>对第一个分片的数据报片的所有后续数据报片都不发送 <strong>ICMP</strong> 差错报告报文。</li> <li>对具有多播地址的数据报都不发送 <strong>ICMP</strong> 差错报告报文。</li> <li>对具有特殊地址(如<strong>127.0.0.0</strong> 或 <strong>0.0.0.0</strong>)的数据报不发送 <strong>ICMP</strong> 差错报告报文。</li></ul> <h5 id="icmp-询问报文"><a href="#icmp-询问报文" class="header-anchor">#</a> ICMP 询问报文</h5> <ul><li>回送请求和回答请求</li> <li>时间戳请求和回答报文</li></ul> <h3 id="_4-4-应用"><a href="#_4-4-应用" class="header-anchor">#</a> 4.4 应用</h3> <h5 id="ping-packet-internet-groper"><a href="#ping-packet-internet-groper" class="header-anchor">#</a> PING（<strong>Packet InterNet Groper</strong>）</h5> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3muz2o3mj30zk0dm76e.jpg" alt="image-20200409111203988" style="zoom:50%;"> <ul><li><p>作用：测试两个主机之间的连通性。</p></li> <li><p><strong>PING</strong> 使用了 <strong>ICMP</strong> 的回显请求报文与回显应答报文。</p> <blockquote><p>利用网络上机器IP地址的唯一性，给目标IP地址发送一个数据包，再要求对方返回一个同样大小的数据包来确定两台网络机器是否连接相通，时延是多少。</p></blockquote> <div class="language-markdown extra-class"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> ping 详细过程</span>
现在我们用主机 A ping局域网内的主机 B，A 会先看看自己有没有 B 的 MAC 地址，如果没有就向外发送一个 ARP 广播包。

    交换机收到这个 ARP 广播包后，会检索自己有没有保存 B 的 MAC 地址，如果有则直接返回给主机 A，如果没有则向所有端口发送 ARP 广播。

    局域网内的其它主机收到这个 ARP 广播包，会去看看是不是在找自己，如果不是，就丢弃掉这个包。B 会立即响应自己的 MAC 地址是多少，按同样的 ARP 报文格式返回给 A，并且自己也学习到了 A 的 MAC 地址。

    有了 B 的 MAC 地址后，A 就可以将其封装到 ICMP 报文中，然后向主机 B 发送该报文，报文格式如：[IP首部，ICMP报文]

    B 收到 A 发送的 ICMP 回显请求后，再按照同样的格式返回一个值给 A，这样就完成了局域网内的 ping 过程。

    需要注意的是，完成这个过程后主机 A 就学习到了 B 的 MAC 地址，在接下来的一段时间内再次 ping，就不需要发送 ARP 广播包了。

    如果 A ping 的是另一网段的主机 C，那么发送的 ARP 广播包会到路由器，路由器会把原来的 MAC 头部换成自己的 MAC 地址，然后查找自己已经学习到的路由表，找到相应的出口转发出去。

    主机 C 学到了路由器一个端口的 MAC 地址，该端口转发给另一端口，而另一个端口学到了 A 的地址，这样就不需要再次做 ARP 解析了，直接将 ICMP 回显的请求回复过去。
</code></pre></div></li> <li><p><strong>PING</strong> 是应用层直接使用网络层 <strong>ICMP</strong> 的例子， 它没有通过运输层的 <strong>TCP</strong> 或<strong>UDP</strong>。</p></li></ul> <h5 id="traceroute"><a href="#traceroute" class="header-anchor">#</a> Traceroute</h5> <img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdncdulz7cj310i0hejvy.jpg" alt="image-20200409111324454" style="zoom:50%;"> <ul><li><p>用来跟踪一个分组从源点到终点的路径。</p></li> <li><p>它利用 <strong>IP</strong> 数据报中的 <strong>TTL</strong> 字段和 <strong>ICMP</strong> 时间超时差错报告报文实现对从源点到终点的路径的跟踪。</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv34h3ej30hj0cw0te.jpg" alt="img"></p> <div class="language-markdown extra-class"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> traceroute 详细过程</span>
	客户端发送一个TTL为1的ICMP请求回显数据包，在第一跳的时候超时并返回一个ICMP超时数据包，得到第一跳的地址。
	客户端发送一个TTL为2的ICMP请求回显数据包，得到第二跳的地址。
	客户端发送一个TTL为3的ICMP请求回显数据包，到达目标主机，目标主机返回一个ICMP回显应答，traceroute结束。
</code></pre></div></li></ul> <h2 id="_5-路由"><a href="#_5-路由" class="header-anchor">#</a> 5. 路由</h2> <h3 id="_5-1-自治系统"><a href="#_5-1-自治系统" class="header-anchor">#</a> 5.1 自治系统</h3> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv5hiexj311c09ggnj.jpg" alt="image-20200409113450496" style="zoom:33%;"> <p>尽管 一个 <strong>AS</strong> 使用了多种内部路由选择协议和度量，但重要的是一个 <strong>AS</strong> 对其他 <strong>AS</strong> 表现出的是一个单一的和一致的路由选择策略。</p> <h3 id="_5-2-内部网关协议-rip-路由信息协议"><a href="#_5-2-内部网关协议-rip-路由信息协议" class="header-anchor">#</a> 5.2 内部网关协议 RIP —— 路由信息协议</h3> <h4 id="_5-2-1-工作原理"><a href="#_5-2-1-工作原理" class="header-anchor">#</a> 5.2.1 工作原理</h4> <ul><li><p><strong>RIP</strong> 是一种分布式的、基于<strong>距离向量</strong>的路由选择协议。</p></li> <li><p><strong>RIP</strong> 协议要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的==距离记录==。</p></li> <li><p><strong>RIP</strong> 协议中的“距离”也称为“跳数”<strong>(hop count)</strong>，因为每经过一个路由器，跳数就加 <strong>1</strong>。</p></li> <li><p>“距离”=“最短距离”</p></li></ul> <p><font color="red">△ 距离</font></p> <ul><li><strong>RIP</strong> 认为一个好的路由就是它通过的路由器的数目少，即“距离短”。</li> <li><strong>RIP</strong> 允许一条路径最多只能包含 <strong>15</strong> 个路由器。</li> <li>“距离”的最大值为 <strong>16</strong> 时即相当于不可达。可见 <strong>RIP</strong> 只适用于==小型互联网==。</li> <li><strong>RIP</strong> 不能在两个网络之间同时使用多条路由。 <strong>RIP</strong> 选择一个具有最少路由器的路由(即最短路由)，哪怕还存在另一条高速**(<strong>低时延</strong>)**但路由器较多的路由。</li></ul> <h4 id="_5-2-2-特点"><a href="#_5-2-2-特点" class="header-anchor">#</a> 5.2.2 特点</h4> <ul><li><p><strong>(1)</strong> 仅和==相邻路由器==交换信息。</p></li> <li><p><strong>(2)</strong> 交换的信息是当前本路由器所知道的全部信息，即自己的==路由表==。</p></li> <li><p><strong>(3)</strong> 按==固定的时间间隔==交换路由信息，</p> <p>​		例如，每隔 <strong>30</strong> 秒。当网络拓扑发生变化时，路由器也及时向相邻路由器通告拓扑变化后的路由信息。</p></li></ul> <h4 id="_5-2-3-路由表的建立"><a href="#_5-2-3-路由表的建立" class="header-anchor">#</a> 5.2.3 路由表的建立</h4> <p>一开始是空的，边交换边更新，很快就知道自己所在的自治系统的所有结点的信息了。</p> <h5 id="【★】距离向量算法"><a href="#【★】距离向量算法" class="header-anchor">#</a> 【★】距离向量算法</h5> <p>其实就是一个不断试验不断优化的过程。</p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3muzxm0dj31j60l00wj.jpg" alt="image-20210209164020702" style="zoom:33%;"> <h5 id="【例题】-2"><a href="#【例题】-2" class="header-anchor">#</a> 【例题】</h5> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv291zej311i0oun4u.jpg" alt="image-20200409115446502" style="zoom:33%;"> <p>第一行在表 4-9(a) 中没有，因此要把这一行添加到表 4-9(a) 中；</p> <p>第二行的 Net2 在表 4-9(a) 中有，且下一条路由器也是 R~4~，因此要更新（距离变大了）；</p> <p>第三行的 Net3 在表 4-9(a) 中有，但是下一条路由器不一样。于是就要比较举例。新的路由信息的距离是 2，小于原来表中的 4，因此要更新。</p> <h4 id="_5-2-4-rip2-协议的报文格式"><a href="#_5-2-4-rip2-协议的报文格式" class="header-anchor">#</a> 5.2.4 RIP2 协议的报文格式</h4> <img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdndnd7svej311i0jwtcp.jpg" alt="image-20200409115709342" style="zoom:33%;"> <ul><li>特点
<ul><li>具有简单的鉴别功能</li></ul></li></ul> <h4 id="_5-2-5-特点"><a href="#_5-2-5-特点" class="header-anchor">#</a> 5.2.5 特点</h4> <p>好消息传播得快，坏消息传播得慢</p> <h4 id="_5-2-6-存在的问题"><a href="#_5-2-6-存在的问题" class="header-anchor">#</a> 5.2.6 存在的问题</h4> <p>当网络出现故障时，要经过比较长的时间 <strong>（<strong>例如数分钟</strong>）</strong> 才能将此信息传送到所有的路由器。</p> <h3 id="_5-3-内部网关协议-ospf-开放最短路径优先"><a href="#_5-3-内部网关协议-ospf-开放最短路径优先" class="header-anchor">#</a> 5.3 内部网关协议 OSPF —— 开放最短路径优先</h3> <h4 id="_5-3-1-特点"><a href="#_5-3-1-特点" class="header-anchor">#</a> 5.3.1 特点</h4> <ul><li>向本自治系统中所有路由器发送信息（洪泛法）；</li> <li>发送的信息就是本路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息；</li> <li>只有当链路状态发生变化时，路由器才向所有路由器用洪泛法发送此信息。
<ul><li>RIP 是不管有没有变化，都要定期交换信息。</li></ul></li> <li>OSPF 允许管理员（根据业务不同）给每条路由指派不同的代价；</li> <li>如果到同一个目的网络有多条代价相同的路径，那么可以分摊——==负载平衡==；</li> <li>所有在 OSPF 路由器之间交换的分租都具有==鉴别==的功能；</li> <li>OSPF 支持可变长度的子网划分和无分类的编址 CIDR</li> <li>由于网络中的链路状态可能经常发生变化，因此 OSPF 让每一个链路状态都带上一个 32 位的序号
<ul><li>序号越大，状态越新</li> <li>序号增长速率不得超过 5s 中 1 次</li></ul></li></ul> <h4 id="_5-3-2-划分区域"><a href="#_5-3-2-划分区域" class="header-anchor">#</a> 5.3.2 划分区域</h4> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mvab0ynj319i0h6jva.jpg" alt="image-20200423100217990"></p> <h4 id="_5-3-3-报文格式"><a href="#_5-3-3-报文格式" class="header-anchor">#</a> 5.3.3 报文格式</h4> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mvb4mdaj31780mg436.jpg" alt="image-20200423100424380"></p> <h4 id="_5-3-3-5种类型"><a href="#_5-3-3-5种类型" class="header-anchor">#</a> 5.3.3 5种类型</h4> <ul><li>问候分组</li> <li>数据库描述分组</li> <li>链路状态请求分组</li> <li>链路状态更新分组
<ul><li>洪泛法</li> <li>最核心</li></ul></li> <li>链路状态确认分组</li></ul> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv6kmc1j31b20fgmzx.jpg" alt="image-20200423101030021"></p> <h4 id="_5-3-4-dijkstra-迪杰斯特拉-算法"><a href="#_5-3-4-dijkstra-迪杰斯特拉-算法" class="header-anchor">#</a> 5.3.4 Dijkstra（迪杰斯特拉）算法</h4> <h3 id="_5-4-外部网关协议-bgp"><a href="#_5-4-外部网关协议-bgp" class="header-anchor">#</a> 5.4 外部网关协议 BGP</h3> <h4 id="_5-4-1-出现的原因"><a href="#_5-4-1-出现的原因" class="header-anchor">#</a> 5.4.1 出现的原因</h4> <ul><li>互联网规模太大，使得自治系统 AS 之间路由选择非常困难；</li> <li>自治系统 AS 之间的路由选择必须考虑有关策略。</li></ul> <h4 id="_5-4-2-路径向量路由选择协议"><a href="#_5-4-2-路径向量路由选择协议" class="header-anchor">#</a> 5.4.2 路径向量路由选择协议</h4> <ul><li><p>思想：</p> <blockquote><p>只是力求寻找一条能够==达到目的网络==且==比较好==的路由（不能兜圈子）。</p></blockquote></li></ul> <p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gnh93brrmij31o80emn1b.jpg" alt="image-20200423101946201"></p> <ul><li><p><font color="Red">BGP 协议交换路由信息的结点数量级是自治系统个数的量级</font></p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mux59l0j31640fy0v9.jpg" alt="image-20200423102237350" style="zoom:33%;"></li></ul> <h4 id="_5-4-3-路由表"><a href="#_5-4-3-路由表" class="header-anchor">#</a> 5.4.3 路由表</h4> <ul><li>目的网络前缀（说明支持CIDR）；</li> <li>下一跳路由器；</li> <li>到达该目的网络所要经过的自治系统序列。</li></ul> <h4 id="_5-4-4-4种报文"><a href="#_5-4-4-4种报文" class="header-anchor">#</a> 5.4.4 4种报文</h4> <ul><li>OPEN：打开，用来与相邻的另一个 BGP 发言人建立关系，使通信初始化；</li> <li>UPDATE：更新，用来告知某一路由的信息，以及列出要撤销的多条路由；</li> <li>KEEPALIVE：保活，用来周期性地证实邻站的连通性；</li> <li>NOTIFACATION：通知，用来发送检测到的差错。</li></ul> <h4 id="_5-4-5-报文格式"><a href="#_5-4-5-报文格式" class="header-anchor">#</a> 5.4.5 报文格式</h4> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mvcjbasj61fe0iw0y502.jpg" alt="image-20200423103303171"></p> <h3 id="_5-5-路由器的构成"><a href="#_5-5-路由器的构成" class="header-anchor">#</a> 5.5 路由器的构成</h3> <h4 id="_5-5-1-路由器的结构"><a href="#_5-5-1-路由器的结构" class="header-anchor">#</a> 5.5.1 路由器的结构</h4> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv4mcs3j313c0iun0t.jpg" alt="image-20200423105428227"></p> <h4 id="_5-5-2-路由器的两大部分"><a href="#_5-5-2-路由器的两大部分" class="header-anchor">#</a> 5.5.2 路由器的两大部分</h4> <h5 id="_1-路由选择"><a href="#_1-路由选择" class="header-anchor">#</a> (1) 路由选择</h5> <ol><li>根据所选定的路由选择协议构造出路由表，同时经常或定期地和相邻路由器交换路由信息而不断地更新和维护路由表。</li></ol> <h5 id="_2-分组转发"><a href="#_2-分组转发" class="header-anchor">#</a> (2) 分组转发</h5> <ol><li><p>交换结构</p> <p>根据转发表对分组进行处理，将某个输入端口进入的分组从一个合适的输出端口转发出去；</p></li> <li><p>输入端口</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv1d754j319m0eetb3.jpg" alt="image-20200423105545189"></p></li> <li><p>输出端口</p> <p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gnh93d71a6j31aa0euwhb.jpg" alt="image-20200423105526547"></p></li></ol> <p><font color="red">△ 这里的端口都是硬件端口</font></p> <h4 id="_5-5-3-转发-和-路由选择-的区别"><a href="#_5-5-3-转发-和-路由选择-的区别" class="header-anchor">#</a> 5.5.3 “转发”和“路由选择”的区别</h4> <h5 id="_1-涉及的路由器个数"><a href="#_1-涉及的路由器个数" class="header-anchor">#</a> (1) 涉及的路由器个数</h5> <ul><li><strong>转发</strong>仅仅涉及到一个路由器</li> <li><strong>路由选择</strong>涉及多个路由器</li></ul> <h5 id="_2-表"><a href="#_2-表" class="header-anchor">#</a> (2) 表</h5> <ul><li>路由表
<ul><li>一般仅包含从目的网络到下一跳（IP地址）的映射</li></ul></li> <li>转发表
<ul><li>转发表由路由表得出；</li> <li>必须包含完成转发功能所需的信息
<ul><li>要到达的目的网络</li> <li>输出端口</li> <li>某些MAC地址信息</li></ul></li></ul></li> <li><font color="red">△ 在讨论“路由选择”的时候，可笼统使用路由表，不区分这两种表</font></li></ul> <h4 id="_5-5-4-交换结构"><a href="#_5-5-4-交换结构" class="header-anchor">#</a> 5.5.4 交换结构</h4> <h5 id="_1-通过存储器"><a href="#_1-通过存储器" class="header-anchor">#</a> (1) 通过存储器</h5> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mvbl36wj30mk0aidgl.jpg" alt="image-20200423151009401" style="zoom:33%;"> <h5 id="_2-通过总线"><a href="#_2-通过总线" class="header-anchor">#</a> (2) 通过总线</h5> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv526fpj30iw0ak74x.jpg" alt="image-20200423151046163" style="zoom:43%;"> <h5 id="_3-通过互连网络"><a href="#_3-通过互连网络" class="header-anchor">#</a> (3) 通过互连网络</h5> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mve1seqj30r60ewmye.jpg" alt="image-20200423151033058" style="zoom:33%;"> <h2 id="_6-ipv6"><a href="#_6-ipv6" class="header-anchor">#</a> 6. IPv6</h2> <h3 id="_6-1-ipv6-的基本首部"><a href="#_6-1-ipv6-的基本首部" class="header-anchor">#</a> 6.1 IPv6 的基本首部</h3> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv8cd28j31h00u0474.jpg" alt="image-20200423154204552"></p> <p>① 更大的地址空间</p> <ul><li><p>IPv6 是 128 位</p></li> <li><p>IPv4 是 32 位</p></li></ul> <p>② 扩展的地址层次结构</p> <p>③ 灵活的首部格式</p> <ul><li>IPv6 有很多可选的扩展首部</li></ul> <p>④ 改进的选项</p> <ul><li><p>IPv6 允许数据报含有选项的控制信息。</p> <ul><li>但 IPv6 的首部长度是固定的，其选项放在有效载荷中。</li></ul></li> <li><p>IPv4 的选项是固定不变的，放在首部的可变部分中。</p></li></ul> <p>⑤ 允许协议继续扩充</p> <p>⑥ 支持即插即用</p> <ul><li>自动配置</li> <li>不需要使用DHCP</li></ul> <p>⑦ 支持资源的预分配</p> <p>⑧ 首部改为 8 字节对齐</p> <ul><li>IPv4 首部是 4 字节对齐</li></ul> <h3 id="_6-2-ipv6-的地址"><a href="#_6-2-ipv6-的地址" class="header-anchor">#</a> 6.2 IPv6 的地址</h3> <h4 id="_6-2-1-冒号十六进制记法"><a href="#_6-2-1-冒号十六进制记法" class="header-anchor">#</a> 6.2.1 冒号十六进制记法</h4> <h5 id="_1-基础版"><a href="#_1-基础版" class="header-anchor">#</a> (1) 基础版</h5> <p>0000 : 0000 : FFFF : 0000 : 0000 : 1180 : 960A : FFFF</p> <h5 id="_2-0000-→-0"><a href="#_2-0000-→-0" class="header-anchor">#</a> (2) 0000 → 0</h5> <p>0 : 0 : FFFF : 0 : 0 : 1180 : 960A : FFFF</p> <h5 id="_3-零压缩-只允许一次"><a href="#_3-零压缩-只允许一次" class="header-anchor">#</a> (3) 零压缩 （只允许一次）</h5> <p>==: :== FFFF : 0 : 0 : 1180 : 960A : FFFF （√）</p> <p>0 : 0 : FFFF ==:  :== 1180 : 960A : FFFF（√）</p> <p>: : FFFF :  : 1180 : 960A : FFFF（×）</p> <h5 id="_4-与前缀结合"><a href="#_4-与前缀结合" class="header-anchor">#</a> (4) 与前缀结合</h5> <p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gnhdf7iqkjj31d60dsadd.jpg" alt="image-20200423155513576"></p> <h5 id="【例题】-3"><a href="#【例题】-3" class="header-anchor">#</a> 【例题】</h5> <p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gnhdfa84vtj315i0iwgof.jpg" alt="image-20200430095907265"></p> <h4 id="_6-2-2-单播"><a href="#_6-2-2-单播" class="header-anchor">#</a> 6.2.2 单播</h4> <blockquote><p>点对点</p></blockquote> <h4 id="_6-2-3-多播"><a href="#_6-2-3-多播" class="header-anchor">#</a> 6.2.3 多播</h4> <blockquote><p>一对多</p></blockquote> <h4 id="_6-2-4-任播"><a href="#_6-2-4-任播" class="header-anchor">#</a> 6.2.4 任播</h4> <blockquote><p>新类型，终点是==一组==计算机，但数据报只交付给最近（通常是）的一个。</p></blockquote> <h4 id="_6-2-5-地址分类"><a href="#_6-2-5-地址分类" class="header-anchor">#</a> 6.2.5 地址分类</h4> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3muxmnstj310u0bytat.jpg" alt="image-20200423155600432" style="zoom:50%;"> <h3 id="_6-3-从-ipv4-向-ipv6-过渡"><a href="#_6-3-从-ipv4-向-ipv6-过渡" class="header-anchor">#</a> 6.3 从 IPv4 向 IPv6 过渡</h3> <h4 id="_6-3-1-双协议栈"><a href="#_6-3-1-双协议栈" class="header-anchor">#</a> 6.3.1 双协议栈</h4> <p>见人说人话，见鬼说鬼话。</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mv9uwa7j319o0m643k.jpg" alt="image-20200423155952248"></p> <h4 id="_6-3-2-隧道技术"><a href="#_6-3-2-隧道技术" class="header-anchor">#</a> 6.3.2 隧道技术</h4> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3muym8o2j31ac0lkdkc.jpg" alt="image-20200423160348450"></p> <h3 id="_6-4-icmpv6"><a href="#_6-4-icmpv6" class="header-anchor">#</a> 6.4 ICMPv6</h3> <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ge3rhe900zj30xs08ujwu.jpg" alt="image-20200423160450945" style="zoom:43%;"> <h4 id="_6-4-1-作用"><a href="#_6-4-1-作用" class="header-anchor">#</a> 6.4.1 作用</h4> <ul><li>利用报文来报告差错</li> <li>获取信息</li> <li>探测邻站</li> <li>管理多播通信</li></ul> <h4 id="_6-4-2-分类"><a href="#_6-4-2-分类" class="header-anchor">#</a> 6.4.2 分类</h4> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt3mvaneaxj30yg0a63zo.jpg" alt="image-20200423160642966" style="zoom:43%;"> <h5 id="【例题】-4"><a href="#【例题】-4" class="header-anchor">#</a> 【例题】</h5> <p><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gnhdf70sybj314m0aataq.jpg" alt="image-20200430095804460"></p> <h3 id="_6-5-与-ipv4-进行比较"><a href="#_6-5-与-ipv4-进行比较" class="header-anchor">#</a> 6.5 与 IPv4 进行比较</h3> <div class="language-markdown extra-class"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 1. 报头</span>
<span class="token list punctuation">1.</span> IPv6报头占40字节，较IPv4报头（变长的24字节）长，但是结构简单
<span class="token list punctuation">2.</span> IPv6报头去掉了IPv4报头中许多不常用的域，放入了可选项和报头扩展，其可选项有更严格的定义
<span class="token list punctuation">3.</span> IPv6报头中有6个域和2个地址空间，相对于IPv4中的10个固定长度的域、2个地址空间和若干个选项的结构来说IPV6更简单
<span class="token title important"><span class="token punctuation">#</span> 2. 地址</span>
<span class="token list punctuation">1.</span> IPv6协议的地址长度是128位，全部可分配地址数为2的128次方（2^128）个，不再存在地址匮乏问题
<span class="token list punctuation">2.</span> IPv6地址表示方式和IPv4也不同：
	IPv4地址表示为点分十进制格式
	IPv6采用的是冒号十六进制格式
<span class="token title important"><span class="token punctuation">#</span> 3. 地址配置</span>
<span class="token list punctuation">1.</span> IPv6协议支持地址自动配置，这是一种即插即用的机制
<span class="token list punctuation">2.</span> IPv6节点通过地址自动配置得到IPv6地址和网关地址
<span class="token list punctuation">3.</span> IPv6支持无状态地址自动配置和状态地址自动配置两种地址自动配置方式。它会给配置128位的地址带来很大的方便，特别是无状态地址自动配置
如何实现：
    “即插即用”是指无需人为干涉，将一个节点插入IPv6网络并在网络中启动，IPv6使用了两种不同的机制来支持即插即用网络连接：启动协议（BOOTstrap Protocol，BOOTP）和动态主机配置协议（DHCP）。 这两种机制允许IP节点从特殊的BOOTP服务器或DHCP服务器获取配置信息。这些协议采用“状态自动配置”（Stateful Autoconfiguration），即服务器必须保持每个节点的状态信息，并管理这些保存的信息。
<span class="token title important"><span class="token punctuation">#</span> 4. 域名解析</span>
<span class="token list punctuation">1.</span> IPv6中的DNS与IPv4的在体系结构上相同，都采用树型结构域名空间。
<span class="token list punctuation">2.</span> IPv4和IPv6共同拥有统一的域名空间。
<span class="token list punctuation">3.</span> IPv6可以自动发现提供解析服务的DNS，有两种方式：
	(1) 无状态的DNS服务器发现；
	(2) 有状态的DNS服务器发现。
		有状态的DNS服务器发现方式是通过类似DHCP的服务器把DNS服务器地址、域名和搜索路径等DNS信息告知节点。无状态DNS服务器自动发现有多种方式。
<span class="token title important"><span class="token punctuation">#</span> 5. 网上邻居</span>
IPv6定义了邻居发现协议NDP，它使用一系列IPv6控制信息报文（ICMPv6）来实现相邻节点（同一链路上的节点）的交互管理，并在一个子网中保持网络层地址和链路层地址之间的映射。
<span class="token title important"><span class="token punctuation">#</span> 6. 路由技术</span>
Pv6主要使用三种路由协议：RIPv6（路由信息协议）、OSPFv6（开放最短路径优先）和IDRPv2（域间路由协议），以及可能的EIGRP和双层的IS-IS。
IPv4可路由的协议有IP、IPX等，不可路由的主要有DEC，NETBIOS等。
</code></pre></div><!----></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/3/2021, 3:51:50 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/noteSite/cs/cn/cn-link-layer.html" class="prev">
        二、链路层
      </a></span> <span class="next"><a href="/noteSite/cs/cn/cn-transfer-layer.html">
        四、传输层
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/noteSite/assets/js/app.b7b8330f.js" defer></script><script src="/noteSite/assets/js/2.0f8877a4.js" defer></script><script src="/noteSite/assets/js/55.20b0af56.js" defer></script>
  </body>
</html>
