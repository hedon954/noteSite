<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>三、类加载、连接和初始化 | Hedon</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/noteSite/favicon.ico">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/noteSite/assets/css/0.styles.2b5d8ceb.css" as="style"><link rel="preload" href="/noteSite/assets/js/app.eecb7af2.js" as="script"><link rel="preload" href="/noteSite/assets/js/2.0f8877a4.js" as="script"><link rel="preload" href="/noteSite/assets/js/42.4625bc4d.js" as="script"><link rel="prefetch" href="/noteSite/assets/js/10.9a97bd95.js"><link rel="prefetch" href="/noteSite/assets/js/100.92ff3756.js"><link rel="prefetch" href="/noteSite/assets/js/101.b961d627.js"><link rel="prefetch" href="/noteSite/assets/js/102.f75eebe3.js"><link rel="prefetch" href="/noteSite/assets/js/103.f4d0f991.js"><link rel="prefetch" href="/noteSite/assets/js/104.b6a8356a.js"><link rel="prefetch" href="/noteSite/assets/js/105.8be2e79c.js"><link rel="prefetch" href="/noteSite/assets/js/106.7ebdae5c.js"><link rel="prefetch" href="/noteSite/assets/js/107.3ae52f0e.js"><link rel="prefetch" href="/noteSite/assets/js/108.0744c9af.js"><link rel="prefetch" href="/noteSite/assets/js/109.6cb19f16.js"><link rel="prefetch" href="/noteSite/assets/js/11.d6449e4b.js"><link rel="prefetch" href="/noteSite/assets/js/110.db9c6c9c.js"><link rel="prefetch" href="/noteSite/assets/js/111.85ab6e8d.js"><link rel="prefetch" href="/noteSite/assets/js/112.38142bcf.js"><link rel="prefetch" href="/noteSite/assets/js/113.a78fbdf7.js"><link rel="prefetch" href="/noteSite/assets/js/114.12823fe4.js"><link rel="prefetch" href="/noteSite/assets/js/115.c9a3a80a.js"><link rel="prefetch" href="/noteSite/assets/js/116.76804354.js"><link rel="prefetch" href="/noteSite/assets/js/117.89277e56.js"><link rel="prefetch" href="/noteSite/assets/js/118.51d0eda9.js"><link rel="prefetch" href="/noteSite/assets/js/119.468fa2dc.js"><link rel="prefetch" href="/noteSite/assets/js/12.84338459.js"><link rel="prefetch" href="/noteSite/assets/js/120.eb97f720.js"><link rel="prefetch" href="/noteSite/assets/js/121.23fc474b.js"><link rel="prefetch" href="/noteSite/assets/js/122.da845dc5.js"><link rel="prefetch" href="/noteSite/assets/js/123.eece2d1e.js"><link rel="prefetch" href="/noteSite/assets/js/124.cce4b723.js"><link rel="prefetch" href="/noteSite/assets/js/125.df71867e.js"><link rel="prefetch" href="/noteSite/assets/js/126.1c342c90.js"><link rel="prefetch" href="/noteSite/assets/js/127.f90abc17.js"><link rel="prefetch" href="/noteSite/assets/js/128.80e7f8d7.js"><link rel="prefetch" href="/noteSite/assets/js/129.61b40720.js"><link rel="prefetch" href="/noteSite/assets/js/13.cfd4493f.js"><link rel="prefetch" href="/noteSite/assets/js/130.d7e089e5.js"><link rel="prefetch" href="/noteSite/assets/js/131.3cf1fb9d.js"><link rel="prefetch" href="/noteSite/assets/js/132.171447d2.js"><link rel="prefetch" href="/noteSite/assets/js/133.6e411f84.js"><link rel="prefetch" href="/noteSite/assets/js/134.98f11957.js"><link rel="prefetch" href="/noteSite/assets/js/135.773eda6c.js"><link rel="prefetch" href="/noteSite/assets/js/136.1b2eca50.js"><link rel="prefetch" href="/noteSite/assets/js/137.2e3529fc.js"><link rel="prefetch" href="/noteSite/assets/js/138.81b6683c.js"><link rel="prefetch" href="/noteSite/assets/js/139.d2a735fe.js"><link rel="prefetch" href="/noteSite/assets/js/14.f255fb4c.js"><link rel="prefetch" href="/noteSite/assets/js/140.7157746c.js"><link rel="prefetch" href="/noteSite/assets/js/141.00ec9050.js"><link rel="prefetch" href="/noteSite/assets/js/142.80e00cf8.js"><link rel="prefetch" href="/noteSite/assets/js/143.c54cdde5.js"><link rel="prefetch" href="/noteSite/assets/js/144.e36f749b.js"><link rel="prefetch" href="/noteSite/assets/js/145.c2f2865d.js"><link rel="prefetch" href="/noteSite/assets/js/146.e15f6808.js"><link rel="prefetch" href="/noteSite/assets/js/147.e6a3a9a8.js"><link rel="prefetch" href="/noteSite/assets/js/148.f20d95ed.js"><link rel="prefetch" href="/noteSite/assets/js/149.65aa2eee.js"><link rel="prefetch" href="/noteSite/assets/js/15.47938ffc.js"><link rel="prefetch" href="/noteSite/assets/js/150.17e56518.js"><link rel="prefetch" href="/noteSite/assets/js/151.412978ad.js"><link rel="prefetch" href="/noteSite/assets/js/152.75bb77eb.js"><link rel="prefetch" href="/noteSite/assets/js/153.22d961f0.js"><link rel="prefetch" href="/noteSite/assets/js/154.530bb2d2.js"><link rel="prefetch" href="/noteSite/assets/js/155.70e6ec77.js"><link rel="prefetch" href="/noteSite/assets/js/156.7d987aa0.js"><link rel="prefetch" href="/noteSite/assets/js/157.9aa989b2.js"><link rel="prefetch" href="/noteSite/assets/js/158.88e832dc.js"><link rel="prefetch" href="/noteSite/assets/js/159.9159ce77.js"><link rel="prefetch" href="/noteSite/assets/js/16.c118e0d3.js"><link rel="prefetch" href="/noteSite/assets/js/160.4752298e.js"><link rel="prefetch" href="/noteSite/assets/js/161.eb0d8a97.js"><link rel="prefetch" href="/noteSite/assets/js/17.42c5f955.js"><link rel="prefetch" href="/noteSite/assets/js/18.574f909b.js"><link rel="prefetch" href="/noteSite/assets/js/19.bec6f68b.js"><link rel="prefetch" href="/noteSite/assets/js/20.b8985a34.js"><link rel="prefetch" href="/noteSite/assets/js/21.279cf49f.js"><link rel="prefetch" href="/noteSite/assets/js/22.7912c368.js"><link rel="prefetch" href="/noteSite/assets/js/23.f01b7a89.js"><link rel="prefetch" href="/noteSite/assets/js/24.2f969812.js"><link rel="prefetch" href="/noteSite/assets/js/25.84a2245b.js"><link rel="prefetch" href="/noteSite/assets/js/26.3957e636.js"><link rel="prefetch" href="/noteSite/assets/js/27.0524a352.js"><link rel="prefetch" href="/noteSite/assets/js/28.f6f1a60d.js"><link rel="prefetch" href="/noteSite/assets/js/29.4aa4c77f.js"><link rel="prefetch" href="/noteSite/assets/js/3.b32820e1.js"><link rel="prefetch" href="/noteSite/assets/js/30.de36f890.js"><link rel="prefetch" href="/noteSite/assets/js/31.6612acd4.js"><link rel="prefetch" href="/noteSite/assets/js/32.1c373dc5.js"><link rel="prefetch" href="/noteSite/assets/js/33.7880c009.js"><link rel="prefetch" href="/noteSite/assets/js/34.b50f71ab.js"><link rel="prefetch" href="/noteSite/assets/js/35.8afc1eec.js"><link rel="prefetch" href="/noteSite/assets/js/36.24097fb5.js"><link rel="prefetch" href="/noteSite/assets/js/37.66fe3725.js"><link rel="prefetch" href="/noteSite/assets/js/38.29ab7e60.js"><link rel="prefetch" href="/noteSite/assets/js/39.86aa09aa.js"><link rel="prefetch" href="/noteSite/assets/js/4.80421812.js"><link rel="prefetch" href="/noteSite/assets/js/40.1824a160.js"><link rel="prefetch" href="/noteSite/assets/js/41.a115cc5e.js"><link rel="prefetch" href="/noteSite/assets/js/43.5afc6529.js"><link rel="prefetch" href="/noteSite/assets/js/44.8a72c388.js"><link rel="prefetch" href="/noteSite/assets/js/45.00d33cf9.js"><link rel="prefetch" href="/noteSite/assets/js/46.fe00ffd7.js"><link rel="prefetch" href="/noteSite/assets/js/47.e80b5b51.js"><link rel="prefetch" href="/noteSite/assets/js/48.d61647f6.js"><link rel="prefetch" href="/noteSite/assets/js/49.9480a2fe.js"><link rel="prefetch" href="/noteSite/assets/js/5.4170108b.js"><link rel="prefetch" href="/noteSite/assets/js/50.d912ae8f.js"><link rel="prefetch" href="/noteSite/assets/js/51.2894520c.js"><link rel="prefetch" href="/noteSite/assets/js/52.8311521a.js"><link rel="prefetch" href="/noteSite/assets/js/53.c549d01e.js"><link rel="prefetch" href="/noteSite/assets/js/54.78ff62d1.js"><link rel="prefetch" href="/noteSite/assets/js/55.fb2a0ba5.js"><link rel="prefetch" href="/noteSite/assets/js/56.4ea72d24.js"><link rel="prefetch" href="/noteSite/assets/js/57.ae99d13a.js"><link rel="prefetch" href="/noteSite/assets/js/58.943efba2.js"><link rel="prefetch" href="/noteSite/assets/js/59.0ec70866.js"><link rel="prefetch" href="/noteSite/assets/js/6.f3d86aa7.js"><link rel="prefetch" href="/noteSite/assets/js/60.e1b3f1ed.js"><link rel="prefetch" href="/noteSite/assets/js/61.450b5973.js"><link rel="prefetch" href="/noteSite/assets/js/62.228e5b10.js"><link rel="prefetch" href="/noteSite/assets/js/63.1b75c3c4.js"><link rel="prefetch" href="/noteSite/assets/js/64.5102ff1b.js"><link rel="prefetch" href="/noteSite/assets/js/65.06741464.js"><link rel="prefetch" href="/noteSite/assets/js/66.726dc697.js"><link rel="prefetch" href="/noteSite/assets/js/67.f402798b.js"><link rel="prefetch" href="/noteSite/assets/js/68.6b977203.js"><link rel="prefetch" href="/noteSite/assets/js/69.bcca8ff6.js"><link rel="prefetch" href="/noteSite/assets/js/7.da9921ea.js"><link rel="prefetch" href="/noteSite/assets/js/70.eed23765.js"><link rel="prefetch" href="/noteSite/assets/js/71.24604845.js"><link rel="prefetch" href="/noteSite/assets/js/72.078dc50c.js"><link rel="prefetch" href="/noteSite/assets/js/73.3d731c61.js"><link rel="prefetch" href="/noteSite/assets/js/74.659e315d.js"><link rel="prefetch" href="/noteSite/assets/js/75.e2905a0c.js"><link rel="prefetch" href="/noteSite/assets/js/76.a2e50a21.js"><link rel="prefetch" href="/noteSite/assets/js/77.fe8b7e91.js"><link rel="prefetch" href="/noteSite/assets/js/78.f9a83403.js"><link rel="prefetch" href="/noteSite/assets/js/79.eba19a0e.js"><link rel="prefetch" href="/noteSite/assets/js/8.eff72f04.js"><link rel="prefetch" href="/noteSite/assets/js/80.4c3b7d91.js"><link rel="prefetch" href="/noteSite/assets/js/81.4caf3898.js"><link rel="prefetch" href="/noteSite/assets/js/82.f8d8167b.js"><link rel="prefetch" href="/noteSite/assets/js/83.43a94b78.js"><link rel="prefetch" href="/noteSite/assets/js/84.90721397.js"><link rel="prefetch" href="/noteSite/assets/js/85.0a3c5e7d.js"><link rel="prefetch" href="/noteSite/assets/js/86.01e50878.js"><link rel="prefetch" href="/noteSite/assets/js/87.64d257d9.js"><link rel="prefetch" href="/noteSite/assets/js/88.fe61590d.js"><link rel="prefetch" href="/noteSite/assets/js/89.5ffa0238.js"><link rel="prefetch" href="/noteSite/assets/js/9.409ee5bd.js"><link rel="prefetch" href="/noteSite/assets/js/90.c8b2a3f6.js"><link rel="prefetch" href="/noteSite/assets/js/91.f923e9e3.js"><link rel="prefetch" href="/noteSite/assets/js/92.6c596924.js"><link rel="prefetch" href="/noteSite/assets/js/93.86401fdc.js"><link rel="prefetch" href="/noteSite/assets/js/94.5a9b0dc6.js"><link rel="prefetch" href="/noteSite/assets/js/95.096e6ef7.js"><link rel="prefetch" href="/noteSite/assets/js/96.0c330f94.js"><link rel="prefetch" href="/noteSite/assets/js/97.fdee34c1.js"><link rel="prefetch" href="/noteSite/assets/js/98.210b05b9.js"><link rel="prefetch" href="/noteSite/assets/js/99.bc105c48.js">
    <link rel="stylesheet" href="/noteSite/assets/css/0.styles.2b5d8ceb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/noteSite/" class="home-link router-link-active"><img src="/noteSite/images/hedon.png" alt="Hedon" class="logo"> <span class="site-name can-hide">Hedon</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/component/" class="nav-link">
  计算机组成原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link router-link-active">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link">
  中间件
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Leetcode Menu" class="dropdown-title"><span class="title">Leetcode</span> <span class="arrow down"></span></button> <button type="button" aria-label="Leetcode Menu" class="mobile-dropdown-title"><span class="title">Leetcode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/data-structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/algorithm-thought/" class="nav-link">
  算法思想
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/leetcode/" class="nav-link">
  Leetcode
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/component/" class="nav-link">
  计算机组成原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link router-link-active">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link">
  中间件
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Leetcode Menu" class="dropdown-title"><span class="title">Leetcode</span> <span class="arrow down"></span></button> <button type="button" aria-label="Leetcode Menu" class="mobile-dropdown-title"><span class="title">Leetcode</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/data-structure/" class="nav-link">
  数据结构
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/algorithm-thought/" class="nav-link">
  算法思想
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/leetcode/leetcode/" class="nav-link">
  Leetcode
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 常用类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 高级特性</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 并发编程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java 虚拟机</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/noteSite/backend/java/jvm/01-intro.html" class="sidebar-link">一、JVM 概述</a></li><li><a href="/noteSite/backend/java/jvm/02-spec.html" class="sidebar-link">二、JVM 规范</a></li><li><a href="/noteSite/backend/java/jvm/03-class.html" aria-current="page" class="active sidebar-link">三、类加载、连接和初始化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/03-class.html#_1-类加载要完成的功能" class="sidebar-link">1. 类加载要完成的功能</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/03-class.html#_2-加载类的方式" class="sidebar-link">2. 加载类的方式</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/03-class.html#_3-类加载器" class="sidebar-link">3. 类加载器</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/03-class.html#_4-双亲委派模型" class="sidebar-link">4. 双亲委派模型</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/03-class.html#_5-类的加载过程" class="sidebar-link">5. 类的加载过程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/03-class.html#加载" class="sidebar-link">加载</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/03-class.html#链接" class="sidebar-link">链接</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/03-class.html#初始化" class="sidebar-link">初始化</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/03-class.html#_6-osgi" class="sidebar-link">6. OSGI</a></li></ul></li><li><a href="/noteSite/backend/java/jvm/04-memory.html" class="sidebar-link">四、内存分配</a></li><li><a href="/noteSite/backend/java/jvm/05-byte.html" class="sidebar-link">五、字节码执行引擎</a></li><li><a href="/noteSite/backend/java/jvm/06-gc.html" class="sidebar-link">六、垃圾回收</a></li><li><a href="/noteSite/backend/java/jvm/07-concurrent.html" class="sidebar-link">七、高效并发</a></li><li><a href="/noteSite/backend/java/jvm/08-monitor.html" class="sidebar-link">八、性能监控与故障处理工具</a></li><li><a href="/noteSite/backend/java/jvm/09-better.html" class="sidebar-link">九、调优</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring 5</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot 2.x</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringCloud Hoxton</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringCloud Alibaba</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis 3.4.5</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="三、类加载、连接和初始化"><a href="#三、类加载、连接和初始化" class="header-anchor">#</a> 三、类加载、连接和初始化</h1> <h2 id="_1-类加载要完成的功能"><a href="#_1-类加载要完成的功能" class="header-anchor">#</a> 1. 类加载要完成的功能</h2> <ol><li>通过类的全限定名来获取该类的二进制字节流；</li> <li>把二进制字节流转为方法区的运行时数据结构；</li> <li>在堆上创建一个 java.lang.Class 对象，用来封装类在方法区内的数据结构，并向外提供了访问方法区内数据结构的接口；</li></ol> <h2 id="_2-加载类的方式"><a href="#_2-加载类的方式" class="header-anchor">#</a> 2. 加载类的方式</h2> <ol><li>最常见的方式：本地文件系统中加载、从 jar 等归档文件中加载；</li> <li>动态方式：将 java 源文件动态编译成 class；</li> <li>其他方式：网络下载（Applet）、从专有数据库中加载等待；</li></ol> <h2 id="_3-类加载器"><a href="#_3-类加载器" class="header-anchor">#</a> 3. 类加载器</h2> <h5 id="java-8"><a href="#java-8" class="header-anchor">#</a> [Java 8]</h5> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtvikgdtx8j61bg0iudk802.jpg" alt="image-20210204174618989"></p> <h5 id="java-13"><a href="#java-13" class="header-anchor">#</a> [Java 13]</h5> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gtvikgw3kwj61em0p8gpv02.jpg" alt="image-20210219163407768" style="zoom:33%;"> <p>启动类加载器：</p> <ul><li>用户加载启动的基础模块类，比如：java.base、java.management、java.xml 等等；</li></ul> <p>平台类加载器：</p> <ul><li>用户加载一些平台相关的模块，比如：java.scripting、java.compiler*、java.corba*  等等；</li></ul> <p>应用程序类加载器：</p> <ul><li>用户加载应用级别的模块，比如：jdk.compiler、jdk.jartool、jdk.jshell 等等；</li> <li>加载 classpath 路径中的所有类库</li></ul> <div class="language-markdown extra-class"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 类加载器说明</span>
<span class="token list punctuation">1.</span> Java 程序不能直接引用启动类加载器，直接设置 classLoader 为 null，默认就使用启动类加载器；
<span class="token list punctuation">2.</span> 类加载器并不需要等到某一个类“首次主动使用”的时候才加载它，JVM 规范允许类加载器在预料到某个类将要被使用的时候就预先加载它；
<span class="token list punctuation">3.</span> 如果在加载的时候 .class 文件缺失，会在该类首次主动使用时报 LinkageError 错误，如果一直没有被使用，就不会报错；
</code></pre></div><h2 id="_4-双亲委派模型"><a href="#_4-双亲委派模型" class="header-anchor">#</a> 4. 双亲委派模型</h2> <h5 id="java-13-2"><a href="#java-13-2" class="header-anchor">#</a> [Java 13]</h5> <p>JVM 中的 ClassLoader 通常采用双亲委派模型，要求除了启动类加载器外，其余的类加载器都应该有自己的父级加载器。</p> <p>这里的父子关系是<strong>组合</strong>而不是继承，工作过程如下：</p> <ol><li>当一个类加载器收到类加载请求后，首先搜索它的内建加载器定义的所有“具名模块”；</li> <li>如果找到了合适的模块定义，将会使用该类加载器来加载；</li> <li>如果 class 没有在这些加载器定义的具名模块中找到，那么将委托给父级加载器，直到启动类加载器；</li> <li>如果父级加载器反馈它不能完成加载请求，比如在它的搜索路径下找不到这个类，那子的类加载器才自己来加载；</li> <li>在类路径下找到的类将成为这些加载器的无名模块；</li> <li>都没有找到的话就报 ClassNotFoundException 错误</li></ol> <h5 id="java-8-2"><a href="#java-8-2" class="header-anchor">#</a> [Java 8]</h5> <p>Java 8 由于没有<code>模块化开发</code>，所以它没有去搜索自己的“具名模块”，而是直接委派给父类加载器，一级一级委派上去，如果父类加载器反馈不能完成类的加载，父类加载器才进行反馈，然后由子类加载器自己来完成类的加载过程。</p> <h5 id="说明"><a href="#说明" class="header-anchor">#</a> 说明</h5> <div class="language-markdown extra-class"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 双亲委派模型的优势</span>
<span class="token list punctuation">1.</span> 采用双亲委派模式的是好处是Java类随着它的类加载器一起具备了一种带有优先级的层次关系，通过这种层级关可以避免类的重复加载，当父亲已经加载了该类时，就没有必要子ClassLoader再加载一次。
<span class="token list punctuation">2.</span> 其次是考虑到安全因素，java核心api中定义类型不会被随意替换，假设通过网络传递一个名为java.lang.Integer的类，通过双亲委托模式传递到启动类加载器，而启动类加载器在核心Java API发现这个名字的类，发现该类已被加载，并不会重新加载网络传递的过来的java.lang.Integer，而直接返回已加载过的Integer.class，这样便可以防止核心API库被随意篡改。

<span class="token title important"><span class="token punctuation">#</span> 双亲委派模型的说明</span>
<span class="token list punctuation">1.</span> 实现双亲委派模型的代码在 java.lang.ClassLoader 的 loadClass() 方法中，如果自定义类加载器的话，推荐覆盖实现 findClass() 方法。
<span class="token list punctuation">2.</span> 如果有一个类加载器能加载某个类，则称其为定义类加载器，所有能成功返回该类的 Class 的类加载器都被称为初始类加载器。
<span class="token list punctuation">3.</span> 如果没有指定父加载器，默认就是启动加载器。
<span class="token list punctuation">4.</span> 每个类加载器都有自己的命名空间，命名空间由该加载器及其父加载器所加载的类构成，不同的命名空间，可以出现类的全路径名相同的情况（多 Module 情况下）。
<span class="token list punctuation">5.</span> 运行时包由同一个类加载器的类构成，决定两个类是否属于同一个运行时包，不仅要看全路径名是否一样，还要看定义类加载器是否相同。只有同一个运行时包的类才能实现相互包内可见。
</code></pre></div><h5 id="破坏双亲委派模型"><a href="#破坏双亲委派模型" class="header-anchor">#</a> 破坏双亲委派模型</h5> <div class="language-markdown extra-class"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> 双亲模型的问题</span>
<span class="token list punctuation">-</span> 父加载器无法向下识别子加载器加载的资源

<span class="token title important"><span class="token punctuation">#</span> 解决</span>
<span class="token list punctuation">-</span> 为了解决这个问题，JDBC 引入了线程上下文类加载器，可以通过 Thread 的 setContextClassLoader() 进行设置；
</code></pre></div><h5 id="自定义类加载器"><a href="#自定义类加载器" class="header-anchor">#</a> 自定义类加载器</h5> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 自定义类加载器
 *
 * @author Hedon Wang
 * @create 2021-02-19 4:54 PM
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClassLoader</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> myName <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyClassLoader</span><span class="token punctuation">(</span><span class="token class-name">String</span> myName<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>myName <span class="token operator">=</span> myName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 将二进制数据转为 Class 类
     * @param name
     * @return
     * @throws ClassNotFoundException
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>

        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadClassData</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//将二进制数据转为 Class 类</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>data<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>data<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 加载 .class 文件为二进制数据
     * @param className
     * @return
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">loadClassData</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">ByteArrayOutputStream</span> aout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        className <span class="token operator">=</span> className<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">&quot;classes/&quot;</span> <span class="token operator">+</span> className <span class="token operator">+</span> <span class="token string">&quot;.class&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            aout <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                aout<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            data <span class="token operator">=</span> aout<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> err<span class="token punctuation">)</span><span class="token punctuation">{</span>
            err<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-类的加载过程"><a href="#_5-类的加载过程" class="header-anchor">#</a> 5. 类的加载过程</h2> <p>当程序主动使用某个类时，如果该类还未被加载到内存中，则系统会通过如下三个步骤来对该类进行初始化：</p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gtvikhcix2j61dy0kkwin02.jpg" alt="image-20210204170647543" style="zoom:33%;"> <h3 id="加载"><a href="#加载" class="header-anchor">#</a> 加载</h3> <blockquote><p>程序经过 <code>javac.exe</code> 命令后，会生成一个或多个字节码文件（.class 结尾）。</p> <p>接着我们使用 <code>java.exe</code> 命令对某个字节码文件进行解析运行，就相当于将 class 文件字节码内容加载到内存中，并将这些静态数据转换成方法区的运行时 数据结构，然后生成一个代表这个类的 java.lang.Class 对象，作为方法区中类数据的访问入口（即引用地址）。所有需要访问和使用类数据只能通过这个 Class 对象。这个加载的过程需要类加载器参与。此过程就称为类的加载。加载到内存中的类，我们就称为<strong>运行时类</strong>。</p></blockquote> <h3 id="链接"><a href="#链接" class="header-anchor">#</a> 链接</h3> <blockquote><p>将 Java 类的二进制代码合并到 JVM 的运行状态之中的过程。</p> <ul><li><p><strong>验证</strong></p> <p>确保加载的类信息符合JVM规范：</p> <p>​	※ 类文件结构检查：按照 JVM 规范规定的类文件结构进行；</p> <p>​	※ 元数据验证：对字节码描述的信息进行语义分析，保证其符合 Java 语言规范要求；</p> <p>​	※ 字节码验证：通过对数据流和控制流进行分析，确保程序语义是合法和符合逻辑的，这样主要对方法体进行校验；</p> <p>​	※ 符号引用验证：对类自身以外的信息，也就是常量池中的各种符号引用，进行匹配校验；</p></li> <li><p><strong>准备</strong></p> <p>正式为类静态变量（static）分配内存并设置类变量默认初始值的阶段，这些内存都将在方法区中进行分配。</p></li> <li><p><strong>解析</strong></p> <p>虚拟机常量池内的符号引用（常量名）替换为直接引用（地址）的过程。</p></li></ul></blockquote> <h3 id="初始化"><a href="#初始化" class="header-anchor">#</a> 初始化</h3> <blockquote><p>执行类构造器<code>&lt;clinit&gt;()</code>方法的过程。类构造器<code>&lt;clinit&gt;()</code>方法是由编译期自动收集类中所有类的静态变量的赋值动作和静态代码块中的语句合并产生的。（类构造器是构造类信息的，不是构造该类对象的构造器）。</p> <p>当初始化一个类的时候，如果发现其父类还没有进行初始化，则需要先触发其父类的初始化。</p> <p>当初始化一个类的时候，并不会初始化它所实现的接口。</p> <p>当初始化一个接口的时候，并不会初始化它的父接口。</p> <p>只有当程序首次使用接口里面的变量或者是调用接口里面的方法的时候才会导致接口的初始化。</p> <p>调用 ClassLoader 类的 loadClass() 方法来装载一个类，并不会初始化这个类，因为这不是对类的主动使用。</p> <p>虚拟机会保证一个类的<code>&lt;clinit&gt;()</code>方法在多线程环境中被正确加锁和同步。</p></blockquote> <h5 id="类的初始化时机"><a href="#类的初始化时机" class="header-anchor">#</a> 类的初始化时机</h5> <p>※ 类的主动引用（一定会发生类的初始化）</p> <ol><li>当虚拟机启动，先初始化 main() 方法所在的类</li> <li>new 一个类的对象</li> <li>调用类的静态成员（除了 final 常量）和静态方法</li> <li>使用 java.lang.reflect 包的方法对类进行反射调用</li> <li>当初始化一个类，如果其父类没有被初始化，则先会初始化它的父类</li> <li>定义了 default 方法的接口，当接口实现类初始化时，会初始化接口</li></ol> <p>※ 类的被动引用（不会发生类的初始化）</p> <ol><li>当访问一个静态域时，只有真正声明这个域的类才会被初始化
当通过子类引用父类的静态变量，不会导致子类初始化</li> <li>通过数组定义类引用，不会触发此类的初始化</li> <li>引用<strong>常量</strong>不会触发此类的初始化（常量在链接阶段就存入调用类的常量池中了）</li></ol> <p>举例：定义一个 Father 类，然后 A 继承 Father：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">Father</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;父类被加载&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token keyword">extends</span> <span class="token class-name">Father</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token punctuation">{</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;子类被加载&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				m <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
		<span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">M</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre></div><p>测试类：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassLoadingTest</span> <span class="token punctuation">{</span>
  	<span class="token comment">// main() 方法主动引用</span>
		<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span> 
      	<span class="token comment">//主动引用</span>
        <span class="token class-name">A</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      	<span class="token comment">//主动引用</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">.</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//主动引用</span>
        <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;com.hedon.A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//被动引用</span>
				<span class="token class-name">A</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//不会导致 A 和 Father 的初始化</span>
      	<span class="token comment">//被动引用</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//只会初始化 Father</span>
      	<span class="token comment">//被动引用</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">A<span class="token punctuation">.</span>M</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不会导致 A 和 Father 的初始化</span>
		<span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><h5 id="类的初始化顺序"><a href="#类的初始化顺序" class="header-anchor">#</a> 类的初始化顺序</h5> <ul><li>先按顺序为 static 变量赋默认值；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyClassA</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">MyClassA</span> myClassA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClassA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
  	<span class="token comment">//构造方法</span>
    <span class="token keyword">private</span> <span class="token class-name">MyClassA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        a<span class="token operator">++</span><span class="token punctuation">;</span>
        b<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//两个静态变量</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> b <span class="token punctuation">;</span>

    <span class="token comment">//获取单例</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">MyClassA</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> myClassA<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getA</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> a<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getB</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">MyClassA</span> myClassA <span class="token operator">=</span> <span class="token class-name">MyClassA</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;a == &quot;</span> <span class="token operator">+</span> myClassA<span class="token punctuation">.</span><span class="token function">getA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// a == 0</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;b == &quot;</span> <span class="token operator">+</span> myClassA<span class="token punctuation">.</span><span class="token function">getB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// b == 1</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述输出结构 a = 0 而 b = 1 的解释：</p> <ol><li><p>将类加载后需要做链接，链接中有一步叫做<strong>准备</strong>。准备的这个过程就是为 static 静态变量分配内存并赋默认值，所以执行到了：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">MyClassA</span> myClassA<span class="token punctuation">;</span> <span class="token comment">//这里还没有调用 MyClassA()，只是先分配了 MyClassA 对象需要的内存</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> a<span class="token punctuation">;</span>  <span class="token comment">//这个时候不会执行原代码中的 a=0，但是 int 类型的值默认为 0</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> b<span class="token punctuation">;</span>
</code></pre></div><p>这个时候 a == 0，b == 0，myClassA == null</p></li> <li><p>链接后才到了初始化阶段，而初始化阶段才会去检查是否需要为 static 变量赋初始值以及执行 static 代码块：</p> <p>按照顺序，先执行：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">MyClassA</span> myClassA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClassA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>调用了构造方法：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">MyClassA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    a<span class="token operator">++</span><span class="token punctuation">;</span>
    b<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>所以这个时候 a == 1，b == 1。</p> <p>然后按顺序往下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> b <span class="token punctuation">;</span>
</code></pre></div><p>这个时候检查到 a 需要赋初始值，而 b 不需要，所以初始化后：a == 0， b == 1。</p></li></ol> <h2 id="_6-osgi"><a href="#_6-osgi" class="header-anchor">#</a> 6. OSGI</h2> <p>OSGI（Open Sevice Gateway Initiative）是 Java 动态化模块化系统的一系列规范，旨在为实线 Java 程序的模块化编程提供基础条件。基于 OSGI 的程序可以实现模块级的热插拨功能，在程序升级更新时，可以只针对需要更新的程序进行停用和重新安装，极大提高了系统升级的安全性和便捷性。</p> <p>OSGI 提供了一种面向服务的架构，该架构为组件提供了动态发现其他组件的功能，这样无论是加入组件还是卸载组件，都能被系统的其他组件感知，以便各个组件之间更好地协调工作。</p> <p>OSGI 不但定义了模块化开发的规范，还定义了实现这些规范所依赖的服务于架构，市面上也有成熟的框架对其进行实现和应用，但只有部分应用适合采用 OSGI 方式，因为它为了实现动态模块，不再遵循 JVM 类加载双亲委派机制和其他 JVM 规范，在安全新上有所牺牲。</p> <!----></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/27/2021, 6:21:27 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/noteSite/backend/java/jvm/02-spec.html" class="prev">
        二、JVM 规范
      </a></span> <span class="next"><a href="/noteSite/backend/java/jvm/04-memory.html">
        四、内存分配
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/noteSite/assets/js/app.eecb7af2.js" defer></script><script src="/noteSite/assets/js/2.0f8877a4.js" defer></script><script src="/noteSite/assets/js/42.4625bc4d.js" defer></script>
  </body>
</html>
