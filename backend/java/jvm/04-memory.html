<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>四、内存分配 | Hedon</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/noteSite/favicon.ico">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/noteSite/assets/css/0.styles.0f3b0cbd.css" as="style"><link rel="preload" href="/noteSite/assets/js/app.9075b0ea.js" as="script"><link rel="preload" href="/noteSite/assets/js/2.691adf44.js" as="script"><link rel="preload" href="/noteSite/assets/js/55.3c03c62b.js" as="script"><link rel="prefetch" href="/noteSite/assets/js/10.f9d8595d.js"><link rel="prefetch" href="/noteSite/assets/js/100.cd002964.js"><link rel="prefetch" href="/noteSite/assets/js/101.c464815c.js"><link rel="prefetch" href="/noteSite/assets/js/102.54ca77d0.js"><link rel="prefetch" href="/noteSite/assets/js/103.252a32ff.js"><link rel="prefetch" href="/noteSite/assets/js/104.26c79e2a.js"><link rel="prefetch" href="/noteSite/assets/js/105.bd4581c4.js"><link rel="prefetch" href="/noteSite/assets/js/106.c33ff8cd.js"><link rel="prefetch" href="/noteSite/assets/js/107.2125d0fe.js"><link rel="prefetch" href="/noteSite/assets/js/108.dee3c875.js"><link rel="prefetch" href="/noteSite/assets/js/109.86f5947c.js"><link rel="prefetch" href="/noteSite/assets/js/11.0e4d5955.js"><link rel="prefetch" href="/noteSite/assets/js/110.3857400e.js"><link rel="prefetch" href="/noteSite/assets/js/111.d4610517.js"><link rel="prefetch" href="/noteSite/assets/js/112.d538bc82.js"><link rel="prefetch" href="/noteSite/assets/js/113.a35aeffd.js"><link rel="prefetch" href="/noteSite/assets/js/114.978205de.js"><link rel="prefetch" href="/noteSite/assets/js/115.ff1b2435.js"><link rel="prefetch" href="/noteSite/assets/js/116.41999847.js"><link rel="prefetch" href="/noteSite/assets/js/117.29dd4c43.js"><link rel="prefetch" href="/noteSite/assets/js/118.3538e12d.js"><link rel="prefetch" href="/noteSite/assets/js/119.010a44df.js"><link rel="prefetch" href="/noteSite/assets/js/12.1bd2f9cc.js"><link rel="prefetch" href="/noteSite/assets/js/120.06c67064.js"><link rel="prefetch" href="/noteSite/assets/js/121.68109d2e.js"><link rel="prefetch" href="/noteSite/assets/js/122.0e3b535e.js"><link rel="prefetch" href="/noteSite/assets/js/123.10b2103b.js"><link rel="prefetch" href="/noteSite/assets/js/124.97d128be.js"><link rel="prefetch" href="/noteSite/assets/js/125.bec328ef.js"><link rel="prefetch" href="/noteSite/assets/js/126.12b84c7e.js"><link rel="prefetch" href="/noteSite/assets/js/127.16ab9aa2.js"><link rel="prefetch" href="/noteSite/assets/js/128.343f6a98.js"><link rel="prefetch" href="/noteSite/assets/js/129.455cceee.js"><link rel="prefetch" href="/noteSite/assets/js/13.f45d544e.js"><link rel="prefetch" href="/noteSite/assets/js/130.f2f0cc2f.js"><link rel="prefetch" href="/noteSite/assets/js/131.d62283a3.js"><link rel="prefetch" href="/noteSite/assets/js/132.7fd63128.js"><link rel="prefetch" href="/noteSite/assets/js/133.84733872.js"><link rel="prefetch" href="/noteSite/assets/js/134.51da4194.js"><link rel="prefetch" href="/noteSite/assets/js/135.7817bbdf.js"><link rel="prefetch" href="/noteSite/assets/js/136.49573322.js"><link rel="prefetch" href="/noteSite/assets/js/137.39ff0954.js"><link rel="prefetch" href="/noteSite/assets/js/138.ff99ed38.js"><link rel="prefetch" href="/noteSite/assets/js/139.fa376ddd.js"><link rel="prefetch" href="/noteSite/assets/js/14.c4835766.js"><link rel="prefetch" href="/noteSite/assets/js/140.80ab3d68.js"><link rel="prefetch" href="/noteSite/assets/js/141.61345e24.js"><link rel="prefetch" href="/noteSite/assets/js/142.3362875c.js"><link rel="prefetch" href="/noteSite/assets/js/143.0700eefe.js"><link rel="prefetch" href="/noteSite/assets/js/144.ce9e6119.js"><link rel="prefetch" href="/noteSite/assets/js/145.f0db043d.js"><link rel="prefetch" href="/noteSite/assets/js/146.4be2e4a5.js"><link rel="prefetch" href="/noteSite/assets/js/147.df049d7c.js"><link rel="prefetch" href="/noteSite/assets/js/148.9e2aa7d9.js"><link rel="prefetch" href="/noteSite/assets/js/149.7521b256.js"><link rel="prefetch" href="/noteSite/assets/js/15.637c455d.js"><link rel="prefetch" href="/noteSite/assets/js/150.eb809d95.js"><link rel="prefetch" href="/noteSite/assets/js/151.4ece8848.js"><link rel="prefetch" href="/noteSite/assets/js/152.75db3788.js"><link rel="prefetch" href="/noteSite/assets/js/153.d8bc1d51.js"><link rel="prefetch" href="/noteSite/assets/js/154.7d259ee0.js"><link rel="prefetch" href="/noteSite/assets/js/155.cee16fdd.js"><link rel="prefetch" href="/noteSite/assets/js/156.a5de2c7c.js"><link rel="prefetch" href="/noteSite/assets/js/157.6f5c5a81.js"><link rel="prefetch" href="/noteSite/assets/js/158.78377a67.js"><link rel="prefetch" href="/noteSite/assets/js/159.1f4580d9.js"><link rel="prefetch" href="/noteSite/assets/js/16.588a856e.js"><link rel="prefetch" href="/noteSite/assets/js/160.fb6e652a.js"><link rel="prefetch" href="/noteSite/assets/js/161.4d52e086.js"><link rel="prefetch" href="/noteSite/assets/js/162.6e62aee2.js"><link rel="prefetch" href="/noteSite/assets/js/163.411c8ac5.js"><link rel="prefetch" href="/noteSite/assets/js/164.8220d125.js"><link rel="prefetch" href="/noteSite/assets/js/165.22b4ac8d.js"><link rel="prefetch" href="/noteSite/assets/js/166.3501bf27.js"><link rel="prefetch" href="/noteSite/assets/js/167.b27544e1.js"><link rel="prefetch" href="/noteSite/assets/js/168.6c6493dc.js"><link rel="prefetch" href="/noteSite/assets/js/169.fc845490.js"><link rel="prefetch" href="/noteSite/assets/js/17.42c5f955.js"><link rel="prefetch" href="/noteSite/assets/js/170.e8f132cb.js"><link rel="prefetch" href="/noteSite/assets/js/171.4c88363c.js"><link rel="prefetch" href="/noteSite/assets/js/172.979574b6.js"><link rel="prefetch" href="/noteSite/assets/js/173.f9917555.js"><link rel="prefetch" href="/noteSite/assets/js/174.0ccb1206.js"><link rel="prefetch" href="/noteSite/assets/js/175.1ca3dc36.js"><link rel="prefetch" href="/noteSite/assets/js/176.d1d5d1a8.js"><link rel="prefetch" href="/noteSite/assets/js/177.d53ba756.js"><link rel="prefetch" href="/noteSite/assets/js/178.05332d59.js"><link rel="prefetch" href="/noteSite/assets/js/179.a528d400.js"><link rel="prefetch" href="/noteSite/assets/js/18.7a2f817c.js"><link rel="prefetch" href="/noteSite/assets/js/180.dc9f6d84.js"><link rel="prefetch" href="/noteSite/assets/js/19.13241de9.js"><link rel="prefetch" href="/noteSite/assets/js/20.fdf3ee8c.js"><link rel="prefetch" href="/noteSite/assets/js/21.ed6203ac.js"><link rel="prefetch" href="/noteSite/assets/js/22.e6553a1c.js"><link rel="prefetch" href="/noteSite/assets/js/23.f8f9c155.js"><link rel="prefetch" href="/noteSite/assets/js/24.7382ddd7.js"><link rel="prefetch" href="/noteSite/assets/js/25.333b798b.js"><link rel="prefetch" href="/noteSite/assets/js/26.cce0d974.js"><link rel="prefetch" href="/noteSite/assets/js/27.6a4f4064.js"><link rel="prefetch" href="/noteSite/assets/js/28.9c5c3516.js"><link rel="prefetch" href="/noteSite/assets/js/29.e890aaed.js"><link rel="prefetch" href="/noteSite/assets/js/3.b100fda9.js"><link rel="prefetch" href="/noteSite/assets/js/30.92bc43cd.js"><link rel="prefetch" href="/noteSite/assets/js/31.63c482b8.js"><link rel="prefetch" href="/noteSite/assets/js/32.00945856.js"><link rel="prefetch" href="/noteSite/assets/js/33.01effe54.js"><link rel="prefetch" href="/noteSite/assets/js/34.cfd0d2e5.js"><link rel="prefetch" href="/noteSite/assets/js/35.5dcc538b.js"><link rel="prefetch" href="/noteSite/assets/js/36.897a22da.js"><link rel="prefetch" href="/noteSite/assets/js/37.4c01d880.js"><link rel="prefetch" href="/noteSite/assets/js/38.bc717e7c.js"><link rel="prefetch" href="/noteSite/assets/js/39.80ed47e4.js"><link rel="prefetch" href="/noteSite/assets/js/4.a61e4cea.js"><link rel="prefetch" href="/noteSite/assets/js/40.2a1e9668.js"><link rel="prefetch" href="/noteSite/assets/js/41.f23256ea.js"><link rel="prefetch" href="/noteSite/assets/js/42.4900306c.js"><link rel="prefetch" href="/noteSite/assets/js/43.be4e214b.js"><link rel="prefetch" href="/noteSite/assets/js/44.5217cb5f.js"><link rel="prefetch" href="/noteSite/assets/js/45.c84cd229.js"><link rel="prefetch" href="/noteSite/assets/js/46.7197c6a0.js"><link rel="prefetch" href="/noteSite/assets/js/47.6449c6cf.js"><link rel="prefetch" href="/noteSite/assets/js/48.23249fd1.js"><link rel="prefetch" href="/noteSite/assets/js/49.4f8a9444.js"><link rel="prefetch" href="/noteSite/assets/js/5.2bccd6df.js"><link rel="prefetch" href="/noteSite/assets/js/50.1e60cc38.js"><link rel="prefetch" href="/noteSite/assets/js/51.bce52934.js"><link rel="prefetch" href="/noteSite/assets/js/52.95b4e096.js"><link rel="prefetch" href="/noteSite/assets/js/53.5af15cad.js"><link rel="prefetch" href="/noteSite/assets/js/54.38e236bc.js"><link rel="prefetch" href="/noteSite/assets/js/56.03713098.js"><link rel="prefetch" href="/noteSite/assets/js/57.9743428d.js"><link rel="prefetch" href="/noteSite/assets/js/58.a1197820.js"><link rel="prefetch" href="/noteSite/assets/js/59.895aeb2b.js"><link rel="prefetch" href="/noteSite/assets/js/6.f3d86aa7.js"><link rel="prefetch" href="/noteSite/assets/js/60.db1655af.js"><link rel="prefetch" href="/noteSite/assets/js/61.ad6f8a55.js"><link rel="prefetch" href="/noteSite/assets/js/62.6d627872.js"><link rel="prefetch" href="/noteSite/assets/js/63.9a2abee5.js"><link rel="prefetch" href="/noteSite/assets/js/64.ad9842f9.js"><link rel="prefetch" href="/noteSite/assets/js/65.f15a2d96.js"><link rel="prefetch" href="/noteSite/assets/js/66.1c5d0857.js"><link rel="prefetch" href="/noteSite/assets/js/67.fa42a212.js"><link rel="prefetch" href="/noteSite/assets/js/68.bc771c5e.js"><link rel="prefetch" href="/noteSite/assets/js/69.1003553b.js"><link rel="prefetch" href="/noteSite/assets/js/7.f685cce4.js"><link rel="prefetch" href="/noteSite/assets/js/70.ecc074fa.js"><link rel="prefetch" href="/noteSite/assets/js/71.3bc8bdad.js"><link rel="prefetch" href="/noteSite/assets/js/72.c3312e75.js"><link rel="prefetch" href="/noteSite/assets/js/73.8c9460f8.js"><link rel="prefetch" href="/noteSite/assets/js/74.41049e04.js"><link rel="prefetch" href="/noteSite/assets/js/75.a5b52a9d.js"><link rel="prefetch" href="/noteSite/assets/js/76.12cb6624.js"><link rel="prefetch" href="/noteSite/assets/js/77.0ab362ff.js"><link rel="prefetch" href="/noteSite/assets/js/78.5fcc8e8b.js"><link rel="prefetch" href="/noteSite/assets/js/79.69e17836.js"><link rel="prefetch" href="/noteSite/assets/js/8.1e22ea55.js"><link rel="prefetch" href="/noteSite/assets/js/80.7a90dda7.js"><link rel="prefetch" href="/noteSite/assets/js/81.429d6f02.js"><link rel="prefetch" href="/noteSite/assets/js/82.01683c08.js"><link rel="prefetch" href="/noteSite/assets/js/83.21ddb8f5.js"><link rel="prefetch" href="/noteSite/assets/js/84.ee557fc3.js"><link rel="prefetch" href="/noteSite/assets/js/85.9aeb5767.js"><link rel="prefetch" href="/noteSite/assets/js/86.196d8a66.js"><link rel="prefetch" href="/noteSite/assets/js/87.8d31cf28.js"><link rel="prefetch" href="/noteSite/assets/js/88.bca89bd4.js"><link rel="prefetch" href="/noteSite/assets/js/89.c760878e.js"><link rel="prefetch" href="/noteSite/assets/js/9.90e72075.js"><link rel="prefetch" href="/noteSite/assets/js/90.7d49a58d.js"><link rel="prefetch" href="/noteSite/assets/js/91.777a0ff8.js"><link rel="prefetch" href="/noteSite/assets/js/92.0321a232.js"><link rel="prefetch" href="/noteSite/assets/js/93.fecb9922.js"><link rel="prefetch" href="/noteSite/assets/js/94.5590c434.js"><link rel="prefetch" href="/noteSite/assets/js/95.830090cd.js"><link rel="prefetch" href="/noteSite/assets/js/96.5b9dc37a.js"><link rel="prefetch" href="/noteSite/assets/js/97.585f1e89.js"><link rel="prefetch" href="/noteSite/assets/js/98.c2e98a21.js"><link rel="prefetch" href="/noteSite/assets/js/99.03f0618f.js">
    <link rel="stylesheet" href="/noteSite/assets/css/0.styles.0f3b0cbd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/noteSite/" class="home-link router-link-active"><img src="/noteSite/images/hedon.png" alt="Hedon" class="logo"> <span class="site-name can-hide">Hedon</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/component/" class="nav-link">
  计算机组成原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link router-link-active">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link">
  中间件
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><a href="/noteSite/leetcode/" class="nav-link">
  Leetcode
</a></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/component/" class="nav-link">
  计算机组成原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link router-link-active">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link">
  中间件
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><a href="/noteSite/leetcode/" class="nav-link">
  Leetcode
</a></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 常用类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 高级特性</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 多线程</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java 并发工具类</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Java 虚拟机</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/noteSite/backend/java/jvm/01-intro.html" class="sidebar-link">一、JVM 概述</a></li><li><a href="/noteSite/backend/java/jvm/02-spec.html" class="sidebar-link">二、JVM 规范</a></li><li><a href="/noteSite/backend/java/jvm/03-class.html" class="sidebar-link">三、类加载、连接和初始化</a></li><li><a href="/noteSite/backend/java/jvm/04-memory.html" aria-current="page" class="active sidebar-link">四、内存分配</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#_1-jvm-简化架构" class="sidebar-link">1. JVM 简化架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#程序计数器" class="sidebar-link">程序计数器</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#虚拟机栈" class="sidebar-link">虚拟机栈</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#堆" class="sidebar-link">堆</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#方法区" class="sidebar-link">方法区</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#运行时常量池" class="sidebar-link">运行时常量池</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#本地方法栈" class="sidebar-link">本地方法栈</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#_2-栈、堆、方法区交互关系" class="sidebar-link">2. 栈、堆、方法区交互关系</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#_3-堆" class="sidebar-link">3. 堆</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#_3-1-概述" class="sidebar-link">3.1 概述</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#_3-2-结构" class="sidebar-link">3.2 结构</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#_3-3-对象的内存布局" class="sidebar-link">3.3 对象的内存布局</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#_3-4-对象的访问定位" class="sidebar-link">3.4 对象的访问定位</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#_4-参数" class="sidebar-link">4. 参数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#_4-1-堆" class="sidebar-link">4.1 堆</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#_4-2-栈" class="sidebar-link">4.2 栈</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/java/jvm/04-memory.html#_4-3-元空间" class="sidebar-link">4.3 元空间</a></li></ul></li></ul></li><li><a href="/noteSite/backend/java/jvm/05-byte.html" class="sidebar-link">五、字节码执行引擎</a></li><li><a href="/noteSite/backend/java/jvm/06-gc.html" class="sidebar-link">六、垃圾回收</a></li><li><a href="/noteSite/backend/java/jvm/07-concurrent.html" class="sidebar-link">七、高效并发</a></li><li><a href="/noteSite/backend/java/jvm/08-monitor.html" class="sidebar-link">八、性能监控与故障处理工具</a></li><li><a href="/noteSite/backend/java/jvm/09-better.html" class="sidebar-link">九、调优</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Spring 5</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringBoot 2.x</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringCloud Hoxton</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>SpringCloud Alibaba</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MyBatis 3.4.5</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="四、内存分配"><a href="#四、内存分配" class="header-anchor">#</a> 四、内存分配</h1> <h2 id="_1-jvm-简化架构"><a href="#_1-jvm-简化架构" class="header-anchor">#</a> 1. JVM 简化架构</h2> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtvil3rywkj61a20u0dky02.jpg" alt="image-20210314091712445"></p> <h3 id="程序计数器"><a href="#程序计数器" class="header-anchor">#</a> 程序计数器</h3> <blockquote><ol><li>每个线程都拥有一个 PC 寄存器，是<strong>线程私有</strong>的。<strong>用来存储指向下一条指令的地址</strong>。</li> <li>在创建线程的时候，同时会创建相应的 PC 寄存器。</li> <li>执行本地方法（JNI）时，PC 寄存器的值为 undefined。</li> <li>PC 寄存器是一块较小的内存空间，是唯一一个在 JVM 规范中没有规定 OutOfMemoryError 的内存区域。</li></ol></blockquote> <h3 id="虚拟机栈"><a href="#虚拟机栈" class="header-anchor">#</a> 虚拟机栈</h3> <blockquote><ol><li>栈由一系列<strong>帧（Frame）<strong>组成，是</strong>线程私有</strong>的。</li> <li>帧用来保存一个方法的局部变量、操作数栈（Java 没有寄存器，所有参数传递使用操作数栈）、常量池指针、动态链接、方法返回值等。</li> <li>每一次方法调用创建一个帧，并压栈。退出方法的时候，修改栈顶指针就可以把栈帧中的内容销毁。</li> <li><strong>局部变量表</strong>存放了编译期可知的各种<strong>基本数据类型</strong>和<strong>引用类型</strong>，每个 <strong>slot</strong> 存放 <strong>32</strong> 位数据，long、double 占 2 个槽位。</li> <li>栈的优点：存取速度比堆快，仅次于寄存器。</li> <li>栈的缺点：存在栈中的数据大小、生存期是在编译期决定的，缺乏灵活性。</li></ol></blockquote> <h3 id="堆"><a href="#堆" class="header-anchor">#</a> 堆</h3> <blockquote><ol><li>用来存放应用系统创建的对象和数组，<strong>所有线程共享</strong> Java 堆。</li> <li>GC 主要就管理堆空间，对<strong>分代</strong> CG 来说，堆也是分代的。</li> <li>堆的优点：运行期<strong>动态分配</strong>内存大小，自动进行垃圾回收。</li> <li>堆的缺点：效率相对较慢。</li></ol></blockquote> <h3 id="方法区"><a href="#方法区" class="header-anchor">#</a> 方法区</h3> <blockquote><ol><li>方法区是线程共享的，通常用来保存装载的<strong>类的结构信</strong>息。
<ul><li>常量池</li> <li>字段、方法</li> <li>特殊方法</li> <li>static 静态变量</li></ul></li> <li>通常和<strong>元空间</strong>关联在一起，但具体的跟 JVM 实现和版本有关。
<ul><li>🔺 String 在 JDK7 之前是放在方法区的，但是 JDK7 以后就移到堆了。</li></ul></li> <li>JVM 规范把方法区描述为堆的一个逻辑部分，但它有一个别名称为 <strong>Non-heap（非堆）</strong>，主要是为了与 Java 堆区分开。</li></ol></blockquote> <h3 id="运行时常量池"><a href="#运行时常量池" class="header-anchor">#</a> 运行时常量池</h3> <blockquote><ol><li>是 Class 文件中每个类或接口的常量池表，在运行期间的表示形式。通常包括：
<ul><li>类的版本</li> <li>字段</li> <li>方法</li> <li>接口</li> <li>...</li></ul></li> <li>JDK6 在<strong>方法区</strong>中分配，JDK7 以后在<strong>堆</strong>中分配。</li> <li>通常在加载类和接口到 JVM 后，就创建相应的运行时常量池。</li></ol></blockquote> <h3 id="本地方法栈"><a href="#本地方法栈" class="header-anchor">#</a> 本地方法栈</h3> <blockquote><ol><li>在 JVM 中用来支持 native 方法执行的栈就是本地方法栈。</li></ol></blockquote> <div class="language-markdown extra-class"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> Class 对象是放在方法区还是堆中？</span>
Class对象是存放在堆区的，不是方法区，这点很多人容易犯错。类的元数据（元数据并不是类的Class对象！Class对象是加载的最终产品，类的方法代码，变量名，方法名，访问权限，返回值等等都是在方法区的）才是存在方法区的。

<span class="token title important"><span class="token punctuation">#</span> static 成员变量放在哪里？</span>
方法区。如果是一个对象的话，那么方法区存引用，对象数据放在堆中。

<span class="token title important"><span class="token punctuation">#</span> 方法区、永久代、元空间区别？</span>
方法区：（逻辑上）
	逻辑上的东西，是JVM 的规范，所有虚拟机必须遵守的。
	是JVM 所有线程共享的、用于存储类的信息、常量池、方法数据、方法代码等。
永久代：（方法区的实现、JDK7 及之前、主要是和元空间对比）
	PermGen ， 就是 PermGen space ，全称是 Permanent Generation space ，是指内存的永久保存区域。
	PermGen space 则是 HotSpot 虚拟机基于 JVM 规范对方法区的一个落地实现，并且只有 HotSpot 才有 PermGen space。
	而如 JRockit（Oracle）、J9（IBM） 虚拟机有方法区 ，但是就没有 PermGen space。
	PermGen space 是JDK7及之前， HotSpot 虚拟机对方法区的一个落地实现。在 JDK8 被移除。
Metaspace（元空间、JDK8 及之后）
	元空间与永久代之间最大的区别在于：元空间并不在虚拟机中，而是使用本地内存。
</code></pre></div><blockquote><p>从前的永久代是用来存放 Class、Method 等元信息的区域， 从 JDK8 开始就去掉了。取而代之的是元空间（MetaSpace），元空间并不在虚拟机里面，而是直接使用本地内存。</p></blockquote> <h2 id="_2-栈、堆、方法区交互关系"><a href="#_2-栈、堆、方法区交互关系" class="header-anchor">#</a> 2. 栈、堆、方法区交互关系</h2> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gtvil1vwkej60v30djtah02.jpg" alt="image-20210225150146164" style="zoom:50%;"> <h2 id="_3-堆"><a href="#_3-堆" class="header-anchor">#</a> 3. 堆</h2> <h3 id="_3-1-概述"><a href="#_3-1-概述" class="header-anchor">#</a> 3.1 概述</h3> <ul><li>Java 堆用来存放应用系统创建的对象和数组，所有<strong>线程共享</strong> Java 堆。</li> <li>Java 堆内存在逻辑上需要是连续的。</li> <li>Java 堆是在运行期动态分配内存大小，自动进行垃圾回收。</li></ul> <h3 id="_3-2-结构"><a href="#_3-2-结构" class="header-anchor">#</a> 3.2 结构</h3> <ul><li>整个堆大小 = 新生代 + 老年代</li> <li>新生代 = Eden + 存活区</li></ul> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gtvil39tizj60ri0aa0tr02.jpg" alt="image-20210225150555532" style="zoom:50%;"> <ul><li>新生代用来放新分配的对象。新生代中经过垃圾回收，没有回收掉的对象，会被复制到老年代。</li> <li>老年代存储对象一般比新生代存储对象的年龄大得多。</li> <li>老年代存储一些大对象。</li></ul> <h3 id="_3-3-对象的内存布局"><a href="#_3-3-对象的内存布局" class="header-anchor">#</a> 3.3 对象的内存布局</h3> <p>以 HotSpot 虚拟机为例，对象在内存中的布局分为以下 3 个部分：</p> <ul><li>对象头：
<ul><li>Mark Word：存储对象自身的运行数据。如：Hashcode、GC 分代年龄、锁状态标志等。</li> <li>类型指针：对象指向它的类元数据的指针。</li></ul></li> <li>实例数据：
<ul><li>真正存放对象实例数据的地方。</li></ul></li> <li>对齐填充：
<ul><li>这部分不一定存在，也没有什么特别含义，仅仅是占位符。因为 HotSpot 要求对象起始地址都是 <strong>8 字节</strong>的整数倍，如果不是，就对齐。</li></ul></li></ul> <h3 id="_3-4-对象的访问定位"><a href="#_3-4-对象的访问定位" class="header-anchor">#</a> 3.4 对象的访问定位</h3> <h4 id="_1-使用句柄"><a href="#_1-使用句柄" class="header-anchor">#</a> ① 使用句柄</h4> <blockquote><p>Java 堆中会划分一块内存来作为句柄池，reference 中存放句柄的地址，句柄中存储对象的实例数据和类元数据的地址。</p></blockquote> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtvil0g4f4j60l80bwgmq02.jpg" alt="image-20210225151358190"></p> <ul><li>间接指针，效率慢</li> <li>修改对象引用的时候只需要修改到对象实例数据的指针即可。</li></ul> <h4 id="_2-使用指针"><a href="#_2-使用指针" class="header-anchor">#</a> ② 使用指针</h4> <blockquote><p>Java 堆中会存放访问类元数据的地址，reference 存储的就直接是对象的地址。</p> <p>HotStop 用的是使用指针。</p></blockquote> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gtvil0276zj60nn0b13zn02.jpg" alt="image-20210225151510797"> <ul><li>reference 直接指向对象，效率快。</li></ul> <h2 id="_4-参数"><a href="#_4-参数" class="header-anchor">#</a> 4. 参数</h2> <h3 id="_4-1-堆"><a href="#_4-1-堆" class="header-anchor">#</a> 4.1 堆</h3> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtvil2de2tj60py0ayjsx02.jpg" alt="image-20210225170257559"></p> <h3 id="_4-2-栈"><a href="#_4-2-栈" class="header-anchor">#</a> 4.2 栈</h3> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtvil1307oj60mq02jaa502.jpg" alt="image-20210225170355372"></p> <h3 id="_4-3-元空间"><a href="#_4-3-元空间" class="header-anchor">#</a> 4.3 元空间</h3> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gtvil2u479j60ms06cmxq02.jpg" alt="image-20210225170714162"></p> <!----></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">9/8/2021, 4:11:30 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/noteSite/backend/java/jvm/03-class.html" class="prev">
        三、类加载、连接和初始化
      </a></span> <span class="next"><a href="/noteSite/backend/java/jvm/05-byte.html">
        五、字节码执行引擎
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/noteSite/assets/js/app.9075b0ea.js" defer></script><script src="/noteSite/assets/js/2.691adf44.js" defer></script><script src="/noteSite/assets/js/55.3c03c62b.js" defer></script>
  </body>
</html>
