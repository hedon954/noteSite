<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>九、Redis 集群分片 | Hedon</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/noteSite/favicon.ico">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/noteSite/assets/css/0.styles.0f3b0cbd.css" as="style"><link rel="preload" href="/noteSite/assets/js/app.3a297227.js" as="script"><link rel="preload" href="/noteSite/assets/js/2.691adf44.js" as="script"><link rel="preload" href="/noteSite/assets/js/87.5d04b12e.js" as="script"><link rel="prefetch" href="/noteSite/assets/js/10.9a97bd95.js"><link rel="prefetch" href="/noteSite/assets/js/100.4b33d7c3.js"><link rel="prefetch" href="/noteSite/assets/js/101.392f8227.js"><link rel="prefetch" href="/noteSite/assets/js/102.f8a4de49.js"><link rel="prefetch" href="/noteSite/assets/js/103.62721944.js"><link rel="prefetch" href="/noteSite/assets/js/104.bfb79698.js"><link rel="prefetch" href="/noteSite/assets/js/105.97bff32a.js"><link rel="prefetch" href="/noteSite/assets/js/106.1867bff9.js"><link rel="prefetch" href="/noteSite/assets/js/107.b910bc78.js"><link rel="prefetch" href="/noteSite/assets/js/108.33acf8e7.js"><link rel="prefetch" href="/noteSite/assets/js/109.bf69b187.js"><link rel="prefetch" href="/noteSite/assets/js/11.d9f58434.js"><link rel="prefetch" href="/noteSite/assets/js/110.0a145e54.js"><link rel="prefetch" href="/noteSite/assets/js/111.199ec792.js"><link rel="prefetch" href="/noteSite/assets/js/112.03af3565.js"><link rel="prefetch" href="/noteSite/assets/js/113.3295d2c4.js"><link rel="prefetch" href="/noteSite/assets/js/114.1b555101.js"><link rel="prefetch" href="/noteSite/assets/js/115.0fca6ee3.js"><link rel="prefetch" href="/noteSite/assets/js/116.cb63d1b4.js"><link rel="prefetch" href="/noteSite/assets/js/117.cb5c63a3.js"><link rel="prefetch" href="/noteSite/assets/js/118.f722b71e.js"><link rel="prefetch" href="/noteSite/assets/js/119.c138f8e8.js"><link rel="prefetch" href="/noteSite/assets/js/12.1bd2f9cc.js"><link rel="prefetch" href="/noteSite/assets/js/120.c4e15462.js"><link rel="prefetch" href="/noteSite/assets/js/121.2b93893a.js"><link rel="prefetch" href="/noteSite/assets/js/122.a57bf8ba.js"><link rel="prefetch" href="/noteSite/assets/js/123.2ee3c26c.js"><link rel="prefetch" href="/noteSite/assets/js/124.c4a4dd2d.js"><link rel="prefetch" href="/noteSite/assets/js/125.de456d51.js"><link rel="prefetch" href="/noteSite/assets/js/126.3bff97b7.js"><link rel="prefetch" href="/noteSite/assets/js/127.7a1e1d38.js"><link rel="prefetch" href="/noteSite/assets/js/128.1fcaa1ab.js"><link rel="prefetch" href="/noteSite/assets/js/129.0703b96f.js"><link rel="prefetch" href="/noteSite/assets/js/13.d63addd9.js"><link rel="prefetch" href="/noteSite/assets/js/130.7d2c279e.js"><link rel="prefetch" href="/noteSite/assets/js/131.24d246c4.js"><link rel="prefetch" href="/noteSite/assets/js/132.3c0ec05c.js"><link rel="prefetch" href="/noteSite/assets/js/133.b82c269f.js"><link rel="prefetch" href="/noteSite/assets/js/134.c81df698.js"><link rel="prefetch" href="/noteSite/assets/js/135.7b127657.js"><link rel="prefetch" href="/noteSite/assets/js/136.d9daae82.js"><link rel="prefetch" href="/noteSite/assets/js/137.d12c9949.js"><link rel="prefetch" href="/noteSite/assets/js/138.c6e72bfc.js"><link rel="prefetch" href="/noteSite/assets/js/139.1e1300cc.js"><link rel="prefetch" href="/noteSite/assets/js/14.91f9301c.js"><link rel="prefetch" href="/noteSite/assets/js/140.707fa203.js"><link rel="prefetch" href="/noteSite/assets/js/141.857cea99.js"><link rel="prefetch" href="/noteSite/assets/js/142.ca91d122.js"><link rel="prefetch" href="/noteSite/assets/js/143.8b8b9910.js"><link rel="prefetch" href="/noteSite/assets/js/144.b26ed237.js"><link rel="prefetch" href="/noteSite/assets/js/145.ec43c253.js"><link rel="prefetch" href="/noteSite/assets/js/146.ea422fc6.js"><link rel="prefetch" href="/noteSite/assets/js/147.82a7f399.js"><link rel="prefetch" href="/noteSite/assets/js/148.80e9974e.js"><link rel="prefetch" href="/noteSite/assets/js/149.d1410beb.js"><link rel="prefetch" href="/noteSite/assets/js/15.637c455d.js"><link rel="prefetch" href="/noteSite/assets/js/150.96cb1ddc.js"><link rel="prefetch" href="/noteSite/assets/js/151.78c9937a.js"><link rel="prefetch" href="/noteSite/assets/js/152.d2e66568.js"><link rel="prefetch" href="/noteSite/assets/js/153.5d4bc8bf.js"><link rel="prefetch" href="/noteSite/assets/js/154.7fe4aa6f.js"><link rel="prefetch" href="/noteSite/assets/js/155.1acc33fc.js"><link rel="prefetch" href="/noteSite/assets/js/156.7ced2431.js"><link rel="prefetch" href="/noteSite/assets/js/157.1653dd6f.js"><link rel="prefetch" href="/noteSite/assets/js/158.fdef3286.js"><link rel="prefetch" href="/noteSite/assets/js/159.17f92aab.js"><link rel="prefetch" href="/noteSite/assets/js/16.588a856e.js"><link rel="prefetch" href="/noteSite/assets/js/160.57607713.js"><link rel="prefetch" href="/noteSite/assets/js/161.ba769789.js"><link rel="prefetch" href="/noteSite/assets/js/162.7670b7bf.js"><link rel="prefetch" href="/noteSite/assets/js/163.838c14e0.js"><link rel="prefetch" href="/noteSite/assets/js/164.1f750873.js"><link rel="prefetch" href="/noteSite/assets/js/165.3a778973.js"><link rel="prefetch" href="/noteSite/assets/js/166.f29c44e8.js"><link rel="prefetch" href="/noteSite/assets/js/167.83c3f8e5.js"><link rel="prefetch" href="/noteSite/assets/js/168.8e6a1f52.js"><link rel="prefetch" href="/noteSite/assets/js/169.aa6e788b.js"><link rel="prefetch" href="/noteSite/assets/js/17.42c5f955.js"><link rel="prefetch" href="/noteSite/assets/js/170.81ca0889.js"><link rel="prefetch" href="/noteSite/assets/js/171.deedd1dc.js"><link rel="prefetch" href="/noteSite/assets/js/172.b86a53b9.js"><link rel="prefetch" href="/noteSite/assets/js/173.cdc8f6b2.js"><link rel="prefetch" href="/noteSite/assets/js/174.f18929d0.js"><link rel="prefetch" href="/noteSite/assets/js/175.dc290254.js"><link rel="prefetch" href="/noteSite/assets/js/176.94845cd4.js"><link rel="prefetch" href="/noteSite/assets/js/177.44ebd1d2.js"><link rel="prefetch" href="/noteSite/assets/js/178.3f8a810b.js"><link rel="prefetch" href="/noteSite/assets/js/179.3fe82e5c.js"><link rel="prefetch" href="/noteSite/assets/js/18.7a2f817c.js"><link rel="prefetch" href="/noteSite/assets/js/180.cdb154c3.js"><link rel="prefetch" href="/noteSite/assets/js/181.f4fa8ae8.js"><link rel="prefetch" href="/noteSite/assets/js/182.94f17f21.js"><link rel="prefetch" href="/noteSite/assets/js/19.13241de9.js"><link rel="prefetch" href="/noteSite/assets/js/20.fdf3ee8c.js"><link rel="prefetch" href="/noteSite/assets/js/21.279cf49f.js"><link rel="prefetch" href="/noteSite/assets/js/22.cf71177a.js"><link rel="prefetch" href="/noteSite/assets/js/23.f8f9c155.js"><link rel="prefetch" href="/noteSite/assets/js/24.2fa19025.js"><link rel="prefetch" href="/noteSite/assets/js/25.d927e4b9.js"><link rel="prefetch" href="/noteSite/assets/js/26.cce0d974.js"><link rel="prefetch" href="/noteSite/assets/js/27.6a4f4064.js"><link rel="prefetch" href="/noteSite/assets/js/28.3e0d9f6a.js"><link rel="prefetch" href="/noteSite/assets/js/29.8ba6931d.js"><link rel="prefetch" href="/noteSite/assets/js/3.724baf89.js"><link rel="prefetch" href="/noteSite/assets/js/30.de36f890.js"><link rel="prefetch" href="/noteSite/assets/js/31.6612acd4.js"><link rel="prefetch" href="/noteSite/assets/js/32.78b8beaf.js"><link rel="prefetch" href="/noteSite/assets/js/33.8b44cb4f.js"><link rel="prefetch" href="/noteSite/assets/js/34.a3c3e9b1.js"><link rel="prefetch" href="/noteSite/assets/js/35.9a5325ad.js"><link rel="prefetch" href="/noteSite/assets/js/36.8c2a6633.js"><link rel="prefetch" href="/noteSite/assets/js/37.8dc4cab2.js"><link rel="prefetch" href="/noteSite/assets/js/38.cbae4750.js"><link rel="prefetch" href="/noteSite/assets/js/39.da4bab0b.js"><link rel="prefetch" href="/noteSite/assets/js/4.a61e4cea.js"><link rel="prefetch" href="/noteSite/assets/js/40.00234240.js"><link rel="prefetch" href="/noteSite/assets/js/41.f23256ea.js"><link rel="prefetch" href="/noteSite/assets/js/42.2f70433c.js"><link rel="prefetch" href="/noteSite/assets/js/43.a3e89e35.js"><link rel="prefetch" href="/noteSite/assets/js/44.214ae715.js"><link rel="prefetch" href="/noteSite/assets/js/45.7dcb07cc.js"><link rel="prefetch" href="/noteSite/assets/js/46.7197c6a0.js"><link rel="prefetch" href="/noteSite/assets/js/47.4b13a3ce.js"><link rel="prefetch" href="/noteSite/assets/js/48.d4f91e20.js"><link rel="prefetch" href="/noteSite/assets/js/49.240bc914.js"><link rel="prefetch" href="/noteSite/assets/js/5.2bccd6df.js"><link rel="prefetch" href="/noteSite/assets/js/50.a0ae5793.js"><link rel="prefetch" href="/noteSite/assets/js/51.0520a778.js"><link rel="prefetch" href="/noteSite/assets/js/52.bcd3b0b7.js"><link rel="prefetch" href="/noteSite/assets/js/53.87d3e53d.js"><link rel="prefetch" href="/noteSite/assets/js/54.1af2d540.js"><link rel="prefetch" href="/noteSite/assets/js/55.bdd0070a.js"><link rel="prefetch" href="/noteSite/assets/js/56.ddea3642.js"><link rel="prefetch" href="/noteSite/assets/js/57.12f3e346.js"><link rel="prefetch" href="/noteSite/assets/js/58.454a9dad.js"><link rel="prefetch" href="/noteSite/assets/js/59.b668a965.js"><link rel="prefetch" href="/noteSite/assets/js/6.f3d86aa7.js"><link rel="prefetch" href="/noteSite/assets/js/60.259492c6.js"><link rel="prefetch" href="/noteSite/assets/js/61.0ade7104.js"><link rel="prefetch" href="/noteSite/assets/js/62.12477d2c.js"><link rel="prefetch" href="/noteSite/assets/js/63.6e4dbca9.js"><link rel="prefetch" href="/noteSite/assets/js/64.ffd3dcf9.js"><link rel="prefetch" href="/noteSite/assets/js/65.c49e7438.js"><link rel="prefetch" href="/noteSite/assets/js/66.387174f5.js"><link rel="prefetch" href="/noteSite/assets/js/67.4ec96ce2.js"><link rel="prefetch" href="/noteSite/assets/js/68.a8f7a106.js"><link rel="prefetch" href="/noteSite/assets/js/69.2d12c766.js"><link rel="prefetch" href="/noteSite/assets/js/7.f685cce4.js"><link rel="prefetch" href="/noteSite/assets/js/70.c6704a7b.js"><link rel="prefetch" href="/noteSite/assets/js/71.f91227b7.js"><link rel="prefetch" href="/noteSite/assets/js/72.9ecb4d62.js"><link rel="prefetch" href="/noteSite/assets/js/73.4e9b1c26.js"><link rel="prefetch" href="/noteSite/assets/js/74.723bef3b.js"><link rel="prefetch" href="/noteSite/assets/js/75.fb82b744.js"><link rel="prefetch" href="/noteSite/assets/js/76.0949df2c.js"><link rel="prefetch" href="/noteSite/assets/js/77.dafcb2dd.js"><link rel="prefetch" href="/noteSite/assets/js/78.7b723904.js"><link rel="prefetch" href="/noteSite/assets/js/79.552747c8.js"><link rel="prefetch" href="/noteSite/assets/js/8.1e22ea55.js"><link rel="prefetch" href="/noteSite/assets/js/80.1eb40217.js"><link rel="prefetch" href="/noteSite/assets/js/81.ed9d2c08.js"><link rel="prefetch" href="/noteSite/assets/js/82.8c1035a1.js"><link rel="prefetch" href="/noteSite/assets/js/83.ece5c212.js"><link rel="prefetch" href="/noteSite/assets/js/84.b091a381.js"><link rel="prefetch" href="/noteSite/assets/js/85.738ce4f1.js"><link rel="prefetch" href="/noteSite/assets/js/86.97891ace.js"><link rel="prefetch" href="/noteSite/assets/js/88.d7a34d04.js"><link rel="prefetch" href="/noteSite/assets/js/89.38526019.js"><link rel="prefetch" href="/noteSite/assets/js/9.09db9bdb.js"><link rel="prefetch" href="/noteSite/assets/js/90.d613e933.js"><link rel="prefetch" href="/noteSite/assets/js/91.bc17a0d7.js"><link rel="prefetch" href="/noteSite/assets/js/92.4f16c9d4.js"><link rel="prefetch" href="/noteSite/assets/js/93.980edac0.js"><link rel="prefetch" href="/noteSite/assets/js/94.7bba8abf.js"><link rel="prefetch" href="/noteSite/assets/js/95.163863cf.js"><link rel="prefetch" href="/noteSite/assets/js/96.96e5902c.js"><link rel="prefetch" href="/noteSite/assets/js/97.26ed8bf9.js"><link rel="prefetch" href="/noteSite/assets/js/98.1befdaae.js"><link rel="prefetch" href="/noteSite/assets/js/99.a463be20.js">
    <link rel="stylesheet" href="/noteSite/assets/css/0.styles.0f3b0cbd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/noteSite/" class="home-link router-link-active"><img src="/noteSite/images/hedon.png" alt="Hedon" class="logo"> <span class="site-name can-hide">Hedon</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/component/" class="nav-link">
  计算机组成原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link router-link-active">
  中间件
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><a href="/noteSite/leetcode/" class="nav-link">
  Leetcode
</a></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/noteSite/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/noteSite/guide/" class="nav-link">
  Guide
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="CS Menu" class="dropdown-title"><span class="title">计算机基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="CS Menu" class="mobile-dropdown-title"><span class="title">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/cs/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/os/" class="nav-link">
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/cn/" class="nav-link">
  计算机网络
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/cs/component/" class="nav-link">
  计算机组成原理
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Backend Menu" class="dropdown-title"><span class="title">后端</span> <span class="arrow down"></span></button> <button type="button" aria-label="Backend Menu" class="mobile-dropdown-title"><span class="title">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/noteSite/backend/java/" class="nav-link">
  Java
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/golang/" class="nav-link">
  Golang
</a></li><li class="dropdown-item"><!----> <a href="/noteSite/backend/middleware/" class="nav-link router-link-active">
  中间件
</a></li></ul></div></div><div class="nav-item"><a href="/noteSite/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/noteSite/linux/" class="nav-link">
  Linux
</a></div><div class="nav-item"><a href="/noteSite/mac/" class="nav-link">
  Mac
</a></div><div class="nav-item"><a href="/noteSite/leetcode/" class="nav-link">
  Leetcode
</a></div><div class="nav-item"><a href="/noteSite/paper/" class="nav-link">
  Paper
</a></div><div class="nav-item"><a href="https://github.com/hedon954/noteSite" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/noteSite/backend/middleware/redis/redis_intro.html" class="sidebar-link">一、Redis 快速入门</a></li><li><a href="/noteSite/backend/middleware/redis/redis_dataType.html" class="sidebar-link">二、Redis 数据类型</a></li><li><a href="/noteSite/backend/middleware/redis/redis_store.html" class="sidebar-link">三、Redis 持久化</a></li><li><a href="/noteSite/backend/middleware/redis/redis_client.html" class="sidebar-link">四、Redis 客户端</a></li><li><a href="/noteSite/backend/middleware/redis/redis_cache.html" class="sidebar-link">五、Redis 缓存</a></li><li><a href="/noteSite/backend/middleware/redis/redis_better.html" class="sidebar-link">六、Redis 性能优化</a></li><li><a href="/noteSite/backend/middleware/redis/redis_master_slave.html" class="sidebar-link">七、Redis 主从复制</a></li><li><a href="/noteSite/backend/middleware/redis/redis_sentinel.html" class="sidebar-link">八、Redis 哨兵模式</a></li><li><a href="/noteSite/backend/middleware/redis/redis_cluster.html" aria-current="page" class="active sidebar-link">九、Redis 集群分片</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_1-集群介绍" class="sidebar-link">1. 集群介绍</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_2-redis-集群架构" class="sidebar-link">2. Redis 集群架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_2-1-架构简介" class="sidebar-link">2.1 架构简介</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_2-2-主从模式" class="sidebar-link">2.2 主从模式</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_2-3-优点" class="sidebar-link">2.3 优点</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_2-4-缺点" class="sidebar-link">2.4 缺点</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_3-数据分区方式" class="sidebar-link">3. 数据分区方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_3-1-范围分区" class="sidebar-link">3.1 范围分区</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_3-2-节点取余分区" class="sidebar-link">3.2 节点取余分区</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_3-3-一致性哈希分区" class="sidebar-link">3.3 一致性哈希分区</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_3-4-虚拟槽分区" class="sidebar-link">3.4 虚拟槽分区</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_4-集群环境搭建" class="sidebar-link">4. 集群环境搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_4-1-环境准备" class="sidebar-link">4.1 环境准备</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_4-2-安装-redis" class="sidebar-link">4.2 安装 Redis</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_4-3-创建目录" class="sidebar-link">4.3 创建目录</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_4-4-创建配置文件" class="sidebar-link">4.4 创建配置文件</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_4-5-启动-redis" class="sidebar-link">4.5 启动 Redis</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_4-6-启动-redis-cluster" class="sidebar-link">4.6 启动 Redis Cluster</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_5-集群状态检查" class="sidebar-link">5. 集群状态检查</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_5-1-检查集群状态" class="sidebar-link">5.1 检查集群状态</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_5-2-集群日志分析" class="sidebar-link">5.2 集群日志分析</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_5-3-查看集群信息" class="sidebar-link">5.3 查看集群信息</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_6-集群环境测试" class="sidebar-link">6.  集群环境测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_6-1-set-get" class="sidebar-link">6.1 SET/GET</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_6-2-从节点只读模式" class="sidebar-link">6.2 从节点只读模式</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_7-集群性能测试" class="sidebar-link">7. 集群性能测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_7-1-redis-benchmark-命令" class="sidebar-link">7.1 redis-benchmark 命令</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_7-2-单机测试" class="sidebar-link">7.2 单机测试</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_7-3-集群测试" class="sidebar-link">7.3 集群测试</a></li></ul></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_8-集群原理总结" class="sidebar-link">8. 集群原理总结</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_8-1-哈希槽" class="sidebar-link">8.1 哈希槽</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_8-2-16384-个-slot" class="sidebar-link">8.2 16384 个 slot</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_8-3-槽位定位算法" class="sidebar-link">8.3 槽位定位算法</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_8-4-扩容原理" class="sidebar-link">8.4 扩容原理</a></li><li class="sidebar-sub-header"><a href="/noteSite/backend/middleware/redis/redis_cluster.html#_8-5-缩容原理" class="sidebar-link">8.5 缩容原理</a></li></ul></li></ul></li><li><a href="/noteSite/backend/middleware/redis/redis_cluster_manage.html" class="sidebar-link">十、Redis 集群高可用</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redis 实战</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="九、redis-集群分片"><a href="#九、redis-集群分片" class="header-anchor">#</a> 九、Redis 集群分片</h1> <h2 id="_1-集群介绍"><a href="#_1-集群介绍" class="header-anchor">#</a> 1. 集群介绍</h2> <p>集群（cluster）就是一组计算机，它们作为一个整体向用户提供一组网络资源，这些单个的计算机系统就是集群的节点（node）。集群提供了以下关键的特性：</p> <ul><li>可扩展性</li> <li>高可用性</li> <li>负载均衡</li> <li>错误恢复</li></ul> <p>分布式与集群的联系与区别如下：</p> <ul><li>分布式即各个业务分开部署，集群指的是几台服务器集中在一起实现同一个业务。</li> <li>分布式的每一个节点都可以做成集群，而集群并不一定就是分布式的。</li></ul> <p>集群主要分为三大类：</p> <ul><li>HA（High Availability Cluster）：高可用集群</li> <li>LBC（Load Balance Cluster）：负载均衡集群</li> <li>HPC（High Performance Computing Cluster）：高性能集群</li></ul> <h2 id="_2-redis-集群架构"><a href="#_2-redis-集群架构" class="header-anchor">#</a> 2. Redis 集群架构</h2> <h3 id="_2-1-架构简介"><a href="#_2-1-架构简介" class="header-anchor">#</a> 2.1 架构简介</h3> <ul><li>并发量大了 → 主从复制解决 → 主从稳定性 → 哨兵解决 → 单节点存储能力 → 集群 Cluster 解决</li> <li>Redis Cluster 集群模式具有高可用、可扩展性、分布式、容错等特性。</li></ul> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt6vbt70waj30hs0c5js8.jpg" alt="img"></p> <p>Redis Cluster 采用无中心结构，每个节点都可以保存数据和整个集群状态，每个节点都和其他所有节点连接，Cluster 至少为 6 个才能保证组成完成高可用集群，分为 3 主 3 从。主节点分配槽，处理客户端的命令请求，从节点可用在主节点故障后，顶替主节点。</p> <div class="custom-block warning"><p class="custom-block-title">为什么至少 6 台呢？</p> <p>我们可以在 Redis 官方找到这么一句话：</p> <blockquote><p>Note that the minial cluster that works as expected requires to contain at least three master nodes.</p></blockquote> <p>因为最小的 Redis 集群，需要至少 3 个主节点（哨兵），既然有 3 个主节点，而一个主节点搭配至少一个从节点，因此至少得 6 台 Redis。</p></div> <p>如上图所示，该集群中包括 6 个 Redis 节点，3 主 3 从，分别为 M1、M2、M3、S1、S2、S3。除了主从 Redis 节点之间进行数据复制外，锁有 Redis 节点之间采用 Gossip 协议进行通信，交换维护节点元数据信息。</p> <div class="custom-block tip"><p class="custom-block-title">Gossip</p></div> <h3 id="_2-2-主从模式"><a href="#_2-2-主从模式" class="header-anchor">#</a> 2.2 主从模式</h3> <ul><li>一个主节点搭配一个或多个从节点，从而保证高可用。</li></ul> <h3 id="_2-3-优点"><a href="#_2-3-优点" class="header-anchor">#</a> 2.3 优点</h3> <ul><li>去中心化</li> <li>可扩展性</li> <li>高可用性</li> <li>自动故障转移</li></ul> <h3 id="_2-4-缺点"><a href="#_2-4-缺点" class="header-anchor">#</a> 2.4 缺点</h3> <ul><li>数据通过异步复制，无法保证数据强一致性</li> <li>集群环境搭建略微复杂</li></ul> <h2 id="_3-数据分区方式"><a href="#_3-数据分区方式" class="header-anchor">#</a> 3. 数据分区方式</h2> <p>随着请求量和数据量的增加，一台机器已经无法满足需求，我们就需要把数据和请求分割到多台机器，这时候就需要引入分布式存储。分布式分成有以下几个特性：</p> <ul><li>增强可用性</li> <li>维护方便</li> <li>均衡 IO</li> <li>改善查询性能</li></ul> <p>分布式存储首先要解决的就是把整个数据集安全分区规则映射到多个节点的问题。</p> <p>下面介绍几个常见的分区算法。</p> <h3 id="_3-1-范围分区"><a href="#_3-1-范围分区" class="header-anchor">#</a> 3.1 范围分区</h3> <ul><li>优点：同一范围内的范围查询不需要跨节点，提升查询速度</li> <li>应用场景：MySQL、Oracle</li></ul> <h3 id="_3-2-节点取余分区"><a href="#_3-2-节点取余分区" class="header-anchor">#</a> 3.2 节点取余分区</h3> <p>hash(object) % N</p> <ul><li>优点：实现简单，数据均匀分摊</li> <li>缺点：当扩容或缩容节点时，需要迁移的数据量大（翻倍扩容可以相对减少迁移量）。</li></ul> <h3 id="_3-3-一致性哈希分区"><a href="#_3-3-一致性哈希分区" class="header-anchor">#</a> 3.3 一致性哈希分区</h3> <ul><li>优点：相比节点取余最大的好处在于加入和删除节点只影响哈希环中相邻的节点，对其他节点无影响。</li> <li>缺点：当使用少量节点时，节点变化将大范围影响哈希环中数据映射，因此这种方式不适合少量数据节点的分布式方案。</li> <li>应用场景：Memcached</li></ul> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt6wrph6gnj30hz0dddgo.jpg" alt="img"></p> <div class="custom-block tip"><p class="custom-block-title">一致性哈希算法</p> <blockquote><p>参考：https://zhuanlan.zhihu.com/p/98030096</p></blockquote> <p><strong>1. 普通 hash 算法在分布式系统中的缺陷</strong></p> <p>在分布式的存储系统中，要将数据存储到具体的节点上，如果我们采用普通的 hash 算法进行路由，将数据映射到具体的节点上，如 key%N，key 是数据的 key，N是 机器节点数，如果有一个机器加入或退出这个集群，则所有的数据映射都无效了，如果是持久化存储则要做数据迁移，如果是分布式缓存，则其他缓存就失效了。</p> <p><strong>2. 一致性哈希</strong></p> <p>一致性哈希提出了在动态变化的 Cache 环境中，哈希算法应该满足的 4 个适应条件：</p> <ul><li><p>均衡性（Balance）</p> <p>平衡性是指哈希的结果能够尽可能分布到所有的缓冲中去，这样可以使得所有的缓冲空间都得到利用。很多哈希算法都能够满足这一条件。</p></li> <li><p>单调性（Monotonicity）</p> <p>单调性是指如果已经有一些内容通过哈希分派到了相应的缓冲中，又有新的缓冲区加入到系统中，那么哈希的结果应能够保证原有已分配的内容可以被映射到新的缓冲区中去，而不会被映射到旧的缓冲集合中的其他缓冲区。（<strong>这段翻译信息有负面价值的，当缓冲区大小变化时一致性哈希（Consistent hashing）尽量保护已分配的内容不会被重新映射到新缓冲区。</strong>）</p></li> <li><p>低分散性（Spread）</p> <p>在分布式环境中，终端有可能看不到所有的缓冲，而是只能看到其中的一部分。当终端希望通过哈希过程将内容映射到缓冲上时，由于不同终端所见的缓冲范围有可能不同，从而导致哈希的结果不一致，最终的结果是相同的内容被不同的终端映射到不同的缓冲区中。这种情况显然是应该避免的，因为它导致相同内容被存储到不同缓冲中去，降低了系统存储的效率。分散性的定义就是上述情况发生的严重程度。好的哈希算法应能够尽量避免不一致的情况发生，也就是尽量降低分散性。</p></li> <li><p>低负载（Load）</p> <p>负载问题实际上是从另一个角度看待分散性问题。既然不同的终端可能将相同的内容映射到不同的缓冲区中，那么对于一个特定的缓冲区而言，也可能被不同的用户映射为不同的内容。与分散性一样，这种情况也是应当避免的，因此好的哈希算法应能够尽量降低缓冲的负荷。</p></li></ul> <p><strong>3. 一致性哈希算法实现</strong></p> <ul><li><p>环形 hash 空间</p> <p>按照常用的 hash 算法来将对应的 key 哈希到一个具有 2<sup>32</sup> 次方个节点的空间中，即 0 ~ （2<sup>32</sup>-1）的数字空间中。现在我们可以将这些数字头尾相连，想象成一个闭合的环形。</p> <p>节点的个数可以自定义，整个 hash 环我们可以用 TreeMap 来实现，因为 TreeMap 是有序的，我们刚好可以利用上。</p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt6x9qckxuj30bh0c70so.jpg" alt="img"></p></li> <li><p>映射服务器节点</p> <p>将各个服务器使用 hash 进行一个哈希，具体可以选择服务器的 IP 或唯一主机名作为关键字进行哈希，这样每台机器就能确定其在哈希环上的位置。假设我们将四台服务器使用 IP 地址哈希后在环空间的位置如下：</p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt6xcfnug3j30i50iy3yw.jpg" alt="img" style="zoom:67%;"></li> <li><p>映射数据</p> <p>现在我们将 objectA、objectB、objectC、objectD 四个对象通过特定的 hash 函数计算出对应的 key 值，然后散列到 hash 环上,然后从数据所在位置沿环顺时针“行走”，第一台遇到的服务器就是其应该定位到的服务器。</p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt6xd1r9oaj30u00ut0u3.jpg" alt="img" style="zoom:43%;"></li> <li><p>节点的删除与增加</p> <ul><li><p>如果此时 NodeC 宕机了，此时 Object A、B、D 不会受到影响，只有 ObjectC 会重新分配到 NodeD 上面去，而其他数据对象不会发生变化。</p></li> <li><p>如果在环境中新增一台服务器 Node X，通过 hash 算法将 Node X 映射到环中，通过按顺时针迁移的规则，那么ObjectC 被迁移到了 NodeX中，其它对象还保持这原有的存储位置。通过对节点的添加和删除的分析，一致性哈希算法在保持了单调性的同时，还是数据的迁移达到了最小，这样的算法对分布式集群来说是非常合适的，避免了大量数据迁移，减小了服务器的的压力。</p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt6xfab1kkj30u00v7wg1.jpg" alt="img" style="zoom:50%;"></li></ul></li> <li><p>虚拟节点</p> <p>到目前为止一致性哈希也可以算做完成了，但是有一个问题还需要解决，那就是<strong>平衡性</strong>。从下图我们可以看出，当服务器节点比较少的时候，会出现一个问题，就是此时必然造成大量数据集中到一个节点上面，极少数数据集中到另外的节点上面。</p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt6xfpinraj30cq0imdfz.jpg" alt="img" style="zoom:67%;"> <p>为了解决这种数据倾斜问题，一致性哈希算法引入了虚拟节点机制，即对每一个服务节点计算多个哈希，每个计算结果位置都放置一个此服务节点，称为虚拟节点。具体做法可以先确定每个物理节点关联的虚拟节点数量，然后在 IP 或者主机名后面增加编号。例如上面的情况，可以为每台服务器计算三个虚拟节点，于是可以分别计算 “Node A#1”、“Node A#2”、“Node A#3”、“Node B#1”、“Node B#2”、“Node B#3”的哈希值，于是形成六个虚拟节点：</p> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gt6xg5m7rtj30hq0ii74v.jpg" alt="img" style="zoom:67%;"> <p>同时数据定位算法不变，只是多了一步虚拟节点到实际节点的映射，例如定位到“Node A#1”、“Node A#2”、“Node A#3”三个虚拟节点的数据均定位到 NodeA上。这样就解决了服务节点少时数据倾斜的问题。每个物理节点关联的虚拟节点数量就根据具体的生产环境情况在确定。</p></li></ul></div> <h3 id="_3-4-虚拟槽分区"><a href="#_3-4-虚拟槽分区" class="header-anchor">#</a> 3.4 虚拟槽分区</h3> <p>Redis 内部内置了序号 0-16383 个槽位，每个槽位可以用来存储一个数据集合，将这些槽位按顺序分配到集群中的各个节点。每次新的数据到来，会通过哈希函数 CRC16(key) 算出将要存储的槽位下标，然后通过该下标找到前面分配的 Redis 节点，最后将数据存储到该节点中。</p> <p>这种结构很容易添加或者删除节点，并且无论是添加删除或者修改某一个节点，都不会造成集群不可用的状态。<strong>使用哈希槽的好处就在于可以方便的添加或移除节点。</strong></p> <ol><li>当需要增加节点时，只需要把其他节点的某些哈希槽挪到新节点就可以了；</li> <li>当需要移除节点时，只需要把移除节点上的哈希槽挪到其他节点就行了。</li></ol> <ul><li>优点：每个 node 均匀的分配了 slot，缩小增减节点影响的范围。</li> <li>缺点：需要存储 node 和 slot 的对应信息。</li> <li>应用场景：Redis Cluster。</li></ul> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt78ks8cd9j31fq0ncgom.jpg" alt="image-20210806181759610"></p> <h2 id="_4-集群环境搭建"><a href="#_4-集群环境搭建" class="header-anchor">#</a> 4. 集群环境搭建</h2> <blockquote><p>为了方便，本节集群环境中准备 3 台虚拟机，每台虚拟机上跑 2 个 Redis，模拟 6 台机器，搭建 3 主 3 从集群。</p></blockquote> <h3 id="_4-1-环境准备"><a href="#_4-1-环境准备" class="header-anchor">#</a> 4.1 环境准备</h3> <table><thead><tr><th>IP</th> <th>端口</th> <th>操作系统</th></tr></thead> <tbody><tr><td>172.16.58.200</td> <td>6371, 6372</td> <td>CentOS 7</td></tr> <tr><td>172.16.58.201</td> <td>6373, 6374</td> <td>CentOS 7</td></tr> <tr><td>172.16.58.202</td> <td>6375, 6376</td> <td>CentOS 7</td></tr></tbody></table> <h3 id="_4-2-安装-redis"><a href="#_4-2-安装-redis" class="header-anchor">#</a> 4.2 安装 Redis</h3> <p>分别在三台机器上下载 Redis：<a href="/noteSite/backend/middleware/redis/redis_intro.html#_2-2-安装-redis">Redis 安装</a></p> <h3 id="_4-3-创建目录"><a href="#_4-3-创建目录" class="header-anchor">#</a> 4.3 创建目录</h3> <p>在三台机器上都创建以下目录</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">mkdir</span> -p /usr/local/redis/cluster/conf
<span class="token function">mkdir</span> -p /usr/local/redis/cluster/data
<span class="token function">mkdir</span> -p /usr/local/redis/cluster/log
</code></pre></div><h3 id="_4-4-创建配置文件"><a href="#_4-4-创建配置文件" class="header-anchor">#</a> 4.4 创建配置文件</h3> <p>三台机器都创建两个配置文件，6371 的如下，其余的同理。</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">vim</span> /usr/local/redis/cluster/conf/redis-6371.conf
</code></pre></div><p>内容如下：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 放行 IP 限制</span>
<span class="token builtin class-name">bind</span> <span class="token number">0.0</span>.0.0
<span class="token comment"># 端口</span>
port <span class="token number">6371</span>
<span class="token comment"># 后台启动</span>
daemonize <span class="token function">yes</span>
<span class="token comment"># 日志存储目录以及日志文件名</span>
logfile <span class="token string">&quot;/usr/local/redis/cluster/log/redis-6371.log&quot;</span>
<span class="token comment"># RDB 数据文件名</span>
dbfilename dump-6371.rbd
<span class="token comment"># AOF 模式开启和 AOF 数据文件名</span>
appendonly <span class="token function">yes</span>
appendfilename <span class="token string">&quot;appendonly-6371.aof&quot;</span>
<span class="token comment"># RDB 数据文件和 AOF 数据文件的存储目录</span>
<span class="token function">dir</span> /usr/local/redis/cluster/data
<span class="token comment"># 设置密码</span>
requirepass <span class="token number">123456</span>
<span class="token comment"># 从节点访问主节点密码（必须与 requirepass 一致）</span>
masterauth <span class="token number">123456</span>
<span class="token comment"># 是否开启集群模式，默认是 no</span>
cluster-enabled <span class="token function">yes</span>
<span class="token comment"># 集群节点信息文件，会保存在 dir 配置对应目录下</span>
cluster-config-file nodes-6371.conf
<span class="token comment"># 集群节点连接超时时间，单位是毫秒</span>
cluster-node-timeout <span class="token number">15000</span>
<span class="token comment"># 集群节点 IP</span>
cluster-announce-ip <span class="token number">172.16</span>.58.200
<span class="token comment"># 集群节点映射端口</span>
cluster-announce-port <span class="token number">6371</span>
<span class="token comment"># 集群节点总线端口</span>
cluster-announce-bus-port <span class="token number">16371</span>
</code></pre></div><h3 id="_4-5-启动-redis"><a href="#_4-5-启动-redis" class="header-anchor">#</a> 4.5 启动 Redis</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 172.16.58.200</span>
/usr/local/redis/bin/redis-server /usr/local/redis/cluster/conf/redis-6371.conf 
/usr/local/redis/bin/redis-server /usr/local/redis/cluster/conf/redis-6372.conf 

<span class="token comment"># 172.16.58.201</span>
/usr/local/redis/bin/redis-server /usr/local/redis/cluster/conf/redis-6373.conf 
/usr/local/redis/bin/redis-server /usr/local/redis/cluster/conf/redis-6374.conf 

<span class="token comment"># 172.16.58.202</span>
/usr/local/redis/bin/redis-server /usr/local/redis/cluster/conf/redis-6375.conf 
/usr/local/redis/bin/redis-server /usr/local/redis/cluster/conf/redis-6376.conf 
</code></pre></div><h3 id="_4-6-启动-redis-cluster"><a href="#_4-6-启动-redis-cluster" class="header-anchor">#</a> 4.6 启动 Redis Cluster</h3> <p>随便找一个节点，执行以下命令，就可以创建 Redis Cluster 了：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>/usr/local/redis/bin/redis-cli -a <span class="token number">123456</span> --cluster create <span class="token punctuation">\</span>
<span class="token number">172.16</span>.58.200:6371 <span class="token number">172.16</span>.58.200:6372 <span class="token punctuation">\</span>
<span class="token number">172.16</span>.58.201:6373 <span class="token number">172.16</span>.58.201:6374 <span class="token punctuation">\</span>
<span class="token number">172.16</span>.58.202:6375 <span class="token number">172.16</span>.58.202:6376 <span class="token punctuation">\</span>
--cluster-replicas <span class="token number">1</span>
</code></pre></div><ul><li><code>--cluster create</code>：创建集群</li> <li><code>--cluster-replicas</code>：主从比例，<code>1</code> 表示一主一从</li></ul> <p>输出：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing <span class="token builtin class-name">hash</span> slots allocation on <span class="token number">6</span> nodes<span class="token punctuation">..</span>.
Master<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">0</span> - <span class="token number">5460</span>
Master<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">5461</span> - <span class="token number">10922</span>
Master<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> -<span class="token operator">&gt;</span> Slots <span class="token number">10923</span> - <span class="token number">16383</span>
Adding replica <span class="token number">172.16</span>.58.201:6374 to <span class="token number">172.16</span>.58.200:6371
Adding replica <span class="token number">172.16</span>.58.202:6376 to <span class="token number">172.16</span>.58.201:6373
Adding replica <span class="token number">172.16</span>.58.200:6372 to <span class="token number">172.16</span>.58.202:6375
M: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 <span class="token number">172.16</span>.58.200:6371
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 <span class="token number">172.16</span>.58.200:6372
   replicates be0ddf4921a4a2f077b8c0a72504c8714c69b836
M: ad98c789913e6cb9db293379509d39d8856d41b2 <span class="token number">172.16</span>.58.201:6373
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
S: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 <span class="token number">172.16</span>.58.201:6374
   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5
M: be0ddf4921a4a2f077b8c0a72504c8714c69b836 <span class="token number">172.16</span>.58.202:6375
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
S: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f <span class="token number">172.16</span>.58.202:6376
   replicates ad98c789913e6cb9db293379509d39d8856d41b2
Can I <span class="token builtin class-name">set</span> the above configuration? <span class="token punctuation">(</span>type <span class="token string">'yes'</span> to accept<span class="token punctuation">)</span>: <span class="token function">yes</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Nodes configuration updated
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Assign a different config epoch to each node
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Sending CLUSTER MEET messages to <span class="token function">join</span> the cluster
Waiting <span class="token keyword">for</span> the cluster to <span class="token function">join</span>
<span class="token builtin class-name">.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using node <span class="token number">172.16</span>.58.200:6371<span class="token punctuation">)</span>
M: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 <span class="token number">172.16</span>.58.200:6371
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 <span class="token number">172.16</span>.58.200:6372
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates be0ddf4921a4a2f077b8c0a72504c8714c69b836
M: be0ddf4921a4a2f077b8c0a72504c8714c69b836 <span class="token number">172.16</span>.58.202:6375
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: ad98c789913e6cb9db293379509d39d8856d41b2 <span class="token number">172.16</span>.58.201:6373
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 <span class="token number">172.16</span>.58.201:6374
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5
S: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f <span class="token number">172.16</span>.58.202:6376
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates ad98c789913e6cb9db293379509d39d8856d41b2
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
</code></pre></div><h2 id="_5-集群状态检查"><a href="#_5-集群状态检查" class="header-anchor">#</a> 5. 集群状态检查</h2> <h3 id="_5-1-检查集群状态"><a href="#_5-1-检查集群状态" class="header-anchor">#</a> 5.1 检查集群状态</h3> <p>命令：<code>check</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code>redis-cli -a <span class="token number">123456</span> --cluster check <span class="token number">172.16</span>.58.201:6373
</code></pre></div><p>输出：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 主节点信息</span>
<span class="token number">172.16</span>.58.201:6373 <span class="token punctuation">(</span>ad98c789<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">0</span> keys <span class="token operator">|</span> <span class="token number">5462</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">172.16</span>.58.200:6371 <span class="token punctuation">(</span>8306858f<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">0</span> keys <span class="token operator">|</span> <span class="token number">5461</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token number">172.16</span>.58.202:6375 <span class="token punctuation">(</span>be0ddf49<span class="token punctuation">..</span>.<span class="token punctuation">)</span> -<span class="token operator">&gt;</span> <span class="token number">0</span> keys <span class="token operator">|</span> <span class="token number">5461</span> slots <span class="token operator">|</span> <span class="token number">1</span> slaves.
<span class="token comment"># 主节点中都有多少 key</span>
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> <span class="token number">0</span> keys <span class="token keyword">in</span> <span class="token number">3</span> masters.
<span class="token number">0.00</span> keys per slot on average.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Performing Cluster Check <span class="token punctuation">(</span>using node <span class="token number">172.16</span>.58.201:6373<span class="token punctuation">)</span>
<span class="token comment"># 主从详细信息</span>
M: ad98c789913e6cb9db293379509d39d8856d41b2 <span class="token number">172.16</span>.58.201:6373
	 <span class="token comment"># 分槽情况</span>
   slots:<span class="token punctuation">[</span><span class="token number">5461</span>-10922<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5462</span> slots<span class="token punctuation">)</span> master
   <span class="token comment"># 从节点个数</span>
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 <span class="token number">172.16</span>.58.201:6374
	 <span class="token comment"># 从节点无槽</span>
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   <span class="token comment"># 从节点在复制哪个主节点</span>
   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5
S: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 <span class="token number">172.16</span>.58.200:6372
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates be0ddf4921a4a2f077b8c0a72504c8714c69b836
M: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 <span class="token number">172.16</span>.58.200:6371
   slots:<span class="token punctuation">[</span><span class="token number">0</span>-5460<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
M: be0ddf4921a4a2f077b8c0a72504c8714c69b836 <span class="token number">172.16</span>.58.202:6375
   slots:<span class="token punctuation">[</span><span class="token number">10923</span>-16383<span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token number">5461</span> slots<span class="token punctuation">)</span> master
   <span class="token number">1</span> additional replica<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
S: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f <span class="token number">172.16</span>.58.202:6376
   slots: <span class="token punctuation">(</span><span class="token number">0</span> slots<span class="token punctuation">)</span> slave
   replicates ad98c789913e6cb9db293379509d39d8856d41b2
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All nodes agree about slots configuration.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check <span class="token keyword">for</span> <span class="token function">open</span> slots<span class="token punctuation">..</span>.
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> Check slots coverage<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>OK<span class="token punctuation">]</span> All <span class="token number">16384</span> slots covered.
</code></pre></div><h3 id="_5-2-集群日志分析"><a href="#_5-2-集群日志分析" class="header-anchor">#</a> 5.2 集群日志分析</h3> <p>由输出日志 <code>Adding replica 172.16.58.201:6374 to 172.16.58.200:6371</code> 我们可以知道 <code>6371</code> 是 <code>6374</code> 的主节点，我们就来分析这两个节点的日志。</p> <ul><li><p>6371</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 6371</span>
$ <span class="token function">tail</span> -f -n <span class="token number">1000</span> /usr/local/redis/cluster/log/redis-6371.log

<span class="token comment"># 初始化 Redis 服务</span>
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:36:50.916 <span class="token comment"># Server initialized</span>
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:36:50.916 <span class="token comment"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo madvise &gt; /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled (set to 'madvise' or 'never').</span>
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:36:50.916 * Ready to accept connections
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:38.570 <span class="token comment"># configEpoch set to 1 via CLUSTER SET-CONFIG-EPOCH</span>
<span class="token comment"># 从节点 6374 请求 SYNC 复制</span>
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.047 * Replica <span class="token number">172.16</span>.58.201:6374 asks <span class="token keyword">for</span> synchronization
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.047 * Partial resynchronization not accepted: Replication ID mismatch <span class="token punctuation">(</span>Replica asked <span class="token keyword">for</span> <span class="token string">'2deebf1e2e8995cd7e561153ce643056c542f05e'</span>, my replication IDs are <span class="token string">'9fed7c28df63218d0d29b9041a683ca7213dcad8'</span> and <span class="token string">'0000000000000000000000000000000000000000'</span><span class="token punctuation">)</span>
<span class="token comment"># 创建 backlog 以及对应的复制 ID</span>
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.047 * Replication backlog created, my new replication IDs are <span class="token string">'145f1a07ead94288b0324a632fcb1d1c2debbba7'</span> and <span class="token string">'0000000000000000000000000000000000000000'</span>
<span class="token comment"># bgsave</span>
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.047 * Starting BGSAVE <span class="token keyword">for</span> SYNC with target: disk
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.047 * Background saving started by pid <span class="token number">89219</span>
<span class="token number">89219</span>:C 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.052 * DB saved on disk
<span class="token number">89219</span>:C 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.052 * RDB: <span class="token number">0</span> MB of memory used by copy-on-write
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.115 * Background saving terminated with success
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.116 * Synchronization with replica <span class="token number">172.16</span>.58.201:6374 succeeded
<span class="token number">83479</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:43.522 <span class="token comment"># Cluster state changed: ok</span>
</code></pre></div></li> <li><p>6374</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 6374</span>
$ <span class="token function">tail</span> -f -n <span class="token number">1000</span> /usr/local/redis/cluster/log/redis-6374.log

<span class="token comment"># 初始化 Redis 服务</span>
<span class="token number">98575</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:44:37.923 <span class="token comment"># Server initialized</span>
<span class="token number">98575</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:44:37.923 <span class="token comment"># WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo madvise &gt; /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled (set to 'madvise' or 'never').</span>
<span class="token number">98575</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:44:37.924 * Ready to accept connections
<span class="token number">98575</span>:M 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:38.749 <span class="token comment"># configEpoch set to 4 via CLUSTER SET-CONFIG-EPOCH</span>
<span class="token comment"># 在变为从节点之前，要做一些准备工作</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:40.769 * Before turning into a replica, using my own master parameters to synthesize a cached master: I may be able to synchronize with the new master with just a partial transfer.
<span class="token comment"># 集群环境准备 ok</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:40.769 <span class="token comment"># Cluster state changed: ok</span>
<span class="token comment"># 连接主节点</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.213 * Connecting to MASTER <span class="token number">172.16</span>.58.200:6371
<span class="token comment"># 开始主从复制</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.213 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">&gt;</span> REPLICA <span class="token function">sync</span> started
<span class="token comment"># 触发了 SYNC 主从同步非阻塞命令</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.214 * Non blocking connect <span class="token keyword">for</span> SYNC fired the event.
<span class="token comment"># 主从 PING-PONG 通信</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.216 * Master replied to PING, replication can continue<span class="token punctuation">..</span>.
<span class="token comment"># 尝试一个部分同步</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.221 * Trying a partial resynchronization <span class="token punctuation">(</span>request 2deebf1e2e8995cd7e561153ce643056c542f05e:1<span class="token punctuation">)</span>.
<span class="token comment"># 因为环境刚搭好，需要全量复制，所以被 master 拒绝了，开始全量复制</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.223 * Full resync from master: 145f1a07ead94288b0324a632fcb1d1c2debbba7:0
<span class="token comment"># 抛弃之前缓存的数据</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.223 * Discarding previously cached master state.
<span class="token comment"># 开始从主节点那拉数据</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.291 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">&gt;</span> REPLICA sync: receiving <span class="token number">175</span> bytes from master to disk
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.292 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">&gt;</span> REPLICA sync: Flushing old data
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.292 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">&gt;</span> REPLICA sync: Loading DB <span class="token keyword">in</span> memory
<span class="token comment"># 加载 RDB</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.293 * Loading RDB produced by version <span class="token number">6.0</span>.9
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.293 * RDB age <span class="token number">0</span> seconds
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.293 * RDB memory usage when created <span class="token number">2.54</span> Mb
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.293 * MASTER <span class="token operator">&lt;</span>-<span class="token operator">&gt;</span> REPLICA sync: Finished with success
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.293 * Background append only <span class="token function">file</span> rewriting started by pid <span class="token number">100901</span>
<span class="token comment"># 加载 AOF</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.318 * AOF rewrite child asks to stop sending diffs.
<span class="token number">100901</span>:C 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.318 * Parent agreed to stop sending diffs. Finalizing AOF<span class="token punctuation">..</span>.
<span class="token number">100901</span>:C 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.318 * Concatenating <span class="token number">0.00</span> MB of AOF <span class="token function">diff</span> received from parent.
<span class="token number">100901</span>:C 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.318 * SYNC append only <span class="token function">file</span> rewrite performed
<span class="token number">100901</span>:C 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.319 * AOF rewrite: <span class="token number">0</span> MB of memory used by copy-on-write
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.414 * Background AOF rewrite terminated with success
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.414 * Residual parent <span class="token function">diff</span> successfully flushed to the rewritten AOF <span class="token punctuation">(</span><span class="token number">0.00</span> MB<span class="token punctuation">)</span>
<span class="token number">98575</span>:S 05 Aug <span class="token number">2021</span> <span class="token number">23</span>:52:41.414 * Background AOF rewrite finished successfully
</code></pre></div></li></ul> <h3 id="_5-3-查看集群信息"><a href="#_5-3-查看集群信息" class="header-anchor">#</a> 5.3 查看集群信息</h3> <p>随便找一个节点，连进 Redis Cluster，核心选项 <code>-c</code>，表示以集群的模式连接：</p> <div class="language-sh extra-class"><pre class="language-sh"><code>redis-cli -c -a <span class="token number">123456</span> -h <span class="token number">172.16</span>.58.200 -p <span class="token number">6371</span>
</code></pre></div><h4 id="_5-3-1-查看集群信息-cluster-info"><a href="#_5-3-1-查看集群信息-cluster-info" class="header-anchor">#</a> 5.3.1 查看集群信息 CLUSTER INFO</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token number">172.16</span>.58.200:637<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> CLUSTER INFO
<span class="token comment"># 集群状态</span>
cluster_state:ok
<span class="token comment"># 总槽数</span>
cluster_slots_assigned:16384
<span class="token comment"># 分配好的槽</span>
cluster_slots_ok:16384
<span class="token comment"># 可能失败的槽</span>
cluster_slots_pfail:0
<span class="token comment"># 真实失败的槽</span>
cluster_slots_fail:0
<span class="token comment"># 已知集群节点</span>
cluster_known_nodes:6
<span class="token comment"># 集群主节点个数</span>
cluster_size:3
<span class="token comment"># 当前集群最大最新的 epoch</span>
cluster_current_epoch:6
<span class="token comment"># 当前节点所在 epoch，后面都会同步到跟 cluster_current_epoch 一样</span>
cluster_my_epoch:1
<span class="token comment"># ping-pong 信息</span>
cluster_stats_messages_ping_sent:1306
cluster_stats_messages_pong_sent:1304
cluster_stats_messages_sent:2610
cluster_stats_messages_ping_received:1299
cluster_stats_messages_pong_received:1306
cluster_stats_messages_meet_received:5
cluster_stats_messages_received:2610
</code></pre></div><h4 id="_5-3-2-查看节点信息-cluster-nodes"><a href="#_5-3-2-查看节点信息-cluster-nodes" class="header-anchor">#</a> 5.3.2 查看节点信息 CLUSTER NODES</h4> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token number">172.16</span>.58.200:637<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> CLUSTER NODES
8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 <span class="token number">172.16</span>.58.200:6372@16372 slave be0ddf4921a4a2f077b8c0a72504c8714c69b836 <span class="token number">0</span> <span class="token number">1628234206407</span> <span class="token number">5</span> connected
be0ddf4921a4a2f077b8c0a72504c8714c69b836 <span class="token number">172.16</span>.58.202:6375@16375 master - <span class="token number">0</span> <span class="token number">1628234205407</span> <span class="token number">5</span> connected <span class="token number">10923</span>-16383
ad98c789913e6cb9db293379509d39d8856d41b2 <span class="token number">172.16</span>.58.201:6373@16373 master - <span class="token number">0</span> <span class="token number">1628234203400</span> <span class="token number">3</span> connected <span class="token number">5461</span>-10922
3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 <span class="token number">172.16</span>.58.201:6374@16374 slave 8306858f71a9a4f43c644bf4426ae2c6561b36a5 <span class="token number">0</span> <span class="token number">1628234205000</span> <span class="token number">1</span> connected
7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f <span class="token number">172.16</span>.58.202:6376@16376 slave ad98c789913e6cb9db293379509d39d8856d41b2 <span class="token number">0</span> <span class="token number">1628234204000</span> <span class="token number">3</span> connected
8306858f71a9a4f43c644bf4426ae2c6561b36a5 <span class="token number">172.16</span>.58.200:6371@16371 myself,master - <span class="token number">0</span> <span class="token number">1628234205000</span> <span class="token number">1</span> connected <span class="token number">0</span>-5460
</code></pre></div><h2 id="_6-集群环境测试"><a href="#_6-集群环境测试" class="header-anchor">#</a> 6.  集群环境测试</h2> <h3 id="_6-1-set-get"><a href="#_6-1-set-get" class="header-anchor">#</a> 6.1 SET/GET</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 我们在 set 的时候，redis 首先会对 key 进行 hash，找到它对应的槽上</span>
<span class="token number">172.16</span>.58.200:637<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> <span class="token builtin class-name">set</span> username hedon
<span class="token comment"># username 经过 hash 后需要放在 6375 对应的槽上，所以重定向到 6375 上</span>
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">14315</span><span class="token punctuation">]</span> located at <span class="token number">172.16</span>.58.202:6375
OK
<span class="token comment"># 因为 username 在 6375 上，当前是 6375，所以在 6375 上可以直接拿</span>
<span class="token number">172.16</span>.58.202:637<span class="token operator"><span class="token file-descriptor important">5</span>&gt;</span> get username
<span class="token string">&quot;hedon&quot;</span>
<span class="token number">172.16</span>.58.202:637<span class="token operator"><span class="token file-descriptor important">5</span>&gt;</span> <span class="token builtin class-name">set</span> address beijing
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">3680</span><span class="token punctuation">]</span> located at <span class="token number">172.16</span>.58.200:6371
OK
<span class="token number">172.16</span>.58.200:637<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> get username
<span class="token comment"># 因为 username 在 6375 上，当前是 6371，所以需要重定向到 6375 上拿</span>
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">14315</span><span class="token punctuation">]</span> located at <span class="token number">172.16</span>.58.202:6375
<span class="token string">&quot;hedon&quot;</span>
</code></pre></div><h3 id="_6-2-从节点只读模式"><a href="#_6-2-从节点只读模式" class="header-anchor">#</a> 6.2 从节点只读模式</h3> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 6372 是一个从节点，所以命令会跳转到它对应的主节点上</span>
<span class="token number">172.16</span>.58.200:637<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> get username
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">14315</span><span class="token punctuation">]</span> located at <span class="token number">172.16</span>.58.202:6375
<span class="token string">&quot;zhangsan&quot;</span>

<span class="token comment"># 可以设置 6372 只读，可以通过 READWRITE 来恢复</span>
<span class="token number">172.16</span>.58.200:637<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> READONLY  
OK

<span class="token comment"># 加上只读模式，6372 读取它的主节点 6375 上的数据，就不需要重定向了</span>
<span class="token number">172.16</span>.58.200:637<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> get username
<span class="token string">&quot;zhangsan&quot;</span>

<span class="token comment"># 当时读取集群中不是它的主节点的数据，还是需要重定向，因为 6372 只复制 6375 的数据</span>
<span class="token number">172.16</span>.58.200:637<span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span> get address
-<span class="token operator">&gt;</span> Redirected to slot <span class="token punctuation">[</span><span class="token number">3680</span><span class="token punctuation">]</span> located at <span class="token number">172.16</span>.58.200:6371
<span class="token string">&quot;beijing&quot;</span>
</code></pre></div><h2 id="_7-集群性能测试"><a href="#_7-集群性能测试" class="header-anchor">#</a> 7. 集群性能测试</h2> <div class="custom-block tip"><p class="custom-block-title">结果</p> <p>很显然单机的性能肯定是更高的，因为：</p> <ol><li>集群需要对 key 做哈希运算；</li> <li>集群在 SET/GET 的时候需要做转发；</li></ol> <p>但是，集群的可用性更强，更加容灾。</p></div> <h3 id="_7-1-redis-benchmark-命令"><a href="#_7-1-redis-benchmark-命令" class="header-anchor">#</a> 7.1 redis-benchmark 命令</h3> <p><code>redis-benchmark</code> 是一个测试 Redis 性能的工具，Redis 性能测试是通过同时执行多个命令实现的。</p> <div class="language-sh extra-class"><pre class="language-sh"><code>redis-benchmark <span class="token punctuation">[</span>option<span class="token punctuation">]</span> <span class="token punctuation">[</span>option value<span class="token punctuation">]</span>
</code></pre></div><p>可选参数：</p> <table><thead><tr><th>选项</th> <th>描述</th></tr></thead> <tbody><tr><td>-h</td> <td>指定服务器主机名</td></tr> <tr><td>-p</td> <td>指定服务器端口</td></tr> <tr><td>-s</td> <td>指定服务器（socket 方式）</td></tr> <tr><td>-c</td> <td>指定并发连接数</td></tr> <tr><td>-n</td> <td>指定请求数</td></tr> <tr><td>-d</td> <td>以字节的形式指定 SET/GET 值的数据大小</td></tr> <tr><td>-k</td> <td>连接方式：1=keep alive（长连接）； 0=reconnect</td></tr> <tr><td>-r</td> <td>指定 SET/GET/INCR 使用随机 key</td></tr> <tr><td>-P</td> <td>通过管道传输请求</td></tr> <tr><td>-q</td> <td>强制退出 Redis</td></tr> <tr><td>--csv</td> <td>以  CSV 格式输出</td></tr> <tr><td>-l（小写的 L）</td> <td>生成循环，永久执行测试</td></tr> <tr><td>-t</td> <td>仅运行以逗号分隔的测试命令列表</td></tr> <tr><td>-I（大写的 i）</td> <td>Idle （空闲）模式，仅打开 N 个 Idle 连接并等待</td></tr></tbody></table> <h3 id="_7-2-单机测试"><a href="#_7-2-单机测试" class="header-anchor">#</a> 7.2 单机测试</h3> <ul><li><p>准备单机配置文件 <code>redis.conf</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 备份</span>
<span class="token function">cp</span> /usr/local/redis/conf/redis.conf /usr/local/redis/conf/redis.conf.backup
<span class="token comment"># 修改</span>
<span class="token function">vim</span> /usr/local/redis/conf/redis.conf
</code></pre></div><p>内容：</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 放行 IP</span>
<span class="token builtin class-name">bind</span> <span class="token number">0.0</span>.0.0
<span class="token comment"># 后台启动</span>
daemonize <span class="token function">yes</span>
<span class="token comment"># 日志存储目录及日志名</span>
logfile <span class="token string">&quot;/usr/local/redis/log/redis.log&quot;</span>
<span class="token comment"># rdb 数据文件名</span>
dbfilename <span class="token string">&quot;dump.rdb&quot;</span>
<span class="token comment"># aof 模式开启和 aof 数据文件名</span>
appendonly <span class="token function">yes</span>
appendfilename <span class="token string">&quot;appendonly.aof&quot;</span>
<span class="token comment"># rdb 数据文件和 aof 数据文件的存储目录</span>
<span class="token function">dir</span> <span class="token string">&quot;/usr/local/redis/data&quot;</span>
<span class="token comment"># 设置密码</span>
requirepass <span class="token number">123456</span>
</code></pre></div></li> <li><p>启动单机 Redis</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token comment"># 如果之前有运行单机 Redis，则杀死</span>
<span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> redis
<span class="token function">kill</span> -9 PID
<span class="token comment"># 启动</span>
/usr/local/redis/bin/redis-server /usr/local/redis/conf/redis.conf
</code></pre></div></li> <li><p>测试</p> <div class="language-sh extra-class"><pre class="language-sh"><code>/usr/local/redis/bin/redis-benchmark -a <span class="token number">123456</span> -h <span class="token number">172.16</span>.58.200 -p <span class="token number">6379</span> -t set,get -r <span class="token number">1000000</span> -n <span class="token number">1000000</span> -c <span class="token number">1000</span>
</code></pre></div></li> <li><p>结果</p> <div class="language-markdown extra-class"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> SET 一百万次在 18.9s 内完成，每秒 52912.85 次</span>
====== SET ======
  1000000 requests completed in 18.90 seconds
  1000 parallel clients
  3 bytes payload
  keep alive: 1
  host configuration &quot;save&quot;: 
  host configuration &quot;appendonly&quot;: yes
  multi-thread: no

0.00% &lt;= 3 milliseconds
...
100.00% &lt;= 36 milliseconds
52912.85 requests per second

<span class="token title important"><span class="token punctuation">#</span> GET 一百万次在 19.92 内完成，每秒 50210.89 次</span>
====== GET ======
  1000000 requests completed in 19.92 seconds
  1000 parallel clients
  3 bytes payload
  keep alive: 1
  host configuration &quot;save&quot;: 
  host configuration &quot;appendonly&quot;: yes
  multi-thread: no

0.00% &lt;= 2 milliseconds
...
100.00% &lt;= 47 milliseconds
50210.89 requests per second
</code></pre></div></li> <li><p>总结</p> <ul><li>SET：一百万次在 18.9s 内完成，每秒 52912.85 次</li> <li>GET：一百万次在 19.92 内完成，每秒 50210.89 次</li></ul></li></ul> <h3 id="_7-3-集群测试"><a href="#_7-3-集群测试" class="header-anchor">#</a> 7.3 集群测试</h3> <ul><li><p>随便先一个节点执行</p> <div class="language-sh extra-class"><pre class="language-sh"><code>/usr/local/redis/bin/redis-benchmark -a <span class="token number">123456</span> -h <span class="token number">172.16</span>.58.200 -p <span class="token number">6371</span> -t set,get -r <span class="token number">1000000</span> -n <span class="token number">1000000</span> -c <span class="token number">1000</span>
</code></pre></div></li> <li><p>结果</p> <div class="language-markdown extra-class"><pre class="language-markdown"><code><span class="token title important"><span class="token punctuation">#</span> SET 一百万次在 23.58s 内完成，每秒 42399.83 次</span>
====== SET ======
  1000000 requests completed in 23.58 seconds
  1000 parallel clients
  3 bytes payload
  keep alive: 1
  host configuration &quot;save&quot;: 
  host configuration &quot;appendonly&quot;: yes
  multi-thread: no

0.00% &lt;= 3 milliseconds
....
100.00% &lt;= 113 milliseconds
42399.83 requests per second

<span class="token title important"><span class="token punctuation">#</span> GET 一百万次在 29.20 内完成，每秒 34241.88 次</span>
====== GET ======
  1000000 requests completed in 29.20 seconds
  1000 parallel clients
  3 bytes payload
  keep alive: 1
  host configuration &quot;save&quot;: 
  host configuration &quot;appendonly&quot;: yes
  multi-thread: no

0.00% &lt;= 3 milliseconds
...
100.00% &lt;= 238 milliseconds
34241.88 requests per second
</code></pre></div></li> <li><p>总结</p> <ul><li>SET：一百万次在 23.58s 内完成，每秒 42399.83 次</li> <li>GET：一百万次在 29.20 内完成，每秒 34241.88 次</li></ul></li></ul> <h2 id="_8-集群原理总结"><a href="#_8-集群原理总结" class="header-anchor">#</a> 8. 集群原理总结</h2> <h3 id="_8-1-哈希槽"><a href="#_8-1-哈希槽" class="header-anchor">#</a> 8.1 哈希槽</h3> <p>Redis Cluster 并没有选用一致性哈希算法，而是采用了哈希槽（SLOT），主要原因是一致性哈希算法对于数据分布、节点位置的控制并不是很友好，一致性哈希算法不太适合节点数目较少的情景。</p> <p>哈希槽其实是两个概念：</p> <ol><li><p>哈希算法：Redis Cluster 的哈希算法并不是简单的 hash()，而是 <code>CRC16</code> 算法，这是一种校验算法；</p> <div class="custom-block tip"><p class="custom-block-title">CRC16</p> <p>所以 CRC，就是循环冗余校验法，可以参考：<a href="/noteSite/cs/cn/cn-link-layer.html#_6-2-循环冗余校验码-crc">计算机网络丨链路层丨差错检测丨循环冗余校验码</a>。</p></div></li> <li><p>槽位的概念：空间分配的规则。</p></li></ol> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>对于槽位的转移和分派，Redis Cluster 是不会自动进行的，而是需要人工配置的。所以 Redis Cluster 的高可用是依赖于节点的主从复制与主从间的自动故障转移。</p></div> <h3 id="_8-2-16384-个-slot"><a href="#_8-2-16384-个-slot" class="header-anchor">#</a> 8.2 16384 个 slot</h3> <p>Redis Cluster 没有单机的那种 16 个数据库（0-15）的概念，而是分成了 16384 个 slot，每个节点负责其中的一部分 slots。</p> <div class="custom-block tip"><p class="custom-block-title">为什么 Redis Cluster 会设计成 16384 个槽位呢？</p> <p>正常的心跳包携带一个节点的完整配置，可以用幂等的方式替换旧的配置，以便更新旧的配置。这意味着它们以原始形式包含节点的槽配置，该节点使用 2k 的空间和 16k 的槽，但使用 65k 的槽将使用 8k 的空间。</p> <p>同时，由于其他的设计权衡，Redis Cluster 不太可能扩展到超过 1000 个 master 节点。</p> <p>所以 16k 是在正确的范围内，以确保每个主机有足够的插槽，最大 1000 个master，但足够小的数字传播插槽配置作为一个原始位图容易。注意，在小集群中，位图将很难压缩，因为当 N 很小时，位图将设置槽 N 位，这是设置的位的很大百分比。</p> <p><strong>1. 如果槽位为 65536，发送心跳信息的消息头达 8k，发送的心跳包过于庞大。</strong></p> <p>如上所述，在消息头中，最占空间的是 <code>myslots[CLUSTER_SLOTS/8]</code>。 当槽位为 65536 时，这块的大小是: <code>65536÷8÷1024=8kb</code>。因为每秒钟，Redis 节点需要发送一定数量的 ping 消息作为心跳包，如果槽位为 65536，这个 ping 消息的消息头太大了，浪费带宽。</p> <p><strong>2. Redis 的集群主节点数量基本不可能超过 1000 个。</strong></p> <p>如上所述，集群节点越多，心跳包的消息体内携带的数据越多。如果节点过 1000 个，也会导致网络拥堵。因此 Redis 作者，不建议 Redis Cluster 节点数量超过 1000 个。 那么，对于节点数在 1000 以内的 Redis Cluster 集群，16384 个槽位够用了，没有必要拓展到65536个。</p> <p><strong>3. 槽位越小，节点少的情况下，压缩率高。</strong></p> <p>Redis 主节点的配置信息中，它所负责的哈希槽是通过一张 bitmap 的形式来保存的，在传输过程中，会对 bitmap 进行压缩，但是如果bitmap 的填充率 slots / N 很高的话（N 表示节点数），bitmap 的压缩率就很低。 如果节点数很少，而哈希槽数量很多的话，bitmap 的压缩率就很低。</p></div> <h3 id="_8-3-槽位定位算法"><a href="#_8-3-槽位定位算法" class="header-anchor">#</a> 8.3 槽位定位算法</h3> <p>Redis Cluster 默认会对 key 值使用 CRC16 算法进行 hash 得到一个整数值，然后用这个整数值对 16384 进行取模来得到具体的槽位。</p> <p>即：<code>HASH_SLOT = CRC16(key) mod 16384</code></p> <p><img src="https://tva1.sinaimg.cn/large/008i3skNly1gt78koy9i5j31fq0ncgom.jpg" alt="image-20210806181754810"></p> <h3 id="_8-4-扩容原理"><a href="#_8-4-扩容原理" class="header-anchor">#</a> 8.4 扩容原理</h3> <h4 id="_8-4-1-添加主节点"><a href="#_8-4-1-添加主节点" class="header-anchor">#</a> 8.4.1 添加主节点</h4> <ol><li>准备节点 M4；</li> <li>启动节点 M4；</li> <li>使用 <code>add-node</code> 将节点加入到集群当中；</li> <li>使用 <code>reshard</code> 对集群重新分配，给 M4 分配槽；</li></ol> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gtbhrzpg7lj30l40k00tq.jpg" alt="image-20210810103452785" style="zoom:50%;"> <h4 id="_8-4-2-添加从节点"><a href="#_8-4-2-添加从节点" class="header-anchor">#</a> 8.4.2 添加从节点</h4> <ol><li>准备节点 S4；</li> <li>启动节点 S4；</li> <li>使用 <code>add-node</code> 将节点加入到集群当中，并用 <code>--cluater-salve</code> 声明该节点为从节点，且使用 <code>--cluster-master-id</code> 指定主节点 ID；</li></ol> <h3 id="_8-5-缩容原理"><a href="#_8-5-缩容原理" class="header-anchor">#</a> 8.5 缩容原理</h3> <h4 id="_8-5-1-删除从节点"><a href="#_8-5-1-删除从节点" class="header-anchor">#</a> 8.5.1 删除从节点</h4> <ol><li>使用 <code>del-node</code> 将节点从集群中移除；</li> <li>使用 kill 或 SHUTDOWN 停止节点进程。</li></ol> <h4 id="_8-5-2-删除主节点"><a href="#_8-5-2-删除主节点" class="header-anchor">#</a> 8.5.2 删除主节点</h4> <p>删除主节点稍微麻烦一点，因为主节点分配了槽，所以必须先把槽分配给其他可用节点后，才可以移除节点，不然会造成数据丢失。</p> <ol><li>使用 <code>reshard</code> 将要删除的主节点 M4 的槽分配给其他节点；</li> <li>使用 <code>del-node</code> 将 M4 从集群中移除；</li> <li>停止 M4 进程。</li></ol> <img src="https://tva1.sinaimg.cn/large/008i3skNly1gtbhthuzsej30mw0k8jsg.jpg" alt="image-20210810103747994" style="zoom:50%;"> <!----></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">8/11/2021, 11:14:33 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/noteSite/backend/middleware/redis/redis_sentinel.html" class="prev">
        八、Redis 哨兵模式
      </a></span> <span class="next"><a href="/noteSite/backend/middleware/redis/redis_cluster_manage.html">
        十、Redis 集群高可用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/noteSite/assets/js/app.3a297227.js" defer></script><script src="/noteSite/assets/js/2.691adf44.js" defer></script><script src="/noteSite/assets/js/87.5d04b12e.js" defer></script>
  </body>
</html>
