(window.webpackJsonp=window.webpackJsonp||[]).push([[134],{545:function(s,a,t){"use strict";t.r(a);var n=t(47),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"十、redis-集群高可用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#十、redis-集群高可用"}},[s._v("#")]),s._v(" 十、Redis 集群高可用")]),s._v(" "),t("h2",{attrs:{id:"_1-节点与插槽管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-节点与插槽管理"}},[s._v("#")]),s._v(" 1. 节点与插槽管理")]),s._v(" "),t("h3",{attrs:{id:"_1-1-添加主节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-添加主节点"}},[s._v("#")]),s._v(" 1.1 添加主节点")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("步骤")]),s._v(" "),t("ol",[t("li",[s._v("准备节点 M4；")]),s._v(" "),t("li",[s._v("启动节点 M4；")]),s._v(" "),t("li",[s._v("使用 "),t("code",[s._v("add-node")]),s._v(" 将节点加入到集群当中；")]),s._v(" "),t("li",[s._v("使用 "),t("code",[s._v("reshard")]),s._v(" 对集群重新分配，给 M4 分配槽；")])]),s._v(" "),t("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://hedonspace.oss-cn-beijing.aliyuncs.com/img2/008i3skNly1gtbho6mejcj30l40k00tq.jpg",alt:"image-20210810103452785"}})]),s._v(" "),t("h4",{attrs:{id:"_1-1-1-准备节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-准备节点"}},[s._v("#")]),s._v(" 1.1.1 准备节点")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("随便在一个节点上添加如下配置文件：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/redis/cluster/conf/redis-6377.conf\n")])])]),t("p",[s._v("内容：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 放行 IP 限制")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口")]),s._v("\nport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6377")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后台启动")]),s._v("\ndaemonize "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志存储目录以及日志文件名")]),s._v("\nlogfile "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/redis/cluster/log/redis-6377.log"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RDB 数据文件名")]),s._v("\ndbfilename dump-6377.rbd\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# AOF 模式开启和 AOF 数据文件名")]),s._v("\nappendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\nappendfilename "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appendonly-6377.aof"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RDB 数据文件和 AOF 数据文件的存储目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" /usr/local/redis/cluster/data\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置密码")]),s._v("\nrequirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从节点访问主节点密码（必须与 requirepass 一致）")]),s._v("\nmasterauth "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启集群模式，默认是 no")]),s._v("\ncluster-enabled "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群节点信息文件，会保存在 dir 配置对应目录下")]),s._v("\ncluster-config-file nodes-6377.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群节点连接超时时间，单位是毫秒")]),s._v("\ncluster-node-timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群节点 IP")]),s._v("\ncluster-announce-ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群节点映射端口")]),s._v("\ncluster-announce-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6377")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群节点总线端口")]),s._v("\ncluster-announce-bus-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16377")]),s._v("\n")])])])])]),s._v(" "),t("h4",{attrs:{id:"_1-1-2-启动节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-启动节点"}},[s._v("#")]),s._v(" 1.1.2 启动节点")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("/usr/local/redis/bin/redis-server /usr/local/redis/cluster/conf/redis-6377.conf\n")])])]),t("h4",{attrs:{id:"_1-1-3-将节点加入集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-将节点加入集群"}},[s._v("#")]),s._v(" 1.1.3 将节点加入集群")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("语法")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a requirepass --cluster add-node new_host:new_port exiting_host:exitsing_port --cluster-master-id node_id\n")])])]),t("ul",[t("li",[t("code",[s._v("requirepass")]),s._v("：密码")]),s._v(" "),t("li",[t("code",[s._v("new_host")]),s._v("：新节点所在 IP")]),s._v(" "),t("li",[t("code",[s._v("new_port")]),s._v("：新节点端口")]),s._v(" "),t("li",[t("code",[s._v("existing_host")]),s._v("：集群中最后一个 Master 的 IP")]),s._v(" "),t("li",[t("code",[s._v("existing_port")]),s._v("：集群中最后一个 Master 的端口")]),s._v(" "),t("li",[t("code",[s._v("node_id")]),s._v("：集群中最后一个节点的 ID")])])]),s._v(" "),t("li",[t("p",[s._v("查看集群节点信息")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6371")]),s._v(" cluster nodes\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 172.16.58.200:6372@16372 master - 0 1628560132000 7 connected 10923-16383\nbe0ddf4921a4a2f077b8c0a72504c8714c69b836 172.16.58.202:6375@16375 slave 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 0 1628560132391 7 connected\nad98c789913e6cb9db293379509d39d8856d41b2 172.16.58.201:6373@16373 master - 0 1628560132000 3 connected 5461-10922\n3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 172.16.58.201:6374@16374 slave 8306858f71a9a4f43c644bf4426ae2c6561b36a5 0 1628560133394 1 connected\n7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f 172.16.58.202:6376@16376 slave ad98c789913e6cb9db293379509d39d8856d41b2 0 1628560134400 3 connected\n8306858f71a9a4f43c644bf4426ae2c6561b36a5 172.16.58.200:6371@16371 myself,master - 0 1628560133000 1 connected 0-5460\n")])])]),t("p",[s._v("可以看到集群中最后一个节点是 "),t("code",[s._v("8306858f71a9a4f43c644bf4426ae2c6561b36a5 172.16.58.200:6371")])])]),s._v(" "),t("li",[t("p",[s._v("将 6377 加入集群中")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster add-node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371 --cluster-master-id 8306858f71a9a4f43c644bf4426ae2c6561b36a5\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Adding node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377 to cluster "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Performing Cluster Check "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("using node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-5460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\nM: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b2\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All nodes agree about slots configuration.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check slots coverage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v(" slots covered.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Send CLUSTER MEET to node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377 to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" it "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" the cluster.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" New node added correctly.\n")])])])])]),s._v(" "),t("h4",{attrs:{id:"_1-1-4-重新分片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-4-重新分片"}},[s._v("#")]),s._v(" 1.1.4 重新分片")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("先来看当前集群状态：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster check "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ad98c789"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" keys "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),s._v(" slots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" slaves.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("71568f93"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" keys "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slaves.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("8f18a0cf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" keys "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" slaves.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("8306858f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("210524")]),s._v(" keys "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" slaves.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("210525")]),s._v(" keys "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" masters.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.85")]),s._v(" keys per slot on average.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Performing Cluster Check "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("using node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5\nM: 71568f93af0eb55bcd25083bb5b6b22115efaafc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\nM: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-5460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b2\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All nodes agree about slots configuration.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check slots coverage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v(" slots covered.\n")])])]),t("p",[s._v("可以看到 6377 已经加入集群中了，但是没有分配槽给它。")])]),s._v(" "),t("li",[t("p",[s._v("添加完新节点后，需要对新添加的主节点进行 hash 槽重新分配，这样该主节点才能存储数据，Redis 共有 16384 个槽，语法如下：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a requirepass --cluster reshard host:port --cluster-from node_id1 --cluster-to node_id2 --cluster-slots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("args"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --cluster-yes\n")])])]),t("ul",[t("li",[t("code",[s._v("requirepass")]),s._v("：密码")]),s._v(" "),t("li",[t("code",[s._v("host:port")]),s._v("：随便集群中的一个 IP 和端口")]),s._v(" "),t("li",[t("code",[s._v("node_id1")]),s._v("：表示分配的槽的来源")]),s._v(" "),t("li",[t("code",[s._v("node_id2")]),s._v("：表示分配的槽的取向")]),s._v(" "),t("li",[t("code",[s._v("<args>")]),s._v("：分配多少槽的范围")]),s._v(" "),t("li",[t("code",[s._v("--cluster-yes")]),s._v("：不回显槽的分配情况，表示默认同意分配")])])]),s._v(" "),t("li",[t("p",[s._v("运行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster reshard "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371 --cluster-from 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 --cluster-to 71568f93af0eb55bcd25083bb5b6b22115efaafc --cluster-slots "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" --cluster-yes \n")])])])]),s._v(" "),t("li",[t("p",[s._v("再次查看集群状态：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster check "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("M: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5\nM: 71568f93af0eb55bcd25083bb5b6b22115efaafc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-13922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\nM: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13923")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-5460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b2\n")])])]),t("p",[s._v("现在 6377 已经分配了 [10923-13922] 的槽了，至此，主节点就添加完毕了。")])])]),s._v(" "),t("h3",{attrs:{id:"_1-2-添加从节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-添加从节点"}},[s._v("#")]),s._v(" 1.2 添加从节点")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("步骤")]),s._v(" "),t("ol",[t("li",[s._v("准备节点 S4；")]),s._v(" "),t("li",[s._v("启动节点 S4；")]),s._v(" "),t("li",[s._v("使用 "),t("code",[s._v("add-node")]),s._v(" 将节点加入到集群当中，并用 "),t("code",[s._v("--cluater-salve")]),s._v(" 声明该节点为从节点，且使用 "),t("code",[s._v("--cluster-master-id")]),s._v(" 指定主节点 ID；")])])]),s._v(" "),t("h4",{attrs:{id:"_1-2-1-准备节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-准备节点"}},[s._v("#")]),s._v(" 1.2.1 准备节点")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("随便在一个节点上添加如下配置文件：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /usr/local/redis/cluster/conf/redis-6378.conf\n")])])]),t("p",[s._v("内容：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 放行 IP 限制")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 端口")]),s._v("\nport "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6378")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后台启动")]),s._v("\ndaemonize "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志存储目录以及日志文件名")]),s._v("\nlogfile "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/usr/local/redis/cluster/log/redis-6378.log"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RDB 数据文件名")]),s._v("\ndbfilename dump-6378.rbd\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# AOF 模式开启和 AOF 数据文件名")]),s._v("\nappendonly "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\nappendfilename "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"appendonly-6378.aof"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RDB 数据文件和 AOF 数据文件的存储目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("dir")]),s._v(" /usr/local/redis/cluster/data\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置密码")]),s._v("\nrequirepass "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从节点访问主节点密码（必须与 requirepass 一致）")]),s._v("\nmasterauth "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启集群模式，默认是 no")]),s._v("\ncluster-enabled "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群节点信息文件，会保存在 dir 配置对应目录下")]),s._v("\ncluster-config-file nodes-6378.conf\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群节点连接超时时间，单位是毫秒")]),s._v("\ncluster-node-timeout "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群节点 IP")]),s._v("\ncluster-announce-ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群节点映射端口")]),s._v("\ncluster-announce-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6378")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群节点总线端口")]),s._v("\ncluster-announce-bus-port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16378")]),s._v("\n")])])])])]),s._v(" "),t("h4",{attrs:{id:"_1-2-2-启动节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-启动节点"}},[s._v("#")]),s._v(" 1.2.2 启动节点")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("/usr/local/redis/bin/redis-server /usr/local/redis/cluster/conf/redis-6378.conf\n")])])]),t("h4",{attrs:{id:"_1-2-3-将节点加入集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-将节点加入集群"}},[s._v("#")]),s._v(" 1.2.3 将节点加入集群")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("语法：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a reuqirepass --cluster add-node new_host:new_port exsiting_host:existing_port --cluater-salve --cluster-master-id node_id\n")])])]),t("ul",[t("li",[t("code",[s._v("reuqirepass")]),s._v("：密码")]),s._v(" "),t("li",[t("code",[s._v("new_host")]),s._v("：新节点所在 IP")]),s._v(" "),t("li",[t("code",[s._v("new_port")]),s._v("：新节点所在端口")]),s._v(" "),t("li",[t("code",[s._v("exisiting_host")]),s._v("：该从节点要跟的主节点的 IP")]),s._v(" "),t("li",[t("code",[s._v("exisiting_port")]),s._v("：该从节点要跟的主节点的端口")]),s._v(" "),t("li",[t("code",[s._v("node_id")]),s._v("：该从节点要跟的主节点的 ID")])])]),s._v(" "),t("li",[t("p",[s._v("运行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster add-node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6378 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377 --cluster-slave --cluster-master-id 71568f93af0eb55bcd25083bb5b6b22115efaafc\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Adding node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6378 to cluster "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Performing Cluster Check "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("using node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 71568f93af0eb55bcd25083bb5b6b22115efaafc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-13922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\nM: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\nM: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13923")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5\nM: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-5460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b2\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All nodes agree about slots configuration.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check slots coverage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v(" slots covered.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Send CLUSTER MEET to node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6378 to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" it "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" the cluster.\nWaiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the cluster to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Configure node as replica of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" New node added correctly.\n")])])])])]),s._v(" "),t("h4",{attrs:{id:"_1-2-4-查询集群状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-查询集群状态"}},[s._v("#")]),s._v(" 1.2.4 查询集群状态")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("执行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster check "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6378\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ad98c789"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" keys "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),s._v(" slots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" slaves.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("71568f93"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" keys "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" slots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" slaves.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("8f18a0cf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" keys "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2461")]),s._v(" slots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" slaves.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("8306858f"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("210524")]),s._v(" keys "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" slaves.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("210525")]),s._v(" keys "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" masters.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.85")]),s._v(" keys per slot on average.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Performing Cluster Check "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("using node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6378"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 35724039f2e9d7f43c349718fee303b0681e454e "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6378\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 71568f93af0eb55bcd25083bb5b6b22115efaafc\nM: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5\nM: 71568f93af0eb55bcd25083bb5b6b22115efaafc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-13922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b2\nM: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13923")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-5460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All nodes agree about slots configuration.\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("open")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Check slots coverage"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" All "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),s._v(" slots covered.\n")])])]),t("p",[s._v("可以看到 6377 也已经有从节点了，至此，从节点就添加完毕了。")])])]),s._v(" "),t("h3",{attrs:{id:"_1-3-删除从节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-删除从节点"}},[s._v("#")]),s._v(" 1.3 删除从节点")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("步骤")]),s._v(" "),t("ol",[t("li",[s._v("使用 "),t("code",[s._v("del-node")]),s._v(" 将节点从集群中移除；")]),s._v(" "),t("li",[s._v("使用 kill 或 SHUTDOWN 停止节点进程。")])])]),s._v(" "),t("p",[s._v("删除从节点就比较简单了，直接将它从集群中删除，然后杀死进程就可以了。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("语法：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a requirepass --cluster del-node host:port node_id\n")])])])]),s._v(" "),t("li",[t("p",[s._v("运行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster del-node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6378 35724039f2e9d7f43c349718fee303b0681e454e\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Removing node 35724039f2e9d7f43c349718fee303b0681e454e from cluster "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6378\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Sending CLUSTER FORGET messages to the cluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Sending CLUSTER RESET SOFT to the deleted node.\n")])])])]),s._v(" "),t("li",[t("p",[s._v("再次查看集群状态：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster check "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("M: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5462")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5\nM: 71568f93af0eb55bcd25083bb5b6b22115efaafc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-13922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\nM: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13923")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-5460"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b2\n")])])]),t("p",[s._v("会发现从节点已经从集群中移除了。")])]),s._v(" "),t("li",[t("p",[s._v("停掉从节点进程：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" redis\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 PID\n")])])])])]),s._v(" "),t("h3",{attrs:{id:"_1-4-删除主节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-删除主节点"}},[s._v("#")]),s._v(" 1.4 删除主节点")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("步骤")]),s._v(" "),t("ol",[t("li",[s._v("使用 "),t("code",[s._v("reshard")]),s._v(" 将要删除的主节点 M4 的槽分配给其他节点；")]),s._v(" "),t("li",[s._v("使用 "),t("code",[s._v("del-node")]),s._v(" 将 M4 从集群中移除；")]),s._v(" "),t("li",[s._v("停止 M4 进程。")])]),s._v(" "),t("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://hedonspace.oss-cn-beijing.aliyuncs.com/img2/008i3skNly1gtbhr6dn56j30mw0k8jsg.jpg",alt:"image-20210810103747994"}})]),s._v(" "),t("p",[s._v("删除主节点稍微麻烦一点，因为主节点分配了槽，所以必须先把槽分配给其他可用节点后，才可以移除节点，不然会造成数据丢失。")]),s._v(" "),t("h4",{attrs:{id:"_1-4-1-重新分片"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-1-重新分片"}},[s._v("#")]),s._v(" 1.4.1 重新分片")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("将数据移动到其他主节点去，执行重新分片命令：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster reshard "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377\n")])])])]),s._v(" "),t("li",[t("p",[s._v("出现：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("How many slots "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" you want to move "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16384")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("? \n")])])]),t("p",[s._v("前面我们给 6377 分配了 2000 个槽，这里输入 2000 即可。")])]),s._v(" "),t("li",[t("p",[s._v("出现：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("What is the receiving node ID? \n")])])]),t("p",[s._v("我们需要指定这些槽的取向，这里我们分配回给 6371，输入 6371 的 ID。")])]),s._v(" "),t("li",[t("p",[s._v("出现：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("Please enter all the "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" node IDs.\n  Type "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'all'")]),s._v(" to use all the nodes as "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" nodes "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" slots.\n  Type "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'done'")]),s._v(" once you entered all the "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("source")]),s._v(" nodes IDs.\nSource node "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1:")]),s._v("\n")])])]),t("p",[s._v("这里是要指定槽从谁取，直接填写 6377 的 ID 即可。然后按回车，再输入 done。")]),s._v(" "),t("p",[s._v("也可以直接输入 all，从集群的所有 master 中随机取。")])]),s._v(" "),t("li",[t("p",[s._v("再输入：")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("yes\n")])])])])]),s._v(" "),t("h4",{attrs:{id:"_1-4-2-查看集群状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-2-查看集群状态"}},[s._v("#")]),s._v(" 1.4.2 查看集群状态")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("执行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster check "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("M: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-6461"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-14372"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9912")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14373")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2011")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 71568f93af0eb55bcd25083bb5b6b22115efaafc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\nM: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6462")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b2\n")])])]),t("p",[s._v("可以看到 6377 的 slots 为 0 了。")])])]),s._v(" "),t("h4",{attrs:{id:"_1-4-3-移除主节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-3-移除主节点"}},[s._v("#")]),s._v(" 1.4.3 移除主节点")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("执行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster del-node "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377 71568f93af0eb55bcd25083bb5b6b22115efaafc\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Removing node 71568f93af0eb55bcd25083bb5b6b22115efaafc from cluster "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6377\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Sending CLUSTER FORGET messages to the cluster"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Sending CLUSTER RESET SOFT to the deleted node.\n")])])])])]),s._v(" "),t("h4",{attrs:{id:"_1-4-4-检查集群状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-4-检查集群状态"}},[s._v("#")]),s._v(" 1.4.4 检查集群状态")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("执行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster check "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("M: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-6461"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-14372"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9912")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14373")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2011")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\nM: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6462")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b2\n")])])]),t("p",[s._v("至此，6377 就从集群中移除了。")])])]),s._v(" "),t("h4",{attrs:{id:"_1-4-5-停止节点进程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-5-停止节点进程"}},[s._v("#")]),s._v(" 1.4.5 停止节点进程")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" redis\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 PID\n")])])]),t("h2",{attrs:{id:"_2-moved-转向"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-moved-转向"}},[s._v("#")]),s._v(" 2. MOVED 转向")]),s._v(" "),t("h3",{attrs:{id:"_2-1-moved-错误演示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-moved-错误演示"}},[s._v("#")]),s._v(" 2.1 MOVED 错误演示")]),s._v(" "),t("p",[s._v("当我们使用操作 Redis 单节点的 Client 来操作集群时，比如使用以下方式登入 Client：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6375")]),s._v("\n")])])]),t("p",[s._v("然后执行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("get username\n")])])]),t("p",[s._v("会出现 MOVED 错误：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("5")]),s._v(">")]),s._v(" get username\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("error"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" MOVED "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14315")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n")])])]),t("p",[s._v("Redis 官方规范要求所有 Clieny 都应该处理 MOVED 错误，从而实现对用户的透明。")]),s._v(" "),t("p",[s._v("单击模式/集群模式下 MOVED 错误的显示区别：")]),s._v(" "),t("ul",[t("li",[s._v("集群模式：自动转向")]),s._v(" "),t("li",[s._v("单击模式：报错，需要开发者自主做出处理")])]),s._v(" "),t("h3",{attrs:{id:"_2-2-解决措施"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-解决措施"}},[s._v("#")]),s._v(" 2.2 解决措施")]),s._v(" "),t("h4",{attrs:{id:"_2-2-1-使用集群模式进入-client"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-使用集群模式进入-client"}},[s._v("#")]),s._v(" 2.2.1 使用集群模式进入 Client")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -c -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6371")]),s._v("\n")])])]),t("h4",{attrs:{id:"_2-2-2-手动切换到正确节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-手动切换到正确节点"}},[s._v("#")]),s._v(" 2.2.2 手动切换到正确节点")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("(error) MOVED 14315 172.16.58.200:6371\n")])])]),t("p",[s._v("上述信息当中有该 slot 所在的节点，可以切换到该节点进行操作。")]),s._v(" "),t("h2",{attrs:{id:"_3-ask-转向"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-ask-转向"}},[s._v("#")]),s._v(" 3. ASK 转向")]),s._v(" "),t("h3",{attrs:{id:"_3-1-ask-错误"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-ask-错误"}},[s._v("#")]),s._v(" 3.1 ASK 错误")]),s._v(" "),t("p",[s._v("除了 MOVED 转向，Redis 规范还要求 Client 实现对 ASK 转向的处理。")]),s._v(" "),t("p",[s._v("当 Client 向源节点发送一个命令，并且命令要处理的键恰好就属于正在被迁移的槽时：")]),s._v(" "),t("ol",[t("li",[s._v("先在自己的数据里面查找指定的键，找到，就直接响应 Client；")]),s._v(" "),t("li",[s._v("但是，这个键有可能已经被迁移到了目标节点，源节点将向 Client 返回一个 ASK 错误。")])]),s._v(" "),t("p",[s._v("单击模式/集群模式下 ASK 错误的显示区别：")]),s._v(" "),t("ul",[t("li",[s._v("集群模式：自动转向")]),s._v(" "),t("li",[s._v("单击模式：报错，需要开发者自主做出处理")])]),s._v(" "),t("h3",{attrs:{id:"_3-2-解决措施"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-解决措施"}},[s._v("#")]),s._v(" 3.2 解决措施")]),s._v(" "),t("h4",{attrs:{id:"_3-2-1-使用集群模式进入-client"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-使用集群模式进入-client"}},[s._v("#")]),s._v(" 3.2.1 使用集群模式进入 Client")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -c -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6371")]),s._v("\n")])])]),t("h4",{attrs:{id:"_3-2-2-使用-asking-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-使用-asking-命令"}},[s._v("#")]),s._v(" 3.2.2 使用 ASKING 命令")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("5")]),s._v(">")]),s._v(" ASKING\nOK\n")])])]),t("p",[s._v("ASKING 命令打开 Redis ASKING 标识，执行 "),t("code",[s._v("get")]),s._v(" 命令后，该标识会被去除，每次都需要 ASKING。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("MOVED vs ASK")]),s._v(" "),t("ol",[t("li",[s._v("MOVED 错误代表槽的负责权已经从一个节点转移到了另外一个节点，是长期的状态；")]),s._v(" "),t("li",[s._v("ASK 错误只是两个节点在迁移槽的过程中使用的一种临时措施。")])])]),s._v(" "),t("h2",{attrs:{id:"_4-自动故障转移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-自动故障转移"}},[s._v("#")]),s._v(" 4. 自动故障转移")]),s._v(" "),t("h3",{attrs:{id:"_4-1-环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-环境准备"}},[s._v("#")]),s._v(" 4.1 环境准备")]),s._v(" "),t("ul",[t("li",[s._v("启动 6 个 redis 节点，参考前面文章。")])]),s._v(" "),t("h3",{attrs:{id:"_4-2-演示"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-演示"}},[s._v("#")]),s._v(" 4.2 演示")]),s._v(" "),t("p",[s._v("查看集群状态")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("M: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-6461"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-14372"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9912")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14373")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2011")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\nM: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6462")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b\n")])])]),t("p",[s._v("下面来演示 6371 故障后，它的从节点 6374 会自动顶上。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("杀死 6371：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -ef "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" redis\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" -9 PID\n")])])])]),s._v(" "),t("li",[t("p",[s._v("查看 6374 日志：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" /usr/local/redis/cluster/log/redis-6374.log \n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 6374 与主节点 6371 失去联系了")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:22.255 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Connection with master lost.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:22.255 * Caching the disconnected master state.\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重新重新连接")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:23.080 * Connecting to MASTER "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:23.080 * MASTER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" REPLICA "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" started\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接失败")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:23.080 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Error condition on socket for SYNC: Connection refused")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:40.880 * FAIL message received from ad98c789913e6cb9db293379509d39d8856d41b2 about 8306858f71a9a4f43c644bf4426ae2c6561b36a5\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群进入 fail 状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:40.880 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Cluster state changed: fail")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始选举")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:40.882 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Start of election delayed for 611 milliseconds (rank #0, offset 15019915).")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:41.184 * Connecting to MASTER "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主从复制")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:41.184 * MASTER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" REPLICA "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" started\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:41.185 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Error condition on socket for SYNC: Connection refused")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 故障转移")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:41.584 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Starting a failover election for epoch 10.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:41.588 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Failover election won: I'm the new master.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:41.588 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# configEpoch set to 10 after successful failover")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除之前的 master 状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:41.588 * Discarding previously cached master state.\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新 replication ID")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:41.588 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Setting secondary replication ID to 145f1a07ead94288b0324a632fcb1d1c2debbba7, valid up to offset: 15019916. New replication ID is a0d6838ae362f8f0416f3c21fb1ea7b25bf32187")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 集群进入 ok 状态")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":03:41.588 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Cluster state changed: ok")]),s._v("\n")])])])]),s._v(" "),t("li",[t("p",[s._v("再看集群状态：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster check "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("M: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14373")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2011")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\nM: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-6461"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-14372"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9912")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b2\nM: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6462")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])])]),s._v(" "),t("li",[t("p",[s._v("尝试获取 username，之前这个字段是存在 6371 上的：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v(" get username\n-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Redirected to slot "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14315")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" located at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhangsan"')]),s._v("\n")])])]),t("p",[s._v("可以发现 username 已经转移到 6374 上面了，自动故障转移成功！")])]),s._v(" "),t("li",[t("p",[s._v("再次启动 6371：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-server redis-6371.conf\n")])])])]),s._v(" "),t("li",[t("p",[s._v("查看集群状态：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("M: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14373")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2011")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\nM: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-6461"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-14372"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9912")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b2\nS: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38\nM: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6462")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])])]),s._v(" "),t("li",[t("p",[s._v("可以看到 6371 已经成了 6374 的从节点了。")])])]),s._v(" "),t("h2",{attrs:{id:"_5-手动故障转移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-手动故障转移"}},[s._v("#")]),s._v(" 5. 手动故障转移")]),s._v(" "),t("p",[s._v("Redis Cluster 使用 "),t("code",[s._v("CLUSTER FAILOVER")]),s._v(" 命令来进行故障转移，不过要在 "),t("strong",[s._v("被转移的主节点的从节点上")]),s._v(" 执行该命令。")]),s._v(" "),t("h3",{attrs:{id:"_5-1-故障转移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-故障转移"}},[s._v("#")]),s._v(" 5.1 故障转移")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("在刚刚降级为从节点的 6371 中执行 "),t("code",[s._v("CLUSTER FAILOVER")]),s._v(" 开启手动故障转移：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -c -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" -h "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6371")]),s._v(" cluster failover\n")])])])])]),s._v(" "),t("h3",{attrs:{id:"_5-2-查看集群状态"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-查看集群状态"}},[s._v("#")]),s._v(" 5.2 查看集群状态")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("执行：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("redis-cli -a "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" --cluster check "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("M: 8306858f71a9a4f43c644bf4426ae2c6561b36a5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-6461"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(","),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10923")]),s._v("-14372"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9912")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: ad98c789913e6cb9db293379509d39d8856d41b2 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6373\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6462")]),s._v("-10922"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4461")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nM: 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6372\n   slots:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14373")]),s._v("-16383"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2011")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" master\n   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" additional replica"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nS: 3c95fde7335c16c7f3fe323bde9cfc9778ca1d38 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8306858f71a9a4f43c644bf4426ae2c6561b36a5\nS: be0ddf4921a4a2f077b8c0a72504c8714c69b836 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6375\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates 8f18a0cf21cc4bcc3d96c0e672edf0949abefad1\nS: 7ba9475d72e3ff57b409e9ff2ee7ecbfce4a024f "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.202:6376\n   slots: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" slots"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" slave\n   replicates ad98c789913e6cb9db293379509d39d8856d41b2\n")])])]),t("p",[s._v("可以看到现在 6371 是 6374 的主节点了。")])])]),s._v(" "),t("h3",{attrs:{id:"_5-3-查看日志"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-查看日志"}},[s._v("#")]),s._v(" 5.3 查看日志")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("查看 6371 日志：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" redis-6371.log\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接受手动故障转移")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.816 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Manual failover user request accepted.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 准备转移")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.835 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Received replication offset for paused master manual failover: 15020307")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开启手动故障转移")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.908 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# All master replication stream processed, manual failover can start.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选举 leader")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.908 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Start of election delayed for 0 milliseconds (rank #0, offset 15020307).")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.908 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Starting a failover election for epoch 11.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 等待投票")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.912 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Currently unable to failover: Waiting for votes, but majority still not reached.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选举完毕")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.913 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Failover election won: I'm the new master.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.913 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# configEpoch set to 11 after successful failover")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.913 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Connection with master lost.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.913 * Caching the disconnected master state.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.913 * Discarding previously cached master state.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.913 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Setting secondary replication ID to a0d6838ae362f8f0416f3c21fb1ea7b25bf32187, valid up to offset: 15020308. New replication ID is 213fd6cf96e35b3c470c6852357d9b438682a208")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主从复制")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:21.851 * Replica "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374 asks "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" synchronization\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33635")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:21.851 * Partial resynchronization request from "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.201:6374 accepted. Sending "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" bytes of backlog starting from offset "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15020308")]),s._v(".\n")])])])]),s._v(" "),t("li",[t("p",[s._v("查看 6374 日志：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tail")]),s._v(" -f -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" redis-6374.log\n")])])]),t("p",[s._v("输出：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接受手动故障转移")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.608 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Manual failover requested by replica 8306858f71a9a4f43c644bf4426ae2c6561b36a5.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.702 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Failover auth granted to 8306858f71a9a4f43c644bf4426ae2c6561b36a5 for epoch 11")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.706 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Connection with replica 172.16.58.200:6371 lost.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":M 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.707 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Configuration change detected. Reconfiguring myself as a replica of 8306858f71a9a4f43c644bf4426ae2c6561b36a5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:20.707 * Before turning into a replica, using my own master parameters to synthesize a cached master: I may be able to synchronize with the new master with just a partial transfer.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:21.630 * Connecting to MASTER "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:6371\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 开始主从复制")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:21.631 * MASTER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" REPLICA "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" started\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:21.631 * Non blocking connect "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" SYNC fired the event.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:21.637 * Master replied to PING, replication can continue"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 增量复制")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:21.644 * Trying a partial resynchronization "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request a0d6838ae362f8f0416f3c21fb1ea7b25bf32187:15020308"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:21.645 * Successful partial resynchronization with master.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:21.645 "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Master replication ID changed to 213fd6cf96e35b3c470c6852357d9b438682a208")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98575")]),s._v(":S 09 Aug "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":15:21.645 * MASTER "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" REPLICA sync: Master accepted a Partial Resynchronization.\n")])])])])]),s._v(" "),t("h3",{attrs:{id:"_5-4-读取数据"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-读取数据"}},[s._v("#")]),s._v(" 5.4 读取数据")]),s._v(" "),t("p",[s._v("现在再来 "),t("code",[s._v("get username")]),s._v("，数据应该转移到 6371 上了：")]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".58.200:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v(" get username\n-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Redirected to slot "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14315")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" located at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v('.58.200:6371\n"zhangsan\n')])])]),t("h2",{attrs:{id:"_6-集群迁移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-集群迁移"}},[s._v("#")]),s._v(" 6. 集群迁移")]),s._v(" "),t("h3",{attrs:{id:"_6-1-手动迁移"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-1-手动迁移"}},[s._v("#")]),s._v(" 6.1 手动迁移")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("源集群于目标集群结构一致")]),s._v(" "),t("blockquote",[t("ol",[t("li",[s._v("取消密码；")]),s._v(" "),t("li",[s._v("创建跟源集群结构一致的目标集群；")]),s._v(" "),t("li",[s._v("先从后主停掉目标集群服务；")]),s._v(" "),t("li",[s._v("删除目标集群中所有节点的 AOF 和 RDB 文件；")]),s._v(" "),t("li",[s._v("源集群数据持久化；")]),s._v(" "),t("li",[s._v("将源集群的所有节点的 AOF 和 RDB 文件复制到目标集群对应的节点上；")]),s._v(" "),t("li",[s._v("启动目标集群服务；")]),s._v(" "),t("li",[s._v("检查目标集群状态。")])])])]),s._v(" "),t("li",[t("p",[s._v("源集群于目标集群结构不一致")]),s._v(" "),t("blockquote",[t("p",[s._v("思路一：")]),s._v(" "),t("ol",[t("li",[s._v("先按照集群结构一致的情况进行迁移；")]),s._v(" "),t("li",[s._v("再进行集群的缩容或者扩容到之前指定的目标集群的结构。")])]),s._v(" "),t("p",[s._v("思路二：")]),s._v(" "),t("ol",[t("li",[s._v("源集群和目标集群都将槽全部归到一个节点 A 上；")]),s._v(" "),t("li",[s._v("源集群对 A 进行持久化；")]),s._v(" "),t("li",[s._v("将源集群 A 节点的 AOF 和 RDB 文件复制到目标集群的 A 节点上；")]),s._v(" "),t("li",[s._v("启动目标集群；")]),s._v(" "),t("li",[s._v("目标集群进行槽的重新分配。")])])])])]),s._v(" "),t("h3",{attrs:{id:"_6-2-自动迁移-redisshake"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-2-自动迁移-redisshake"}},[s._v("#")]),s._v(" 6.2 自动迁移 RedisShake")]),s._v(" "),t("p",[s._v("阿里开源的 Redis 自动化迁移工具。")]),s._v(" "),t("ul",[t("li",[s._v("Github: https://github.com/alibaba/RedisShake/wiki")])]),s._v(" "),t("h3",{attrs:{id:"_6-3-迁移检查-redisfullcheck"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-3-迁移检查-redisfullcheck"}},[s._v("#")]),s._v(" 6.3 迁移检查 RedisFullCheck")]),s._v(" "),t("p",[s._v("阿里开源的配套工具，用于检查源和目标是否数据统一。")]),s._v(" "),t("ul",[t("li",[s._v("Github: https://github.com/alibaba/RedisFullCheck/wiki")])]),s._v(" "),t("Vssue")],1)}),[],!1,null,null,null);a.default=e.exports}}]);