(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{504:function(s,t,a){"use strict";a.r(t);var e=a(47),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_1-clickhouse-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-clickhouse-简介"}},[s._v("#")]),s._v(" 1. ClickHouse 简介")]),s._v(" "),a("p",[s._v("ClickHouse 是俄罗斯的 Yandex 于 2016 年开源的"),a("strong",[s._v("列式存储数据库")]),s._v("（DBMS），使用 C++ 语言编写，主要用于"),a("strong",[s._v("在线分析处理查询")]),s._v("（OLAP），能够使用 SQL 查询实时生成分析数据报告。")]),s._v(" "),a("h2",{attrs:{id:"_1-1-特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-特点"}},[s._v("#")]),s._v(" 1.1 特点")]),s._v(" "),a("h3",{attrs:{id:"_1-1-1-列式存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-列式存储"}},[s._v("#")]),s._v(" 1.1.1 列式存储")]),s._v(" "),a("p",[s._v("以下面的表为例：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("Id")]),s._v(" "),a("th",[s._v("Name")]),s._v(" "),a("th",[s._v("Age")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("1")]),s._v(" "),a("td",[s._v("张三")]),s._v(" "),a("td",[s._v("18")])]),s._v(" "),a("tr",[a("td",[s._v("2")]),s._v(" "),a("td",[s._v("李四")]),s._v(" "),a("td",[s._v("22")])]),s._v(" "),a("tr",[a("td",[s._v("3")]),s._v(" "),a("td",[s._v("王五")]),s._v(" "),a("td",[s._v("34")])])])]),s._v(" "),a("p",[s._v("在磁盘上的组织结构分别为：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("行式存储")]),s._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1gztbj8rr7bj215i03uq3c.jpg",alt:"image-20220228164442502"}}),s._v(" "),a("p",[s._v("好处是想查某个人所有的属性时，可以通过一次磁盘查找加顺序读取就可以。但是当想查所有人的年龄时，需要不停的查找，或者全表扫描才行，遍历的很多数据都是不需要的。")])]),s._v(" "),a("li",[a("p",[s._v("列式存储")]),s._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1gztbjlpc2lj215k03qjrs.jpg",alt:"image-20220228164506060"}}),s._v(" "),a("p",[s._v("这时想查所有人的年龄只需把年龄那一列拿出来就可以了。")])])]),s._v(" "),a("p",[s._v("列式存储的好处：")]),s._v(" "),a("ul",[a("li",[s._v("对于列的聚合、计数、求和等统计操作优于行式存储；")]),s._v(" "),a("li",[s._v("由于某一列的数据类型都是相同的，针对于数据存储更容易进行数据压缩，每一列 选择更优的数据压缩算法，大大提高了数据的压缩比重；")]),s._v(" "),a("li",[s._v("由于数据压缩比更好，一方面节省了磁盘空间，另一方面对于 cache 也有了更大的发挥空间。")])]),s._v(" "),a("h3",{attrs:{id:"_1-1-2-dbms-的功能"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-dbms-的功能"}},[s._v("#")]),s._v(" 1.1.2 DBMS 的功能")]),s._v(" "),a("p",[s._v("几乎覆盖了标准 SQL 的大部分语法，包括 DDL 和 DML，以及配套的各种函数，用户管理及权限管理，数据的备份与恢复。")]),s._v(" "),a("h3",{attrs:{id:"_1-1-3-多样化引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-3-多样化引擎"}},[s._v("#")]),s._v(" 1.1.3 多样化引擎")]),s._v(" "),a("p",[s._v("ClickHouse 和 MySQL 类似，把表级的存储引擎插件化，根据表的不同需求可以设定不同的存储引擎。目前包括合并树、日志、接口和其他四大类 20 多种引擎。")]),s._v(" "),a("h3",{attrs:{id:"_1-1-4-高吞吐写入能力"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-4-高吞吐写入能力"}},[s._v("#")]),s._v(" 1.1.4 高吞吐写入能力")]),s._v(" "),a("p",[s._v("ClickHouse 采用类 LSM Tree 的结构，数据写入后定期在后台 Compaction。通过类 LSM tree 的结构，ClickHouse 在数据导入时全部是顺序 append 写，写入后数据段不可更改，在后台 compaction 时也是多个段 merge sort 后顺序写回磁盘。顺序写的特性，充分利用了磁盘的吞吐能力，即便在 HDD 上也有着优异的写入性能。")]),s._v(" "),a("p",[s._v("官方公开 benchmark 测试显示能够达到 50MB-200MB/s 的写入吞吐能力，按照每行 100Byte 估算，大约相当于 50W-200W 条/s 的写入速度。")]),s._v(" "),a("h3",{attrs:{id:"_1-1-5-数据分区与线程级并行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-5-数据分区与线程级并行"}},[s._v("#")]),s._v(" 1.1.5 数据分区与线程级并行")]),s._v(" "),a("p",[s._v("ClickHouse 将数据划分为多个 partition，每个 partition 再进一步划分为多个 index granularity（索引粒度），然后通过多个 CPU 核心分别处理其中的一部分来实现并行数据处理。 在这种设计下，单条 Query 就能利用整机所有 CPU。极致的并行处理能力，极大的降低了查 询延时。")]),s._v(" "),a("p",[s._v("所以，ClickHouse 即使对于大量数据的查询也能够化整为零平行处理。但是有一个弊端就是对于单条查询使用多 CPU，就不利于同时并发多条查询。所以对于高 QBS 的查询业务， ClickHouse 并不是强项。")]),s._v(" "),a("h1",{attrs:{id:"_2-clickhouse-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-clickhouse-安装"}},[s._v("#")]),s._v(" 2. ClickHouse 安装")]),s._v(" "),a("blockquote",[a("p",[s._v("CentOS7")])]),s._v(" "),a("h2",{attrs:{id:"_2-1-准备工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-准备工作"}},[s._v("#")]),s._v(" 2.1 准备工作")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("关闭防火墙")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("systemctl disable firewalld\n")])])])]),s._v(" "),a("li",[a("p",[s._v("取消打开文件数限制")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/security/limits.conf\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/security/limits.d/20-nproc.conf\n")])])]),a("p",[s._v("分别在文件末尾添加：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("* soft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n* hard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65536")]),s._v("\n* soft nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n* hard nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("安装 libtoll 和 unixODBC 依赖")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y libtool\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y *unixODBC*\n")])])])]),s._v(" "),a("li",[a("p",[s._v("取消 SELINUX")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/selinux/config\n")])])]),a("p",[s._v("将 SELINUX 修改为 disabled")])]),s._v(" "),a("li",[a("p",[s._v("重启")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_2-2-单机安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-单机安装"}},[s._v("#")]),s._v(" 2.2 单机安装")]),s._v(" "),a("blockquote",[a("p",[s._v("参考官网："),a("a",{attrs:{href:"https://clickhouse.com/#quick-start",target:"_blank",rel:"noopener noreferrer"}},[s._v("ClickHouser"),a("OutboundLink")],1)])]),s._v(" "),a("ol",[a("li",[a("p",[s._v("创建 clickhouse 目录")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /opt/software/clickhouse\n")])])])]),s._v(" "),a("li",[a("p",[s._v("进入 clickhouse 目录")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt/software/clickhouse\n")])])])]),s._v(" "),a("li",[a("p",[s._v("下载安装包")]),s._v(" "),a("p",[s._v("在该网站 https://repo.yandex.ru/clickhouse/rpm/stable/x86_64/ 中找到想要下载的版本的安装包，总共需要 4 个：")]),s._v(" "),a("ul",[a("li",[s._v("clickhouse-client")]),s._v(" "),a("li",[s._v("clickhouse-common-static")]),s._v(" "),a("li",[s._v("clickhouse-common-static-dbg")]),s._v(" "),a("li",[s._v("clickhouse-server")])]),s._v(" "),a("p",[s._v("本次使用的版本为：21.7.3.14")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://repo.yandex.ru/clickhouse/rpm/stable/x86_64/clickhouse-client-21.7.3.14-2.noarch.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://repo.yandex.ru/clickhouse/rpm/stable/x86_64/clickhouse-common-static-21.7.3.14-2.x86_64.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://repo.yandex.ru/clickhouse/rpm/stable/x86_64/clickhouse-common-static-dbg-21.7.3.14-2.x86_64.rpm\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://repo.yandex.ru/clickhouse/rpm/stable/x86_64/clickhouse-server-21.7.3.14-2.noarch.rpm\n")])])])]),s._v(" "),a("li",[a("p",[s._v("安装")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ivh *.rpm\n")])])]),a("p",[s._v("安装后，常用的默认路径：")]),s._v(" "),a("ul",[a("li",[s._v("bin    ->  /usr/bin/")]),s._v(" "),a("li",[s._v("conf  ->  /etc/clickhouse-server/")]),s._v(" "),a("li",[s._v("lib     ->  /var/lib/clickhouse/")]),s._v(" "),a("li",[s._v("log    ->  /var/log/clickhouse/")])])]),s._v(" "),a("li",[a("p",[s._v("修改配置文件，支持远程访问")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/clickhouse-server/config.xml\n")])])]),a("p",[s._v("查找 listen，将下面这一行的注释打开：\n"),a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1gzu89enocuj21bn0u0q8e.jpg",alt:"image-20220301113659228"}})])])]),s._v(" "),a("h2",{attrs:{id:"_2-3-测试结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-测试结果"}},[s._v("#")]),s._v(" 2.3 测试结果")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("启动 clickhouse-server")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" systemctl start clickhouse-server\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#或者：sudo clickhouse start")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("使用客户端连接")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("clickhouse-client -m\n")])])]),a("ul",[a("li",[a("code",[s._v("-m")]),s._v(": 可以在命令窗口输入多行命令，用分号来识别结尾；")])]),s._v(" "),a("p",[s._v("输出：（默认端口：9000）")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("ClickHouse client version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.7")]),s._v(".3.14 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("official build"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\nConnecting to localhost:9000 as user default.\nConnected to ClickHouse server version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21.7")]),s._v(".3 revision "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("54449")]),s._v(".\n\nlocalhost "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("执行命令")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("localhost "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" show databases"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nSHOW DATABASES\n\nQuery id: 2559789d-835a-4806-9cb3-cff05f14c25f\n\n┌─name────┐\n│ default │\n│ system  │\n└─────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" set. Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.004")]),s._v(" sec.\n")])])])]),s._v(" "),a("li",[a("p",[s._v("测试完毕，安装成功。")])])]),s._v(" "),a("h1",{attrs:{id:"_3-clickhouse-数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-clickhouse-数据类型"}},[s._v("#")]),s._v(" 3. ClickHouse 数据类型")]),s._v(" "),a("blockquote",[a("p",[a("a",{attrs:{href:"https://clickhouse.com/docs/en/sql-reference/data-types/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"_3-1-整型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-整型"}},[s._v("#")]),s._v(" 3.1 整型")]),s._v(" "),a("blockquote",[a("p",[s._v("固定长度的整型，包括有符号整型或无符号整型。 整型范围（-2^n-1^~2^n-1^-1)")]),s._v(" "),a("p",[s._v("使用场景: 个数、数量、也可以存储型 "),a("strong",[s._v("id")]),s._v("。")])]),s._v(" "),a("ul",[a("li",[s._v("Int8 - [-128 : 127]")]),s._v(" "),a("li",[s._v("Int16 - [-32768 : 32767]")]),s._v(" "),a("li",[s._v("Int32 - [-2147483648 : 2147483647]")]),s._v(" "),a("li",[s._v("Int64 - [-9223372036854775808 : 9223372036854775807] 无符号整型范围(0~2n-1):")]),s._v(" "),a("li",[s._v("UInt8 - [0 : 255]")]),s._v(" "),a("li",[s._v("UInt16 - [0 : 65535]")]),s._v(" "),a("li",[s._v("UInt32 - [0 : 4294967295]")]),s._v(" "),a("li",[s._v("UInt64 - [0 : 18446744073709551615]")])]),s._v(" "),a("h2",{attrs:{id:"_3-2-浮点型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-浮点型"}},[s._v("#")]),s._v(" 3.2 浮点型")]),s._v(" "),a("blockquote",[a("p",[s._v("建议尽可能以整数形式存储数据。例如，将固定精度的数字转换为整数值，如时间用毫秒为单位表示，因为浮点型进行计算时可能引起四舍五入的误差。")]),s._v(" "),a("p",[s._v("使用场景:一般数据值比较小，不涉及大量的统计计算，精度要求不高的时候。比如：保存商品的重量。")])]),s._v(" "),a("ul",[a("li",[s._v("Float32")]),s._v(" "),a("li",[s._v("Float64")])]),s._v(" "),a("h2",{attrs:{id:"_3-3-布尔型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-布尔型"}},[s._v("#")]),s._v(" 3.3 布尔型")]),s._v(" "),a("blockquote",[a("p",[s._v("没有单独的类型来存储布尔值。可以使用 UInt8 类型，取值限制为 0 或 1。")])]),s._v(" "),a("h2",{attrs:{id:"_3-4-decimal-型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-decimal-型"}},[s._v("#")]),s._v(" 3.4 Decimal 型")]),s._v(" "),a("blockquote",[a("p",[s._v("有符号的浮点数，可在加、减和乘法运算过程中保持精度。对于除法，最低有效数字会被丢弃（不舍入）。")]),s._v(" "),a("p",[s._v("使用场景: 一般金额字段、汇率、利率等字段为了保证小数点精度，都使用 Decimal 进行存储。")])]),s._v(" "),a("ul",[a("li",[s._v("Decimal32(s)，相当于Decimal(9-s,s)，有效位数为1~9")]),s._v(" "),a("li",[s._v("Decimal64(s)，相当于Decimal(18-s,s)，有效位数为1~18")]),s._v(" "),a("li",[s._v("Decimal128(s)，相当于Decimal(38-s,s)，有效位数为1~38\n"),a("ul",[a("li",[s._v("s 标识小数位")])])])]),s._v(" "),a("h2",{attrs:{id:"_3-5-字符串"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-字符串"}},[s._v("#")]),s._v(" 3.5 字符串")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("String")]),s._v(" "),a("p",[s._v("字符串可以任意长度的。它可以包含任意的字节集，包含空字节。")])]),s._v(" "),a("li",[a("p",[s._v("FixedString(N)")]),s._v(" "),a("p",[s._v("固定长度 N 的字符串，N 必须是严格的正自然数。当服务端读取长度小于 N 的字符串时候，通过在字符串末尾添加空字节来达到 N 字节长度。 当服务端读取长度大于 N 的字符串时候，将返回错误消息。")]),s._v(" "),a("p",[s._v("与 String 相比，极少会使用 FixedString，因为使用起来不是很方便。")]),s._v(" "),a("p",[s._v("使用场景：名称、文字描述、字符型编码。 固定长度的可以保存一些定长的内容，比如一些编码，性别等。但是考虑到一定的变化风险，带来收益不够明显，所以定长字符串使用意义有限。")])])]),s._v(" "),a("h2",{attrs:{id:"_3-6-枚举类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-6-枚举类型"}},[s._v("#")]),s._v(" 3.6 枚举类型")]),s._v(" "),a("blockquote",[a("p",[s._v("使用场景：对一些状态、类型的字段算是一种空间优化，也算是一种数据约束。但是实际使用中往往因为一些数据内容的变化增加一定的维护成本，甚至是数据丢失问题。所以谨慎使用。")])]),s._v(" "),a("p",[s._v("包括 Enum8 和 Enum16 类型。Enum 保存 "),a("code",[s._v("'string'= integer")]),s._v(" 的对应关系。")]),s._v(" "),a("ul",[a("li",[s._v("Enum8 用 "),a("code",[s._v("'String'= Int8")]),s._v(" 对描述。")]),s._v(" "),a("li",[s._v("Enum16 用 "),a("code",[s._v("'String'= Int16")]),s._v(" 对描述。")])]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("创建一个带有一个枚举 Enum8('hello'=1,'world'=2) 类型的列")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("CREATE TABLE t_enum\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\tx Enum8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'world'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nENGINE "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" TinyLog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("这个 "),a("strong",[s._v("x")]),s._v(" 列只能存储类型定义中列出的值：**'hello' **或 "),a("strong",[s._v("'world'")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("INSERT INTO t_enum VALUES "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'world'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("查询")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SELECT * FROM t_enum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("输出：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SELECT *\nFROM t_enum\n\nQuery id: 35c41734-a9a7-4564-bf64-81767021b6a1\n\n┌─x─────┐\n│ hello │\n│ world │\n│ hello │\n└───────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" set. Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.007")]),s._v(" sec.\n")])])])]),s._v(" "),a("li",[a("p",[s._v("查询枚举对应的值")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SELECT CAST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Int8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" FROM t_enum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("输出：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SELECT CAST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Int8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nFROM t_enum\n\nQuery id: 5f2b7d38-da1e-49a2-be6d-f567a8d2bc81\n\n┌─CAST"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x, "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Int8'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("─┐\n│               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" │\n│               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" │\n│               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" │\n└─────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" set. Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.005")]),s._v(" sec.\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_3-7-时间类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-7-时间类型"}},[s._v("#")]),s._v(" 3.7 时间类型")]),s._v(" "),a("p",[s._v("目前 ClickHouse 有三种时间类型：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Date")]),s._v(" "),a("p",[s._v("接受"),a("code",[s._v("“年-月-日”")]),s._v("的字符串比如“2019-12-16”")])]),s._v(" "),a("li",[a("p",[s._v("Datetime")]),s._v(" "),a("p",[s._v("接受"),a("code",[s._v("“年-月-日 时:分:秒”")]),s._v("的字符串比如“2019-12-16 20:50:10”")])]),s._v(" "),a("li",[a("p",[s._v("Datetime64")]),s._v(" "),a("p",[s._v("接受“"),a("code",[s._v("年-月-日 时:分:秒.亚秒")]),s._v("”的字符串比如“2019-12-16 20:50:10.66”")])])]),s._v(" "),a("p",[s._v("日期类型，用两个字节存储，表示从 1970-01-01 （无符号）到当前的日期值。")]),s._v(" "),a("h2",{attrs:{id:"_3-8-数组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-8-数组"}},[s._v("#")]),s._v(" 3.8 数组")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("Array(T)")]),s._v("：由 T 类型元素组成的数组。")]),s._v(" "),a("p",[s._v("T 可以是任意类型，包含数组类型。 但不推荐使用多维数组，ClickHouse 对多维数组的支持有限。例如，不能在 MergeTree 表中存储多维数组。")])])]),s._v(" "),a("p",[s._v("示例：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("创建数组方式一：使用 array() 函数")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SELECT array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" AS x, toTypeName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("输出：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SELECT\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AS x,\n    toTypeName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nQuery id: d2a31cf6-7e65-4b0f-a0c8-6015bb3bf229\n\n┌─x─────┬─toTypeName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("─┐\n│ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1,2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" │ Array"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("UInt8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("            │\n└───────┴─────────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" set. Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.004")]),s._v(" sec. \n")])])])]),s._v(" "),a("li",[a("p",[s._v("创建数组方式二：使用方括号")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SELECT "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" AS x, toTypeName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_3-9-空值"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-9-空值"}},[s._v("#")]),s._v(" 3.9 空值")]),s._v(" "),a("p",[s._v("ClickHouse 允许存储空值，格式为："),a("code",[s._v("Nullable(typename)")]),s._v("，默认值为："),a("code",[s._v("NULL")]),s._v("。")]),s._v(" "),a("h1",{attrs:{id:"_4-clickhouse-表引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-clickhouse-表引擎"}},[s._v("#")]),s._v(" 4. ClickHouse 表引擎")]),s._v(" "),a("p",[s._v("表引擎是 ClickHouse 的一大特色。可以说， 表引擎决定了如何存储表的数据。包括:")]),s._v(" "),a("ul",[a("li",[s._v("数据的存储方式和位置，写到哪里以及从哪里读取数据；")]),s._v(" "),a("li",[s._v("支持哪些查询以及如何支持；")]),s._v(" "),a("li",[s._v("并发数据访问；")]),s._v(" "),a("li",[s._v("索引的使用（如果存在）；")]),s._v(" "),a("li",[s._v("是否可以执行多线程请求；")]),s._v(" "),a("li",[s._v("数据复制参数；")])]),s._v(" "),a("p",[s._v("表引擎的使用方式就是必须显式在创建表时定义该表使用的引擎，以及引擎使用的相关参数。")]),s._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),a("p",[s._v("特别注意：引擎的名称大小写敏感。")])]),s._v(" "),a("h2",{attrs:{id:"_4-1-tinylog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-tinylog"}},[s._v("#")]),s._v(" 4.1 TinyLog")]),s._v(" "),a("p",[s._v("以列文件的形式保存在磁盘上，不支持索引，没有并发控制。一般保存少量数据的小表， 生产环境上作用有限。可以用于平时练习测试用。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("CREATE TABLE t_tinylog "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" String, name String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("TinyLog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h2",{attrs:{id:"_4-2-memory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-memory"}},[s._v("#")]),s._v(" 4.2 Memory")]),s._v(" "),a("p",[s._v("内存引擎，数据以未压缩的原始形式直接保存在内存当中，服务器重启数据就会消失。 读写操作不会相互阻塞，不支持索引。简单查询下有非常非常高的性能表现（超过 10G/s）。")]),s._v(" "),a("p",[s._v("一般用到它的地方不多，除了用来测试，就是在需要非常高的性能，同时数据量又不太大（上限大概 1 亿行）的场景。")]),s._v(" "),a("h2",{attrs:{id:"_4-3-mergetree"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-mergetree"}},[s._v("#")]),s._v(" 4.3 MergeTree")]),s._v(" "),a("p",[s._v("ClickHouse 中最强大的表引擎当属 MergeTree 引擎及该系列（MergeTree）中的其他引擎，支持"),a("strong",[s._v("索引")]),s._v("和"),a("strong",[s._v("分区")]),s._v("，地位可以相当于 Innodb 之于 MySQL。而且基于 MergeTree， 还衍生除了很多小弟，也是非常有特色的引擎。")]),s._v(" "),a("h3",{attrs:{id:"_4-3-1-基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-基本使用"}},[s._v("#")]),s._v(" 4.3.1 基本使用")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("建表")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_mt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n   id UInt32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   sku_id String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   total_amount "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Decimal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   create_time "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Datetime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MergeTree\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" toYYYYMMDD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("插入数据")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" t_order_mt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 11:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_004'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-02 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("查询数据")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t_order_mt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("输出：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SELECT *\nFROM t_order_mt\n\nQuery id: 2a5e5ca0-9597-4f57-acb9-1b9dbb0ffaa8\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-02 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" set. Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.331")]),s._v(" sec. \n")])])])])]),s._v(" "),a("h3",{attrs:{id:"_4-3-2-分区-partition-by-可选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-分区-partition-by-可选项"}},[s._v("#")]),s._v(" 4.3.2 分区 partition by（可选项）")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("作用")]),s._v(" "),a("p",[s._v("学过 hive 的应该都不陌生，分区的目的主要是降低扫描的范围，优化查询速度。")])]),s._v(" "),a("li",[a("p",[s._v("默认")]),s._v(" "),a("p",[s._v("如果不填分区，只会使用一个分区。")])]),s._v(" "),a("li",[a("p",[s._v("分区目录")]),s._v(" "),a("p",[s._v("MergeTree 是以列文件 + 索引文件 + 表定义文件组成的，但是如果设定了分区那么这些文件就会保存到不同的分区目录中。")])]),s._v(" "),a("li",[a("p",[s._v("并行")]),s._v(" "),a("p",[s._v("分区后，面对设计跨分区的查询统计，ClickHouse 会以分区为单位并行处理。")])]),s._v(" "),a("li",[a("p",[s._v("数据写入与分区合并")]),s._v(" "),a("p",[s._v("任何一个批次的数据写入都会产生一个临时分区，不会纳入任何一个已有的分区。写入后的某个时刻（大概 10-15 分钟后），ClickHouse 会自动执行合并操作（等不及也可以手动通过 optimize 执行），把临时分区的数据，合并到已有分区中。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPTIMIZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" xxx final"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("示例")]),s._v(" "),a("p",[s._v("在上述例子的基础上，再插入数据：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" t_order_mt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 11:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_004'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-02 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("查看数据，会发现它们并没有被纳入任何分区：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SELECT *\nFROM t_order_mt\n\nQuery id: dbec28cb-0ca0-4fd8-adc1-99ea4d8fe1ff\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-02 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-02 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" set. Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.008")]),s._v(" sec. \n")])])]),a("p",[s._v("手动合并：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPTIMIZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_mt FINAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("再次查询：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t_order_mt\n\nQuery id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2386")]),s._v("e7a2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f2c4"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v("b2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("b96d"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v("dfb3d202cd\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.004")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \n")])])])])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("补充：分区的存储")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost t_order_mt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/var/lib/clickhouse/data/default/t_order_mt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost t_order_mt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\ndrwxr-x--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("203")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 20200601_1_3_1\ndrwxr-x--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("203")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 20200602_2_4_1\ndrwxr-x--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:39 detached\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:39 format_version.txt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost t_order_mt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd 20200601_1_3_1/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost 20200601_1_3_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v("\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("260")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 checksums.txt\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("118")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 columns.txt\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 count.txt\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("217")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 data.bin\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("144")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 data.mrk3\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 default_compression_codec.txt\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 minmax_create_time.idx\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 partition.dat\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 primary.idx\n")])])]),a("p",[s._v("分区的文件夹名称：PartitionId_MinBlockNum_MaxBlockNum_Level（分区值_最小分区块编号_最大分区块编号_合并层级）")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("PartitionId")]),s._v(" "),a("p",[s._v("数据分区 ID，数据分区规则由分区 ID 决定，分区 ID 由 PARTITION BY 分区键决定。根据分区键字段类型，ID生成规则可分为：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("未定义分区键")]),s._v(" "),a("p",[s._v("没有定义 PARTITION BY，默认生成一个目录名为 "),a("code",[s._v("all")]),s._v(" 的数据分区，所有数据均存放在 "),a("code",[s._v("all")]),s._v(" 目录下。")])]),s._v(" "),a("li",[a("p",[s._v("整型分区键")]),s._v(" "),a("p",[s._v("分区键为整型，那么直接用该整型值的字符串形式做为分区 ID。")])]),s._v(" "),a("li",[a("p",[s._v("日期类分区键")]),s._v(" "),a("p",[s._v("分区键为日期类型，或者可以转化成日期类型。")])]),s._v(" "),a("li",[a("p",[s._v("其他类型分区键")]),s._v(" "),a("p",[s._v("String、Float 类型等，通过 128 位的 "),a("code",[s._v("Hash")]),s._v(" 算法取其 Hash 值作为分区 ID。")])])])]),s._v(" "),a("li",[a("p",[s._v("MinBlockNum")]),s._v(" "),a("p",[s._v("最小分区块编号，自增类型，从 1 开始向上递增。每产生一个新的目录分区就向上递增一个数字。")])]),s._v(" "),a("li",[a("p",[s._v("MaxBlockNum")]),s._v(" "),a("p",[s._v("最大分区块编号，新创建的分区 MinBlockNum 等于 MaxBlockNum 的编号。")])]),s._v(" "),a("li",[a("p",[s._v("Level")]),s._v(" "),a("p",[s._v("合并的层级，被合并的次数。合并次数越多，层级值越大。")])])]),s._v(" "),a("p",[s._v("分区目录下的各个文件：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("bin 文件：数据文件")])]),s._v(" "),a("li",[a("p",[s._v("mrk 文件：标记文件")]),s._v(" "),a("p",[s._v("标记文件在 idx 索引文件和 bin 数据文件之间起到了桥梁作用。")]),s._v(" "),a("p",[s._v("以 mrk2 结尾的文件，表示该表启用了自适应索引间隔。")])]),s._v(" "),a("li",[a("p",[s._v("primary.idx 文件：主键索引文件，用于加快查询效率。")])]),s._v(" "),a("li",[a("p",[s._v("minmax_create_time.idx：分区键的最大最小值。")])]),s._v(" "),a("li",[a("p",[s._v("checksums.txt：校验文件，用于校验各个文件的正确性。存放各个文件的 size 以及 hash 值。")])])])]),s._v(" "),a("h3",{attrs:{id:"_4-3-3-主键-primary-key-可选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-3-主键-primary-key-可选项"}},[s._v("#")]),s._v(" 4.3.3 主键 primary key（可选项）")]),s._v(" "),a("p",[s._v("ClickHouse 中的主键，"),a("strong",[s._v("只提供数据的一级索引，没有提供唯一约束")]),s._v("。这意味着是可以存在相同的 primary key 的数据的。")]),s._v(" "),a("p",[s._v("主键的设定主要依据是查询语句中的 where 条件。")]),s._v(" "),a("p",[s._v("根据条件通过对主键进行某种形式的二分查找，能够定位到对应的 index granularity，避免了全表扫描。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("index granularity：直接翻译的话就是索引粒度，指在稀疏索引中两个相邻索引对应数据的间隔。")]),s._v(" "),a("p",[s._v("ClickHouse 中的 MergeTree 默认是 8192。官方不建议修改这个值，除非该列存在大量重复值，比如在一个分区中几万行才有一个不同数据。")])])]),s._v(" "),a("p",[s._v("ClickHouse 中的索引粒度采用的是：稀疏索引：")]),s._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://tva1.sinaimg.cn/large/e6c9d24egy1gzvlvza2iej215k0lyq72.jpg",alt:"image-20220302161405388"}}),s._v(" "),a("p",[s._v("稀疏索引的好处就是可以用很少的索引数据，定位更多的数据，代价就是只能定位到索引粒度的第一行，然后再进行进行扫描。")]),s._v(" "),a("h3",{attrs:{id:"_4-3-4-排序-order-by-必选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-4-排序-order-by-必选项"}},[s._v("#")]),s._v(" 4.3.4 排序 order by（必选项）")]),s._v(" "),a("p",[s._v("order by 设定了分区内的数据按照哪些字段顺序进行有序保存。")]),s._v(" "),a("p",[s._v("order by 是 MergeTree 中唯一一个必填项，甚至比 primary key 还重要，因为当用户不设置主键的情况，很多处理会依照 order by 的字段进行处理（比如去重和汇总）。")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("主键必须是 order by 字段的前缀字段。")]),s._v(" "),a("p",[s._v("比如 order by 字段是 (id,sku_id)，那么主键必须是 id 或者 (id,sku_id)。")])]),s._v(" "),a("h3",{attrs:{id:"_4-3-5-二级索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-5-二级索引"}},[s._v("#")]),s._v(" 4.3.5 二级索引")]),s._v(" "),a("p",[s._v("二级索引就是对一级索引再次建索引。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_mt2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  id UInt32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tsku_id String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\ttotal_amount "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Decimal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  create_time "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Datetime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" a total_amount "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),s._v(" minmax GRANULARITY "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MergeTree\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" toYYYYMMDD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[s._v("INDEX a total_amount TYPE minmax GRANULARITY 5\n"),a("ul",[a("li",[s._v("INDEX：关键字")]),s._v(" "),a("li",[s._v("a：索引名称")]),s._v(" "),a("li",[s._v("total_amount：字段名")]),s._v(" "),a("li",[s._v("TYPE：关键字")]),s._v(" "),a("li",[s._v("minmax：二级索引类型")]),s._v(" "),a("li",[s._v("GRANULARITY：设定二级索引对于一级索引粒度的粒度")]),s._v(" "),a("li",[s._v("5：每 5 个建一个索引")])])])]),s._v(" "),a("h3",{attrs:{id:"_4-3-6-数据-ttl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-6-数据-ttl"}},[s._v("#")]),s._v(" 4.3.6 数据 TTL")]),s._v(" "),a("p",[s._v("TTL 即 Time To Live，MergeTree 提供了可以管理数据表或者列的生命周期的功能。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("列级")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_mt3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  id UInt32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tsku_id String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\ttotal_amount "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Decimal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" TTL create_time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SECOND")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  create_time "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Datetime")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MergeTree\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" toYYYYMMDD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("表级")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_mt3 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MODIFY")]),s._v(" TTL create_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTERVAL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SECOND")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_4-4-replacingmergetree"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-replacingmergetree"}},[s._v("#")]),s._v(" 4.4 ReplacingMergeTree")]),s._v(" "),a("h2",{attrs:{id:"_4-5-summingmergetree"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-summingmergetree"}},[s._v("#")]),s._v(" 4.5 SummingMergeTree")]),s._v(" "),a("h1",{attrs:{id:"_5-clickhouse-sql-操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-clickhouse-sql-操作"}},[s._v("#")]),s._v(" 5. ClickHouse SQL 操作")]),s._v(" "),a("h1",{attrs:{id:"_6-clickhouse-副本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-clickhouse-副本"}},[s._v("#")]),s._v(" 6. ClickHouse 副本")]),s._v(" "),a("h1",{attrs:{id:"_7-clickhouse-执行计划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-clickhouse-执行计划"}},[s._v("#")]),s._v(" 7. ClickHouse 执行计划")]),s._v(" "),a("h1",{attrs:{id:"_8-clickhouse-建表优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-clickhouse-建表优化"}},[s._v("#")]),s._v(" 8. ClickHouse 建表优化")]),s._v(" "),a("h1",{attrs:{id:"_9-clickhouse-语法优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-clickhouse-语法优化"}},[s._v("#")]),s._v(" 9. ClickHouse 语法优化")]),s._v(" "),a("h1",{attrs:{id:"_10-clickhouse-查询优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-clickhouse-查询优化"}},[s._v("#")]),s._v(" 10. ClickHouse 查询优化")]),s._v(" "),a("h1",{attrs:{id:"_11-clickhouse-数据一致性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-clickhouse-数据一致性"}},[s._v("#")]),s._v(" 11. ClickHouse 数据一致性")]),s._v(" "),a("h1",{attrs:{id:"_12-clickhouse-物化视图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-clickhouse-物化视图"}},[s._v("#")]),s._v(" 12. ClickHouse 物化视图")]),s._v(" "),a("h1",{attrs:{id:"_13-materializemysql-引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-materializemysql-引擎"}},[s._v("#")]),s._v(" 13. MaterializeMySQL 引擎")]),s._v(" "),a("h1",{attrs:{id:"_14-clickhouse-常见故障排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-clickhouse-常见故障排查"}},[s._v("#")]),s._v(" 14. ClickHouse 常见故障排查")]),s._v(" "),a("h1",{attrs:{id:"_15-clickhouse-监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_15-clickhouse-监控"}},[s._v("#")]),s._v(" 15. ClickHouse 监控")]),s._v(" "),a("h1",{attrs:{id:"_16-clickhouse-备份及恢复"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_16-clickhouse-备份及恢复"}},[s._v("#")]),s._v(" 16. ClickHouse 备份及恢复")])])}),[],!1,null,null,null);t.default=n.exports}}]);