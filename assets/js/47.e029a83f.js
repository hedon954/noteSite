(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{458:function(s,t,a){"use strict";a.r(t);var n=a(47),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"二、redis-数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、redis-数据类型"}},[s._v("#")]),s._v(" 二、Redis 数据类型")]),s._v(" "),a("h2",{attrs:{id:"_1-redis-基本数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-redis-基本数据类型"}},[s._v("#")]),s._v(" 1. Redis 基本数据类型")]),s._v(" "),a("p",[s._v("基本数据结构包含：字符串（strings）、 散列（hashes）、 列表（lists）、 集合（sets）、 有序集合（sorted sets）五种。")]),s._v(" "),a("h3",{attrs:{id:"字符串-string"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字符串-string"}},[s._v("#")]),s._v(" 字符串（string）")]),s._v(" "),a("p",[a("strong",[s._v("1）基本说明")])]),s._v(" "),a("p",[s._v("字符串是Redis最简单的储存类型，它存储的值可以是"),a("code",[s._v("字符串")]),s._v("、"),a("code",[s._v("整数")]),s._v("或者"),a("code",[s._v("浮点数")]),s._v("，对整个字符串或者字符串的其中一部分执行操作；对整数或者浮点数执行自增（increment）或者自减（decrement）操作。")]),s._v(" "),a("p",[s._v("Redis 的字符串是一个由字节组成的序列，跟 Java 里面的 "),a("strong",[s._v("ArrayList")]),s._v(" 有点类似，"),a("strong",[s._v("采用预分配冗余空间的方式来减少内存的频繁分配")]),s._v("，如图中所示，内部为当前字符串实际分配的空间 "),a("code",[s._v("capacity")]),s._v(" 一般要高于实际字符串长度 len。当字符串长度小于 1M 时，扩容都是 "),a("strong",[s._v("加倍")]),s._v(" 现有的空间，如果超过 1M，扩容时一次 "),a("strong",[s._v("只会多扩 1M")]),s._v(" 的空间。"),a("strong",[s._v("需要注意的是字符串最大长度为 512M")]),s._v("。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEly1gphaysn7lbj30fw04pt8m.jpg",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("2）应用场景")])]),s._v(" "),a("p",[s._v("字符串类型在工作中使用广泛，主要用于"),a("strong",[s._v("缓存数据，提高查询性能")]),s._v("。比如存储登录用户信息、电商中存储商品信息、可以做计数器（想知道什么时候封锁一个IP地址（访问超过几次））等等。")]),s._v(" "),a("p",[a("strong",[s._v("3）操作指令")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加一条String类型数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" key value\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取一条String类型数据")]),s._v("\nget key\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加多条String类型数据")]),s._v("\nmset key1 value1 key2 value2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取多条String类型数据")]),s._v("\nmget key1 key2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自增（+1）")]),s._v("\nincr key\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按照步长（step）自增")]),s._v("\nincrby key step\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自减（-1）")]),s._v("\ndecr key\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按照步长（step）递减")]),s._v("\ndecrby key step\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除")]),s._v("\ndel key\n")])])]),a("p",[a("strong",[s._v("4）实操")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 插入字符串  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("set username zhangsan  \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OK"')]),s._v("  \n​  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取字符串  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("get username  \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhangsan"')]),s._v("  \n​  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 插入多个字符串  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("mset age "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" address bj  \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"OK"')]),s._v("  \n​  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取多个字符串  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("mget username age  \n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhangsan"')]),s._v("  \n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"18"')]),s._v("  \n​  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自增  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("incr num  \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("incr num  \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("  \n​  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自减  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("decr num  \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("  \n​  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定步长自增  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("incrby num "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("incrby num "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5"')]),s._v("  \n​  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定步长自减  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("decrby num "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("  \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("  \n​  \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("del num  \n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n")])])]),a("h3",{attrs:{id:"散列-hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#散列-hash"}},[s._v("#")]),s._v(" 散列（hash）")]),s._v(" "),a("p",[a("strong",[s._v("1）基本说明")])]),s._v(" "),a("p",[s._v("散列相当于 Java 中的 HashMap，内部是无序字典。实现原理跟 "),a("code",[s._v("HashMap")]),s._v(" 一致。一个哈希表有多个节点，每个节点保存一个键值对。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEly1gphb2sv4nbj30g307pa9z.jpg",alt:"img"}})]),s._v(" "),a("p",[s._v("与 Java 中的 HashMap 不同的是，rehash 的方式不一样，因为 Java 的 HashMap 在字典很大时，rehash 是个耗时的操作，需要一次性全部 rehash。Redis 为了高性能，不能堵塞服务，"),a("strong",[s._v("所以采用了渐进式 rehash 策略")]),s._v("。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEly1gphb2gphyhj30ug08d0t1.jpg",alt:"img"}})]),s._v(" "),a("p",[a("strong",[s._v("渐进式 rehash 会在 rehash 的同时，保留新旧两个 hash 结构，查询时会同时查询两个 hash 结构，然后在后续的定时任务中以及 hash 操作指令中，循序渐进地将旧 hash 的内容一点点迁移到新的 hash 结构中。当搬迁完成了，就会使用新的 hash 结构取而代之。")])]),s._v(" "),a("p",[a("strong",[s._v("当 hash 移除了最后一个元素之后，该数据结构自动被删除，内存被回收。")])]),s._v(" "),a("p",[a("strong",[s._v("2）应用场景")])]),s._v(" "),a("p",[s._v("Hash 也可以同于对象存储，比如存储用户信息，与字符串不一样的是，字符串是需要将对象进行序列化（比如 JSON 序列化）之后才能保存，而 Hash 则可以讲用户对象的每个字段单独存储，这样就能节省序列化和反序列的时间。如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEly1gphb4gst7jg30ci04gtb5.gif",alt:"img"}})]),s._v(" "),a("p",[s._v("此外还可以保存用户的购买记录，比如 key 为用户 id，field 为商品 id，value 为商品数量。同样还可以用于购物车数据的存储，比如 key 为用户 id，field 为商品 id，value 为购买数量等等。")]),s._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEgy1gphb50l4c5j30u00xvjys.jpg",alt:"img"}}),s._v(" "),a("p",[a("strong",[s._v("3）操作指令")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置属性")]),s._v("\nhset keyname field1 value1 field2 value2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取某个属性值")]),s._v("\nhget keyname field\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取所有属性值")]),s._v("\nhgetall keyname\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除某个属性")]),s._v("\nhdel keyname field\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取属性个数")]),s._v("\nhlen keyname\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按照步长自增/自减某个属性（该属性必须是数字）")]),s._v("\nhincrby keyname field step\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除整个 hash")]),s._v("\ndel keyname\n")])])]),a("p",[a("strong",[s._v("4）实操")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 插入 hash 数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hset userInfo username zhangsan age "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" address bj\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 hash 单条 field 数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hget userInfo username\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhangsan"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hget userInfo age\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"18"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 hash 多个 field 数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hmget userInfo username age\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhangsan"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"18"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 hash 所有 field 数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hgetall userInfo\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhangsan"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"age"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"18"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"address"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bj"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 hash 的 field 个数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hlen userInfo\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自增 hash 的某个 field")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hincrby userInfo age "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hincrby userInfo age "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"22"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自减 hash 的某个 field（通过自增负步长来实现）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hincrby userInfo age -2\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"20"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 hash 的某个 field")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("hdel userInfo age\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除 hash 所有数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("del userInfo\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n")])])]),a("h3",{attrs:{id:"列表-list"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#列表-list"}},[s._v("#")]),s._v(" 列表（list）")]),s._v(" "),a("p",[a("strong",[s._v("1）基本说明")])]),s._v(" "),a("p",[s._v("Redis 中的 lists 相当于 Java 中的 "),a("code",[s._v("LinkedList")]),s._v("，实现原理是一个双向链表（其底层是一个快速列表），即可以支持反向查找和遍历，更方便操作。插入和删除操作非常快，时间复杂度为 O(1)，但是索引定位很慢，时间复杂度为 O(n)。")]),s._v(" "),a("p",[a("strong",[s._v("2）应用场景")])]),s._v(" "),a("p",[s._v("lists 的应用场景非常多，可以利用它轻松实现热销榜。")]),s._v(" "),a("p",[s._v("可以实现工作队列（利用 lists 的 push 操作，将任务存在 lists 中，然后工作线程再用 pop 操作将任务取出进行执行 ）。")]),s._v(" "),a("p",[s._v("可以实现最新列表，比如最新评论等。")]),s._v(" "),a("p",[a("strong",[s._v("3）操作指令")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 左进")]),s._v("\nlpush key value1 value2 value3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 左出")]),s._v("\nlpop key\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 右进")]),s._v("\nrpush key value1 value2 value3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 右出")]),s._v("\nrpop key\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从左往右读取 start和end是下标")]),s._v("\nlrange key start end\n")])])]),a("p",[a("strong",[s._v("4）实操")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 list 左边依次插入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("lpush student zhangsan lisi wangwu\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 list 右边插入")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("rpush student tianqi\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 list 左边弹出一个")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("lpop liangshan\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wangwu"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从 list 右边弹出一个")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("rpop liangshan\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tianqi"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取 list 下标 0 ~ 1 的数据(左闭右闭)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("lrange liangshan "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lisi"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhangsan"')]),s._v("\n")])])]),a("p",[a("strong",[s._v("5）注意：blpop 阻塞版获取")])]),s._v(" "),a("p",[s._v("为什么要阻塞版本的pop呢，主要"),a("strong",[s._v("是为了避免轮询。")])]),s._v(" "),a("p",[s._v("举个简单的例子如果我们用 list 来实现一个工作队列。执行任务的 thread 可以调用阻塞版本的 pop 去获取任务这样就可以避免轮询去检查是否有任务存在。当任务来时候工作线程可以立即返回，也可以避免轮询带来的延迟。")]),s._v(" "),a("h3",{attrs:{id:"集合-set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合-set"}},[s._v("#")]),s._v(" 集合（set）")]),s._v(" "),a("p",[a("strong",[s._v("1）基本说明")])]),s._v(" "),a("p",[s._v("集合类似 Java 中的 "),a("code",[s._v("HashSet")]),s._v("，内部实现是一个 value 永远为 null 的 HashMap，实际就是通过计算 hash 的方式来快速排重的，这\n也是 set 能提供判断一个成员是否在集合内的原因。")]),s._v(" "),a("p",[a("strong",[s._v("2）应用场景")])]),s._v(" "),a("p",[s._v("Redis 的 sets 类型是使用哈希表构造的，因此复杂度是 0(1)。它支持集合内的增删改查，并且支持多个集合间的交集、并集、\n差集操作。可以利用这些集合操作，解决程序开发过程当中很多数据集合间的问题。比如计算网站独立 ip，用户画像中的用\n户标签，共同好友等功能。")]),s._v(" "),a("p",[a("strong",[s._v("3）操作指令")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加内容")]),s._v("\nsadd key value1 value2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询 key 里所有的值")]),s._v("\nsmembers key\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 移除 key 里面的某个 value")]),s._v("\nsrem key value\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 随机移除某个 value")]),s._v("\nspop key\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回两个 set 的并集")]),s._v("\nsunion key1 key2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#返回 key1 剔除交集的那部分(差集)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sdiff")]),s._v(" key1 key2\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#跟 siffer 相反，返回交集")]),s._v("\nsinter key1 key2\n")])])]),a("h3",{attrs:{id:"有序集合-sorted-set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#有序集合-sorted-set"}},[s._v("#")]),s._v(" 有序集合（sorted set）")]),s._v(" "),a("p",[a("strong",[s._v("1）基本说明")])]),s._v(" "),a("p",[s._v("sorted sets 是 Redis 类似于 "),a("code",[s._v("SortedSet")]),s._v(" 和 "),a("code",[s._v("HashMap")]),s._v(" 的结合体，一方面它是一个 set，保证了内部 value 的"),a("strong",[s._v("唯一性")]),s._v("，另一方面它可以给每个 value 赋予一个 score，代表这个 value 的"),a("strong",[s._v("排序权重")]),s._v("。")]),s._v(" "),a("p",[s._v("内部使用 HashMap 和跳跃表（SkipList）来保证数据的存储和有序，HashMap 里放的是成员到 score 的映射，而跳跃表里存放的是所有的成员，排序依据是 HashMap 里存的 score，使用 "),a("strong",[s._v("跳跃表")]),s._v(" 的结构可以获得比较高的查找效率，并且在实现上比较简单。")]),s._v(" "),a("p",[s._v("sorted sets 中最后一个 value 被移除后，数据结构自动删除，内存被回收。")]),s._v(" "),a("p",[s._v("跳表：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://tva1.sinaimg.cn/large/008eGmZEgy1gphbh2tslvj31ku0qidvt.jpg",alt:"image-20210412221232375"}})]),s._v(" "),a("p",[a("strong",[s._v("2）应用场景")])]),s._v(" "),a("p",[s._v("主要应用于根据某个权重进行排序的队列的场景，比如游戏积分排行榜，设置优先级的任务列表，学生成绩表等。")]),s._v(" "),a("p",[a("strong",[s._v("3）操作指令")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加元素")]),s._v("\nzadd key score value "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("score value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取集合的值并按照score从小到大排列， 最小的是最上面")]),s._v("\nzrange key start end \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 返回有序集 key 中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员。有序集成员按 score 值递增(从小到大)次序排列, 最小的是最上面")]),s._v("\nzrangeByScore key score_min score_max \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除")]),s._v("\nzrem key value \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取key的集合有多少元素")]),s._v("\nzcard key\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计分数从小到大有多少元素 （闭区间）")]),s._v("\nzcount key score_min score_max \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取value所在位置（从小到大排序，最小的是0）")]),s._v("\nzrank key value \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取value所在的位置（从大到小排列， 最大的是0）")]),s._v("\nzrevrank key value\n")])])]),a("p",[a("strong",[s._v("4）实操")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 插入多条数据和分数并去重及排序")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("zadd rank "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v(" zhangsan "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),s._v(" lisi "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v(" wangwu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v(" zhaoliu\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"4"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 插入多条数据及分数并去重及排序")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("zadd rank "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("66")]),s._v(" zhangsan "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),s._v(" lisi "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v(" wangwu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v(" zhaoliu\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取下标 0 ~ 3 的数据(左闭右闭)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("zrange rank "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhangsan"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wangwu"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lisi"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhaoliu"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取分数在 77 ~ 99 之间的数据(左闭右闭)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("zrangeByScore rank "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"wangwu"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lisi"')]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"zhaoliu"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除一条数据")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("zrem rank zhaoliu\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询元素的个数")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("zcard rank\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计分数在 77 ~ 88 之间的数据(左闭右闭)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("zcount rank "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("88")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取指定元素的下标")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("zrank rank zhangsan\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取指定元素的下标并反转")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("zrevrank rank zhangsan\n"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("\n")])])]),a("h2",{attrs:{id:"_2-redis-高级数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-redis-高级数据类型"}},[s._v("#")]),s._v(" 2. Redis 高级数据类型")]),s._v(" "),a("h3",{attrs:{id:"位图-bitmap"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#位图-bitmap"}},[s._v("#")]),s._v(" 位图（bitmap）")]),s._v(" "),a("p",[a("strong",[s._v("1）基本说明")])]),s._v(" "),a("p",[s._v("bitmap 就是通过一个 bit 位来表示某个元素对应的值或者状态, 其中的 key 就是对应元素本身，实际上底层也是通过对字符串的操作来实现。bitmap 支持的最大位数是 2"),a("sup",[s._v("32")]),s._v(" 位，使用 512M 内存就可以存储多达 42.9 亿的字节信息。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SETBIT key offset value （offset位偏移量，从0开始）\n")])])]),a("p",[s._v("它是由一组 bit 位组成的，每个 bit 位对应 0 和 1 两个状态，虽然内部还是采用了 String 类型存储，但 Redis 提供了一些指令用于直接操作位图，因此我们可以把它看成一个 bit 数组，数组的下表就是偏移量。")]),s._v(" "),a("p",[a("strong",[s._v("2）使用场景")])]),s._v(" "),a("p",[s._v("它的优点是内存开销小、效率高且操作简单，很适合用于「签到」这类只有两种取值的场景。比如按月存储，一个月最多 31 天，那么我们一个用于再某一个月的签到缓存二进制就是：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("00000 00000 00000 00000 00000 00000 0\n")])])]),a("p",[s._v("当某天签到将 0 改成 1 即可。")]),s._v(" "),a("p",[a("strong",[s._v("3）操作指令")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置值，offset 从 0 开始")]),s._v("\nSETBIT key offset value\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取值")]),s._v("\nGETBIT key offset\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计指定字节区间 bit 为 1 的数量")]),s._v("\nBITCOUNT key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("start end"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 操作多字节位域")]),s._v("\nBITFIELD key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("GET "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" offset"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SET "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" offset value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INCRBY "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" offset increment"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OVERFLOW WRAP/SAT/FAIL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  查询指定字节区间第一个被设置成 1 的 bit 位的位置")]),s._v("\nBITPOS key bit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("start"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("end"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("BITFIELD")]),s._v(" "),a("p",[a("code",[s._v("BITFIELD")]),s._v(" 命令可以将一个 Redis 字符串看作是一个由二进制位组成的数组，并对这个数组中储存的长度不同的整数进行访问（被储存的整数无需进行对齐）。换句话说，通过这个命令，用户可以执行诸如“对偏移量 1234 上的 5 位长有符号整数进行设置”、“获取偏移量 4567 上的 31 位长无符号整数”等操作。此外，"),a("code",[s._v("BITFIELD")]),s._v(" 命令还可以对指定的整数执行加法操作和减法操作，并且这些操作可以通过设置妥善地处理计算时出现的溢出情况。")]),s._v(" "),a("p",[a("code",[s._v("BITFIELD")]),s._v(" 命令可以在一次调用中同时对多个位范围进行操作：它接受一系列待执行的操作作为参数，并返回一个数组作为回复，数组中的每个元素就是对应操作的执行结果。")]),s._v(" "),a("p",[s._v("比如以下命令就展示了如何对位于偏移量 100 的 8 位长有符号整数执行加法操作，并获取位于偏移量 0 上的 4 位长无符号整数：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" BITFIELD mykey INCRBY i8 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" GET u4 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),a("p",[s._v("注意：")]),s._v(" "),a("ul",[a("li",[s._v("使用 "),a("code",[s._v("GET")]),s._v(" 子命令对超出字符串当前范围的二进制位进行访问（包括键不存在的情况），超出部分的二进制位的值将被当做是 0 。")]),s._v(" "),a("li",[s._v("使用 "),a("code",[s._v("SET")]),s._v(" 子命令或者 "),a("code",[s._v("INCRBY")]),s._v(" 子命令对超出字符串当前范围的二进制位进行访问将导致字符串被扩大，被扩大的部分会使用值为 0 的二进制位进行填充。在对字符串进行扩展时，命令会根据字符串目前已有的最远端二进制位，计算出执行操作所需的最小长度。")])]),s._v(" "),a("p",[s._v("以下是 "),a("code",[s._v("BITFIELD")]),s._v(" 命令支持的子命令：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("GET <type> <offset>")]),s._v(" —— 返回指定的二进制位范围。")]),s._v(" "),a("li",[a("code",[s._v("SET <type> <offset> <value>")]),s._v(" —— 对指定的二进制位范围进行设置，并返回它的旧值。")]),s._v(" "),a("li",[a("code",[s._v("INCRBY <type> <offset> <increment>")]),s._v(" —— 对指定的二进制位范围执行加法操作，并返回它的旧值。用户可以通过向 "),a("code",[s._v("increment")]),s._v(" 参数传入负值来实现相应的减法操作。")])]),s._v(" "),a("p",[s._v("除了以上三个子命令之外，还有一个子命令，它可以改变之后执行的 "),a("code",[s._v("INCRBY")]),s._v(" 子命令在发生溢出情况时的行为：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("OVERFLOW [WRAP|SAT|FAIL]")])])]),s._v(" "),a("p",[s._v("当被设置的二进制位范围值为整数时，用户可以在类型参数的前面添加 "),a("code",[s._v("i")]),s._v(" 来表示有符号整数，或者使用 "),a("code",[s._v("u")]),s._v(" 来表示无符号整数。比如说，我们可以使用 "),a("code",[s._v("u8")]),s._v(" 来表示 8 位长的无符号整数，也可以使用 "),a("code",[s._v("i16")]),s._v(" 来表示 16 位长的有符号整数。")]),s._v(" "),a("p",[a("code",[s._v("BITFIELD")]),s._v(" 命令最大支持 64 位长的有符号整数以及 63 位长的无符号整数，其中无符号整数的 63 位长度限制是由于 Redis 协议目前还无法返回 64 位长的无符号整数而导致的。")]),s._v(" "),a("p",[a("strong",[s._v("二进制位和位置偏移量")])]),s._v(" "),a("p",[s._v("在二进制位范围命令中，用户有两种方法来设置偏移量：")]),s._v(" "),a("ul",[a("li",[s._v("如果用户给定的是一个没有任何前缀的数字，那么这个数字指示的就是字符串以零为开始（zero-base）的偏移量。")]),s._v(" "),a("li",[s._v("另一方面，如果用户给定的是一个带有 "),a("code",[s._v("#")]),s._v(" 前缀的偏移量，那么命令将使用这个偏移量与被设置的数字类型的位长度相乘，从而计算出真正的偏移量。")])]),s._v(" "),a("p",[s._v("比如说，对于以下这个命令来说：")]),s._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("BITFIELD mystring SET i8 #0 100 i8 #1 200\n")])])]),a("p",[s._v("命令会把 "),a("code",[s._v("mystring")]),s._v(" 键里面，第一个 "),a("code",[s._v("i8")]),s._v(" 长度的二进制位的值设置为 "),a("code",[s._v("100")]),s._v(" ，并把第二个 "),a("code",[s._v("i8")]),s._v(" 长度的二进制位的值设置为 "),a("code",[s._v("200")]),s._v(" 。当我们把一个字符串键当成数组来使用，并且数组中储存的都是同等长度的整数时，使用 "),a("code",[s._v("#")]),s._v(" 前缀可以让我们免去手动计算被设置二进制位所在位置的麻烦。")]),s._v(" "),a("p",[a("strong",[s._v("溢出控制")])]),s._v(" "),a("p",[s._v("用户可以通过 "),a("code",[s._v("OVERFLOW")]),s._v(" 命令以及以下展示的三个参数，指定 "),a("code",[s._v("BITFIELD")]),s._v(" 命令在执行自增或者自减操作时，碰上向上溢出（overflow）或者向下溢出（underflow）情况时的行为：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("WRAP")]),s._v(" ：使用回绕（wrap around）方法处理有符号整数和无符号整数的溢出情况。对于无符号整数来说，回绕就像使用数值本身与能够被储存的最大无符号整数执行取模计算，这也是 C 语言的标准行为。对于有符号整数来说，上溢将导致数字重新从最小的负数开始计算，而下溢将导致数字重新从最大的正数开始计算。比如说，如果我们对一个值为 "),a("code",[s._v("127")]),s._v(" 的 "),a("code",[s._v("i8")]),s._v(" 整数执行加一操作，那么将得到结果 "),a("code",[s._v("-128")]),s._v(" 。")]),s._v(" "),a("li",[a("code",[s._v("SAT")]),s._v(" ：使用饱和计算（saturation arithmetic）方法处理溢出，也即是说，下溢计算的结果为最小的整数值，而上溢计算的结果为最大的整数值。举个例子，如果我们对一个值为 "),a("code",[s._v("120")]),s._v(" 的 "),a("code",[s._v("i8")]),s._v(" 整数执行加 "),a("code",[s._v("10")]),s._v(" 计算，那么命令的结果将为 "),a("code",[s._v("i8")]),s._v(" 类型所能储存的最大整数值 "),a("code",[s._v("127")]),s._v(" 。与此相反，如果一个针对 "),a("code",[s._v("i8")]),s._v(" 值的计算造成了下溢，那么这个 "),a("code",[s._v("i8")]),s._v(" 值将被设置为 "),a("code",[s._v("-127")]),s._v(" 。")]),s._v(" "),a("li",[a("code",[s._v("FAIL")]),s._v(" ：在这一模式下，命令将拒绝执行那些会导致上溢或者下溢情况出现的计算，并向用户返回空值表示计算未被执行。")])]),s._v(" "),a("p",[s._v("需要注意的是，"),a("code",[s._v("OVERFLOW")]),s._v(" 子命令只会对紧随着它之后被执行的 "),a("code",[s._v("INCRBY")]),s._v(" 命令产生效果，这一效果将一直持续到与它一同被执行的下一个 "),a("code",[s._v("OVERFLOW")]),s._v(" 命令为止。在默认情况下，"),a("code",[s._v("INCRBY")]),s._v(" 命令使用 "),a("code",[s._v("WRAP")]),s._v(" 方式来处理溢出计算。")]),s._v(" "),a("p",[s._v("以下是一个使用 "),a("code",[s._v("OVERFLOW")]),s._v(" 子命令来控制溢出行为的例子：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" BITFIELD mykey incrby u2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" OVERFLOW SAT incrby u2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1021")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" BITFIELD mykey incrby u2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" OVERFLOW SAT incrby u2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1021")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" BITFIELD mykey incrby u2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" OVERFLOW SAT incrby u2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1021")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" BITFIELD mykey incrby u2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1001")]),s._v(" OVERFLOW SAT incrby u2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1021")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("--使用默认的 WRAP 方式处理溢出\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("--使用 SAT 方式处理溢出\n")])])]),a("p",[s._v("而以下则是一个因为 "),a("code",[s._v("OVERFLOW FAIL")]),s._v(" 行为而导致子命令返回空值的例子：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" BITFIELD mykey OVERFLOW FAIL incrby u2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1021")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nil"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),a("p",[a("strong",[s._v("作用")])]),s._v(" "),a("p",[a("code",[s._v("BITFIELD")]),s._v(" 命令的作用在于它能够将很多小的整数储存到一个长度较大的位图中，又或者将一个非常庞大的键分割为多个较小的键来进行储存，从而非常高效地使用内存，使得 Redis 能够得到更多不同的应用 ——特别是在实时分析领域："),a("code",[s._v("BITFIELD")]),s._v(" 能够以指定的方式对计算溢出进行控制的能力，使得它可以被应用于这一领域。")]),s._v(" "),a("p",[a("strong",[s._v("性能注意事项")])]),s._v(" "),a("p",[a("code",[s._v("BITFIELD")]),s._v(" 在一般情况下都是一个快速的命令，需要注意的是，访问一个长度较短的字符串的远端二进制位将引发一次内存分配操作，这一操作花费的时间可能会比命令访问已有的字符串花费的时间要长。")]),s._v(" "),a("p",[a("strong",[s._v("二进制位的排列")])]),s._v(" "),a("p",[a("code",[s._v("BITFIELD")]),s._v(" 把位图第一个字节偏移量 0 上的二进制位看作是 most significant 位，以此类推。举个例子，如果我们对一个已经预先被全部设置为 0 的位图进行设置，将它在偏移量 7 的值设置为 5 位无符号整数值 23 （二进制位为 "),a("code",[s._v("10111")]),s._v(" ），那么命令将生产出以下这个位图表示：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("+--------+--------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("00000001"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("01110000"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------+--------+\n")])])]),a("p",[s._v("当偏移量和整数长度与字节边界进行对齐时，"),a("code",[s._v("BITFIELD")]),s._v(" 表示二进制位的方式跟大端表示法（big endian）一致，但是在没有对齐的情况下，理解这些二进制位是如何进行排列也是非常重要的。")]),s._v(" "),a("p",[a("strong",[s._v("返回值")])]),s._v(" "),a("p",[a("code",[s._v("BITFIELD")]),s._v(" 命令的返回值是一个数组，数组中的每个元素对应一个被执行的子命令。需要注意的是，"),a("code",[s._v("OVERFLOW")]),s._v(" 子命令本身并不产生任何回复。")])]),s._v(" "),a("p",[a("strong",[s._v("4）实操")])]),s._v(" "),a("blockquote",[a("p",[s._v("模仿一个签到功能。")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 一个用于在 2021 年 8 月第一个签到了")]),s._v("\nSETBIT user:sign:5:202108 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查某个用户在 2021 年 8 月 3 号是否签到了")]),s._v("\nGETBIT user:sign:5:202108 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计某个用户在 2021 年 8 月签到了多少次")]),s._v("\nBITCOUNT user:sign:5:202108\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取某个用户在 2021 年 8 月首次签到")]),s._v("\nBITPOS user:sign:5:202108 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取某个用户在 2021 年 8 月首次漏签")]),s._v("\nBITPOS user:sign:5:202108 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取偏移量 0 的 3 位无符号整数")]),s._v("\nBITFIELD user:sign:5:202108 get u3 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])])]),a("Vssue")],1)}),[],!1,null,null,null);t.default=e.exports}}]);