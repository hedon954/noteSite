(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{503:function(s,t,a){"use strict";a.r(t);var n=a(47),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"_4-clickhouse-表引擎"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-clickhouse-表引擎"}},[s._v("#")]),s._v(" 4. ClickHouse 表引擎")]),s._v(" "),a("p",[s._v("表引擎是 ClickHouse 的一大特色。可以说， 表引擎决定了如何存储表的数据。包括:")]),s._v(" "),a("ul",[a("li",[s._v("数据的存储方式和位置，写到哪里以及从哪里读取数据；")]),s._v(" "),a("li",[s._v("支持哪些查询以及如何支持；")]),s._v(" "),a("li",[s._v("并发数据访问；")]),s._v(" "),a("li",[s._v("索引的使用（如果存在）；")]),s._v(" "),a("li",[s._v("是否可以执行多线程请求；")]),s._v(" "),a("li",[s._v("数据复制参数；")])]),s._v(" "),a("p",[s._v("表引擎的使用方式就是必须显式在创建表时定义该表使用的引擎，以及引擎使用的相关参数。")]),s._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[s._v("WARNING")]),s._v(" "),a("p",[s._v("特别注意：引擎的名称大小写敏感。")])]),s._v(" "),a("h2",{attrs:{id:"_4-1-tinylog"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-tinylog"}},[s._v("#")]),s._v(" 4.1 TinyLog")]),s._v(" "),a("p",[s._v("以列文件的形式保存在磁盘上，不支持索引，没有并发控制。一般保存少量数据的小表， 生产环境上作用有限。可以用于平时练习测试用。")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("CREATE TABLE t_tinylog "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" String, name String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("TinyLog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h2",{attrs:{id:"_4-2-memory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-memory"}},[s._v("#")]),s._v(" 4.2 Memory")]),s._v(" "),a("p",[s._v("内存引擎，数据以未压缩的原始形式直接保存在内存当中，服务器重启数据就会消失。 读写操作不会相互阻塞，不支持索引。简单查询下有非常非常高的性能表现（超过 10G/s）。")]),s._v(" "),a("p",[s._v("一般用到它的地方不多，除了用来测试，就是在需要非常高的性能，同时数据量又不太大（上限大概 1 亿行）的场景。")]),s._v(" "),a("h2",{attrs:{id:"_4-3-mergetree"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-mergetree"}},[s._v("#")]),s._v(" 4.3 MergeTree")]),s._v(" "),a("p",[s._v("ClickHouse 中最强大的表引擎当属 MergeTree 引擎及该系列（MergeTree）中的其他引擎，支持"),a("strong",[s._v("索引")]),s._v("和"),a("strong",[s._v("分区")]),s._v("，地位可以相当于 Innodb 之于 MySQL。而且基于 MergeTree， 还衍生除了很多小弟，也是非常有特色的引擎。")]),s._v(" "),a("h3",{attrs:{id:"_4-3-1-基本使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-基本使用"}},[s._v("#")]),s._v(" 4.3.1 基本使用")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("建表")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_mt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n   id UInt32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   sku_id String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   total_amount "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Decimal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n   create_time "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Datetime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MergeTree\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" toYYYYMMDD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("插入数据")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" t_order_mt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 11:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_004'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-02 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("查询数据")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t_order_mt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("输出：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SELECT *\nFROM t_order_mt\n\nQuery id: 2a5e5ca0-9597-4f57-acb9-1b9dbb0ffaa8\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-02 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" set. Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.331")]),s._v(" sec. \n")])])])])]),s._v(" "),a("h3",{attrs:{id:"_4-3-2-分区-partition-by-可选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-分区-partition-by-可选项"}},[s._v("#")]),s._v(" 4.3.2 分区 partition by（可选项）")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("作用")]),s._v(" "),a("p",[s._v("学过 hive 的应该都不陌生，分区的目的主要是降低扫描的范围，优化查询速度。")])]),s._v(" "),a("li",[a("p",[s._v("默认")]),s._v(" "),a("p",[s._v("如果不填分区，只会使用一个分区。")])]),s._v(" "),a("li",[a("p",[s._v("分区目录")]),s._v(" "),a("p",[s._v("MergeTree 是以列文件 + 索引文件 + 表定义文件组成的，但是如果设定了分区那么这些文件就会保存到不同的分区目录中。")])]),s._v(" "),a("li",[a("p",[s._v("并行")]),s._v(" "),a("p",[s._v("分区后，面对设计跨分区的查询统计，ClickHouse 会以分区为单位并行处理。")])]),s._v(" "),a("li",[a("p",[s._v("数据写入与分区合并")]),s._v(" "),a("p",[s._v("任何一个批次的数据写入都会产生一个临时分区，不会纳入任何一个已有的分区。写入后的某个时刻（大概 10-15 分钟后），ClickHouse 会自动执行合并操作（等不及也可以手动通过 optimize 执行），把临时分区的数据，合并到已有分区中。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPTIMIZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" xxx final"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("示例")]),s._v(" "),a("p",[s._v("在上述例子的基础上，再插入数据：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" t_order_mt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 11:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_004'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-02 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("查看数据，会发现它们并没有被纳入任何分区：")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("SELECT *\nFROM t_order_mt\n\nQuery id: dbec28cb-0ca0-4fd8-adc1-99ea4d8fe1ff\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":00:00 │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-01 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-02 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v("-06-02 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":00:00 │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" rows "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" set. Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.008")]),s._v(" sec. \n")])])]),a("p",[s._v("手动合并：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPTIMIZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_mt FINAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("再次查询：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t_order_mt\n\nQuery id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2386")]),s._v("e7a2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("f2c4"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v("b2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("b96d"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v("dfb3d202cd\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.004")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \n")])])])])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("补充：分区的存储")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost t_order_mt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/var/lib/clickhouse/data/default/t_order_mt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost t_order_mt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\ndrwxr-x--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("203")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 20200601_1_3_1\ndrwxr-x--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("203")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 20200602_2_4_1\ndrwxr-x--- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:39 detached\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:39 format_version.txt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost t_order_mt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd 20200601_1_3_1/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost 20200601_1_3_1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v("\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("260")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 checksums.txt\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("118")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 columns.txt\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 count.txt\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("217")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 data.bin\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("144")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 data.mrk3\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 default_compression_codec.txt\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 minmax_create_time.idx\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 partition.dat\n-rw-r----- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" clickhouse clickhouse   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 06:52 primary.idx\n")])])]),a("p",[s._v("分区的文件夹名称：PartitionId_MinBlockNum_MaxBlockNum_Level（分区值_最小分区块编号_最大分区块编号_合并层级）")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("PartitionId")]),s._v(" "),a("p",[s._v("数据分区 ID，数据分区规则由分区 ID 决定，分区 ID 由 PARTITION BY 分区键决定。根据分区键字段类型，ID生成规则可分为：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("未定义分区键")]),s._v(" "),a("p",[s._v("没有定义 PARTITION BY，默认生成一个目录名为 "),a("code",[s._v("all")]),s._v(" 的数据分区，所有数据均存放在 "),a("code",[s._v("all")]),s._v(" 目录下。")])]),s._v(" "),a("li",[a("p",[s._v("整型分区键")]),s._v(" "),a("p",[s._v("分区键为整型，那么直接用该整型值的字符串形式做为分区 ID。")])]),s._v(" "),a("li",[a("p",[s._v("日期类分区键")]),s._v(" "),a("p",[s._v("分区键为日期类型，或者可以转化成日期类型。")])]),s._v(" "),a("li",[a("p",[s._v("其他类型分区键")]),s._v(" "),a("p",[s._v("String、Float 类型等，通过 128 位的 "),a("code",[s._v("Hash")]),s._v(" 算法取其 Hash 值作为分区 ID。")])])])]),s._v(" "),a("li",[a("p",[s._v("MinBlockNum")]),s._v(" "),a("p",[s._v("最小分区块编号，自增类型，从 1 开始向上递增。每产生一个新的目录分区就向上递增一个数字。")])]),s._v(" "),a("li",[a("p",[s._v("MaxBlockNum")]),s._v(" "),a("p",[s._v("最大分区块编号，新创建的分区 MinBlockNum 等于 MaxBlockNum 的编号。")])]),s._v(" "),a("li",[a("p",[s._v("Level")]),s._v(" "),a("p",[s._v("合并的层级，被合并的次数。合并次数越多，层级值越大。")])])]),s._v(" "),a("p",[s._v("分区目录下的各个文件：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("bin 文件：数据文件")])]),s._v(" "),a("li",[a("p",[s._v("mrk 文件：标记文件")]),s._v(" "),a("p",[s._v("标记文件在 idx 索引文件和 bin 数据文件之间起到了桥梁作用。")]),s._v(" "),a("p",[s._v("以 mrk2 结尾的文件，表示该表启用了自适应索引间隔。")])]),s._v(" "),a("li",[a("p",[s._v("primary.idx 文件：主键索引文件，用于加快查询效率。")])]),s._v(" "),a("li",[a("p",[s._v("minmax_create_time.idx：分区键的最大最小值。")])]),s._v(" "),a("li",[a("p",[s._v("checksums.txt：校验文件，用于校验各个文件的正确性。存放各个文件的 size 以及 hash 值。")])])])]),s._v(" "),a("h3",{attrs:{id:"_4-3-3-主键-primary-key-可选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-3-主键-primary-key-可选项"}},[s._v("#")]),s._v(" 4.3.3 主键 primary key（可选项）")]),s._v(" "),a("p",[s._v("ClickHouse 中的主键，"),a("strong",[s._v("只提供数据的一级索引，没有提供唯一约束")]),s._v("。这意味着是可以存在相同的 primary key 的数据的。")]),s._v(" "),a("p",[s._v("主键的设定主要依据是查询语句中的 where 条件。")]),s._v(" "),a("p",[s._v("根据条件通过对主键进行某种形式的二分查找，能够定位到对应的 index granularity，避免了全表扫描。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("index granularity：直接翻译的话就是索引粒度，指在稀疏索引中两个相邻索引对应数据的间隔。")]),s._v(" "),a("p",[s._v("ClickHouse 中的 MergeTree 默认是 8192。官方不建议修改这个值，除非该列存在大量重复值，比如在一个分区中几万行才有一个不同数据。")])])]),s._v(" "),a("p",[s._v("ClickHouse 中的索引粒度采用的是：稀疏索引：")]),s._v(" "),a("img",{staticStyle:{zoom:"50%"},attrs:{src:"https://hedonspace.oss-cn-beijing.aliyuncs.com/img2/e6c9d24egy1gzvlvza2iej215k0lyq72.jpg",alt:"image-20220302161405388"}}),s._v(" "),a("p",[s._v("稀疏索引的好处就是可以用很少的索引数据，定位更多的数据，代价就是只能定位到索引粒度的第一行，然后再进行进行扫描。")]),s._v(" "),a("h3",{attrs:{id:"_4-3-4-排序-order-by-必选项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-4-排序-order-by-必选项"}},[s._v("#")]),s._v(" 4.3.4 排序 order by（必选项）")]),s._v(" "),a("p",[s._v("order by 设定了分区内的数据按照哪些字段顺序进行有序保存。")]),s._v(" "),a("p",[s._v("order by 是 MergeTree 中唯一一个必填项，甚至比 primary key 还重要，因为当用户不设置主键的情况，很多处理会依照 order by 的字段进行处理（比如去重和汇总）。")]),s._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),a("p",[s._v("主键必须是 order by 字段的前缀字段。")]),s._v(" "),a("p",[s._v("比如 order by 字段是 (id,sku_id)，那么主键必须是 id 或者 (id,sku_id)。")])]),s._v(" "),a("h3",{attrs:{id:"_4-3-5-二级索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-5-二级索引"}},[s._v("#")]),s._v(" 4.3.5 二级索引")]),s._v(" "),a("p",[s._v("二级索引就是对一级索引再次建索引。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_mt2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  id UInt32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tsku_id String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\ttotal_amount "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Decimal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  create_time "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Datetime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INDEX")]),s._v(" a total_amount "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TYPE")]),s._v(" minmax GRANULARITY "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MergeTree\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" toYYYYMMDD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("ul",[a("li",[s._v("INDEX a total_amount TYPE minmax GRANULARITY 5\n"),a("ul",[a("li",[s._v("INDEX：关键字")]),s._v(" "),a("li",[s._v("a：索引名称")]),s._v(" "),a("li",[s._v("total_amount：字段名")]),s._v(" "),a("li",[s._v("TYPE：关键字")]),s._v(" "),a("li",[s._v("minmax：二级索引类型")]),s._v(" "),a("li",[s._v("GRANULARITY：设定二级索引对于一级索引粒度的粒度")]),s._v(" "),a("li",[s._v("5：每 5 个建一个索引")])])])]),s._v(" "),a("h3",{attrs:{id:"_4-3-6-数据-ttl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-6-数据-ttl"}},[s._v("#")]),s._v(" 4.3.6 数据 TTL")]),s._v(" "),a("p",[s._v("TTL 即 Time To Live，MergeTree 提供了可以管理数据表或者列的生命周期的功能。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("列级")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_mt3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n  id UInt32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\tsku_id String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\ttotal_amount "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Decimal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" TTL create_time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interval")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SECOND")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n  create_time "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Datetime")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("MergeTree\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" toYYYYMMDD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("表级")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALTER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_mt3 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MODIFY")]),s._v(" TTL create_time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTERVAL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SECOND")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])])]),s._v(" "),a("h2",{attrs:{id:"_4-4-replacingmergetree"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-replacingmergetree"}},[s._v("#")]),s._v(" 4.4 ReplacingMergeTree")]),s._v(" "),a("p",[s._v("ReplacingMergeTree 是 MergeTree 的一个变种，它存储特性完全继承 MergeTree，只是多了一个 "),a("strong",[s._v("去重")]),s._v(" 的功能。 尽管 MergeTree 可以设置主键，但是 primary key 其实没有唯一约束的功能。如果你想处理掉重复的数据，可以借助这个 ReplacingMergeTree。")]),s._v(" "),a("h3",{attrs:{id:"_4-4-1-去重时机"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1-去重时机"}},[s._v("#")]),s._v(" 4.4.1 去重时机")]),s._v(" "),a("p",[s._v("数据的去重只会在合并的过程中出现。合并会在未知的时间在后台进行，所以你无法预先作出计划。有一些数据可能仍未被处理。")]),s._v(" "),a("h3",{attrs:{id:"_4-4-2-去重范围"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2-去重范围"}},[s._v("#")]),s._v(" 4.4.2 去重范围")]),s._v(" "),a("p",[s._v("如果表经过了分区，去重只会在分区内部进行去重，不能执行跨分区的去重。所以 ReplacingMergeTree 能力有限， ReplacingMergeTree 适用于在后台清除重复的数据以节省空间，但是它不保证没有重复的数据出现。")]),s._v(" "),a("h3",{attrs:{id:"_4-4-3-案例演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-3-案例演示"}},[s._v("#")]),s._v(" 4.4.3 案例演示")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("建表")]),s._v(" "),a("div",{staticClass:"language-SQL extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_rmt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" UInt32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("total_amount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Decimal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Datetime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ReplacingMergeTree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" toYYYYMMDD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("ReplacingMergeTree() 填入的参数为版本字段，重复数据保留版本字段值最大的。 如果不填版本字段，默认按照插入顺序保留最后一条。")])]),s._v(" "),a("li",[a("p",[s._v("插入数据")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" t_order_rmt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 11:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_004'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-02 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("执行第一次查询")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t_order_rmt\n\nQuery id: e6dbee31"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("efe"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("f71"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("895")]),s._v("a"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37")]),s._v("b0ffadc351\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.009")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("手动合并")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPTIMIZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_rmt FINAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("再执行一次查询")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t_order_rmt\n\nQuery id: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("095")]),s._v("b8af2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("db9"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v("b7"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("b4ed"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("84")]),s._v("d2a0827d96\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.003")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("结论")]),s._v(" "),a("ul",[a("li",[s._v("实际上是使用 "),a("code",[s._v("order by")]),s._v(" 字段作为唯一键；")]),s._v(" "),a("li",[s._v("去重不能跨分区；")]),s._v(" "),a("li",[s._v("只有同一批插入（新版本）或合并分区时才会进行去重；")]),s._v(" "),a("li",[s._v("认定重复的数据保留，版本字段值最大的；")]),s._v(" "),a("li",[s._v("如果版本字段相同则按插入顺序保留最后一笔；")])])])]),s._v(" "),a("h2",{attrs:{id:"_4-5-summingmergetree"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-summingmergetree"}},[s._v("#")]),s._v(" 4.5 SummingMergeTree")]),s._v(" "),a("p",[s._v("对于不查询明细，只关心以维度进行汇总聚合结果的场景。如果只使用普通的 MergeTree 的话，无论是存储空间的开销，还是查询时临时聚合的开销都比较大。")]),s._v(" "),a("p",[s._v("ClickHouse 为了这种场景，提供了一种能够“预聚合”的引擎 SummingMergeTree。")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("创建表")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_smt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" UInt32"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("total_amount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Decimal")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("`")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Datetime")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENGINE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" SummingMergeTree"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("total_amount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PARTITION")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" toYYYYMMDD"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("create_time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("PRIMARY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("KEY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ORDER")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("BY")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" sku_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("插入数据")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INSERT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INTO")]),s._v(" t_order_smt "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VALUES")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 11:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_004'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-01 13:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sku_002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'2020-06-02 12:00:00'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("执行第一次查询")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t_order_smt FINAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("p",[s._v("输出：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t_order_smt\n\nQuery id: ea1c76ba"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("ce"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("f91"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("aa2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08042")]),s._v("f0d2fad\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.003")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \n")])])])]),s._v(" "),a("li",[a("p",[s._v("手动合并")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OPTIMIZE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TABLE")]),s._v(" t_order_smt FINAL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("li",[a("p",[s._v("再执行一次查询")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" t_order_smt\n\nQuery id: ea1c76ba"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v("ce"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("f91"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("aa2"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("08042")]),s._v("f0d2fad\n\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" │ sku_001 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16000.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_004 │      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("01")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n┌──id─┬─sku_id──┬─total_amount─┬─────────create_time─┐\n│ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("102")]),s._v(" │ sku_002 │       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600.00")]),s._v(" │ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),s._v(" │\n└─────┴─────────┴──────────────┴─────────────────────┘\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" Elapsed: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.003")]),s._v(" sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" \n")])])])]),s._v(" "),a("li",[a("p",[s._v("结论")]),s._v(" "),a("ul",[a("li",[s._v("以 SummingMergeTree() 中指定的列作为汇总数据列；")]),s._v(" "),a("li",[s._v("可以填写多列，必须是数字列，如果不填，以所有非维度列且为数字列的字段为汇总数据列；")]),s._v(" "),a("li",[s._v("以 order by 的列为准，作为维度列；")]),s._v(" "),a("li",[s._v("其他的列按插入顺序保留第一行；")]),s._v(" "),a("li",[s._v("不在一个分区的数据不会被聚合；")]),s._v(" "),a("li",[s._v("只有在同一批次插入（新版本）或分片合并时才会进行聚合；")])])]),s._v(" "),a("li",[a("p",[s._v("使用场景")]),s._v(" "),a("p",[s._v("设计聚合表的话，唯一键值、流水号可以去掉，所有字段全部是维度、度量或者时间戳。")])]),s._v(" "),a("li",[a("p",[s._v("问题")]),s._v(" "),a("p",[s._v("能不能直接执行以下 SQL 得到汇总值?")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" total_amount "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" XXX "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" province_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("’’ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" create_date"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("’xxx’\n")])])]),a("p",[s._v("不行，可能会包含一些还没来得及聚合的临时明细。")]),s._v(" "),a("p",[s._v("如果要是获取汇总值，还是需要使用 sum 进行聚合，这样效率会有一定的提高，但本身 ClickHouse 是列式存储的，效率提升有限，不会特别明显。")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("SUM")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("total_amount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" province_name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("’’ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("AND")]),s._v(" create_date"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("‘xxx’\n")])])])])]),s._v(" "),a("Vssue")],1)}),[],!1,null,null,null);t.default=e.exports}}]);